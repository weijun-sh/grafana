(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9782],{"./public/app/features/dashboard/dashgrid/SeriesVisibilityConfigFactory.ts":(e,t,s)=>{"use strict";s.d(t,{N:()=>(function(e,t,s,i){const{overrides:r}=s,u=e,h=r.findIndex(n);if(h<0){if(t===o.SeriesVisibilityChangeMode.ToggleSelection){const e=a([u]);return Object.assign({},s,{overrides:[...s.overrides,e]})}const e=p(i,u),r=a(e);return Object.assign({},s,{overrides:[...s.overrides,r]})}const g=Array.from(r),[m]=g.splice(h,1);if(t===o.SeriesVisibilityChangeMode.ToggleSelection){const e=c(m);if(e[0]===u&&1===e.length)return Object.assign({},s,{overrides:g});const t=a([u]);return Object.assign({},s,{overrides:[...g,t]})}const f=l(m,u);if(d(f,i))return Object.assign({},s,{overrides:g});return Object.assign({},s,{overrides:[...g,f]})})});var i=s("./packages/grafana-data/src/index.ts"),o=s("./packages/grafana-ui/src/index.ts");const r="hideSeriesFrom",n=(0,i.isSystemOverrideWithRef)(r);function a(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.ByNamesMatcherMode.exclude,o=arguments.length>2?arguments[2]:void 0;return o=null!==(t=o)&&void 0!==t?t:{id:"custom.hideFrom",value:{viz:!0,legend:!1,tooltip:!1}},{__systemRef:r,matcher:{id:i.FieldMatcherID.byNames,options:{mode:s,names:e,prefix:s===i.ByNamesMatcherMode.exclude?"All except:":void 0,readOnly:!0}},properties:[Object.assign({},o,{value:{viz:!0,legend:!1,tooltip:!1}})]}}const l=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.ByNamesMatcherMode.exclude;const o=e.properties.find(e=>"custom.hideFrom"===e.id),r=c(e),n=r.findIndex(e=>e===t);return n<0?r.push(t):r.splice(n,1),a(r,s,o)},c=e=>{var t;const s=null===(t=e.matcher.options)||void 0===t?void 0:t.names;return Array.isArray(s)?[...s]:[]},d=(e,t)=>c(e).length===p(t).length,p=(e,t)=>{const s=new Set;for(const o of e)for(const r of o.fields){if(r.type!==i.FieldType.number)continue;const n=(0,i.getFieldDisplayName)(r,o,e);n!==t&&s.add(n)}return Array.from(s)}},"./public/app/features/explore/Wrapper.tsx":(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>Ys});var i=s("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),o=s("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),r=s("./packages/grafana-runtime/src/index.ts"),n=s("./packages/grafana-ui/src/index.ts"),a=s("./public/app/types/explore.ts"),l=s("./public/app/core/components/Branding/Branding.tsx"),c=s("./public/app/core/selectors/navModel.ts"),d=s("./.yarn/__virtual__/kbar-virtual-9b2cef4f82/0/cache/kbar-npm-0.1.0-beta.33-287f85404a-545720900a.zip/node_modules/kbar/lib/index.js"),p=s("./public/app/features/explore/state/main.ts"),u=s("./public/app/features/explore/state/query.ts"),h=s("./public/app/features/explore/state/selectors.ts");const g=e=>{let{exploreIdLeft:t,exploreIdRight:s}=e;const[r,n]=(0,i.useState)([]),{query:a}=(0,d.useKBar)(),l=(0,o.useDispatch)(),c=(0,o.useSelector)(h.p);return(0,i.useEffect)(()=>{const e={name:"Explore",priority:d.Priority.HIGH+1},i=[];c?(i.push({id:"explore/run-query-left",name:"Run query (left)",keywords:"query left",perform:()=>{l((0,u.aA)(t))},section:e}),s&&(i.push({id:"explore/run-query-right",name:"Run query (right)",keywords:"query right",perform:()=>{l((0,u.aA)(s))},section:e}),i.push({id:"explore/split-view-close-left",name:"Close split view left",keywords:"split",perform:()=>{l((0,p.YV)(t))},section:e}),i.push({id:"explore/split-view-close-right",name:"Close split view right",keywords:"split",perform:()=>{l((0,p.YV)(s))},section:e}))):(i.push({id:"explore/run-query",name:"Run query",keywords:"query",perform:()=>{l((0,u.aA)(t))},section:e}),i.push({id:"explore/split-view-open",name:"Open split view",keywords:"split",perform:()=>{l((0,p.bW)())},section:e})),n(i)},[t,s,c,a,l]),(0,d.useRegisterActions)(a?r:[],[r,a]),null};var m=s("./.yarn/cache/memoize-one-npm-6.0.0-8b2a2cd020-f185ea69f7.zip/node_modules/memoize-one/dist/memoize-one.esm.js"),f=s("./packages/grafana-data/src/index.ts"),y=s("./packages/grafana-e2e-selectors/src/index.ts"),v=s("./public/app/core/store.ts"),x=s("./public/app/core/utils/explore.ts"),b=s("./public/app/features/profile/state/selectors.ts"),w=s("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),S=s("./.yarn/__virtual__/react-virtualized-auto-sizer-virtual-b5ab366cb0/0/cache/react-virtualized-auto-sizer-npm-1.0.6-50869b8392-81270e9d32.zip/node_modules/react-virtualized-auto-sizer/dist/index.esm.js"),j=s("./.yarn/cache/redux-npm-4.1.2-04cdbe7a08-6a839cee5b.zip/node_modules/redux/es/redux.js"),R=s("./packages/grafana-ui/src/components/Table/types.ts"),C=s("./public/app/core/app_events.ts"),T=s("./public/app/plugins/panel/nodeGraph/utils.ts"),z=s("./public/app/types/events.ts"),I=s("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),k=s("./.yarn/__virtual__/react-use-virtual-00326e70ba/0/cache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/usePrevious.js"),F=s("./packages/grafana-schema/src/index.ts"),L=s("./public/app/plugins/panel/timeseries/config.ts"),O=s("./public/app/features/dashboard/dashgrid/SeriesVisibilityConfigFactory.ts"),N=s("./.yarn/cache/immer-npm-9.0.12-e8cd7358fa-bcbec6d76d.zip/node_modules/immer/dist/immer.esm.js");var D=s("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const $=20;function P(e){let{data:t,height:s,width:o,timeZone:a,absoluteRange:l,onChangeTime:c,loadingState:d,annotations:p,onHiddenSeriesChanged:u,splitOpenFn:h,graphStyle:g,tooltipDisplayMode:m=F.f3.Single}=e;const y=(0,n.useTheme2)(),[v,x]=(0,i.useState)(!1),[b,S]=(0,i.useState)(1),j=(0,k.Z)(t),R=(0,i.useRef)(0);t&&j&&!(0,f.compareArrayValues)(j,t,f.compareDataFrameStructures)&&R.current++;const T=b+R.current,[z,P]=(0,i.useState)({defaults:{color:{mode:f.FieldColorModeId.PaletteClassic},custom:{drawStyle:F.l8.Line,fillOpacity:0,pointSize:5}},overrides:[]}),A=(0,n.useStyles2)(E),M={from:(0,f.dateTime)(l.from),to:(0,f.dateTime)(l.to),raw:{from:(0,f.dateTime)(l.from),to:(0,f.dateTime)(l.to)}},B=(0,i.useMemo)(()=>{const e=(0,f.createFieldConfigRegistry)((0,L.F)(L.r),"Explore"),s=function(e,t){return(0,N.ZP)(e,e=>{void 0===e.defaults.custom&&(e.defaults.custom={});const{custom:s}=e.defaults;switch(void 0===s.stacking&&(s.stacking={group:"A"}),t){case"lines":s.drawStyle=F.l8.Line,s.stacking.mode=F.o0.None,s.fillOpacity=0;break;case"bars":s.drawStyle=F.l8.Bars,s.stacking.mode=F.o0.None,s.fillOpacity=100;break;case"points":s.drawStyle=F.l8.Points,s.stacking.mode=F.o0.None,s.fillOpacity=0;break;case"stacked_lines":s.drawStyle=F.l8.Line,s.stacking.mode=F.o0.Normal,s.fillOpacity=100;break;case"stacked_bars":s.drawStyle=F.l8.Bars,s.stacking.mode=F.o0.Normal,s.fillOpacity=100;break;default:throw new Error(`Invalid graph-style: ${t}`)}})}(z,g);return(0,f.applyFieldOverrides)({fieldConfig:s,data:t,timeZone:a,replaceVariables:e=>e,theme:y,fieldConfigRegistry:e})},[z,g,t,a,y]);(0,i.useEffect)(()=>{if(u){const e=[];B.forEach(t=>{t.fields.map(e=>{var t,s,i;return null===(t=e.config)||void 0===t?void 0:null===(s=t.custom)||void 0===s?void 0:null===(i=s.hideFrom)||void 0===i?void 0:i.viz}).every(I.identity)&&e.push((0,f.getFrameDisplayName)(t))}),u(e)}},[B,u]);const H=v?B:B.slice(0,$),q={eventBus:C.Z,onSplitOpen:h,onToggleSeriesVisibility(e,s){S(e=>e+1),P((0,O.N)(e,s,z,t))}};return(0,D.jsxs)(n.PanelContextProvider,{value:q,children:[B.length>$&&!v&&(0,D.jsxs)("div",{className:(0,w.cx)([A.timeSeriesDisclaimer]),children:[(0,D.jsx)(n.Icon,{className:A.disclaimerIcon,name:"exclamation-triangle"}),`Showing only ${$} time series. `,(0,D.jsx)("span",{className:(0,w.cx)([A.showAllTimeSeries]),onClick:()=>{R.current++,x(!0)},children:`Show all ${B.length}`})]}),(0,D.jsx)(r.PanelRenderer,{data:{series:H,timeRange:M,structureRev:T,state:d,annotations:p},pluginId:"timeseries",title:"",width:o,height:s,onChangeTimeRange:c,timeZone:a,options:{tooltip:{mode:m,sort:F.As.None},legend:{displayMode:F.jK.List,placement:"bottom",calcs:[]}}})]})}const E=e=>({timeSeriesDisclaimer:w.css`
    label: time-series-disclaimer;
    width: 300px;
    margin: ${e.spacing(1)} auto;
    padding: 10px 0;
    border-radius: ${e.spacing(2)};
    text-align: center;
    background-color: ${e.colors.background.primary};
  `,disclaimerIcon:w.css`
    label: disclaimer-icon;
    color: ${e.colors.warning.main};
    margin-right: ${e.spacing(.5)};
  `,showAllTimeSeries:w.css`
    label: show-all-time-series;
    cursor: pointer;
    color: ${e.colors.text.link};
  `});var A=s("./public/app/types/index.ts");const M=A.f0.map(e=>({value:e,label:e[0].toUpperCase()+e.slice(1).replace(/_/," ")})),B=(0,w.css)({display:"flex",justifyContent:"space-between"});function H(e){const{graphStyle:t,onChangeGraphStyle:s}=e;return(0,D.jsxs)("div",{className:B,children:["Graph",(0,D.jsx)(n.RadioButtonGroup,{size:"sm",options:M,value:t,onChange:s})]})}var q=function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),_=function(){return(_=Object.assign||function(e){for(var t,s=1,i=arguments.length;s<i;s++)for(var o in t=arguments[s])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Z={top:{width:"100%",height:"10px",top:"-5px",left:"0px",cursor:"row-resize"},right:{width:"10px",height:"100%",top:"0px",right:"-5px",cursor:"col-resize"},bottom:{width:"100%",height:"10px",bottom:"-5px",left:"0px",cursor:"row-resize"},left:{width:"10px",height:"100%",top:"0px",left:"-5px",cursor:"col-resize"},topRight:{width:"20px",height:"20px",position:"absolute",right:"-10px",top:"-10px",cursor:"ne-resize"},bottomRight:{width:"20px",height:"20px",position:"absolute",right:"-10px",bottom:"-10px",cursor:"se-resize"},bottomLeft:{width:"20px",height:"20px",position:"absolute",left:"-10px",bottom:"-10px",cursor:"sw-resize"},topLeft:{width:"20px",height:"20px",position:"absolute",left:"-10px",top:"-10px",cursor:"nw-resize"}},Q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onMouseDown=function(e){t.props.onResizeStart(e,t.props.direction)},t.onTouchStart=function(e){t.props.onResizeStart(e,t.props.direction)},t}return q(t,e),t.prototype.render=function(){return i.createElement("div",{className:this.props.className||"",style:_(_({position:"absolute",userSelect:"none"},Z[this.props.direction]),this.props.replaceStyles||{}),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart},this.props.children)},t}(i.PureComponent),W=s("./.yarn/cache/fast-memoize-npm-2.5.2-f42a7c6940-79fa759719.zip/node_modules/fast-memoize/src/index.js"),V=s.n(W),U=function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),G=function(){return(G=Object.assign||function(e){for(var t,s=1,i=arguments.length;s<i;s++)for(var o in t=arguments[s])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},K={width:"auto",height:"auto"},Y=V()(function(e,t,s){return Math.max(Math.min(e,s),t)}),J=V()(function(e,t){return Math.round(e/t)*t}),X=V()(function(e,t){return new RegExp(e,"i").test(t)}),ee=function(e){return Boolean(e.touches&&e.touches.length)},te=V()(function(e,t,s){void 0===s&&(s=0);var i=t.reduce(function(s,i,o){return Math.abs(i-e)<Math.abs(t[s]-e)?o:s},0),o=Math.abs(t[i]-e);return 0===s||o<s?t[i]:e}),se=V()(function(e,t){return e.substr(e.length-t.length,t.length)===t}),ie=V()(function(e){return"auto"===(e=e.toString())?e:se(e,"px")?e:se(e,"%")?e:se(e,"vh")?e:se(e,"vw")?e:se(e,"vmax")?e:se(e,"vmin")?e:e+"px"}),oe=function(e,t,s,i){if(e&&"string"==typeof e){if(se(e,"px"))return Number(e.replace("px",""));if(se(e,"%"))return t*(Number(e.replace("%",""))/100);if(se(e,"vw"))return s*(Number(e.replace("vw",""))/100);if(se(e,"vh"))return i*(Number(e.replace("vh",""))/100)}return e},re=V()(function(e,t,s,i,o,r,n){return i=oe(i,e.width,t,s),o=oe(o,e.height,t,s),r=oe(r,e.width,t,s),n=oe(n,e.height,t,s),{maxWidth:void 0===i?void 0:Number(i),maxHeight:void 0===o?void 0:Number(o),minWidth:void 0===r?void 0:Number(r),minHeight:void 0===n?void 0:Number(n)}}),ne=["as","style","className","grid","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],ae="__resizable_base__",le=function(e){function t(t){var s=e.call(this,t)||this;return s.ratio=1,s.resizable=null,s.parentLeft=0,s.parentTop=0,s.resizableLeft=0,s.resizableRight=0,s.resizableTop=0,s.resizableBottom=0,s.targetLeft=0,s.targetTop=0,s.appendBase=function(){if(!s.resizable||!s.window)return null;var e=s.parentNode;if(!e)return null;var t=s.window.document.createElement("div");return t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.transform="scale(0, 0)",t.style.left="0",t.style.flex="0 0 100%",t.classList?t.classList.add(ae):t.className+=ae,e.appendChild(t),t},s.removeBase=function(e){var t=s.parentNode;t&&t.removeChild(e)},s.ref=function(e){e&&(s.resizable=e)},s.state={isResizing:!1,width:void 0===(s.propsSize&&s.propsSize.width)?"auto":s.propsSize&&s.propsSize.width,height:void 0===(s.propsSize&&s.propsSize.height)?"auto":s.propsSize&&s.propsSize.height,direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},s.onResizeStart=s.onResizeStart.bind(s),s.onMouseMove=s.onMouseMove.bind(s),s.onMouseUp=s.onMouseUp.bind(s),s}return U(t,e),Object.defineProperty(t.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return this.resizable&&this.resizable.ownerDocument?this.resizable.ownerDocument.defaultView:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||K},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){var e=0,t=0;if(this.resizable&&this.window){var s=this.resizable.offsetWidth,i=this.resizable.offsetHeight,o=this.resizable.style.position;"relative"!==o&&(this.resizable.style.position="relative"),e="auto"!==this.resizable.style.width?this.resizable.offsetWidth:s,t="auto"!==this.resizable.style.height?this.resizable.offsetHeight:i,this.resizable.style.position=o}return{width:e,height:t}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sizeStyle",{get:function(){var e=this,t=this.props.size,s=function(t){if(void 0===e.state[t]||"auto"===e.state[t])return"auto";if(e.propsSize&&e.propsSize[t]&&se(e.propsSize[t].toString(),"%")){if(se(e.state[t].toString(),"%"))return e.state[t].toString();var s=e.getParentSize();return Number(e.state[t].toString().replace("px",""))/s[t]*100+"%"}return ie(e.state[t])};return{width:t&&void 0!==t.width&&!this.state.isResizing?ie(t.width):s("width"),height:t&&void 0!==t.height&&!this.state.isResizing?ie(t.height):s("height")}},enumerable:!1,configurable:!0}),t.prototype.getParentSize=function(){if(!this.parentNode)return this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0};var e=this.appendBase();if(!e)return{width:0,height:0};var t=!1,s=this.parentNode.style.flexWrap;"wrap"!==s&&(t=!0,this.parentNode.style.flexWrap="wrap"),e.style.position="relative",e.style.minWidth="100%",e.style.minHeight="100%";var i={width:e.offsetWidth,height:e.offsetHeight};return t&&(this.parentNode.style.flexWrap=s),this.removeBase(e),i},t.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},t.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},t.prototype.componentDidMount=function(){if(this.resizable&&this.window){var e=this.window.getComputedStyle(this.resizable);this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:"auto"!==e.flexBasis?e.flexBasis:void 0})}},t.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},t.prototype.createSizeForCssProperty=function(e,t){var s=this.propsSize&&this.propsSize[t];return"auto"!==this.state[t]||this.state.original[t]!==e||void 0!==s&&"auto"!==s?e:"auto"},t.prototype.calculateNewMaxFromBoundary=function(e,t){var s,i,o=this.props.boundsByDirection,r=this.state.direction,n=o&&X("left",r),a=o&&X("top",r);if("parent"===this.props.bounds){var l=this.parentNode;l&&(s=n?this.resizableRight-this.parentLeft:l.offsetWidth+(this.parentLeft-this.resizableLeft),i=a?this.resizableBottom-this.parentTop:l.offsetHeight+(this.parentTop-this.resizableTop))}else"window"===this.props.bounds?this.window&&(s=n?this.resizableRight:this.window.innerWidth-this.resizableLeft,i=a?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(s=n?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),i=a?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop));return s&&Number.isFinite(s)&&(e=e&&e<s?e:s),i&&Number.isFinite(i)&&(t=t&&t<i?t:i),{maxWidth:e,maxHeight:t}},t.prototype.calculateNewSizeFromDirection=function(e,t){var s=this.props.scale||1,i=this.props.resizeRatio||1,o=this.state,r=o.direction,n=o.original,a=this.props,l=a.lockAspectRatio,c=a.lockAspectRatioExtraHeight,d=a.lockAspectRatioExtraWidth,p=n.width,u=n.height,h=c||0,g=d||0;return X("right",r)&&(p=n.width+(e-n.x)*i/s,l&&(u=(p-g)/this.ratio+h)),X("left",r)&&(p=n.width-(e-n.x)*i/s,l&&(u=(p-g)/this.ratio+h)),X("bottom",r)&&(u=n.height+(t-n.y)*i/s,l&&(p=(u-h)*this.ratio+g)),X("top",r)&&(u=n.height-(t-n.y)*i/s,l&&(p=(u-h)*this.ratio+g)),{newWidth:p,newHeight:u}},t.prototype.calculateNewSizeFromAspectRatio=function(e,t,s,i){var o=this.props,r=o.lockAspectRatio,n=o.lockAspectRatioExtraHeight,a=o.lockAspectRatioExtraWidth,l=void 0===i.width?10:i.width,c=void 0===s.width||s.width<0?e:s.width,d=void 0===i.height?10:i.height,p=void 0===s.height||s.height<0?t:s.height,u=n||0,h=a||0;if(r){var g=(d-u)*this.ratio+h,m=(p-u)*this.ratio+h,f=(l-h)/this.ratio+u,y=(c-h)/this.ratio+u,v=Math.max(l,g),x=Math.min(c,m),b=Math.max(d,f),w=Math.min(p,y);e=Y(e,v,x),t=Y(t,b,w)}else e=Y(e,l,c),t=Y(t,d,p);return{newWidth:e,newHeight:t}},t.prototype.setBoundingClientRect=function(){if("parent"===this.props.bounds){var e=this.parentNode;if(e){var t=e.getBoundingClientRect();this.parentLeft=t.left,this.parentTop=t.top}}if(this.props.bounds&&"string"!=typeof this.props.bounds){var s=this.props.bounds.getBoundingClientRect();this.targetLeft=s.left,this.targetTop=s.top}if(this.resizable){var i=this.resizable.getBoundingClientRect(),o=i.left,r=i.top,n=i.right,a=i.bottom;this.resizableLeft=o,this.resizableRight=n,this.resizableTop=r,this.resizableBottom=a}},t.prototype.onResizeStart=function(e,t){if(this.resizable&&this.window){var s,i=0,o=0;if(e.nativeEvent&&function(e){return Boolean((e.clientX||0===e.clientX)&&(e.clientY||0===e.clientY))}(e.nativeEvent)?(i=e.nativeEvent.clientX,o=e.nativeEvent.clientY):e.nativeEvent&&ee(e.nativeEvent)&&(i=e.nativeEvent.touches[0].clientX,o=e.nativeEvent.touches[0].clientY),this.props.onResizeStart)if(this.resizable)if(!1===this.props.onResizeStart(e,t,this.resizable))return;this.props.size&&(void 0!==this.props.size.height&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),void 0!==this.props.size.width&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.ratio="number"==typeof this.props.lockAspectRatio?this.props.lockAspectRatio:this.size.width/this.size.height;var r=this.window.getComputedStyle(this.resizable);if("auto"!==r.flexBasis){var n=this.parentNode;if(n){var a=this.window.getComputedStyle(n).flexDirection;this.flexDir=a.startsWith("row")?"row":"column",s=r.flexBasis}}this.setBoundingClientRect(),this.bindEvents();var l={original:{x:i,y:o,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:G(G({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(e.target).cursor||"auto"}),direction:t,flexBasis:s};this.setState(l)}},t.prototype.onMouseMove=function(e){if(this.state.isResizing&&this.resizable&&this.window){if(this.window.TouchEvent&&ee(e))try{e.preventDefault(),e.stopPropagation()}catch(e){}var t=this.props,s=t.maxWidth,i=t.maxHeight,o=t.minWidth,r=t.minHeight,n=ee(e)?e.touches[0].clientX:e.clientX,a=ee(e)?e.touches[0].clientY:e.clientY,l=this.state,c=l.direction,d=l.original,p=l.width,u=l.height,h=this.getParentSize(),g=re(h,this.window.innerWidth,this.window.innerHeight,s,i,o,r);s=g.maxWidth,i=g.maxHeight,o=g.minWidth,r=g.minHeight;var m=this.calculateNewSizeFromDirection(n,a),f=m.newHeight,y=m.newWidth,v=this.calculateNewMaxFromBoundary(s,i);this.props.snap&&this.props.snap.x&&(y=te(y,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(f=te(f,this.props.snap.y,this.props.snapGap));var x=this.calculateNewSizeFromAspectRatio(y,f,{width:v.maxWidth,height:v.maxHeight},{width:o,height:r});if(y=x.newWidth,f=x.newHeight,this.props.grid){var b=J(y,this.props.grid[0]),w=J(f,this.props.grid[1]),S=this.props.snapGap||0;y=0===S||Math.abs(b-y)<=S?b:y,f=0===S||Math.abs(w-f)<=S?w:f}var j={width:y-d.width,height:f-d.height};if(p&&"string"==typeof p)if(se(p,"%"))y=y/h.width*100+"%";else if(se(p,"vw")){y=y/this.window.innerWidth*100+"vw"}else if(se(p,"vh")){y=y/this.window.innerHeight*100+"vh"}if(u&&"string"==typeof u)if(se(u,"%"))f=f/h.height*100+"%";else if(se(u,"vw")){f=f/this.window.innerWidth*100+"vw"}else if(se(u,"vh")){f=f/this.window.innerHeight*100+"vh"}var R={width:this.createSizeForCssProperty(y,"width"),height:this.createSizeForCssProperty(f,"height")};"row"===this.flexDir?R.flexBasis=R.width:"column"===this.flexDir&&(R.flexBasis=R.height),this.setState(R),this.props.onResize&&this.props.onResize(e,c,this.resizable,j)}},t.prototype.onMouseUp=function(e){var t=this.state,s=t.isResizing,i=t.direction,o=t.original;if(s&&this.resizable){var r={width:this.size.width-o.width,height:this.size.height-o.height};this.props.onResizeStop&&this.props.onResizeStop(e,i,this.resizable,r),this.props.size&&this.setState(this.props.size),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:G(G({},this.state.backgroundStyle),{cursor:"auto"})})}},t.prototype.updateSize=function(e){this.setState({width:e.width,height:e.height})},t.prototype.renderResizer=function(){var e=this,t=this.props,s=t.enable,o=t.handleStyles,r=t.handleClasses,n=t.handleWrapperStyle,a=t.handleWrapperClass,l=t.handleComponent;if(!s)return null;var c=Object.keys(s).map(function(t){return!1!==s[t]?i.createElement(Q,{key:t,direction:t,onResizeStart:e.onResizeStart,replaceStyles:o&&o[t],className:r&&r[t]},l&&l[t]?l[t]:null):null});return i.createElement("div",{className:a,style:n},c)},t.prototype.render=function(){var e=this,t=Object.keys(this.props).reduce(function(t,s){return-1!==ne.indexOf(s)?t:(t[s]=e.props[s],t)},{}),s=G(G(G({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0});this.state.flexBasis&&(s.flexBasis=this.state.flexBasis);var o=this.props.as||"div";return i.createElement(o,G({ref:this.ref,style:s,className:this.props.className},t),this.state.isResizing&&i.createElement("div",{style:this.state.backgroundStyle}),this.props.children,this.renderResizer())},t.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},t}(i.PureComponent);const ce=(0,n.stylesFactory)(e=>({container:w.css`
      position: fixed !important;
      bottom: 0;
      background: ${e.colors.background.primary};
      border-top: 1px solid ${e.colors.border.weak};
      margin: ${e.spacing(0,-2,0,-2)};
      box-shadow: ${e.shadows.z3};
      z-index: ${e.zIndex.sidemenu};
    `,drawerActive:w.css`
      opacity: 1;
      animation: 0.5s ease-out ${(e=>w.keyframes`
  0% {
    transform: translateY(${e.components.horizontalDrawer.defaultHeight}px);
  }

  100% {
    transform: translateY(0px);
  }
`)(e)};
    `,rzHandle:w.css`
      background: ${e.colors.secondary.main};
      transition: 0.3s background ease-in-out;
      position: relative;
      width: 200px !important;
      height: 7px !important;
      left: calc(50% - 100px) !important;
      top: -4px !important;
      cursor: grab;
      border-radius: 4px;
      &:hover {
        background: ${e.colors.secondary.shade};
      }
    `}));function de(e){const{width:t,children:s,onResize:i}=e,o=(0,n.useTheme2)(),r=ce(o),a=`${t+31.5}px`;return(0,D.jsx)(le,{className:(0,w.cx)(r.container,r.drawerActive),defaultSize:{width:a,height:`${o.components.horizontalDrawer.defaultHeight}px`},handleClasses:{top:r.rzHandle},enable:{top:!0,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},maxHeight:"100vh",maxWidth:a,minWidth:a,onResize:i,children:s})}var pe=s("./public/app/features/inspector/InspectDataTab.tsx"),ue=s("./public/app/features/inspector/InspectErrorTab.tsx"),he=s("./public/app/features/inspector/InspectJSONTab.tsx"),ge=s("./public/app/features/inspector/InspectStatsTab.tsx"),me=s("./public/app/features/inspector/QueryInspector.tsx");const fe={runQueries:u.aA},ye=(0,o.connect)(function(e,t){let{exploreId:s}=t;const i=e.explore[s],{loading:o,queryResponse:r}=i;return{loading:o,queryResponse:r}},fe)(function(e){var t;const{loading:s,width:i,onClose:o,queryResponse:r,timeZone:a}=e,l=(null===r||void 0===r?void 0:r.series)||[],c=null===r||void 0===r?void 0:r.error,d={label:"Stats",value:"stats",icon:"chart-line",content:(0,D.jsx)(ge.f,{data:r,timeZone:null===r||void 0===r?void 0:null===(t=r.request)||void 0===t?void 0:t.timezone})},p={label:"JSON",value:"json",icon:"brackets-curly",content:(0,D.jsx)(he.W,{data:r,onClose:o})},u={label:"Data",value:"data",icon:"database",content:(0,D.jsx)(pe.E,{data:l,isLoading:s,options:{withTransforms:!1,withFieldConfig:!1},timeZone:a})},h=[d,{label:"Query",value:"query",icon:"info-circle",content:(0,D.jsx)(me.D,{data:l,onRefreshQuery:()=>e.runQueries(e.exploreId)})},p,u];if(c){const e={label:"Error",value:"error",icon:"exclamation-triangle",content:(0,D.jsx)(ue.l,{error:c})};h.push(e)}return(0,D.jsx)(de,{width:i,children:(0,D.jsx)(n.TabbedContainer,{tabs:h,onClose:o,closeIconTooltip:"Close query inspector"})})});var ve=s("./public/app/core/utils/shortLinks.ts"),xe=s("./public/app/features/dashboard/components/DashNav/DashNavButton.tsx"),be=s("./public/app/features/dashboard/services/TimeSrv.ts"),we=s("./public/app/features/profile/state/reducers.ts"),Se=s("./public/app/core/components/TimePicker/TimePickerWithHistory.tsx"),je=s("./public/app/core/utils/timePicker.ts");function Re(e){const{onClick:t,isSynced:s}=e;return(0,D.jsx)(n.Tooltip,{content:()=>{const{isSynced:t}=e,s=t?"Unsync all views":"Sync all views to this time range";return(0,D.jsx)(D.Fragment,{children:s})},placement:"bottom",children:(0,D.jsx)(n.ToolbarButton,{icon:"link",variant:s?"active":"default","aria-label":s?"Synced times":"Unsynced times",onClick:t})})}function Ce(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class Te extends i.Component{constructor(){super(...arguments),Ce(this,"onMoveTimePicker",e=>{const{range:t,onChangeTime:s,timeZone:i}=this.props,{from:o,to:r}=(0,je.e)(e,t);s({from:(0,f.dateTimeForTimeZone)(i,o),to:(0,f.dateTimeForTimeZone)(i,r)})}),Ce(this,"onMoveForward",()=>this.onMoveTimePicker(1)),Ce(this,"onMoveBack",()=>this.onMoveTimePicker(-1)),Ce(this,"onChangeTimePicker",e=>{const t=f.dateMath.isMathString(e.raw.from)?e.raw.from:e.from,s=f.dateMath.isMathString(e.raw.to)?e.raw.to:e.to;this.props.onChangeTime({from:t,to:s})}),Ce(this,"onZoom",()=>{const{range:e,onChangeTime:t,timeZone:s}=this.props,{from:i,to:o}=(0,je.h)(e,2);t({from:(0,f.dateTimeForTimeZone)(s,i),to:(0,f.dateTimeForTimeZone)(s,o)})})}render(){const{range:e,timeZone:t,fiscalYearStartMonth:s,splitted:i,syncedTimes:o,onChangeTimeSync:r,hideText:n,onChangeTimeZone:a,onChangeFiscalYearStartMonth:l}=this.props,c=i?(0,D.jsx)(Re,{onClick:r,isSynced:o}):void 0,d={value:e,timeZone:t,fiscalYearStartMonth:s,onMoveBackward:this.onMoveBack,onMoveForward:this.onMoveForward,onZoom:this.onZoom,hideText:n};return(0,D.jsx)(Se.a,Object.assign({},d,{timeSyncButton:c,isSynced:o,widthOverride:i?window.innerWidth/2:void 0,onChange:this.onChangeTimePicker,onChangeTimeZone:a,onChangeFiscalYearStartMonth:l}))}}var ze=s("./.yarn/__virtual__/react-transition-group-virtual-8df824fae8/0/cache/react-transition-group-npm-4.4.2-5052c30656-b67bf5b3e8.zip/node_modules/react-transition-group/esm/CSSTransition.js");function Ie(e){const{start:t,pause:s,resume:i,isLive:o,isPaused:r,stop:a,splitted:l}=e,c=o&&!r?"active":"default",d=o?r?i:s:t;return(0,D.jsxs)(n.ButtonGroup,{children:[(0,D.jsx)(n.Tooltip,{content:o&&!r?(0,D.jsx)(D.Fragment,{children:"Pause the live stream"}):(0,D.jsx)(D.Fragment,{children:"Start live stream your logs"}),placement:"bottom",children:(0,D.jsx)(n.ToolbarButton,{iconOnly:l,variant:c,icon:!o||r?"play":"pause",onClick:d,children:o&&r?"Paused":"Live"})}),(0,D.jsx)(ze.Z,{mountOnEnter:!0,unmountOnExit:!0,timeout:100,in:o,classNames:{enter:ke.stopButtonEnter,enterActive:ke.stopButtonEnterActive,exit:ke.stopButtonExit,exitActive:ke.stopButtonExitActive},children:(0,D.jsx)(n.Tooltip,{content:(0,D.jsx)(D.Fragment,{children:"Stop and exit the live stream"}),placement:"bottom",children:(0,D.jsx)(n.ToolbarButton,{variant:c,onClick:a,icon:"square-shape"})})})]})}const ke={stopButtonEnter:w.css`
    label: stopButtonEnter;
    width: 0;
    opacity: 0;
    overflow: hidden;
  `,stopButtonEnterActive:w.css`
    label: stopButtonEnterActive;
    opacity: 1;
    width: 32px;
  `,stopButtonExit:w.css`
    label: stopButtonExit;
    width: 32px;
    opacity: 1;
    overflow: hidden;
  `,stopButtonExitActive:w.css`
    label: stopButtonExitActive;
    opacity: 0;
    width: 0;
  `};var Fe=s("./public/app/features/explore/state/datasource.ts"),Le=s("./public/app/features/explore/state/time.ts");function Oe(e){const t=function(e){const t=(0,o.useDispatch)(),s=(0,i.useCallback)(()=>{t((0,u.sQ)({exploreId:e,isPaused:!0}))},[e,t]),r=(0,i.useCallback)(()=>{t((0,u.sQ)({exploreId:e,isPaused:!1}))},[e,t]),a=(0,i.useCallback)(()=>{s(),t((0,Le.oz)(e,n.RefreshPicker.offOption.value)),t((0,u.aA)(e))},[e,t,s]),l=(0,i.useCallback)(()=>{t((0,Le.oz)(e,n.RefreshPicker.liveOption.value))},[e,t]);return{pause:s,resume:r,stop:a,start:l}}(e.exploreId);return e.children(t)}function Ne(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const De=(0,i.lazy)(()=>s.e(47).then(s.bind(s,"./public/app/features/explore/AddToDashboard/index.tsx")).then(e=>{let{AddToDashboard:t}=e;return{default:t}}));const $e={changeDatasource:Fe.zU,changeRefreshInterval:Le.oz,cancelQueries:u.ci,runQueries:u.aA,closeSplit:p.YV,split:p.bW,syncTimes:Le.mG,onChangeTimeZone:we.YT,onChangeFiscalYearStartMonth:we.rf},Pe=(0,o.connect)((e,t)=>{var s;let{exploreId:i}=t;const{syncedTimes:o}=e.explore,r=e.explore[i],{datasourceInstance:n,datasourceMissing:a,range:l,refreshInterval:c,loading:d,isLive:p,isPaused:u,containerWidth:g}=r,m=!(null===n||void 0===n||null===(s=n.meta)||void 0===s||!s.streaming);return{datasourceMissing:a,datasourceName:null===n||void 0===n?void 0:n.name,loading:d,range:l,timeZone:(0,b.Z)(e.user),fiscalYearStartMonth:(0,b.i)(e.user),splitted:(0,h.p)(e),refreshInterval:c,hasLiveOption:m,isLive:p,isPaused:u,syncedTimes:o,containerWidth:g}},$e)(class extends i.PureComponent{constructor(){var e;super(...arguments),e=this,Ne(this,"onChangeDatasource",async e=>{this.props.changeDatasource(this.props.exploreId,e.uid,{importQueries:!0})}),Ne(this,"onRunQuery",function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{runQueries:s,cancelQueries:i,exploreId:o}=e.props;return t?i(o):s(o)}),Ne(this,"onChangeRefreshInterval",e=>{const{changeRefreshInterval:t,exploreId:s}=this.props;t(s,e)}),Ne(this,"onChangeTimeSync",()=>{const{syncTimes:e,exploreId:t}=this.props;e(t)}),Ne(this,"renderRefreshPicker",e=>{const{loading:t,refreshInterval:s,isLive:i}=this.props;let o=t?"Cancel":"Run query",r=void 0,a="108px";return e&&(r=o,o=void 0,a="35px"),(0,D.jsx)(n.RefreshPicker,{onIntervalChanged:this.onChangeRefreshInterval,value:s,isLoading:t,text:o,tooltip:r,intervals:(0,be.$t)().getValidIntervals(n.defaultIntervals),isLive:i,onRefresh:()=>this.onRunQuery(t),noIntervalPicker:i,primary:!0,width:a})})}render(){const{datasourceMissing:e,closeSplit:t,exploreId:s,loading:o,range:l,timeZone:c,fiscalYearStartMonth:d,splitted:p,syncedTimes:u,refreshInterval:h,onChangeTime:g,split:m,hasLiveOption:f,isLive:y,isPaused:v,containerWidth:x,onChangeTimeZone:b,onChangeFiscalYearStartMonth:w,topOfViewRef:S}=this.props,j=(p?x<700:x<800)||!1,R=p||x<1210;return(0,D.jsx)("div",{ref:S,children:(0,D.jsx)(n.PageToolbar,{"aria-label":"Explore toolbar",title:s===a.K.left?"Explore":void 0,pageIcon:s===a.K.left?"compass":void 0,leftItems:[s===a.K.left&&(0,D.jsx)(xe.u,{tooltip:"Copy shortened link",icon:"share-alt",onClick:()=>(0,ve.L)(window.location.href),"aria-label":"Copy shortened link"},"share"),!e&&(0,D.jsx)(r.DataSourcePicker,{onChange:this.onChangeDatasource,current:this.props.datasourceName,hideTextValue:j,width:j?8:void 0},`${s}-ds-picker`)].filter(Boolean),children:(0,D.jsxs)(n.ToolbarButtonRow,{children:[p?(0,D.jsx)(n.ToolbarButton,{title:"Close split pane",onClick:()=>t(s),icon:"times",children:"Close"}):(0,D.jsx)(n.ToolbarButton,{title:"Split",onClick:()=>m(),icon:"columns",disabled:y,children:"Split"}),r.config.featureToggles.explore2Dashboard&&(0,D.jsx)(i.Suspense,{fallback:null,children:(0,D.jsx)(De,{exploreId:s})}),!y&&(0,D.jsx)(Te,{exploreId:s,range:l,timeZone:c,fiscalYearStartMonth:d,onChangeTime:g,splitted:p,syncedTimes:u,onChangeTimeSync:this.onChangeTimeSync,hideText:R,onChangeTimeZone:b,onChangeFiscalYearStartMonth:w}),this.renderRefreshPicker(R),h&&(0,D.jsx)(n.SetInterval,{func:this.onRunQuery,interval:h,loading:o}),f&&(0,D.jsx)(Oe,{exploreId:s,children:e=>(0,D.jsx)(Ie,{splitted:p,isLive:y,isPaused:v,start:e.start,pause:e.pause,resume:e.resume,stop:e.stop})})]})})})}});var Ee=s("./.yarn/cache/tinycolor2-npm-1.4.2-462ba30c26-57ed262e08.zip/node_modules/tinycolor2/tinycolor.js"),Ae=s.n(Ee);const Me=function(e,t){var s=(0,i.useRef)(function(){});(0,i.useEffect)(function(){s.current=e}),(0,i.useEffect)(function(){if(null!==t){var e=setInterval(function(){return s.current()},t||0);return function(){return clearInterval(e)}}},[t])},Be=e=>{let{timeInMs:t,className:s,humanize:i}=e;return(0,D.jsx)("span",{className:`elapsed-time ${s}`,children:He(t,i)})},He=function(e){const t=e/1e3;if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1]))return`${t.toFixed(1)}s`;const s=(0,f.toDuration)(t,"seconds"),i=s.hours(),o=s.minutes(),r=s.seconds();return i?`${i}h ${o}m ${r}s`:o?`${o}m ${r}s`:`${r}s`},qe=e=>{let{resetKey:t,humanize:s,className:o}=e;const[r,n]=(0,i.useState)(0);return Me(()=>n(r+150),150),(0,i.useEffect)(()=>n(0),[t]),(0,D.jsx)(Be,{timeInMs:r,className:o,humanize:s})};var _e;function Ze(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const Qe=e=>({logsRowsLive:w.css`
    label: logs-rows-live;
    font-family: ${e.typography.fontFamilyMonospace};
    font-size: ${e.typography.bodySmall.fontSize};
    display: flex;
    flex-flow: column nowrap;
    height: 60vh;
    overflow-y: scroll;
    :first-child {
      margin-top: auto !important;
    }
  `,logsRowFade:w.css`
    label: logs-row-fresh;
    color: ${e.colors.text};
    background-color: ${Ae()(e.colors.info.transparent).setAlpha(.25).toString()};
    animation: fade 1s ease-out 1s 1 normal forwards;
    @keyframes fade {
      from {
        background-color: ${Ae()(e.colors.info.transparent).setAlpha(.25).toString()};
      }
      to {
        background-color: transparent;
      }
    }
  `,logsRowsIndicator:w.css`
    font-size: ${e.typography.h6.fontSize};
    padding-top: ${e.spacing(1)};
    display: flex;
    align-items: center;
  `,button:w.css`
    margin-right: ${e.spacing(1)};
  `,fullWidth:w.css`
    width: 100%;
  `});const We=(0,n.withTheme2)(class extends i.PureComponent{constructor(e){super(e),Ze(this,"liveEndDiv",null),Ze(this,"scrollContainerRef",i.createRef()),Ze(this,"onScroll",e=>{const{isPaused:t,onPause:s}=this.props,{scrollTop:i,clientHeight:o,scrollHeight:r}=e.currentTarget;r-(i+o)>=5&&!t&&s()}),Ze(this,"rowsToRender",()=>{const{isPaused:e}=this.props;let{logRowsToRender:t=[]}=this.state;return e||(t=t.slice(-100)),t}),this.state={logRowsToRender:e.logRows}}static getDerivedStateFromProps(e,t){return e.isPaused?null:{logRowsToRender:e.logRows}}render(){const{theme:e,timeZone:t,onPause:s,onResume:i,isPaused:o}=this.props,r=Qe(e),{logsRow:a,logsRowLocalTime:l,logsRowMessage:c}=(0,n.getLogRowStyles)(e);return(0,D.jsxs)("div",{children:[(0,D.jsx)("table",{className:r.fullWidth,children:(0,D.jsxs)("tbody",{onScroll:o?void 0:this.onScroll,className:(0,w.cx)(["logs-rows",r.logsRowsLive]),ref:this.scrollContainerRef,children:[this.rowsToRender().map(e=>(0,D.jsxs)("tr",{className:(0,w.cx)(a,r.logsRowFade),children:[(0,D.jsx)("td",{className:(0,w.cx)(l),children:(0,f.dateTimeFormat)(e.timeEpochMs,{timeZone:t})}),(0,D.jsx)("td",{className:(0,w.cx)(c),children:e.hasAnsi?(0,D.jsx)(n.LogMessageAnsi,{value:e.raw}):e.entry})]},e.uid)),(0,D.jsx)("tr",{ref:e=>{var t,s;this.liveEndDiv=e,this.liveEndDiv&&null!==(t=this.scrollContainerRef.current)&&void 0!==t&&t.scrollTo&&!o&&(null===(s=this.scrollContainerRef.current)||void 0===s||s.scrollTo(0,this.scrollContainerRef.current.scrollHeight))}})]})}),(0,D.jsxs)("div",{className:r.logsRowsIndicator,children:[(0,D.jsxs)(n.Button,{variant:"secondary",onClick:o?i:s,className:r.button,children:[(0,D.jsx)(n.Icon,{name:o?"play":"pause"})," ",o?"Resume":"Pause"]}),(0,D.jsxs)(n.Button,{variant:"secondary",onClick:this.props.stopLive,className:r.button,children:[_e||(_e=(0,D.jsx)(n.Icon,{name:"square-shape",size:"lg",type:"mono"})),"  Exit live mode"]}),o||(0,D.jsxs)("span",{children:["Last line received: ",(0,D.jsx)(qe,{resetKey:this.props.logRows,humanize:!0})," ago"]})]})]})}});var Ve=s("./public/app/core/logs_model.ts"),Ue=s("./packages/grafana-ui/src/components/Logs/LogRowMessage.tsx");const Ge=e=>({metaContainer:w.css`
    flex: 1;
    color: ${e.colors.text.secondary};
    margin-bottom: ${e.spacing(2)};
    min-width: 30%;
    display: flex;
    flex-wrap: wrap;
  `,metaItem:w.css`
    margin-right: ${e.spacing(2)};
    margin-top: ${e.spacing(.5)};
    display: flex;
    align-items: baseline;

    .logs-meta-item__error {
      color: ${e.colors.error.text};
    }
  `,metaLabel:w.css`
    margin-right: calc(${e.spacing(2)} / 2);
    font-size: ${e.typography.bodySmall.fontSize};
    font-weight: ${e.typography.fontWeightMedium};
  `,metaValue:w.css`
    font-family: ${e.typography.fontFamilyMonospace};
    font-size: ${e.typography.bodySmall.fontSize};
  `}),Ke=(0,i.memo)(function(e){const t=(0,n.useStyles2)(Ge),{label:s,value:i}=e;return(0,D.jsxs)("div",{"data-testid":"meta-info-text-item",className:t.metaItem,children:[s&&(0,D.jsxs)("span",{className:t.metaLabel,children:[s,":"]}),(0,D.jsx)("span",{className:t.metaValue,children:i})]})}),Ye=(0,i.memo)(function(e){const t=(0,n.useStyles2)(Ge),{metaItems:s}=e;return(0,D.jsx)("div",{className:t.metaContainer,"data-testid":"meta-info-text",children:s.map((e,t)=>(0,D.jsx)(Ke,{label:e.label,value:e.value},`${t}-${e.label}`))})});var Je;const Xe=i.memo(e=>{let{meta:t,dedupStrategy:s,dedupCount:i,showDetectedFields:o,clearDetectedFields:r,hasUnescapedContent:a,forceEscape:l,onEscapeNewlines:c,logRows:d}=e;const p=[...t];return s!==f.LogsDedupStrategy.none&&p.push({label:"Dedup count",value:i,kind:f.LogsMetaKind.Number}),d.some(e=>e.entry.length>Ue.n)&&p.push({label:"Info",value:"Logs with more than 100,000 characters could not be parsed and highlighted",kind:f.LogsMetaKind.String}),(null===o||void 0===o?void 0:o.length)>0&&p.push({label:"Showing only detected fields",value:et(o,f.LogsMetaKind.LabelsMap)},{label:"",value:(0,D.jsx)(n.Button,{variant:"secondary",size:"sm",onClick:r,children:"Show original line"})}),a&&p.push({label:"Your logs might have incorrectly escaped content",value:(0,D.jsx)(n.Tooltip,{content:"Fix incorrectly escaped newline and tab sequences in log lines. Manually review the results to confirm that the replacements are correct.",placement:"right",children:(0,D.jsxs)(n.Button,{variant:"secondary",size:"sm",onClick:c,children:[(0,D.jsxs)("span",{children:[l?"Remove escaping":"Escape newlines"," "]}),Je||(Je=(0,D.jsx)(n.Icon,{name:"exclamation-triangle",className:"muted",size:"sm"}))]})})}),(0,D.jsx)(D.Fragment,{children:p&&(0,D.jsx)(Ye,{metaItems:p.map(e=>({label:e.label,value:"kind"in e?et(e.value,e.kind):e.value}))})})});function et(e,t){return t===f.LogsMetaKind.LabelsMap?(0,D.jsx)("span",{className:"logs-meta-item__labels",children:(0,D.jsx)(n.LogLabels,{labels:e})}):t===f.LogsMetaKind.Error?(0,D.jsx)("span",{className:"logs-meta-item__error",children:e}):e}var tt;function st(e){let{pages:t,currentPageIndex:s,oldestLogsFirst:i,timeZone:o,loading:r,changeTime:a}=e;const l=e=>`${(0,f.dateTimeFormat)(e,{format:f.systemDateFormats.interval.second,timeZone:o})}`,c=(0,n.useTheme2)(),d=it(c,r);return(0,D.jsx)(n.CustomScrollbar,{autoHide:!0,children:(0,D.jsx)("div",{className:d.pagesWrapper,"data-testid":"logsNavigationPages",children:(0,D.jsx)("div",{className:d.pagesContainer,children:t.map((e,t)=>(0,D.jsxs)("div",{"data-testid":`page${t+1}`,className:d.page,onClick:()=>!r&&a({from:e.queryRange.from,to:e.queryRange.to}),children:[(0,D.jsx)("div",{className:(0,w.cx)(d.line,{selectedBg:s===t})}),(0,D.jsx)("div",{className:(0,w.cx)(d.time,{selectedText:s===t}),children:((e,t)=>{if(s===t&&r)return tt||(tt=(0,D.jsx)(n.Spinner,{}));return`${l(i?e.logsRange.from:e.logsRange.to)} — ${l(i?e.logsRange.to:e.logsRange.from)}`})(e,t)})]},e.queryRange.to))})})})}Xe.displayName="LogsMetaRow";const it=(e,t)=>({pagesWrapper:w.css`
      height: 100%;
      padding-left: ${e.spacing(.5)};
      display: flex;
      flex-direction: column;
      overflow-y: scroll;
      &::after {
        content: '';
        display: block;
        background: repeating-linear-gradient(
          135deg,
          ${e.colors.background.primary},
          ${e.colors.background.primary} 5px,
          ${e.colors.background.secondary} 5px,
          ${e.colors.background.secondary} 15px
        );
        width: 3px;
        height: inherit;
        margin-bottom: 8px;
      }
    `,pagesContainer:w.css`
      display: flex;
      padding: 0;
      flex-direction: column;
    `,page:w.css`
      display: flex;
      margin: ${e.spacing(2)} 0;
      cursor: ${t?"auto":"pointer"};
      white-space: normal;
      .selectedBg {
        background: ${e.colors.primary.main};
      }
      .selectedText {
        color: ${e.colors.primary.main};
      }
    `,line:w.css`
      width: 3px;
      height: 100%;
      align-items: center;
      background: ${e.colors.text.secondary};
    `,time:w.css`
      width: 60px;
      min-height: 80px;
      font-size: ${e.v1.typography.size.sm};
      padding-left: ${e.spacing(.5)};
      display: flex;
      align-items: center;
    `});var ot,rt,nt;const at=(0,i.memo)(function(e){let{absoluteRange:t,logsSortOrder:s,timeZone:o,loading:r,onChangeTime:a,scrollToTopLogs:l,visibleRange:c,queries:d,clearCache:p,addResultsToCache:u}=e;const[h,g]=(0,i.useState)([]),[m,y]=(0,i.useState)(0),v=(0,i.useRef)(),x=(0,i.useRef)(),b=(0,i.useRef)(0),w=s===f.LogsSortOrder.Ascending,S=w?m===h.length-1:0===m,j=w?0===m:m===h.length-1,R=(0,n.useTheme2)(),C=lt(R,w,r);(0,i.useEffect)(()=>{const e={logsRange:c,queryRange:t};let i=[];if((0,I.isEqual)(x.current,t)&&(0,I.isEqual)(v.current,d)){g(t=>i=[...i=t.filter(t=>!(0,I.isEqual)(e.queryRange,t.queryRange)),e].sort((e,t)=>z(e,t,s)));const o=i.findIndex(e=>e.queryRange.to===t.to);y(o)}else p(),g([e]),y(0),v.current=d,b.current=t.to-t.from;u()},[c,t,s,d,p,u]),(0,i.useEffect)(()=>{p()},[]);const T=e=>{let{from:t,to:s}=e;x.current={from:t,to:s},a({from:t,to:s})},z=(e,t,s)=>s===f.LogsSortOrder.Ascending?e.queryRange.to>t.queryRange.to?1:-1:e.queryRange.to>t.queryRange.to?-1:1,k=(0,D.jsx)(n.Button,{"data-testid":"olderLogsButton",className:C.navButton,variant:"secondary",onClick:()=>{if(j)T({from:c.from-b.current,to:c.from});else{const e=w?-1:1;T({from:h[m+e].queryRange.from,to:h[m+e].queryRange.to})}},disabled:r,children:(0,D.jsxs)("div",{className:C.navButtonContent,children:[r?ot||(ot=(0,D.jsx)(n.Spinner,{})):(0,D.jsx)(n.Icon,{name:w?"angle-up":"angle-down",size:"lg"}),"Older logs"]})}),F=(0,D.jsx)(n.Button,{"data-testid":"newerLogsButton",className:C.navButton,variant:"secondary",onClick:()=>{if(!S){const e=w?1:-1;T({from:h[m+e].queryRange.from,to:h[m+e].queryRange.to})}},disabled:r||S,children:(0,D.jsxs)("div",{className:C.navButtonContent,children:[r&&(rt||(rt=(0,D.jsx)(n.Spinner,{}))),S||r?null:(0,D.jsx)(n.Icon,{name:w?"angle-down":"angle-up",size:"lg"}),S?"Start of range":"Newer logs"]})});return(0,D.jsxs)("div",{className:C.navContainer,children:[w?k:F,(0,D.jsx)(st,{pages:h,currentPageIndex:m,oldestLogsFirst:w,timeZone:o,loading:r,changeTime:T}),w?F:k,(0,D.jsx)(n.Button,{"data-testid":"scrollToTop",className:C.scrollToTopButton,variant:"secondary",onClick:l,title:"Scroll to top",children:nt||(nt=(0,D.jsx)(n.Icon,{name:"arrow-up",size:"lg"}))})]})}),lt=(e,t,s)=>({navContainer:w.css`
      max-height: 95vh;
      display: flex;
      flex-direction: column;
      justify-content: ${t?"flex-start":"space-between"};
      position: sticky;
      top: ${e.spacing(2)};
      right: 0;
    `,navButton:w.css`
      width: 58px;
      height: 68px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      line-height: 1;
    `,navButtonContent:w.css`
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      white-space: normal;
    `,scrollToTopButton:w.css`
      width: 40px;
      height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin-top: ${e.spacing(1)};
    `});function ct(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const dt={showLabels:"grafana.explore.logs.showLabels",showTime:"grafana.explore.logs.showTime",wrapLogMessage:"grafana.explore.logs.wrapLogMessage",prettifyLogMessage:"grafana.explore.logs.prettifyLogMessage",logsSortOrder:"grafana.explore.logs.sortOrder"};const pt=(0,n.withTheme2)(class extends i.PureComponent{constructor(){super(...arguments),ct(this,"flipOrderTimer",void 0),ct(this,"cancelFlippingTimer",void 0),ct(this,"topLogsRef",(0,i.createRef)()),ct(this,"state",{showLabels:v.Z.getBool(dt.showLabels,!1),showTime:v.Z.getBool(dt.showTime,!0),wrapLogMessage:v.Z.getBool(dt.wrapLogMessage,!0),prettifyLogMessage:v.Z.getBool(dt.prettifyLogMessage,!1),dedupStrategy:f.LogsDedupStrategy.none,hiddenLogLevels:[],logsSortOrder:v.Z.get(dt.logsSortOrder)||f.LogsSortOrder.Descending,isFlipping:!1,showDetectedFields:[],forceEscape:!1}),ct(this,"onChangeLogsSortOrder",()=>{this.setState({isFlipping:!0}),this.flipOrderTimer=window.setTimeout(()=>{this.setState(e=>{const t=e.logsSortOrder===f.LogsSortOrder.Descending?f.LogsSortOrder.Ascending:f.LogsSortOrder.Descending;return v.Z.set(dt.logsSortOrder,t),{logsSortOrder:t}})},0),this.cancelFlippingTimer=window.setTimeout(()=>this.setState({isFlipping:!1}),1e3)}),ct(this,"onEscapeNewlines",()=>{this.setState(e=>({forceEscape:!e.forceEscape}))}),ct(this,"onChangeDedup",e=>{this.setState({dedupStrategy:e})}),ct(this,"onChangeLabels",e=>{const{target:t}=e;if(t){const e=t.checked;this.setState({showLabels:e}),v.Z.set(dt.showLabels,e)}}),ct(this,"onChangeTime",e=>{const{target:t}=e;if(t){const e=t.checked;this.setState({showTime:e}),v.Z.set(dt.showTime,e)}}),ct(this,"onChangeWrapLogMessage",e=>{const{target:t}=e;if(t){const e=t.checked;this.setState({wrapLogMessage:e}),v.Z.set(dt.wrapLogMessage,e)}}),ct(this,"onChangePrettifyLogMessage",e=>{const{target:t}=e;if(t){const e=t.checked;this.setState({prettifyLogMessage:e}),v.Z.set(dt.prettifyLogMessage,e)}}),ct(this,"onToggleLogLevel",e=>{const t=e.map(e=>f.LogLevel[e]);this.setState({hiddenLogLevels:t})}),ct(this,"onClickScan",e=>{e.preventDefault(),this.props.onStartScanning&&this.props.onStartScanning()}),ct(this,"onClickStopScan",e=>{e.preventDefault(),this.props.onStopScanning&&this.props.onStopScanning()}),ct(this,"showDetectedField",e=>{-1===this.state.showDetectedFields.indexOf(e)&&this.setState(t=>({showDetectedFields:t.showDetectedFields.concat(e)}))}),ct(this,"hideDetectedField",e=>{this.state.showDetectedFields.indexOf(e)>-1&&this.setState(t=>({showDetectedFields:t.showDetectedFields.filter(t=>e!==t)}))}),ct(this,"clearDetectedFields",()=>{this.setState(e=>({showDetectedFields:[]}))}),ct(this,"checkUnescapedContent",(0,m.Z)(e=>!!e.some(e=>e.hasUnescapedContent))),ct(this,"dedupRows",(0,m.Z)((e,t)=>{const s=(0,Ve.UW)(e,t);return{dedupedRows:s,dedupCount:s.reduce((e,t)=>t.duplicates?e+t.duplicates:e,0)}})),ct(this,"filterRows",(0,m.Z)((e,t)=>(0,Ve.nu)(e,new Set(t)))),ct(this,"createNavigationRange",(0,m.Z)(e=>{if(!e||0===e.length)return;const t=e[0].timeEpochMs,s=e[e.length-1].timeEpochMs;return s<t?{from:s,to:t}:{from:t,to:s}})),ct(this,"scrollToTopLogs",()=>{var e;return null===(e=this.topLogsRef.current)||void 0===e?void 0:e.scrollIntoView()})}componentWillUnmount(){this.flipOrderTimer&&window.clearTimeout(this.flipOrderTimer),this.cancelFlippingTimer&&window.clearTimeout(this.cancelFlippingTimer)}render(){const{width:e,logRows:t,logsMeta:s,logsSeries:i,visibleRange:o,loading:r=!1,loadingState:a,onClickFilterLabel:l,onClickFilterOutLabel:c,timeZone:d,scanning:p,scanRange:u,showContextToggle:h,absoluteRange:g,onChangeTime:m,getFieldLinks:y,theme:v,logsQueries:x,clearCache:b,addResultsToCache:w,exploreId:S}=this.props,{showLabels:j,showTime:R,wrapLogMessage:C,prettifyLogMessage:T,dedupStrategy:z,hiddenLogLevels:k,logsSortOrder:L,isFlipping:O,showDetectedFields:N,forceEscape:$}=this.state,E=ut(v,C),A=t&&t.length>0,M=this.checkUnescapedContent(t),B=this.filterRows(t,k),{dedupedRows:H,dedupCount:q}=this.dedupRows(B,z),_=this.createNavigationRange(t),Z=u?`Scanning ${f.rangeUtil.describeTimeRange(u)}`:"Scanning...";return(0,D.jsxs)(D.Fragment,{children:[i&&i.length?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{className:E.infoText,children:"This datasource does not support full-range histograms. The graph is based on the logs seen in the response."}),(0,D.jsx)(P,{graphStyle:"lines",data:i,height:150,width:e,tooltipDisplayMode:F.f3.Multi,absoluteRange:o||g,timeZone:d,loadingState:a,onChangeTime:m,onHiddenSeriesChanged:this.onToggleLogLevel})]}):void 0,(0,D.jsxs)("div",{className:E.logOptions,ref:this.topLogsRef,children:[(0,D.jsxs)(n.InlineFieldRow,{children:[(0,D.jsx)(n.InlineField,{label:"Time",className:E.horizontalInlineLabel,transparent:!0,children:(0,D.jsx)(n.InlineSwitch,{value:R,onChange:this.onChangeTime,className:E.horizontalInlineSwitch,transparent:!0,id:`show-time_${S}`})}),(0,D.jsx)(n.InlineField,{label:"Unique labels",className:E.horizontalInlineLabel,transparent:!0,children:(0,D.jsx)(n.InlineSwitch,{value:j,onChange:this.onChangeLabels,className:E.horizontalInlineSwitch,transparent:!0,id:`unique-labels_${S}`})}),(0,D.jsx)(n.InlineField,{label:"Wrap lines",className:E.horizontalInlineLabel,transparent:!0,children:(0,D.jsx)(n.InlineSwitch,{value:C,onChange:this.onChangeWrapLogMessage,className:E.horizontalInlineSwitch,transparent:!0,id:`wrap-lines_${S}`})}),(0,D.jsx)(n.InlineField,{label:"Prettify JSON",className:E.horizontalInlineLabel,transparent:!0,children:(0,D.jsx)(n.InlineSwitch,{value:T,onChange:this.onChangePrettifyLogMessage,className:E.horizontalInlineSwitch,transparent:!0,id:`prettify_${S}`})}),(0,D.jsx)(n.InlineField,{label:"Dedup",className:E.horizontalInlineLabel,transparent:!0,children:(0,D.jsx)(n.RadioButtonGroup,{options:Object.values(f.LogsDedupStrategy).map(e=>({label:(0,I.capitalize)(e),value:e,description:f.LogsDedupDescription[e]})),value:z,onChange:this.onChangeDedup,className:E.radioButtons})})]}),(0,D.jsx)("div",{children:(0,D.jsx)(n.InlineField,{label:"Display results",className:E.horizontalInlineLabel,transparent:!0,children:(0,D.jsx)(n.RadioButtonGroup,{disabled:O,options:[{label:"Newest first",value:f.LogsSortOrder.Descending,description:"Show results newest to oldest"},{label:"Oldest first",value:f.LogsSortOrder.Ascending,description:"Show results oldest to newest"}],value:L,onChange:this.onChangeLogsSortOrder,className:E.radioButtons})})})]}),(0,D.jsx)(Xe,{logRows:t,meta:s||[],dedupStrategy:z,dedupCount:q,hasUnescapedContent:M,forceEscape:$,showDetectedFields:N,onEscapeNewlines:this.onEscapeNewlines,clearDetectedFields:this.clearDetectedFields}),(0,D.jsxs)("div",{className:E.logsSection,children:[(0,D.jsx)("div",{className:E.logRows,"data-testid":"logRows",children:(0,D.jsx)(n.LogRows,{logRows:t,deduplicatedRows:H,dedupStrategy:z,getRowContext:this.props.getRowContext,onClickFilterLabel:l,onClickFilterOutLabel:c,showContextToggle:h,showLabels:j,showTime:R,enableLogDetails:!0,forceEscape:$,wrapLogMessage:C,prettifyLogMessage:T,timeZone:d,getFieldLinks:y,logsSortOrder:L,showDetectedFields:N,onClickShowDetectedField:this.showDetectedField,onClickHideDetectedField:this.hideDetectedField})}),(0,D.jsx)(at,{logsSortOrder:L,visibleRange:null!==_&&void 0!==_?_:g,absoluteRange:g,timeZone:d,onChangeTime:m,loading:r,queries:null!==x&&void 0!==x?x:[],scrollToTopLogs:this.scrollToTopLogs,addResultsToCache:w,clearCache:b})]}),!r&&!A&&!p&&(0,D.jsxs)("div",{className:E.noData,children:["No logs found.",(0,D.jsx)(n.Button,{size:"xs",fill:"text",onClick:this.onClickScan,children:"Scan for older logs"})]}),p&&(0,D.jsxs)("div",{className:E.noData,children:[(0,D.jsx)("span",{children:Z}),(0,D.jsx)(n.Button,{size:"xs",fill:"text",onClick:this.onClickStopScan,children:"Stop scan"})]})]})}}),ut=(e,t)=>({noData:w.css`
      > * {
        margin-left: 0.5em;
      }
    `,logOptions:w.css`
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      flex-wrap: wrap;
      background-color: ${e.colors.background.primary};
      padding: ${e.spacing(1,2)};
      border-radius: ${e.shape.borderRadius()};
      margin: ${e.spacing(2,0,1)};
      border: 1px solid ${e.colors.border.medium};
    `,headerButton:w.css`
      margin: ${e.spacing(.5,0,0,1)};
    `,horizontalInlineLabel:w.css`
      > label {
        margin-right: 0;
      }
    `,horizontalInlineSwitch:w.css`
      padding: 0 ${e.spacing(1)} 0 0;
    `,radioButtons:w.css`
      margin: 0;
    `,logsSection:w.css`
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    `,logRows:w.css`
      overflow-x: ${t?"unset":"scroll"};
      overflow-y: visible;
      width: 100%;
    `,infoText:w.css`
      font-size: ${e.typography.size.sm};
      color: ${e.colors.text.secondary};
    `}),ht=500,gt=100,mt=(0,m.Z)(()=>({logsEnter:w.css`
      label: logsEnter;
      position: absolute;
      opacity: 0;
      height: auto;
      width: 100%;
    `,logsEnterActive:w.css`
      label: logsEnterActive;
      opacity: 1;
      transition: opacity ${ht}ms ease-out ${gt}ms;
    `,logsExit:w.css`
      label: logsExit;
      position: absolute;
      opacity: 1;
      height: auto;
      width: 100%;
    `,logsExitActive:w.css`
      label: logsExitActive;
      opacity: 0;
      transition: opacity ${ht}ms ease-out ${gt}ms;
    `}));function ft(e){const{visible:t,children:s}=e,i=mt();return(0,D.jsx)(ze.Z,{in:t,mountOnEnter:!0,unmountOnExit:!0,timeout:ht+gt,classNames:{enter:i.logsEnter,enterActive:i.logsEnterActive,exit:i.logsExit,exitActive:i.logsExitActive},children:s})}var yt=s("./public/app/features/explore/utils/links.ts");function vt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const xt={updateTimeRange:Le.cD,splitOpen:p.bW,addResultsToCache:u.K8,clearCache:u.LK},bt=(0,o.connect)(function(e,t){let{exploreId:s}=t;const i=e.explore[s],{logsResult:o,loading:r,scanning:n,datasourceInstance:a,isLive:l,isPaused:c,range:d,absoluteRange:p,logsVolumeDataProvider:u,logsVolumeData:h}=i,g=(0,b.Z)(e.user);return{loading:r,logRows:null===o||void 0===o?void 0:o.rows,logsMeta:null===o||void 0===o?void 0:o.meta,logsSeries:null===o||void 0===o?void 0:o.series,logsQueries:null===o||void 0===o?void 0:o.queries,visibleRange:null===o||void 0===o?void 0:o.visibleRange,scanning:n,timeZone:g,datasourceInstance:a,isLive:l,isPaused:c,range:d,absoluteRange:p,logsVolumeDataProvider:u,logsVolumeData:h}},xt)(class extends i.PureComponent{constructor(){super(...arguments),vt(this,"onChangeTime",e=>{const{exploreId:t,updateTimeRange:s}=this.props;s({exploreId:t,absoluteRange:e})}),vt(this,"getLogRowContext",async(e,t)=>{const{datasourceInstance:s}=this.props;return(0,f.hasLogsContextSupport)(s)?s.getLogRowContext(e,t):[]}),vt(this,"showContextToggle",e=>{const{datasourceInstance:t}=this.props;return!!(0,f.hasLogsContextSupport)(t)&&t.showContextToggle(e)}),vt(this,"getFieldLinks",(e,t)=>{const{splitOpen:s,range:i}=this.props;return(0,yt.a)({field:e,rowIndex:t,splitOpenFn:s,range:i})})}render(){const{loading:e,loadingState:t,logRows:s,logsMeta:i,logsSeries:o,logsQueries:r,onClickFilterLabel:a,onClickFilterOutLabel:l,onStartScanning:c,onStopScanning:d,absoluteRange:p,timeZone:u,visibleRange:h,scanning:g,range:m,width:f,isLive:y,exploreId:v,addResultsToCache:x,clearCache:b}=this.props;if(!s)return null;const S=w.css`
      & > div {
        overflow: visible;
        & > div {
          overflow: visible;
        }
      }
    `;return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(ft,{visible:y,children:(0,D.jsx)(n.Collapse,{label:"Logs",loading:!1,isOpen:!0,children:(0,D.jsx)(Oe,{exploreId:v,children:e=>(0,D.jsx)(We,{logRows:s,timeZone:u,stopLive:e.stop,isPaused:this.props.isPaused,onPause:e.pause,onResume:e.resume})})})}),(0,D.jsx)(ft,{visible:!y,children:(0,D.jsx)(n.Collapse,{label:"Logs",loading:e,isOpen:!0,className:S,children:(0,D.jsx)(pt,{exploreId:v,logRows:s,logsMeta:i,logsSeries:o,logsQueries:r,width:f,loading:e,loadingState:t,onChangeTime:this.onChangeTime,onClickFilterLabel:a,onClickFilterOutLabel:l,onStartScanning:c,onStopScanning:d,absoluteRange:p,visibleRange:h,timeZone:u,scanning:g,scanRange:m.raw,showContextToggle:this.showContextToggle,getRowContext:this.getLogRowContext,getFieldLinks:this.getFieldLinks,addResultsToCache:()=>x(v),clearCache:()=>b(v)})})})]})}});var wt,St;const jt=100;function Rt(e){var t;const[s,o]=(0,i.useState)(!1),r=e.error.message||(null===(t=e.error.data)||void 0===t?void 0:t.message)||"",a=!s&&r.length>jt;return(0,D.jsx)(n.Alert,{title:"Failed to load log volume for this query",severity:"warning",children:a?(0,D.jsx)(n.Button,{variant:"secondary",size:"xs",onClick:()=>{o(!0)},children:"Show details"}):r})}function Ct(e){const{width:t,logsVolumeData:s,absoluteRange:i,timeZone:o,splitOpen:r,onUpdateTimeRange:a,onLoadLogsVolume:l}=e,c=(0,n.useTheme2)(),d=(0,n.useStyles2)(Tt),p=parseInt(c.spacing(2).slice(0,-2),10);let u;if(!s)return null;if(null!==s&&void 0!==s&&s.error)return(0,D.jsx)(Rt,{error:null===s||void 0===s?void 0:s.error});(null===s||void 0===s?void 0:s.state)===f.LoadingState.Loading?u=wt||(wt=(0,D.jsx)("span",{children:"Log volume is loading..."})):null!==s&&void 0!==s&&s.data&&(u=s.data.length>0?(0,D.jsx)(P,{graphStyle:"lines",loadingState:f.LoadingState.Done,data:s.data,height:150,width:t-p,absoluteRange:i,onChangeTime:a,timeZone:o,splitOpenFn:r,tooltipDisplayMode:n.TooltipDisplayMode.Multi}):St||(St=(0,D.jsx)("span",{children:"No volume data."})));const h=function(e,t){var s,i;const o=e&&e.data[0]&&(null===(s=e.data[0].meta)||void 0===s?void 0:null===(i=s.custom)||void 0===i?void 0:i.absoluteRange);return o?(t.from-t.to)/(o.from-o.to):void 0}(s,i);let g;return void 0!==h&&h<1&&(g=(0,D.jsx)(n.InlineField,{label:"Reload log volume",transparent:!0,children:(0,D.jsx)(n.Button,{size:"xs",icon:"sync",variant:"secondary",onClick:l,id:"reload-volume"})})),(0,D.jsxs)(n.Collapse,{label:"Log volume",isOpen:!0,loading:(null===s||void 0===s?void 0:s.state)===f.LoadingState.Loading,children:[(0,D.jsx)("div",{style:{height:150},className:d.contentContainer,children:u}),(0,D.jsx)("div",{className:d.zoomInfoContainer,children:g})]})}const Tt=()=>({zoomInfoContainer:w.css`
      display: flex;
      justify-content: end;
      position: absolute;
      right: 5px;
      top: 5px;
    `,contentContainer:w.css`
      display: flex;
      align-items: center;
      justify-content: center;
    `});const zt=()=>{const e=(0,n.useStyles2)(It);return(0,D.jsx)(D.Fragment,{children:(0,D.jsx)("div",{"data-testid":"explore-no-data",className:(0,w.cx)([e.wrapper,"panel-container"]),children:(0,D.jsx)("span",{className:(0,w.cx)([e.message]),children:"No data"})})})},It=e=>({wrapper:w.css`
    label: no-data-card;
    padding: ${e.spacing(3)};
    background: ${e.colors.background.primary};
    border-radius: ${e.shape.borderRadius(2)};
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-grow: 1;
  `,message:w.css`
    font-size: ${e.typography.h2.fontSize};
    padding: ${e.spacing(4)};
    color: ${e.colors.text.disabled};
  `});var kt,Ft,Lt=s("./public/app/core/core.ts");const Ot=()=>{const e=(0,n.useTheme2)(),t=Lt.Vt.hasPermission(A.bW.DataSourcesCreate)&&Lt.Vt.hasPermission(A.bW.DataSourcesWrite),s=(0,D.jsxs)(D.Fragment,{children:[kt||(kt=(0,D.jsx)(n.Icon,{name:"rocket"})),(0,D.jsx)(D.Fragment,{children:" ProTip: You can also define data sources through configuration files. "}),Ft||(Ft=(0,D.jsx)("a",{href:"http://docs.grafana.org/administration/provisioning/#datasources?utm_source=explore",target:"_blank",rel:"noreferrer",className:"text-link",children:"Learn more"}))]}),i=(0,D.jsx)(n.LinkButton,{size:"lg",href:"datasources/new",icon:"database",disabled:!t,children:"Add data source"}),o=w.css`
    max-width: ${e.breakpoints.values.lg}px;
    margin-top: ${e.spacing(2)};
    align-self: center;
  `;return(0,D.jsx)(n.CallToActionCard,{callToActionElement:i,className:o,footer:s,message:"Explore requires at least one data source. Once you have added a data source, you can query it here."})};var Nt,Dt=s("./.yarn/__virtual__/react-use-virtual-00326e70ba/0/cache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useToggle.js"),$t=s("./public/app/plugins/panel/nodeGraph/NodeGraph.tsx"),Pt=s("./public/app/plugins/panel/nodeGraph/useCategorizeFrames.ts");const Et=e=>({warningText:w.css`
    label: warningText;
    font-size: ${e.typography.bodySmall.fontSize};
    color: ${e.colors.text.secondary};
  `});const At={splitOpen:p.bW},Mt=(0,o.connect)(function(e,t){let{exploreId:s}=t;return{range:e.explore[s].range}},At)(function(e){var t;const{dataFrames:s,range:i,splitOpen:o,withTraceView:r}=e,a=(0,yt.u)(i,o),l=(0,n.useTheme2)(),c=(0,n.useStyles2)(Et),d=(0,f.applyFieldOverrides)({fieldConfig:{defaults:{},overrides:[]},data:s,replaceVariables:e=>e,theme:l}),{nodes:p}=(0,Pt.Y)(d),[u,h]=(0,Dt.Z)(!1),g=r&&(null===(t=p[0])||void 0===t?void 0:t.length)>1e3?(0,D.jsxs)("span",{className:c.warningText,children:[" (",p[0].length," nodes, can be slow to load)"]}):null;return(0,D.jsx)(n.Collapse,{label:(0,D.jsxs)("span",{children:["Node graph",g," ",Nt||(Nt=(0,D.jsx)(n.Badge,{text:"Beta",color:"blue",icon:"rocket",tooltip:"This visualization is in beta"}))]}),collapsible:r,isOpen:!r||u,onToggle:r?()=>h():void 0,children:(0,D.jsx)("div",{style:{height:r?500:600},children:(0,D.jsx)($t.E,{dataFrames:d,getLinks:a})})})});var Bt=s("./.yarn/cache/reselect-npm-4.1.5-bc046e41ae-54c13c1e79.zip/node_modules/reselect/es/index.js"),Ht=s("./public/app/core/utils/query.ts"),qt=s("./public/app/features/plugins/datasource_srv.ts"),_t=s("./public/app/features/query/components/QueryEditorRows.tsx");const Zt=e=>{let{exploreId:t}=e;const s=(0,o.useDispatch)(),{getQueries:r,getDatasourceInstanceSettings:n,getQueryResponse:a,getHistory:l,getEventBridge:c}=(0,i.useMemo)(()=>(e=>{const t=(0,h.F)(e);return{getQueries:(0,Bt.P1)(t,e=>e.queries),getQueryResponse:(0,Bt.P1)(t,e=>e.queryResponse),getHistory:(0,Bt.P1)(t,e=>e.history),getEventBridge:(0,Bt.P1)(t,e=>e.eventBridge),getDatasourceInstanceSettings:(0,Bt.P1)(t,e=>{var t;return(0,qt.ak)().getInstanceSettings(null===(t=e.datasourceInstance)||void 0===t?void 0:t.uid)})}})(t),[t]),d=(0,o.useSelector)(r),p=(0,o.useSelector)(n),g=(0,o.useSelector)(a),m=(0,o.useSelector)(l),y=(0,o.useSelector)(c),v=(0,i.useCallback)(()=>{s((0,u.aA)(t))},[s,t]),x=(0,i.useCallback)(e=>{s((0,u.PM)({queries:e,exploreId:t})),e.length<d.length&&v()},[s,t,v,d]),b=(0,i.useCallback)(e=>{x([...d,Object.assign({},e,{refId:(0,Ht.Hs)(d)})])},[x,d]);return(0,D.jsx)(_t.l,{dsSettings:p,queries:d,onQueriesChange:x,onAddQuery:b,onRunQueries:v,data:g,app:f.CoreApp.Explore,history:m,eventBus:y})};var Qt=s("./.yarn/__virtual__/react-transition-group-virtual-8df824fae8/0/cache/react-transition-group-npm-4.4.2-5052c30656-b67bf5b3e8.zip/node_modules/react-transition-group/esm/Transition.js");const Wt=e=>{const t={transition:`opacity ${e.duration}ms linear`,opacity:0},s={exited:{opacity:0,display:"none"},entering:{opacity:0},entered:{opacity:1},exiting:{opacity:0}};return(0,D.jsx)(Qt.ZP,{in:e.in,timeout:e.duration,unmountOnExit:e.unmountOnExit||!1,onExited:e.onExited,children:i=>(0,D.jsx)("div",{style:Object.assign({},t,s[i]),children:e.children})})},Vt=e=>{var t;const{queryError:s}=e,i=!!s,o=i?100:10,r=s?"Query error":"Unknown error",a=(null===s||void 0===s?void 0:s.message)||(null===s||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||null;return(0,D.jsx)(Wt,{in:i,duration:o,children:(0,D.jsx)(n.Alert,{severity:"error",title:r,topSpacing:2,children:a})})};function Ut(e){const t=(0,o.useSelector)(t=>{var s;return null===(s=t.explore[e.exploreId])||void 0===s?void 0:s.queryResponse}),s=(null===t||void 0===t?void 0:t.state)===f.LoadingState.Error?null===t||void 0===t?void 0:t.error:void 0;return null!==s&&void 0!==s&&s.refId?null:(0,D.jsx)(Vt,{queryError:s})}var Gt=s("./public/app/features/explore/state/history.ts"),Kt=s("./public/app/core/utils/richHistory.ts"),Yt=s("./public/app/core/actions/index.ts"),Jt=s("./public/app/core/copy/appNotification.ts"),Xt=s("./public/app/store/store.ts");const es={changeDatasource:Fe.zU,deleteHistoryItem:Gt.NV,commentHistoryItem:Gt.Ff,starHistoryItem:Gt.ev,setQueries:u.KO},ts=(0,o.connect)(function(e,t){let{exploreId:s}=t;const i=e.explore,{datasourceInstance:o}=i[s];return{exploreId:s,datasourceInstance:o}},es),ss=(0,n.stylesFactory)((e,t)=>{const s=e.colors.bg2;return{queryCard:w.css`
      display: flex;
      flex-direction: column;
      border: 1px solid ${e.colors.border1};
      margin: ${e.spacing.sm} 0;
      background-color: ${s};
      border-radius: ${e.border.radius.sm};
      .starred {
        color: ${e.palette.orange};
      }
    `,cardRow:w.css`
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: ${e.spacing.sm};
      border-bottom: none;
      :first-of-type {
        border-bottom: 1px solid ${e.colors.border1};
        padding: ${e.spacing.xs} ${e.spacing.sm};
      }
      img {
        height: ${e.typography.size.base};
        max-width: ${e.typography.size.base};
        margin-right: ${e.spacing.sm};
      }
    `,datasourceContainer:w.css`
      display: flex;
      align-items: center;
      font-size: ${e.typography.size.sm};
      font-weight: ${e.typography.weight.semibold};
    `,queryActionButtons:w.css`
      max-width: ${"170px"};
      display: flex;
      justify-content: flex-end;
      font-size: ${e.typography.size.base};
      button {
        margin-left: ${e.spacing.sm};
      }
    `,queryContainer:w.css`
      font-weight: ${e.typography.weight.semibold};
      width: calc(100% - ${"240px"});
    `,queryRow:w.css`
      border-top: 1px solid ${e.colors.border1};
      word-break: break-all;
      padding: 4px 2px;
      :first-child {
        border-top: none;
        padding: 0 0 4px 0;
      }
    `,updateCommentContainer:w.css`
      width: calc(100% + ${"240px"});
      margin-top: ${e.spacing.sm};
    `,comment:w.css`
      overflow-wrap: break-word;
      font-size: ${e.typography.size.sm};
      font-weight: ${e.typography.weight.regular};
      margin-top: ${e.spacing.xs};
    `,commentButtonRow:w.css`
      > * {
        margin-right: ${e.spacing.sm};
      }
    `,textArea:w.css`
      width: 100%;
    `,runButton:w.css`
      max-width: ${"170px"};
      display: flex;
      justify-content: flex-end;
      button {
        height: auto;
        padding: ${e.spacing.xs} ${e.spacing.md};
        line-height: 1.4;
        span {
          white-space: normal !important;
        }
      }
    `}});const is=ts(function(e){var t;const{query:s,dsImg:o,isRemoved:a,commentHistoryItem:l,starHistoryItem:c,deleteHistoryItem:d,changeDatasource:p,exploreId:u,datasourceInstance:h,setQueries:g}=e,[m,f]=(0,i.useState)(!1),[y,v]=(0,i.useState)(s.comment),[b,S]=(0,i.useState)(void 0);(0,i.useEffect)(()=>{(async()=>{const e=await(0,r.getDataSourceSrv)().get(s.datasourceName);S(e)})()},[s.datasourceName]);const j=(0,n.useTheme)(),R=ss(j,a),T=()=>{l(s.id,y),f(!1)},I=()=>{f(!1),v(s.comment)},k=(0,D.jsxs)("div",{className:R.updateCommentContainer,"aria-label":y?"Update comment form":"Add comment form",children:[(0,D.jsx)(n.TextArea,{value:y,placeholder:y?void 0:"An optional description of what the query does.",onChange:e=>v(e.currentTarget.value),className:R.textArea}),(0,D.jsxs)("div",{className:R.commentButtonRow,children:[(0,D.jsx)(n.Button,{onClick:T,"aria-label":"Submit button",children:"Save comment"}),(0,D.jsx)(n.Button,{variant:"secondary",onClick:I,children:"Cancel"})]})]}),F=(0,D.jsxs)("div",{className:R.queryActionButtons,children:[(0,D.jsx)(n.IconButton,{name:"comment-alt",onClick:()=>f(!m),title:(null===(t=s.comment)||void 0===t?void 0:t.length)>0?"Edit comment":"Add comment"}),(0,D.jsx)(n.IconButton,{name:"copy",onClick:()=>{const e=s.queries.map(e=>(0,Kt.OH)(e,b)).join("\n");(0,x.n9)(e),(0,Xt.WI)((0,Yt.$l)((0,Jt.AT)("Query copied to clipboard")))},title:"Copy query to clipboard"}),!a&&(0,D.jsx)(n.IconButton,{name:"share-alt",onClick:async()=>{const e=(0,Kt.t2)(s);await(0,ve.L)(e)},title:"Copy shortened link to clipboard"}),(0,D.jsx)(n.IconButton,{name:"trash-alt",title:"Delete query",onClick:()=>{s.starred?C.Z.publish(new z.VJ({title:"Delete",text:"Are you sure you want to permanently delete your starred query?",yesText:"Delete",icon:"trash-alt",onConfirm:()=>{d(s.id),(0,Xt.WI)((0,Yt.$l)((0,Jt.AT)("Query deleted")))}})):(d(s.id),(0,Xt.WI)((0,Yt.$l)((0,Jt.AT)("Query deleted"))))}}),(0,D.jsx)(n.IconButton,{name:s.starred?"favorite":"star",iconType:s.starred?"mono":"default",onClick:()=>{c(s.id,!s.starred)},title:s.starred?"Unstar query":"Star query"})]});return(0,D.jsxs)("div",{className:R.queryCard,onKeyDown:e=>{"Enter"===e.key&&(e.shiftKey||e.ctrlKey)&&T(),"Escape"===e.key&&I()},children:[(0,D.jsxs)("div",{className:R.cardRow,children:[(0,D.jsxs)("div",{className:R.datasourceContainer,children:[(0,D.jsx)("img",{src:o,"aria-label":"Data source icon"}),(0,D.jsx)("div",{"aria-label":"Data source name",children:a?"Data source does not exist anymore":s.datasourceName})]}),F]}),(0,D.jsxs)("div",{className:(0,w.cx)(R.cardRow),children:[(0,D.jsxs)("div",{className:R.queryContainer,children:[s.queries.map((e,t)=>{const s=(0,Kt.OH)(e,b);return(0,D.jsx)("div",{"aria-label":"Query text",className:R.queryRow,children:s},`${e}-${t}`)}),!m&&s.comment&&(0,D.jsx)("div",{"aria-label":"Query comment",className:R.comment,children:s.comment}),m&&k]}),!m&&(0,D.jsx)("div",{className:R.runButton,children:(0,D.jsx)(n.Button,{variant:"secondary",onClick:async()=>{const e=s.queries;s.datasourceName!==(null===h||void 0===h?void 0:h.name)?(await p(u,s.datasourceName,{importQueries:!0}),g(u,e)):g(u,e)},disabled:a,children:(null===h||void 0===h?void 0:h.name)===s.datasourceName?"Run query":"Switch data source and run query"})})]})]})});var os,rs;const ns=(0,n.stylesFactory)((e,t)=>{const s=e.isLight?e.palette.gray5:e.palette.dark4,i=`${t-180}px`;return{container:w.css`
      display: flex;
      .label-slider {
        font-size: ${e.typography.size.sm};
        &:last-of-type {
          margin-top: ${e.spacing.lg};
        }
        &:first-of-type {
          font-weight: ${e.typography.weight.semibold};
          margin-bottom: ${e.spacing.md};
        }
      }
    `,containerContent:w.css`
      width: calc(${"100% - 134px"});
    `,containerSlider:w.css`
      width: 129px;
      margin-right: ${e.spacing.sm};
      .slider {
        bottom: 10px;
        height: ${i};
        width: 129px;
        padding: ${e.spacing.sm} 0;
      }
    `,slider:w.css`
      position: fixed;
    `,selectors:w.css`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,filterInput:w.css`
      margin-bottom: ${e.spacing.sm};
    `,multiselect:w.css`
      width: 100%;
      margin-bottom: ${e.spacing.sm};
      .gf-form-select-box__multi-value {
        background-color: ${s};
        padding: ${e.spacing.xxs} ${e.spacing.xs} ${e.spacing.xxs} ${e.spacing.sm};
        border-radius: ${e.border.radius.sm};
      }
    `,sort:w.css`
      width: 170px;
    `,sessionName:w.css`
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      margin-top: ${e.spacing.lg};
      h4 {
        margin: 0 10px 0 0;
      }
    `,heading:w.css`
      font-size: ${e.typography.heading.h4};
      margin: ${e.spacing.md} ${e.spacing.xxs} ${e.spacing.sm} ${e.spacing.xxs};
    `,footer:w.css`
      height: 60px;
      margin: ${e.spacing.lg} auto;
      display: flex;
      justify-content: center;
      font-weight: ${e.typography.weight.light};
      font-size: ${e.typography.size.sm};
      a {
        font-weight: ${e.typography.weight.semibold};
        margin-left: ${e.spacing.xxs};
      }
    `,queries:w.css`
      font-size: ${e.typography.size.sm};
      font-weight: ${e.typography.weight.regular};
      margin-left: ${e.spacing.xs};
    `}});function as(e){const{queries:t,richHistorySearchFilters:s,updateFilters:o,clearRichHistoryResults:r,richHistorySettings:a,exploreId:l,height:c,activeDatasourceInstance:d}=e,p=(0,n.useTheme)(),u=ns(p,c),h=(0,Kt.DR)();if((0,i.useEffect)(()=>{const e=a.activeDatasourceOnly&&d?[d]:a.lastUsedDatasourceFilters,t={search:"",sortOrder:Kt.As.Descending,datasourceFilters:e,from:0,to:a.retentionPeriod,starred:!1};return o(t),()=>{r()}},[]),!s)return os||(os=(0,D.jsx)("span",{children:"Loading..."}));const g=(0,Kt.k4)(t,s.sortOrder);return(0,D.jsxs)("div",{className:u.container,children:[(0,D.jsx)("div",{className:u.containerSlider,children:(0,D.jsxs)("div",{className:u.slider,children:[rs||(rs=(0,D.jsx)("div",{className:"label-slider",children:"Filter history"})),(0,D.jsx)("div",{className:"label-slider",children:(0,Kt.bQ)(s.from)}),(0,D.jsx)("div",{className:"slider",children:(0,D.jsx)(n.RangeSlider,{tooltipAlwaysVisible:!1,min:0,max:a.retentionPeriod,value:[s.from,s.to],orientation:"vertical",formatTooltipResult:Kt.bQ,reverse:!0,onAfterChange:e=>{o({from:e[0],to:e[1]})}})}),(0,D.jsx)("div",{className:"label-slider",children:(0,Kt.bQ)(s.to)})]})}),(0,D.jsxs)("div",{className:u.containerContent,children:[(0,D.jsxs)("div",{className:u.selectors,children:[!a.activeDatasourceOnly&&(0,D.jsx)(n.MultiSelect,{className:u.multiselect,options:h.map(e=>({value:e.name,label:e.name})),value:s.datasourceFilters,placeholder:"Filter queries for data sources(s)","aria-label":"Filter queries for data sources(s)",onChange:e=>{o({datasourceFilters:e.map(e=>e.value)})}}),(0,D.jsx)("div",{className:u.filterInput,children:(0,D.jsx)(n.FilterInput,{placeholder:"Search queries",value:s.search,onChange:e=>o({search:e})})}),(0,D.jsx)("div",{"aria-label":"Sort queries",className:u.sort,children:(0,D.jsx)(n.Select,{value:ys.filter(e=>e.value===s.sortOrder),options:ys,placeholder:"Sort queries by",onChange:e=>o({sortOrder:e.value})})})]}),Object.keys(g).map(e=>(0,D.jsxs)("div",{children:[(0,D.jsxs)("div",{className:u.heading,children:[e," ",(0,D.jsxs)("span",{className:u.queries,children:[g[e].length," queries"]})]}),g[e].map(e=>{const t=h.findIndex(t=>t.name===e.datasourceName);return(0,D.jsx)(is,{query:e,exploreId:l,dsImg:-1===t?"public/img/icn-datasource.svg":h[t].imgUrl,isRemoved:-1===t},e.id)})]},e)),(0,D.jsx)("div",{className:u.footer,children:"The history is local to your browser and is not shared with others."})]})]})}var ls=s("./public/app/core/history/RichHistoryLocalStorage.ts");const cs=(0,n.stylesFactory)(e=>({container:w.css`
      font-size: ${e.typography.size.sm};
      .space-between {
        margin-bottom: ${e.spacing.lg};
      }
    `,input:w.css`
      max-width: 200px;
    `})),ds=[{value:2,label:"2 days"},{value:5,label:"5 days"},{value:7,label:"1 week"},{value:14,label:"2 weeks"}];function ps(e){const{retentionPeriod:t,starredTabAsFirstTab:s,activeDatasourceOnly:i,onChangeRetentionPeriod:o,toggleStarredTabAsFirstTab:r,toggleactiveDatasourceOnly:a,deleteRichHistory:l}=e,c=(0,n.useTheme)(),d=cs(c),p=ds.find(e=>e.value===t);return(0,D.jsxs)("div",{className:d.container,children:[(0,D.jsx)(n.Field,{label:"History time span",description:`Select the period of time for which Grafana will save your query history. Up to ${ls.H6} entries will be stored.`,className:"space-between",children:(0,D.jsx)("div",{className:d.input,children:(0,D.jsx)(n.Select,{value:p,options:ds,onChange:o})})}),(0,D.jsx)(n.InlineField,{label:"Change the default active tab from “Query history” to “Starred”",className:"space-between",children:(0,D.jsx)(n.InlineSwitch,{id:"explore-query-history-settings-default-active-tab",value:s,onChange:r})}),(0,D.jsx)(n.InlineField,{label:"Only show queries for data source currently active in Explore",className:"space-between",children:(0,D.jsx)(n.InlineSwitch,{id:"explore-query-history-settings-data-source-behavior",value:i,onChange:a})}),(0,D.jsx)("div",{className:w.css`
          font-weight: ${c.typography.weight.bold};
        `,children:"Clear query history"}),(0,D.jsx)("div",{className:w.css`
          margin-bottom: ${c.spacing.sm};
        `,children:"Delete all of your query history, permanently."}),(0,D.jsx)(n.Button,{variant:"destructive",onClick:()=>{C.Z.publish(new z.VJ({title:"Delete",text:"Are you sure you want to permanently delete your query history?",yesText:"Delete",icon:"trash-alt",onConfirm:()=>{l(),(0,Xt.WI)((0,Yt.$l)((0,Jt.AT)("Query history deleted")))}}))},children:"Clear query history"})]})}var us;const hs=(0,n.stylesFactory)(e=>{const t=e.isLight?e.palette.gray5:e.palette.dark4;return{container:w.css`
      display: flex;
    `,containerContent:w.css`
      width: 100%;
    `,selectors:w.css`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,multiselect:w.css`
      width: 100%;
      margin-bottom: ${e.spacing.sm};
      .gf-form-select-box__multi-value {
        background-color: ${t};
        padding: ${e.spacing.xxs} ${e.spacing.xs} ${e.spacing.xxs} ${e.spacing.sm};
        border-radius: ${e.border.radius.sm};
      }
    `,filterInput:w.css`
      margin-bottom: ${e.spacing.sm};
    `,sort:w.css`
      width: 170px;
    `,footer:w.css`
      height: 60px;
      margin-top: ${e.spacing.lg};
      display: flex;
      justify-content: center;
      font-weight: ${e.typography.weight.light};
      font-size: ${e.typography.size.sm};
      a {
        font-weight: ${e.typography.weight.semibold};
        margin-left: ${e.spacing.xxs};
      }
    `}});function gs(e){const{updateFilters:t,clearRichHistoryResults:s,activeDatasourceInstance:o,richHistorySettings:r,queries:a,richHistorySearchFilters:l,exploreId:c}=e,d=(0,n.useTheme)(),p=hs(d),u=(0,Kt.DR)();return(0,i.useEffect)(()=>{const e=r.activeDatasourceOnly&&o?[o]:r.lastUsedDatasourceFilters,i={search:"",sortOrder:Kt.As.Descending,datasourceFilters:e,from:0,to:r.retentionPeriod,starred:!0};return t(i),()=>{s()}},[]),l?(0,D.jsx)("div",{className:p.container,children:(0,D.jsxs)("div",{className:p.containerContent,children:[(0,D.jsxs)("div",{className:p.selectors,children:[!r.activeDatasourceOnly&&(0,D.jsx)(n.MultiSelect,{className:p.multiselect,options:u.map(e=>({value:e.name,label:e.name})),value:l.datasourceFilters,placeholder:"Filter queries for data sources(s)","aria-label":"Filter queries for data sources(s)",onChange:e=>{t({datasourceFilters:e.map(e=>e.value)})}}),(0,D.jsx)("div",{className:p.filterInput,children:(0,D.jsx)(n.FilterInput,{placeholder:"Search queries",value:l.search,onChange:e=>t({search:e})})}),(0,D.jsx)("div",{"aria-label":"Sort queries",className:p.sort,children:(0,D.jsx)(n.Select,{value:ys.filter(e=>e.value===l.sortOrder),options:ys,placeholder:"Sort queries by",onChange:e=>t({sortOrder:e.value})})})]}),a.map(e=>{const t=u.findIndex(t=>t.name===e.datasourceName);return(0,D.jsx)(is,{query:e,exploreId:c,dsImg:-1===t?"public/img/icn-datasource.svg":u[t].imgUrl,isRemoved:-1===t},e.id)}),(0,D.jsx)("div",{className:p.footer,children:"The history is local to your browser and is not shared with others."})]})}):us||(us=(0,D.jsx)("span",{children:"Loading..."}))}function ms(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}let fs;!function(e){e.RichHistory="Query history",e.Starred="Starred",e.Settings="Settings"}(fs||(fs={}));const ys=[{label:"Newest first",value:Kt.As.Descending},{label:"Oldest first",value:Kt.As.Ascending},{label:"Data source A-Z",value:Kt.As.DatasourceAZ},{label:"Data source Z-A",value:Kt.As.DatasourceZA}];const vs=(0,n.withTheme)(class extends i.PureComponent{constructor(){super(...arguments),ms(this,"updateSettings",e=>{this.props.updateHistorySettings(Object.assign({},this.props.richHistorySettings,e))}),ms(this,"updateFilters",e=>{const t=Object.assign({},this.props.richHistorySearchFilters,e);this.props.updateHistorySearchFilters(this.props.exploreId,t),this.loadRichHistory()}),ms(this,"clearResults",()=>{this.props.clearRichHistoryResults(this.props.exploreId)}),ms(this,"loadRichHistory",(0,I.debounce)(()=>{this.props.loadRichHistory(this.props.exploreId)},300)),ms(this,"onChangeRetentionPeriod",e=>{void 0!==e.value&&this.updateSettings({retentionPeriod:e.value})}),ms(this,"toggleStarredTabAsFirstTab",()=>this.updateSettings({starredTabAsFirstTab:!this.props.richHistorySettings.starredTabAsFirstTab})),ms(this,"toggleActiveDatasourceOnly",()=>this.updateSettings({activeDatasourceOnly:!this.props.richHistorySettings.activeDatasourceOnly}))}render(){const{richHistory:e,height:t,exploreId:s,deleteRichHistory:i,onClose:o,firstTab:r,activeDatasourceInstance:a}=this.props;let l=[{label:"Query history",value:fs.RichHistory,content:(0,D.jsx)(as,{queries:e,updateFilters:this.updateFilters,clearRichHistoryResults:()=>this.props.clearRichHistoryResults(this.props.exploreId),activeDatasourceInstance:a,richHistorySettings:this.props.richHistorySettings,richHistorySearchFilters:this.props.richHistorySearchFilters,exploreId:s,height:t}),icon:"history"},{label:"Starred",value:fs.Starred,content:(0,D.jsx)(gs,{queries:e,activeDatasourceInstance:a,updateFilters:this.updateFilters,clearRichHistoryResults:()=>this.props.clearRichHistoryResults(this.props.exploreId),richHistorySettings:this.props.richHistorySettings,richHistorySearchFilters:this.props.richHistorySearchFilters,exploreId:s}),icon:"star"},{label:"Settings",value:fs.Settings,content:(0,D.jsx)(ps,{retentionPeriod:this.props.richHistorySettings.retentionPeriod,starredTabAsFirstTab:this.props.richHistorySettings.starredTabAsFirstTab,activeDatasourceOnly:this.props.richHistorySettings.activeDatasourceOnly,onChangeRetentionPeriod:this.onChangeRetentionPeriod,toggleStarredTabAsFirstTab:this.toggleStarredTabAsFirstTab,toggleactiveDatasourceOnly:this.toggleActiveDatasourceOnly,deleteRichHistory:i}),icon:"sliders-v-alt"}];return(0,D.jsx)(n.TabbedContainer,{tabs:l,onClose:o,defaultTab:r,closeIconTooltip:"Close query history"})}});var xs;const bs={initRichHistory:Gt.sO,loadRichHistory:Gt.TV,clearRichHistoryResults:Gt.Cs,updateHistorySettings:Gt.ch,updateHistorySearchFilters:Gt.KZ,deleteRichHistory:Gt.ik};const ws=(0,o.connect)(function(e,t){let{exploreId:s}=t;const i=e.explore,o=i[s],r=o.richHistorySearchFilters,n=i.richHistorySettings,{datasourceInstance:a}=o,l=null!==n&&void 0!==n&&n.starredTabAsFirstTab?fs.Starred:fs.RichHistory,{richHistory:c}=o;return{richHistory:c,firstTab:l,activeDatasourceInstance:null===a||void 0===a?void 0:a.name,richHistorySettings:n,richHistorySearchFilters:r}},bs)(function(e){const t=(0,n.useTheme2)(),[s,o]=(0,i.useState)(t.components.horizontalDrawer.defaultHeight),{richHistory:r,width:a,firstTab:l,activeDatasourceInstance:c,exploreId:d,deleteRichHistory:p,initRichHistory:u,loadRichHistory:h,clearRichHistoryResults:g,richHistorySettings:m,updateHistorySettings:f,richHistorySearchFilters:y,updateHistorySearchFilters:v,onClose:x}=e;return(0,i.useEffect)(()=>{u()},[u]),m?(0,D.jsx)(de,{width:a,onResize:(e,t,s)=>{o(Number(s.style.height.slice(0,-2)))},children:(0,D.jsx)(vs,{richHistory:r,firstTab:l,activeDatasourceInstance:c,exploreId:d,onClose:x,height:s,deleteRichHistory:p,richHistorySettings:m,richHistorySearchFilters:y,updateHistorySettings:f,updateHistorySearchFilters:v,loadRichHistory:h,clearRichHistoryResults:g})}):xs||(xs=(0,D.jsx)("span",{children:"Loading..."}))}),Ss=e=>({containerMargin:w.css`
      margin-top: ${e.spacing(2)};
    `});function js(e){const t=(0,n.useTheme2)(),s=Ss(t);return(0,D.jsx)("div",{className:s.containerMargin,children:(0,D.jsxs)(n.HorizontalGroup,{children:[!e.addQueryRowButtonHidden&&(0,D.jsx)(n.Button,{variant:"secondary","aria-label":"Add row button",onClick:e.onClickAddQueryRowButton,disabled:e.addQueryRowButtonDisabled,icon:"plus",children:"Add query"}),(0,D.jsx)(n.Button,{variant:"secondary","aria-label":"Rich history button",className:(0,w.cx)({"explore-active-button":e.richHistoryButtonActive}),onClick:e.onClickRichHistoryButton,icon:"history",children:"Query history"}),(0,D.jsx)(n.Button,{variant:"secondary","aria-label":"Query inspector button",className:(0,w.cx)({"explore-active-button":e.queryInspectorButtonActive}),onClick:e.onClickQueryInspectorButton,icon:"info-circle",children:"Inspector"})]})})}var Rs=s("./public/app/core/config.ts"),Cs=s("./public/app/core/constants.ts");const Ts={splitOpen:p.bW},zs=(0,o.connect)(function(e,t){let{exploreId:s}=t;const i=e.explore[s],{loading:o,tableResult:r,range:n}=i;return{loading:!(r&&r.length>0)&&o,tableResult:r,range:n}},Ts);const Is=zs(class extends i.PureComponent{getTableHeight(){const{tableResult:e}=this.props;return e&&0!==e.length?Math.max(Math.min(600,35*e.length)+35):200}render(){var e,t;const{loading:s,onCellFilterAdded:i,tableResult:o,width:r,splitOpen:a,range:l,ariaLabel:c,timeZone:d}=this.props,p=this.getTableHeight(),u=r-2*Rs.vc.theme.panelPadding-Cs.QO;let h=o;if(null!==(e=h)&&void 0!==e&&e.length){h=(0,f.applyFieldOverrides)({data:[h],timeZone:d,theme:Rs.vc.theme2,replaceVariables:e=>e,fieldConfig:{defaults:{},overrides:[]}})[0];for(const e of h.fields)e.getLinks=(t=>(0,yt.a)({field:e,rowIndex:t.valueRowIndex,splitOpenFn:a,range:l,dataFrame:h}))}return(0,D.jsx)(n.Collapse,{label:"Table",loading:s,isOpen:!0,children:null!==(t=h)&&void 0!==t&&t.length?(0,D.jsx)(n.Table,{ariaLabel:c,data:h,width:u,height:p,onCellFilterAdded:i}):(0,D.jsx)(Ye,{metaItems:[{value:"0 series returned"}]})})}});var ks=s("./packages/jaeger-ui-components/src/TracePageHeader/TracePageSearchBar.tsx"),Fs=s("./packages/jaeger-ui-components/src/TraceTimelineViewer/VirtualizedTraceView.tsx"),Ls=s("./public/app/features/explore/TraceView/TraceView.tsx"),Os=s("./public/app/features/explore/TraceView/useSearch.ts"),Ns=s("./public/app/features/explore/TraceView/utils/transform.ts");function Ds(e){const t=e.dataFrames[0],{dataFrames:s,splitOpenFn:r,exploreId:a,scrollElement:l,topOfViewRef:c,queryResponse:d}=e,p=(0,i.useMemo)(()=>(0,Ns.N)(t),[t]),{search:u,setSearch:h,spanFindMatches:g}=(0,Os.R)(null===p||void 0===p?void 0:p.spans),[m,f]=(0,i.useState)(""),[y,v]=(0,i.useState)(""),x=(0,o.useSelector)(t=>{var s,i;return null!==(s=null===(i=t.explore[e.exploreId])||void 0===i?void 0:i.datasourceInstance)&&void 0!==s?s:void 0});return p?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(ks.Z,{navigable:!0,searchValue:u,setSearch:h,spanFindMatches:g,searchBarSuffix:y,setSearchBarSuffix:v,focusedSpanIdForSearch:m,setFocusedSpanIdForSearch:f}),(0,D.jsx)(n.Collapse,{label:"Trace View",isOpen:!0,children:(0,D.jsx)(Ls.m,{exploreId:a,dataFrames:s,splitOpenFn:r,scrollElement:l,traceProp:p,spanFindMatches:g,search:u,focusedSpanIdForSearch:m,queryResponse:d,datasource:x,topOfViewRef:c,topOfViewRefType:Fs.l4.Explore})})]}):null}var $s,Ps,Es=s("./public/app/features/explore/state/explorePane.ts");function As(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const Ms=e=>({exploreMain:w.css`
      label: exploreMain;
      // Is needed for some transition animations to work.
      position: relative;
      margin-top: 21px;
    `,button:w.css`
      label: button;
      margin: 1em 4px 0 0;
    `,queryContainer:w.css`
      label: queryContainer;
      // Need to override normal css class and don't want to count on ordering of the classes in html.
      height: auto !important;
      flex: unset !important;
      display: unset !important;
      padding: ${e.spacing(1)};
    `});var Bs;!function(e){e[e.RichHistory=0]="RichHistory",e[e.QueryInspector=1]="QueryInspector"}(Bs||(Bs={}));const Hs={changeSize:Es.qN,changeGraphStyle:Es.Rl,modifyQueries:u.sK,scanStart:u.EA,scanStopAction:u.P4,setQueries:u.KO,updateTimeRange:Le.cD,makeAbsoluteTime:Le.F9,loadLogsVolumeData:u.QH,addQueryRow:u.CS,splitOpen:p.bW},qs=(0,o.connect)(function(e,t){let{exploreId:s}=t;const i=e.explore,{syncedTimes:o}=i,r=i[s],n=(0,b.Z)(e.user),{datasourceInstance:a,datasourceMissing:l,queryKeys:c,isLive:d,graphResult:p,logsVolumeData:u,logsResult:h,showLogs:g,showMetrics:m,showTable:f,showTrace:y,absoluteRange:v,queryResponse:x,showNodeGraph:w,loading:S,graphStyle:j}=r;return{datasourceInstance:a,datasourceMissing:l,queryKeys:c,isLive:d,graphResult:p,logsVolumeData:u,logsResult:null!==h&&void 0!==h?h:void 0,absoluteRange:v,queryResponse:x,syncedTimes:o,timeZone:n,showLogs:g,showMetrics:m,showTable:f,showTrace:y,showNodeGraph:w,loading:S,graphStyle:j}},Hs),_s=(0,j.compose)(qs,n.withTheme2)(class extends i.PureComponent{constructor(e){super(e),As(this,"scrollElement",void 0),As(this,"absoluteTimeUnsubsciber",void 0),As(this,"topOfViewRef",(0,i.createRef)()),As(this,"onChangeTime",e=>{const{updateTimeRange:t,exploreId:s}=this.props;t({exploreId:s,rawRange:e})}),As(this,"onClickExample",e=>{this.props.setQueries(this.props.exploreId,[e])}),As(this,"onCellFilterAdded",e=>{const{value:t,key:s,operator:i}=e;i===R.PT&&this.onClickFilterLabel(s,t),i===R.tE&&this.onClickFilterOutLabel(s,t)}),As(this,"onClickFilterLabel",(e,t)=>{this.onModifyQueries({type:"ADD_FILTER",key:e,value:t})}),As(this,"onClickFilterOutLabel",(e,t)=>{this.onModifyQueries({type:"ADD_FILTER_OUT",key:e,value:t})}),As(this,"onClickAddQueryRowButton",()=>{const{exploreId:e,queryKeys:t}=this.props;this.props.addQueryRow(e,t.length)}),As(this,"onMakeAbsoluteTime",()=>{const{makeAbsoluteTime:e}=this.props;e()}),As(this,"onModifyQueries",(e,t)=>{const{datasourceInstance:s}=this.props;if(null!==s&&void 0!==s&&s.modifyQuery){const i=(e,t)=>s.modifyQuery(e,t);this.props.modifyQueries(this.props.exploreId,e,i,t)}}),As(this,"onResize",e=>{this.props.changeSize(this.props.exploreId,e)}),As(this,"onStartScanning",()=>{this.props.scanStart(this.props.exploreId)}),As(this,"onStopScanning",()=>{this.props.scanStopAction({exploreId:this.props.exploreId})}),As(this,"onUpdateTimeRange",e=>{const{exploreId:t,updateTimeRange:s}=this.props;s({exploreId:t,absoluteRange:e})}),As(this,"onChangeGraphStyle",e=>{const{exploreId:t,changeGraphStyle:s}=this.props;s(t,e)}),As(this,"toggleShowRichHistory",()=>{this.setState(e=>({openDrawer:e.openDrawer===Bs.RichHistory?void 0:Bs.RichHistory}))}),As(this,"toggleShowQueryInspector",()=>{this.setState(e=>({openDrawer:e.openDrawer===Bs.QueryInspector?void 0:Bs.QueryInspector}))}),As(this,"memoizedGetNodeGraphDataFrames",(0,m.Z)(T.Ee)),this.state={openDrawer:void 0}}componentDidMount(){this.absoluteTimeUnsubsciber=C.Z.subscribe(z.QI,this.onMakeAbsoluteTime)}componentWillUnmount(){var e;null===(e=this.absoluteTimeUnsubsciber)||void 0===e||e.unsubscribe()}renderEmptyState(){return $s||($s=(0,D.jsx)("div",{className:"explore-container",children:(0,D.jsx)(Ot,{})}))}renderNoData(){return Ps||(Ps=(0,D.jsx)(zt,{}))}renderGraphPanel(e){const{graphResult:t,absoluteRange:s,timeZone:i,splitOpen:o,queryResponse:r,loading:a,theme:l,graphStyle:c}=this.props,d=parseInt(l.spacing(2).slice(0,-2),10),p=(0,D.jsx)(H,{graphStyle:c,onChangeGraphStyle:this.onChangeGraphStyle});return(0,D.jsx)(n.Collapse,{label:p,loading:a,isOpen:!0,children:(0,D.jsx)(P,{graphStyle:c,data:t,height:400,width:e-d,absoluteRange:s,onChangeTime:this.onUpdateTimeRange,timeZone:i,annotations:r.annotations,splitOpenFn:o,loadingState:r.state})})}renderLogsVolume(e){const{logsVolumeData:t,exploreId:s,loadLogsVolumeData:i,absoluteRange:o,timeZone:r,splitOpen:n}=this.props;return(0,D.jsx)(Ct,{absoluteRange:o,width:e,logsVolumeData:t,onUpdateTimeRange:this.onUpdateTimeRange,timeZone:r,splitOpen:n,onLoadLogsVolume:()=>i(s)})}renderTablePanel(e){const{exploreId:t,datasourceInstance:s,timeZone:i}=this.props;return(0,D.jsx)(Is,{ariaLabel:y.wl.pages.Explore.General.table,width:e,exploreId:t,onCellFilterAdded:null!==s&&void 0!==s&&s.modifyQuery?this.onCellFilterAdded:void 0,timeZone:i})}renderLogsPanel(e){const{exploreId:t,syncedTimes:s,theme:i,queryResponse:o}=this.props,r=parseInt(i.spacing(2).slice(0,-2),10);return(0,D.jsx)(bt,{exploreId:t,loadingState:o.state,syncedTimes:s,width:e-r,onClickFilterLabel:this.onClickFilterLabel,onClickFilterOutLabel:this.onClickFilterOutLabel,onStartScanning:this.onStartScanning,onStopScanning:this.onStopScanning})}renderNodeGraphPanel(){const{exploreId:e,showTrace:t,queryResponse:s}=this.props;return(0,D.jsx)(Mt,{dataFrames:this.memoizedGetNodeGraphDataFrames(s.series),exploreId:e,withTraceView:t})}renderTraceViewPanel(){const{queryResponse:e,splitOpen:t,exploreId:s}=this.props,i=e.series.filter(e=>{var t;return"trace"===(null===(t=e.meta)||void 0===t?void 0:t.preferredVisualisationType)});return i.length&&(0,D.jsx)(Ds,{exploreId:s,dataFrames:i,splitOpenFn:t,scrollElement:this.scrollElement,queryResponse:e,topOfViewRef:this.topOfViewRef})}render(){const{datasourceInstance:e,datasourceMissing:t,exploreId:s,graphResult:i,queryResponse:o,isLive:r,theme:a,showMetrics:l,showTable:c,showLogs:d,showTrace:p,showNodeGraph:u,timeZone:h}=this.props,{openDrawer:g}=this.state,m=Ms(a),v=o&&o.state!==f.LoadingState.NotStarted,x=g===Bs.RichHistory,b=g===Bs.QueryInspector,j=o.state===f.LoadingState.Done&&[o.logsFrames,o.graphFrames,o.nodeGraphFrames,o.tableFrames,o.traceFrames].every(e=>0===e.length);return(0,D.jsxs)(n.CustomScrollbar,{testId:y.wl.pages.Explore.General.scrollView,autoHeightMin:"100%",scrollRefCallback:e=>this.scrollElement=e||void 0,children:[(0,D.jsx)(Pe,{exploreId:s,onChangeTime:this.onChangeTime,topOfViewRef:this.topOfViewRef}),t?this.renderEmptyState():null,e&&(0,D.jsxs)("div",{className:"explore-container",children:[(0,D.jsxs)("div",{className:(0,w.cx)("panel-container",m.queryContainer),children:[(0,D.jsx)(Zt,{exploreId:s}),(0,D.jsx)(js,{addQueryRowButtonDisabled:r,addQueryRowButtonHidden:!1,richHistoryButtonActive:x,queryInspectorButtonActive:b,onClickAddQueryRowButton:this.onClickAddQueryRowButton,onClickRichHistoryButton:this.toggleShowRichHistory,onClickQueryInspectorButton:this.toggleShowQueryInspector}),(0,D.jsx)(Ut,{exploreId:s})]}),(0,D.jsx)(S.Z,{onResize:this.onResize,disableHeight:!0,children:e=>{let{width:t}=e;return 0===t?null:(0,D.jsx)("main",{className:(0,w.cx)(m.exploreMain),style:{width:t},children:(0,D.jsxs)(n.ErrorBoundaryAlert,{children:[v&&(0,D.jsxs)(D.Fragment,{children:[l&&i&&(0,D.jsx)(n.ErrorBoundaryAlert,{children:this.renderGraphPanel(t)}),(0,D.jsx)(n.ErrorBoundaryAlert,{children:this.renderLogsVolume(t)}),c&&(0,D.jsx)(n.ErrorBoundaryAlert,{children:this.renderTablePanel(t)}),d&&(0,D.jsx)(n.ErrorBoundaryAlert,{children:this.renderLogsPanel(t)}),u&&(0,D.jsx)(n.ErrorBoundaryAlert,{children:this.renderNodeGraphPanel()}),p&&(0,D.jsx)(n.ErrorBoundaryAlert,{children:this.renderTraceViewPanel()}),j&&(0,D.jsx)(n.ErrorBoundaryAlert,{children:this.renderNoData()})]}),x&&(0,D.jsx)(ws,{width:t,exploreId:s,onClose:this.toggleShowRichHistory}),b&&(0,D.jsx)(ye,{exploreId:s,width:t,onClose:this.toggleShowQueryInspector,timeZone:h})]})})}})]})]})}});function Zs(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const Qs=(0,m.Z)(x.Z8),Ws=(0,m.Z)(x.vP);const Vs={initializeExplore:Es.CK,refreshExplore:Es.Om,cleanupPaneAction:p.Jt},Us=(0,o.connect)(function(e,t){var s;const i=(0,x.J5)(t.urlQuery),o=(0,b.Z)(e.user),r=(0,b.i)(e.user),{datasource:n,queries:a,range:l,panelsState:c}=i||{},d=n||v.Z.get((0,x.I$)(e.user.orgId)),p=Qs(a),u=l?Ws(l,o,r):(0,x.OQ)(o,x.UI,r);return{initialized:null===(s=e.explore[t.exploreId])||void 0===s?void 0:s.initialized,initialDatasource:d,initialQueries:p,initialRange:u,panelsState:c}},Vs)(class extends i.PureComponent{constructor(e){super(e),Zs(this,"el",void 0),Zs(this,"exploreEvents",void 0),Zs(this,"refreshExplore",e=>{const{exploreId:t,urlQuery:s}=this.props;s!==e&&s!==p.IS[t]&&this.props.refreshExplore(t,s)}),Zs(this,"getRef",e=>{this.el=e}),this.exploreEvents=new f.EventBusSrv,this.state={openDrawer:void 0}}componentDidMount(){var e,t;const{initialized:s,exploreId:i,initialDatasource:o,initialQueries:r,initialRange:n,panelsState:a}=this.props,l=null!==(e=null===(t=this.el)||void 0===t?void 0:t.offsetWidth)&&void 0!==e?e:0;s||this.props.initializeExplore(i,o,r,n,l,this.exploreEvents,a)}componentWillUnmount(){this.exploreEvents.removeAllListeners(),this.props.cleanupPaneAction({exploreId:this.props.exploreId})}componentDidUpdate(e){this.refreshExplore(e.urlQuery)}render(){const e=this.props.split?"explore explore-split":"explore";return(0,D.jsx)("div",{className:e,ref:this.getRef,"data-testid":y.wl.pages.Explore.General.container,children:this.props.initialized&&(0,D.jsx)(_s,{exploreId:this.props.exploreId})})}}),Gs={resetExploreAction:p.WK,richHistoryUpdatedAction:p.ZU},Ks=(0,o.connect)(e=>({navModel:(0,c.h)(e.navIndex,"explore"),exploreState:e.explore}),Gs);const Ys=Ks(class extends i.PureComponent{componentWillUnmount(){this.props.resetExploreAction({})}componentDidMount(){p.IS.left=void 0,p.IS.right=void 0;const e=r.locationService.getSearchObject();(e.from||e.to)&&r.locationService.partial({from:void 0,to:void 0},!0)}componentDidUpdate(e){var t,s,i,o;const{left:r,right:n}=this.props.queryParams,a=Boolean(r)&&Boolean(n)?`${null===(t=this.props.exploreState.left.datasourceInstance)||void 0===t?void 0:t.name} | ${null===(s=this.props.exploreState.right)||void 0===s?void 0:null===(i=s.datasourceInstance)||void 0===i?void 0:i.name}`:`${null===(o=this.props.exploreState.left.datasourceInstance)||void 0===o?void 0:o.name}`,c=`${this.props.navModel.main.text} - ${a} - ${l.c.AppTitle}`;document.title=c}render(){const{left:e,right:t}=this.props.queryParams,s=Boolean(e)&&Boolean(t);return(0,D.jsxs)("div",{className:"page-scrollbar-wrapper",children:[(0,D.jsx)(g,{exploreIdLeft:a.K.left,exploreIdRight:a.K.right}),(0,D.jsxs)("div",{className:"explore-wrapper",children:[(0,D.jsx)(n.ErrorBoundaryAlert,{style:"page",children:(0,D.jsx)(Us,{split:s,exploreId:a.K.left,urlQuery:e})}),s&&(0,D.jsx)(n.ErrorBoundaryAlert,{style:"page",children:(0,D.jsx)(Us,{split:s,exploreId:a.K.right,urlQuery:t})})]})]})}})},"./public/app/features/explore/state/selectors.ts":(e,t,s)=>{"use strict";s.d(t,{F:()=>r,p:()=>o});var i=s("./public/app/types/index.ts");const o=e=>Boolean(e.explore[i.Kd.left]&&e.explore[i.Kd.right]),r=e=>t=>t.explore[e]},"./.yarn/__virtual__/react-use-virtual-00326e70ba/0/cache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/usePrevious.js":(e,t,s)=>{"use strict";s.d(t,{Z:()=>(function(e){var t=(0,i.useRef)();return(0,i.useEffect)(function(){t.current=e}),t.current})});var i=s("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js")},"./.yarn/cache/fast-memoize-npm-2.5.2-f42a7c6940-79fa759719.zip/node_modules/fast-memoize/src/index.js":e=>{function t(e,t,s,i){var o,r=null==(o=i)||"number"==typeof o||"boolean"==typeof o?i:s(i),n=t.get(r);return void 0===n&&(n=e.call(this,i),t.set(r,n)),n}function s(e,t,s){var i=Array.prototype.slice.call(arguments,3),o=s(i),r=t.get(o);return void 0===r&&(r=e.apply(this,i),t.set(o,r)),r}function i(e,t,s,i,o){return s.bind(t,e,i,o)}function o(e,o){return i(e,this,1===e.length?t:s,o.cache.create(),o.serializer)}function r(){return JSON.stringify(arguments)}function n(){this.cache=Object.create(null)}n.prototype.has=function(e){return e in this.cache},n.prototype.get=function(e){return this.cache[e]},n.prototype.set=function(e,t){this.cache[e]=t};var a={create:function(){return new n}};e.exports=function(e,t){var s=t&&t.cache?t.cache:a,i=t&&t.serializer?t.serializer:r;return(t&&t.strategy?t.strategy:o)(e,{cache:s,serializer:i})},e.exports.strategies={variadic:function(e,t){return i(e,this,s,t.cache.create(),t.serializer)},monadic:function(e,s){return i(e,this,t,s.cache.create(),s.serializer)}}},"./.yarn/cache/immer-npm-9.0.12-e8cd7358fa-bcbec6d76d.zip/node_modules/immer/dist/immer.esm.js":(e,t,s)=>{"use strict";function i(e){for(var t=arguments.length,s=Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];throw Error("[Immer] minified error nr: "+e+(s.length?" "+s.map(function(e){return"'"+e+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function o(e){return!!e&&!!e[Q]}function r(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var s=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return s===Object||"function"==typeof s&&Function.toString.call(s)===W}(e)||Array.isArray(e)||!!e[Z]||!!e.constructor[Z]||u(e)||h(e))}function n(e,t,s){void 0===s&&(s=!1),0===a(e)?(s?Object.keys:V)(e).forEach(function(i){s&&"symbol"==typeof i||t(i,e[i],e)}):e.forEach(function(s,i){return t(i,s,e)})}function a(e){var t=e[Q];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:u(e)?2:h(e)?3:0}function l(e,t){return 2===a(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function c(e,t){return 2===a(e)?e.get(t):e[t]}function d(e,t,s){var i=a(e);2===i?e.set(t,s):3===i?(e.delete(t),e.add(s)):e[t]=s}function p(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function u(e){return B&&e instanceof Map}function h(e){return H&&e instanceof Set}function g(e){return e.o||e.t}function m(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=U(e);delete t[Q];for(var s=V(t),i=0;i<s.length;i++){var o=s[i],r=t[o];!1===r.writable&&(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(t[o]={configurable:!0,writable:!0,enumerable:r.enumerable,value:e[o]})}return Object.create(Object.getPrototypeOf(e),t)}function f(e,t){return void 0===t&&(t=!1),v(e)||o(e)||!r(e)?e:(a(e)>1&&(e.set=e.add=e.clear=e.delete=y),Object.freeze(e),t&&n(e,function(e,t){return f(t,!0)},!0),e)}function y(){i(2)}function v(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function x(e){var t=G[e];return t||i(18,e),t}function b(){return A}function w(e,t){t&&(x("Patches"),e.u=[],e.s=[],e.v=t)}function S(e){j(e),e.p.forEach(C),e.p=null}function j(e){e===A&&(A=e.l)}function R(e){return A={p:[],l:A,h:e,m:!0,_:0}}function C(e){var t=e[Q];0===t.i||1===t.i?t.j():t.O=!0}function T(e,t){t._=t.p.length;var s=t.p[0],o=void 0!==e&&e!==s;return t.h.g||x("ES5").S(t,e,o),o?(s[Q].P&&(S(t),i(4)),r(e)&&(e=z(t,e),t.l||k(t,e)),t.u&&x("Patches").M(s[Q].t,e,t.u,t.s)):e=z(t,s,[]),S(t),t.u&&t.v(t.u,t.s),e!==_?e:void 0}function z(e,t,s){if(v(t))return t;var i=t[Q];if(!i)return n(t,function(o,r){return I(e,i,t,o,r,s)},!0),t;if(i.A!==e)return t;if(!i.P)return k(e,i.t,!0),i.t;if(!i.I){i.I=!0,i.A._--;var o=4===i.i||5===i.i?i.o=m(i.k):i.o;n(3===i.i?new Set(o):o,function(t,r){return I(e,i,o,t,r,s)}),k(e,o,!1),s&&e.u&&x("Patches").R(i,s,e.u,e.s)}return i.o}function I(e,t,s,i,n,a){if(o(n)){var c=z(e,n,a&&t&&3!==t.i&&!l(t.D,i)?a.concat(i):void 0);if(d(s,i,c),!o(c))return;e.m=!1}if(r(n)&&!v(n)){if(!e.h.F&&e._<1)return;z(e,n),t&&t.A.l||k(e,n)}}function k(e,t,s){void 0===s&&(s=!1),e.h.F&&e.m&&f(t,s)}function F(e,t){var s=e[Q];return(s?g(s):e)[t]}function L(e,t){if(t in e)for(var s=Object.getPrototypeOf(e);s;){var i=Object.getOwnPropertyDescriptor(s,t);if(i)return i;s=Object.getPrototypeOf(s)}}function O(e){e.P||(e.P=!0,e.l&&O(e.l))}function N(e){e.o||(e.o=m(e.t))}function D(e,t,s){var i=u(t)?x("MapSet").N(t,s):h(t)?x("MapSet").T(t,s):e.g?function(e,t){var s=Array.isArray(e),i={i:s?1:0,A:t?t.A:b(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},o=i,r=K;s&&(o=[i],r=Y);var n=Proxy.revocable(o,r),a=n.revoke,l=n.proxy;return i.k=l,i.j=a,l}(t,s):x("ES5").J(t,s);return(s?s.A:b()).p.push(i),i}function $(e){return o(e)||i(22,e),function e(t){if(!r(t))return t;var s,i=t[Q],o=a(t);if(i){if(!i.P&&(i.i<4||!x("ES5").K(i)))return i.t;i.I=!0,s=P(t,o),i.I=!1}else s=P(t,o);return n(s,function(t,o){i&&c(i.t,t)===o||d(s,t,e(o))}),3===o?new Set(s):s}(e)}function P(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return m(e)}s.d(t,{ZP:()=>ee});var E,A,M="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),B="undefined"!=typeof Map,H="undefined"!=typeof Set,q="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,_=M?Symbol.for("immer-nothing"):((E={})["immer-nothing"]=!0,E),Z=M?Symbol.for("immer-draftable"):"__$immer_draftable",Q=M?Symbol.for("immer-state"):"__$immer_state",W=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),V="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,U=Object.getOwnPropertyDescriptors||function(e){var t={};return V(e).forEach(function(s){t[s]=Object.getOwnPropertyDescriptor(e,s)}),t},G={},K={get:function(e,t){if(t===Q)return e;var s=g(e);if(!l(s,t))return function(e,t,s){var i,o=L(t,s);return o?"value"in o?o.value:null===(i=o.get)||void 0===i?void 0:i.call(e.k):void 0}(e,s,t);var i=s[t];return e.I||!r(i)?i:i===F(e.t,t)?(N(e),e.o[t]=D(e.A.h,i,e)):i},has:function(e,t){return t in g(e)},ownKeys:function(e){return Reflect.ownKeys(g(e))},set:function(e,t,s){var i=L(g(e),t);if(null==i?void 0:i.set)return i.set.call(e.k,s),!0;if(!e.P){var o=F(g(e),t),r=null==o?void 0:o[Q];if(r&&r.t===s)return e.o[t]=s,e.D[t]=!1,!0;if(p(s,o)&&(void 0!==s||l(e.t,t)))return!0;N(e),O(e)}return e.o[t]===s&&"number"!=typeof s&&(void 0!==s||t in e.o)||(e.o[t]=s,e.D[t]=!0,!0)},deleteProperty:function(e,t){return void 0!==F(e.t,t)||t in e.t?(e.D[t]=!1,N(e),O(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var s=g(e),i=Reflect.getOwnPropertyDescriptor(s,t);return i?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:i.enumerable,value:s[t]}:i},defineProperty:function(){i(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){i(12)}},Y={};n(K,function(e,t){Y[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),Y.deleteProperty=function(e,t){return Y.set.call(this,e,t,void 0)},Y.set=function(e,t,s){return K.set.call(this,e[0],t,s,e[0])};var J=new(function(){function e(e){var t=this;this.g=q,this.F=!0,this.produce=function(e,s,o){if("function"==typeof e&&"function"!=typeof s){var n=s;s=e;var a=t;return function(e){var t=this;void 0===e&&(e=n);for(var i=arguments.length,o=Array(i>1?i-1:0),r=1;r<i;r++)o[r-1]=arguments[r];return a.produce(e,function(e){var i;return(i=s).call.apply(i,[t,e].concat(o))})}}var l;if("function"!=typeof s&&i(6),void 0!==o&&"function"!=typeof o&&i(7),r(e)){var c=R(t),d=D(t,e,void 0),p=!0;try{l=s(d),p=!1}finally{p?S(c):j(c)}return"undefined"!=typeof Promise&&l instanceof Promise?l.then(function(e){return w(c,o),T(e,c)},function(e){throw S(c),e}):(w(c,o),T(l,c))}if(!e||"object"!=typeof e){if(void 0===(l=s(e))&&(l=e),l===_&&(l=void 0),t.F&&f(l,!0),o){var u=[],h=[];x("Patches").M(e,l,u,h),o(u,h)}return l}i(21,e)},this.produceWithPatches=function(e,s){if("function"==typeof e)return function(s){for(var i=arguments.length,o=Array(i>1?i-1:0),r=1;r<i;r++)o[r-1]=arguments[r];return t.produceWithPatches(s,function(t){return e.apply(void 0,[t].concat(o))})};var i,o,r=t.produce(e,s,function(e,t){i=e,o=t});return"undefined"!=typeof Promise&&r instanceof Promise?r.then(function(e){return[e,i,o]}):[r,i,o]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){r(e)||i(8),o(e)&&(e=$(e));var t=R(this),s=D(this,e,void 0);return s[Q].C=!0,j(t),s},t.finishDraft=function(e,t){var s=(e&&e[Q]).A;return w(s,t),T(void 0,s)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!q&&i(20),this.g=e},t.applyPatches=function(e,t){var s;for(s=t.length-1;s>=0;s--){var i=t[s];if(0===i.path.length&&"replace"===i.op){e=i.value;break}}s>-1&&(t=t.slice(s+1));var r=x("Patches").$;return o(e)?r(e,t):this.produce(e,function(e){return r(e,t)})},e}()),X=J.produce;J.produceWithPatches.bind(J),J.setAutoFreeze.bind(J),J.setUseProxies.bind(J),J.applyPatches.bind(J),J.createDraft.bind(J),J.finishDraft.bind(J);const ee=X}}]);