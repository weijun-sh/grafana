"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5372],{"./public/app/core/hooks/useCleanup.ts":(e,t,n)=>{n.d(t,{x:()=>s});var r=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=n("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),a=n("./public/app/core/actions/cleanUp.ts");function s(e){const t=(0,i.useDispatch)(),n=(0,r.useRef)(e);n.current=e,(0,r.useEffect)((()=>()=>{t((0,a.e)({stateSelector:n.current}))}),[t])}},"./public/app/features/alerting/unified/RuleEditor.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>ci});var r=n("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),a=n("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),s=n("./.yarn/__virtual__/react-use-virtual-00326e70ba/0/cache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useAsync.js"),o=n("./packages/grafana-ui/src/index.ts"),l=n("./public/app/core/components/Page/Page.tsx"),u=n("./public/app/core/hooks/useCleanup.ts"),c=n("./.yarn/__virtual__/react-hook-form-virtual-92b6119fd4/0/cache/react-hook-form-npm-7.5.3-f9cc466c62-fbfaa3b664.zip/node_modules/react-hook-form/dist/index.esm.js"),d=n("./.yarn/__virtual__/react-router-dom-virtual-e45eb1b58b/0/cache/react-router-dom-npm-5.3.0-aa9adb5bec-47584fd629.zip/node_modules/react-router-dom/esm/react-router-dom.js"),p=n("./public/app/core/copy/appNotification.ts"),f=n("./public/app/core/hooks/useQueryParams.ts"),h=n("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts"),g=n("./public/app/features/alerting/unified/state/actions.ts"),m=n("./public/app/features/alerting/unified/types/rule-form.ts"),v=n("./public/app/features/alerting/unified/utils/redux.ts"),b=n("./public/app/features/alerting/unified/utils/rule-form.ts"),x=n("./public/app/features/alerting/unified/utils/rule-id.ts"),y=n("./public/app/features/alerting/unified/utils/time.ts"),j=n("./.yarn/__virtual__/react-use-virtual-00326e70ba/0/cache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useMountedState.js"),w=n("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/takeWhile.js"),C=n("./packages/grafana-data/src/index.ts"),k=n("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/observable/of.js"),S=n("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/map.js"),A=n("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),I=n("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/share.js"),O=n("./packages/grafana-runtime/src/index.ts");function R(e){if(function(e){return"expr"in e}(e))return function(e){throw new Error("preview for cloud alerting rules is not implemented")}();if(function(e){return"grafana_condition"in e}(e))return function(e){const t=m.$.grafana;return(0,C.withLoadingIndicator)({whileLoading:_(t),source:(0,O.getBackendSrv)().fetch({method:"POST",url:"/api/v1/rule/test/grafana",data:e}).pipe((0,S.U)((e=>{let{data:n}=e;return _(t,{state:C.LoadingState.Done,series:n.instances.map(C.dataFrameFromJSON)})})),(0,A.K)((e=>(0,k.of)(_(t,{state:C.LoadingState.Error,error:(0,O.toDataQueryError)(e)})))),(0,I.B)())})}(e);throw new Error("unsupported preview rule request")}function _(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{ruleType:e,data:Object.assign({state:C.LoadingState.Loading,series:[],timeRange:(0,C.getDefaultTimeRange)()},t)}}var N,T,$=n("./public/app/features/alerting/unified/hooks/useAlertQueriesStatus.ts"),F=n("./.yarn/__virtual__/react-virtualized-auto-sizer-virtual-b5ab366cb0/0/cache/react-virtualized-auto-sizer-npm-1.0.6-50869b8392-81270e9d32.zip/node_modules/react-virtualized-auto-sizer/dist/index.esm.js"),q=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function E(e){const{preview:t}=e,n=(0,o.useStyles2)(D),r={defaults:{},overrides:[{matcher:{id:C.FieldMatcherID.byName,options:"Info"},properties:[{id:"custom.displayMode",value:o.TableCellDisplayMode.JSONView}]}]};if(!t)return null;const{data:i,ruleType:a}=t;return i.state===C.LoadingState.Loading?(0,q.jsx)("div",{className:n.container,children:N||(N=(0,q.jsx)("span",{children:"Loading preview..."}))}):i.state===C.LoadingState.Error?(0,q.jsx)("div",{className:n.container,children:i.error?(0,v.kk)(i.error):"Failed to preview alert rule"}):(0,q.jsxs)("div",{className:n.container,children:[(0,q.jsxs)("span",{children:["Preview based on the result of running the query, for this moment."," ",a===m.$.grafana?"Configuration for `no data` and `error handling` is not applied.":null]}),(0,q.jsx)("div",{className:n.table,children:(0,q.jsx)(F.Z,{children:e=>{let{width:t,height:n}=e;return(0,q.jsx)("div",{style:{width:`${t}px`,height:`${n}px`},children:(0,q.jsx)(O.PanelRenderer,{title:"",width:t,height:n,pluginId:"table",data:i,fieldConfig:r})})}})})]})}function D(e){return{container:r.css`
      margin: ${e.spacing(2)} 0;
    `,table:r.css`
      flex: 1 1 auto;
      height: 135px;
      margin-top: ${e.spacing(2)};
      border: 1px solid ${e.colors.border.medium};
      border-radius: ${e.shape.borderRadius(1)};
    `}}const L=["type","dataSourceName","condition","queries","expression"];function M(){const e=(0,o.useStyles2)(Q),[t,n]=function(){const[e,t]=(0,i.useState)(),{getValues:n}=(0,c.Gc)(),r=(0,j.Z)(),a=(0,i.useCallback)((()=>{const e=function(e){const[t,n,r,i,a]=e;switch(t){case m.$.cloudAlerting:return{dataSourceName:n,expr:a};case m.$.grafana:return{grafana_condition:{condition:r,data:i,now:(0,C.dateTimeFormatISO)(Date.now())}};default:throw new Error(`Alert type ${t} not supported by preview.`)}}(n(L));R(e).pipe((0,w.o)((e=>!function(e){switch(e.data.state){case C.LoadingState.Done:case C.LoadingState.Error:return!0;default:return!1}}(e)),!0)).subscribe((e=>{r()&&t(e)}))}),[n,r]);return[e,a]}(),{watch:r}=(0,c.Gc)(),[a,s,l]=r(["type","condition","queries"]),{allDataSourcesAvailable:u}=(0,$.S)(l);if(a===m.$.cloudRecording||a===m.$.cloudAlerting)return null;const d=Boolean(s)&&u;return(0,q.jsxs)("div",{className:e.container,children:[(0,q.jsxs)(o.HorizontalGroup,{children:[u&&(0,q.jsx)(o.Button,{disabled:!d,type:"button",variant:"primary",onClick:n,children:"Preview alerts"}),!u&&(T||(T=(0,q.jsx)(o.Alert,{title:"Preview is not available",severity:"warning",children:"Cannot display the query preview. Some of the data sources used in the queries are not available."})))]}),(0,q.jsx)(E,{preview:t})]})}function Q(e){return{container:r.css`
      margin-top: ${e.spacing(2)};
      max-width: ${e.breakpoints.values.xxl}px;
    `}}const z=e=>{let{title:t,stepNo:n,children:r,description:i}=e;const a=(0,o.useStyles2)(B);return(0,q.jsxs)("div",{className:a.parent,children:[(0,q.jsx)("div",{children:(0,q.jsx)("span",{className:a.stepNo,children:n})}),(0,q.jsx)("div",{className:a.content,children:(0,q.jsxs)(o.FieldSet,{label:t,className:a.fieldset,children:[i&&(0,q.jsx)("p",{className:a.description,children:i}),r]})})]})},B=e=>({fieldset:r.css`
    legend {
      font-size: 16px;
      padding-top: ${e.spacing(.5)};
    }
  `,parent:r.css`
    display: flex;
    flex-direction: row;
    max-width: ${e.breakpoints.values.xl};
    & + & {
      margin-top: ${e.spacing(4)};
    }
  `,description:r.css`
    margin-top: -${e.spacing(2)};
  `,stepNo:r.css`
    display: inline-block;
    width: ${e.spacing(4)};
    height: ${e.spacing(4)};
    line-height: ${e.spacing(4)};
    border-radius: ${e.spacing(4)};
    text-align: center;
    color: ${e.colors.text.maxContrast};
    background-color: ${e.colors.background.canvas};
    font-size: ${e.typography.size.lg};
    margin-right: ${e.spacing(2)};
  `,content:r.css`
    flex: 1;
  `});var P;const U=["onChange","ref"];const G=()=>{var e,t;const n=(0,o.useStyles)(V),{register:r,control:i,watch:a,formState:{errors:s}}=(0,c.Gc)();return a("type")===m.$.cloudRecording?null:(0,q.jsxs)(z,{stepNo:2,title:"Alert evaluation behavior",children:[(0,q.jsx)(o.Field,{label:"For",description:"Expression has to be true for this long for the alert to be fired.",children:(0,q.jsxs)("div",{className:n.flexRow,children:[(0,q.jsx)(o.Field,{invalid:!(null===(e=s.forTime)||void 0===e||!e.message),error:null===(t=s.forTime)||void 0===t?void 0:t.message,className:n.inlineField,children:(0,q.jsx)(o.Input,Object.assign({},r("forTime",{pattern:{value:/^\d+$/,message:"Must be a positive integer."}}),{width:8}))}),(0,q.jsx)(o.InputControl,{name:"forTimeUnit",render:e=>{let{field:{onChange:t}}=e,r=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e.field,U);return(0,q.jsx)(o.Select,Object.assign({},r,{options:y.qr,onChange:e=>t(null==e?void 0:e.value),width:15,className:n.timeUnit}))},control:i})]})}),P||(P=(0,q.jsx)(M,{}))]})},V=e=>({inlineField:r.css`
    margin-bottom: 0;
  `,flexRow:r.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    align-items: flex-start;
  `,timeUnit:r.css`
    margin-left: ${e.spacing.xs};
  `});var W=n("./.yarn/__virtual__/@grafana-experimental-virtual-22e4fdfd25/0/cache/@grafana-experimental-npm-0.0.2-canary.30-71a280d204-b5b453b937.zip/node_modules/@grafana/experimental/index.js"),Y=n("./public/app/features/alerting/unified/components/rule-editor/AnnotationsField.tsx"),Z=n("./public/app/features/alerting/unified/components/rule-editor/SelectWIthAdd.tsx"),K=n("./public/app/features/expressions/guards.ts");function H(e,t,n){const r=new RegExp("(\\$"+t+"\\b)|(\\${"+t+"})","gm"),i="${"+n+"}";return e.replace(r,i)}function J(e){return!(e.includes("/")||e.includes("\\"))||'Cannot contain "/" or "\\" characters'}const X=["onChange","ref"],ee=["ref"];function te(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}const ne=e=>{var t,n,r,s,l;let{rulesSourceName:u}=e;const{control:d,watch:p,formState:{errors:f},setValue:m}=(0,c.Gc)(),v=(0,o.useStyles2)(re),[b,x]=(0,i.useState)(!1),y=(0,h._)((e=>e.rulerRules)),j=(0,a.useDispatch)();(0,i.useEffect)((()=>{j((0,g.UR)({rulesSourceName:u}))}),[u,j]);const w=null===(t=y[u])||void 0===t?void 0:t.result,C=p("namespace"),k=(0,i.useMemo)((()=>w?Object.keys(w).map((e=>({label:e,value:e}))):[]),[w]),S=(0,i.useMemo)((()=>{var e;return C&&(null==w||null===(e=w[C])||void 0===e?void 0:e.map((e=>({label:e.name,value:e.name}))))||[]}),[C,w]);return(0,q.jsxs)("div",{className:v.flexRow,children:[(0,q.jsx)(o.Field,{"data-testid":"namespace-picker",label:"Namespace",error:null===(n=f.namespace)||void 0===n?void 0:n.message,invalid:!(null===(r=f.namespace)||void 0===r||!r.message),children:(0,q.jsx)(o.InputControl,{render:e=>{let{field:{onChange:t}}=e,n=te(e.field,X);return(0,q.jsx)(Z.P,Object.assign({},n,{className:v.input,onChange:e=>{m("group",""),t(e)},onCustomChange:e=>{e&&x(!0)},options:k,width:42}))},name:"namespace",control:d,rules:{required:{value:!0,message:"Required."},validate:{pathSeparator:J}}})}),(0,q.jsx)(o.Field,{"data-testid":"group-picker",label:"Group",error:null===(s=f.group)||void 0===s?void 0:s.message,invalid:!(null===(l=f.group)||void 0===l||!l.message),children:(0,q.jsx)(o.InputControl,{render:e=>{let{}=e,t=te(e.field,ee);return(0,q.jsx)(Z.P,Object.assign({},t,{options:S,width:42,custom:b,className:v.input}))},name:"group",control:d,rules:{required:{value:!0,message:"Required."},validate:{pathSeparator:J}}})})]})},re=e=>({flexRow:r.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;

    & > * + * {
      margin-left: ${e.spacing(3)};
    }
  `,input:r.css`
    width: 330px !important;
  `});var ie=n("./public/app/features/alerting/unified/components/rule-editor/LabelsField.tsx"),ae=n("./public/app/features/alerting/unified/components/rule-editor/RuleFolderPicker.tsx");const se=["ref"];var oe,le,ue;const ce={message:"Recording rule name must be valid metric name. It may only contain letters, numbers, and colons. It may not contain whitespace.",value:/^[a-zA-Z_:][a-zA-Z0-9_:]*$/},de=()=>{var e,t,n,r,i,a;const{register:s,watch:l,formState:{errors:u}}=(0,c.Gc)(),d=(0,o.useStyles2)(pe),p=l("type"),f=l("dataSourceName"),h=l("type");return(0,q.jsxs)(z,{stepNo:h===m.$.cloudRecording?2:3,title:h===m.$.cloudRecording?"Add details for your recording rule":"Add details for your alert",description:h===m.$.cloudRecording?"Add labels to help you better manage your rules":"Write a summary and add labels to help you better manage your alerts",children:[(0,q.jsx)(o.Field,{className:d.formInput,label:"Rule name",error:null==u||null===(e=u.name)||void 0===e?void 0:e.message,invalid:!(null===(t=u.name)||void 0===t||!t.message),children:(0,q.jsx)(o.Input,Object.assign({id:"name"},s("name",{required:{value:!0,message:"Must enter an alert name"},pattern:p===m.$.cloudRecording?ce:void 0,validate:{pathSeparator:e=>p!==m.$.grafana||J(e)}})))}),(p===m.$.cloudRecording||p===m.$.cloudAlerting)&&f&&(0,q.jsx)(ne,{rulesSourceName:f}),p===m.$.grafana&&(0,q.jsxs)("div",{className:d.flexRow,children:[(0,q.jsx)(o.Field,{label:oe||(oe=(0,q.jsx)(o.Label,{htmlFor:"folder",description:"Select a folder to store your rule.",children:(0,q.jsxs)(W.Stack,{gap:.5,children:["Folder",(0,q.jsx)(o.Tooltip,{placement:"top",content:(0,q.jsx)("div",{children:"Each folder has unique folder permission. When you store multiple rules in a folder, the folder access permissions get assigned to the rules."}),children:(0,q.jsx)(o.Icon,{name:"info-circle",size:"xs"})})]})})),className:d.formInput,error:null===(n=u.folder)||void 0===n?void 0:n.message,invalid:!(null===(r=u.folder)||void 0===r||!r.message),"data-testid":"folder-picker",children:(0,q.jsx)(o.InputControl,{render:e=>{let{}=e,t=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e.field,se);return(0,q.jsx)(ae.W,Object.assign({inputId:"folder"},t,{enableCreateNew:!0,enableReset:!0}))},name:"folder",rules:{required:{value:!0,message:"Please select a folder"},validate:{pathSeparator:e=>J(e.title)}}})}),(0,q.jsx)(o.Field,{label:"Group","data-testid":"group-picker",description:"Rules within the same group are evaluated after the same time interval.",className:d.formInput,error:null===(i=u.group)||void 0===i?void 0:i.message,invalid:!(null===(a=u.group)||void 0===a||!a.message),children:(0,q.jsx)(o.Input,Object.assign({id:"group"},s("group",{required:{value:!0,message:"Must enter a group name"}})))})]}),h!==m.$.cloudRecording&&(le||(le=(0,q.jsx)(Y.Z,{}))),ue||(ue=(0,q.jsx)(ie.Z,{}))]})},pe=e=>({formInput:r.css`
    width: 330px;
    & + & {
      margin-left: ${e.spacing(3)};
    }
  `,flexRow:r.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    align-items: flex-end;
  `});var fe=n("./public/app/features/alerting/unified/components/CollapseToggle.tsx"),he=n("./public/app/types/unified-alerting-dto.ts");const ge=["includeNoData","includeError"];const me=[{value:he.g0.Alerting,label:"Alerting"},{value:he.g0.NoData,label:"No Data"},{value:he.g0.OK,label:"OK"},{value:he.g0.Error,label:"Error"}],ve=e=>{let{includeNoData:t,includeError:n}=e,r=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,ge);const a=(0,i.useMemo)((()=>t?n?me:me.filter((e=>e.value!==he.g0.Error)):me.filter((e=>e.value!==he.g0.NoData))),[t,n]);return(0,q.jsx)(o.Select,Object.assign({options:a},r))};var be,xe=n("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js");const ye=()=>{const{watch:e}=(0,c.Gc)(),t=e("evaluateFor"),n=e("evaluateEvery");if("0"===t)return null;const r=(0,C.parseDuration)(t),i=(0,C.parseDuration)(n);if((0,xe.isEmpty)(r)||(0,xe.isEmpty)(i))return null;const a=(0,C.durationToMilliseconds)(r),s=(0,C.durationToMilliseconds)(i);return a&&s&&a<=s?be||(be=(0,q.jsx)(o.Alert,{severity:"warning",title:"",children:'Setting a "for" duration that is less than or equal to the evaluation interval will result in the evaluation interval being used to calculate when an alert that has stopped receiving data will be closed.'})):null},je=["onChange","ref"],we=["onChange","ref"];var Ce,ke;function Se(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}const Ae={required:{value:!0,message:"Required."},pattern:y.lR},Ie={required:{value:!0,message:"Required."},pattern:y.O8,validate:e=>{const t=(0,C.parseDuration)(e);if(Object.keys(t).length){const e=(0,C.durationToMilliseconds)(t);if(e<1e4)return"Cannot be less than 10 seconds.";if(e%1e4!=0)return"Must be a multiple of 10 seconds."}return!0}},Oe=()=>{var e,t;const n=(0,o.useStyles2)(Re),[r,a]=(0,i.useState)(!1),{register:s,formState:{errors:l}}=(0,c.Gc)(),u="eval-every-input",d="eval-for-input";return(0,q.jsxs)(z,{stepNo:2,title:"Alert evaluation behavior",children:[(0,q.jsx)(o.Field,{label:"Evaluate",description:"Evaluation interval applies to every rule within a group. It can overwrite the interval of an existing alert rule.",children:(0,q.jsxs)("div",{className:n.flexRow,children:[(0,q.jsx)(o.InlineLabel,{htmlFor:u,width:16,tooltip:"How often the alert will be evaluated to see if it fires",children:"Evaluate every"}),(0,q.jsx)(o.Input,Object.assign({id:u,width:8},s("evaluateEvery",Ie))),(0,q.jsx)(o.InlineLabel,{htmlFor:d,width:7,tooltip:'Once condition is breached, alert will go into pending state. If it is pending for longer than the "for" value, it will become a firing alert.',children:"for"}),(0,q.jsx)(o.Field,{className:n.inlineField,error:null===(e=l.evaluateFor)||void 0===e?void 0:e.message,invalid:!(null===(t=l.evaluateFor)||void 0===t||!t.message),validationMessageHorizontalOverflow:!0,children:(0,q.jsx)(o.Input,Object.assign({id:d,width:8},s("evaluateFor",Ae)))})]})}),Ce||(Ce=(0,q.jsx)(ye,{})),(0,q.jsx)(fe.U,{isCollapsed:!r,onToggle:e=>a(!e),text:"Configure no data and error handling",className:n.collapseToggle}),r&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(o.Field,{htmlFor:"no-data-state-input",label:"Alert state if no data or all values are null",children:(0,q.jsx)(o.InputControl,{render:e=>{let{field:{onChange:t}}=e,n=Se(e.field,je);return(0,q.jsx)(ve,Object.assign({},n,{inputId:"no-data-state-input",width:42,includeNoData:!0,includeError:!1,onChange:e=>t(null==e?void 0:e.value)}))},name:"noDataState"})}),(0,q.jsx)(o.Field,{htmlFor:"exec-err-state-input",label:"Alert state if execution error or timeout",children:(0,q.jsx)(o.InputControl,{render:e=>{let{field:{onChange:t}}=e,n=Se(e.field,we);return(0,q.jsx)(ve,Object.assign({},n,{inputId:"exec-err-state-input",width:42,includeNoData:!1,includeError:!0,onChange:e=>t(null==e?void 0:e.value)}))},name:"execErrState"})})]}),ke||(ke=(0,q.jsx)(M,{}))]})},Re=e=>({inlineField:r.css`
    margin-bottom: 0;
  `,flexRow:r.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    align-items: flex-start;
  `,collapseToggle:r.css`
    margin: ${e.spacing(2,0,2,-1)};
  `});function _e(e){return null==e}var Ne={isNothing:_e,isObject:function(e){return"object"==typeof e&&null!==e},toArray:function(e){return Array.isArray(e)?e:_e(e)?[]:[e]},repeat:function(e,t){var n,r="";for(n=0;n<t;n+=1)r+=e;return r},isNegativeZero:function(e){return 0===e&&Number.NEGATIVE_INFINITY===1/e},extend:function(e,t){var n,r,i,a;if(t)for(n=0,r=(a=Object.keys(t)).length;n<r;n+=1)e[i=a[n]]=t[i];return e}};function Te(e,t){var n="",r=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(n+="\n\n"+e.mark.snippet),r+" "+n):r}function $e(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=Te(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}$e.prototype=Object.create(Error.prototype),$e.prototype.constructor=$e,$e.prototype.toString=function(e){return this.name+": "+Te(this,e)};var Fe=$e;function qe(e,t,n,r,i){var a="",s="",o=Math.floor(i/2)-1;return r-t>o&&(t=r-o+(a=" ... ").length),n-r>o&&(n=r+o-(s=" ...").length),{str:a+e.slice(t,n).replace(/\t/g,"â†’")+s,pos:r-t+a.length}}function Ee(e,t){return Ne.repeat(" ",t-e.length)+e}var De=function(e,t){if(t=Object.create(t||null),!e.buffer)return null;t.maxLength||(t.maxLength=79),"number"!=typeof t.indent&&(t.indent=1),"number"!=typeof t.linesBefore&&(t.linesBefore=3),"number"!=typeof t.linesAfter&&(t.linesAfter=2);for(var n,r=/\r?\n|\r|\0/g,i=[0],a=[],s=-1;n=r.exec(e.buffer);)a.push(n.index),i.push(n.index+n[0].length),e.position<=n.index&&s<0&&(s=i.length-2);s<0&&(s=i.length-1);var o,l,u="",c=Math.min(e.line+t.linesAfter,a.length).toString().length,d=t.maxLength-(t.indent+c+3);for(o=1;o<=t.linesBefore&&!(s-o<0);o++)l=qe(e.buffer,i[s-o],a[s-o],e.position-(i[s]-i[s-o]),d),u=Ne.repeat(" ",t.indent)+Ee((e.line-o+1).toString(),c)+" | "+l.str+"\n"+u;for(l=qe(e.buffer,i[s],a[s],e.position,d),u+=Ne.repeat(" ",t.indent)+Ee((e.line+1).toString(),c)+" | "+l.str+"\n",u+=Ne.repeat("-",t.indent+c+3+l.pos)+"^\n",o=1;o<=t.linesAfter&&!(s+o>=a.length);o++)l=qe(e.buffer,i[s+o],a[s+o],e.position-(i[s]-i[s+o]),d),u+=Ne.repeat(" ",t.indent)+Ee((e.line+o+1).toString(),c)+" | "+l.str+"\n";return u.replace(/\n$/,"")},Le=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Me=["scalar","sequence","mapping"];var Qe=function(e,t){if(t=t||{},Object.keys(t).forEach((function(t){if(-1===Le.indexOf(t))throw new Fe('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')})),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(e){return e},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=function(e){var t={};return null!==e&&Object.keys(e).forEach((function(n){e[n].forEach((function(e){t[String(e)]=n}))})),t}(t.styleAliases||null),-1===Me.indexOf(this.kind))throw new Fe('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')};function ze(e,t){var n=[];return e[t].forEach((function(e){var t=n.length;n.forEach((function(n,r){n.tag===e.tag&&n.kind===e.kind&&n.multi===e.multi&&(t=r)})),n[t]=e})),n}function Be(e){return this.extend(e)}Be.prototype.extend=function(e){var t=[],n=[];if(e instanceof Qe)n.push(e);else if(Array.isArray(e))n=n.concat(e);else{if(!e||!Array.isArray(e.implicit)&&!Array.isArray(e.explicit))throw new Fe("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(n=n.concat(e.explicit))}t.forEach((function(e){if(!(e instanceof Qe))throw new Fe("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(e.loadKind&&"scalar"!==e.loadKind)throw new Fe("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(e.multi)throw new Fe("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")})),n.forEach((function(e){if(!(e instanceof Qe))throw new Fe("Specified list of YAML types (or a single Type object) contains a non-Type object.")}));var r=Object.create(Be.prototype);return r.implicit=(this.implicit||[]).concat(t),r.explicit=(this.explicit||[]).concat(n),r.compiledImplicit=ze(r,"implicit"),r.compiledExplicit=ze(r,"explicit"),r.compiledTypeMap=function(){var e,t,n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function r(e){e.multi?(n.multi[e.kind].push(e),n.multi.fallback.push(e)):n[e.kind][e.tag]=n.fallback[e.tag]=e}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(r);return n}(r.compiledImplicit,r.compiledExplicit),r};var Pe=Be,Ue=new Qe("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return null!==e?e:""}}),Ge=new Qe("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return null!==e?e:[]}}),Ve=new Qe("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return null!==e?e:{}}}),We=new Pe({explicit:[Ue,Ge,Ve]});var Ye=new Qe("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(e){if(null===e)return!0;var t=e.length;return 1===t&&"~"===e||4===t&&("null"===e||"Null"===e||"NULL"===e)},construct:function(){return null},predicate:function(e){return null===e},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});var Ze=new Qe("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t=e.length;return 4===t&&("true"===e||"True"===e||"TRUE"===e)||5===t&&("false"===e||"False"===e||"FALSE"===e)},construct:function(e){return"true"===e||"True"===e||"TRUE"===e},predicate:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function Ke(e){return 48<=e&&e<=55}function He(e){return 48<=e&&e<=57}var Je=new Qe("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n,r=e.length,i=0,a=!1;if(!r)return!1;if("-"!==(t=e[i])&&"+"!==t||(t=e[++i]),"0"===t){if(i+1===r)return!0;if("b"===(t=e[++i])){for(i++;i<r;i++)if("_"!==(t=e[i])){if("0"!==t&&"1"!==t)return!1;a=!0}return a&&"_"!==t}if("x"===t){for(i++;i<r;i++)if("_"!==(t=e[i])){if(!(48<=(n=e.charCodeAt(i))&&n<=57||65<=n&&n<=70||97<=n&&n<=102))return!1;a=!0}return a&&"_"!==t}if("o"===t){for(i++;i<r;i++)if("_"!==(t=e[i])){if(!Ke(e.charCodeAt(i)))return!1;a=!0}return a&&"_"!==t}}if("_"===t)return!1;for(;i<r;i++)if("_"!==(t=e[i])){if(!He(e.charCodeAt(i)))return!1;a=!0}return!(!a||"_"===t)},construct:function(e){var t,n=e,r=1;if(-1!==n.indexOf("_")&&(n=n.replace(/_/g,"")),"-"!==(t=n[0])&&"+"!==t||("-"===t&&(r=-1),t=(n=n.slice(1))[0]),"0"===n)return 0;if("0"===t){if("b"===n[1])return r*parseInt(n.slice(2),2);if("x"===n[1])return r*parseInt(n.slice(2),16);if("o"===n[1])return r*parseInt(n.slice(2),8)}return r*parseInt(n,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&e%1==0&&!Ne.isNegativeZero(e)},represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),Xe=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");var et=/^[-+]?[0-9]+e/;var tt=new Qe("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(e){return null!==e&&!(!Xe.test(e)||"_"===e[e.length-1])},construct:function(e){var t,n;return n="-"===(t=e.replace(/_/g,"").toLowerCase())[0]?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),".inf"===t?1===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===t?NaN:n*parseFloat(t,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&(e%1!=0||Ne.isNegativeZero(e))},represent:function(e,t){var n;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Ne.isNegativeZero(e))return"-0.0";return n=e.toString(10),et.test(n)?n.replace("e",".e"):n},defaultStyle:"lowercase"}),nt=We.extend({implicit:[Ye,Ze,Je,tt]}),rt=nt,it=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),at=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");var st=new Qe("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(e){return null!==e&&(null!==it.exec(e)||null!==at.exec(e))},construct:function(e){var t,n,r,i,a,s,o,l,u=0,c=null;if(null===(t=it.exec(e))&&(t=at.exec(e)),null===t)throw new Error("Date resolve error");if(n=+t[1],r=+t[2]-1,i=+t[3],!t[4])return new Date(Date.UTC(n,r,i));if(a=+t[4],s=+t[5],o=+t[6],t[7]){for(u=t[7].slice(0,3);u.length<3;)u+="0";u=+u}return t[9]&&(c=6e4*(60*+t[10]+ +(t[11]||0)),"-"===t[9]&&(c=-c)),l=new Date(Date.UTC(n,r,i,a,s,o,u)),c&&l.setTime(l.getTime()-c),l},instanceOf:Date,represent:function(e){return e.toISOString()}});var ot=new Qe("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(e){return"<<"===e||null===e}}),lt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";var ut=new Qe("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n,r=0,i=e.length,a=lt;for(n=0;n<i;n++)if(!((t=a.indexOf(e.charAt(n)))>64)){if(t<0)return!1;r+=6}return r%8==0},construct:function(e){var t,n,r=e.replace(/[\r\n=]/g,""),i=r.length,a=lt,s=0,o=[];for(t=0;t<i;t++)t%4==0&&t&&(o.push(s>>16&255),o.push(s>>8&255),o.push(255&s)),s=s<<6|a.indexOf(r.charAt(t));return 0===(n=i%4*6)?(o.push(s>>16&255),o.push(s>>8&255),o.push(255&s)):18===n?(o.push(s>>10&255),o.push(s>>2&255)):12===n&&o.push(s>>4&255),new Uint8Array(o)},predicate:function(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)},represent:function(e){var t,n,r="",i=0,a=e.length,s=lt;for(t=0;t<a;t++)t%3==0&&t&&(r+=s[i>>18&63],r+=s[i>>12&63],r+=s[i>>6&63],r+=s[63&i]),i=(i<<8)+e[t];return 0===(n=a%3)?(r+=s[i>>18&63],r+=s[i>>12&63],r+=s[i>>6&63],r+=s[63&i]):2===n?(r+=s[i>>10&63],r+=s[i>>4&63],r+=s[i<<2&63],r+=s[64]):1===n&&(r+=s[i>>2&63],r+=s[i<<4&63],r+=s[64],r+=s[64]),r}}),ct=Object.prototype.hasOwnProperty,dt=Object.prototype.toString;var pt=new Qe("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,r,i,a,s=[],o=e;for(t=0,n=o.length;t<n;t+=1){if(r=o[t],a=!1,"[object Object]"!==dt.call(r))return!1;for(i in r)if(ct.call(r,i)){if(a)return!1;a=!0}if(!a)return!1;if(-1!==s.indexOf(i))return!1;s.push(i)}return!0},construct:function(e){return null!==e?e:[]}}),ft=Object.prototype.toString;var ht=new Qe("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,r,i,a,s=e;for(a=new Array(s.length),t=0,n=s.length;t<n;t+=1){if(r=s[t],"[object Object]"!==ft.call(r))return!1;if(1!==(i=Object.keys(r)).length)return!1;a[t]=[i[0],r[i[0]]]}return!0},construct:function(e){if(null===e)return[];var t,n,r,i,a,s=e;for(a=new Array(s.length),t=0,n=s.length;t<n;t+=1)r=s[t],i=Object.keys(r),a[t]=[i[0],r[i[0]]];return a}}),gt=Object.prototype.hasOwnProperty;var mt=new Qe("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(e){if(null===e)return!0;var t,n=e;for(t in n)if(gt.call(n,t)&&null!==n[t])return!1;return!0},construct:function(e){return null!==e?e:{}}}),vt=rt.extend({implicit:[st,ot],explicit:[ut,pt,ht,mt]}),bt=Object.prototype.hasOwnProperty,xt=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,yt=/[\x85\u2028\u2029]/,jt=/[,\[\]\{\}]/,wt=/^(?:!|!!|![a-z\-]+!)$/i,Ct=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function kt(e){return Object.prototype.toString.call(e)}function St(e){return 10===e||13===e}function At(e){return 9===e||32===e}function It(e){return 9===e||32===e||10===e||13===e}function Ot(e){return 44===e||91===e||93===e||123===e||125===e}function Rt(e){var t;return 48<=e&&e<=57?e-48:97<=(t=32|e)&&t<=102?t-97+10:-1}function _t(e){return 48===e?"\0":97===e?"":98===e?"\b":116===e||9===e?"\t":110===e?"\n":118===e?"\v":102===e?"\f":114===e?"\r":101===e?"":32===e?" ":34===e?'"':47===e?"/":92===e?"\\":78===e?"Â…":95===e?"Â ":76===e?"\u2028":80===e?"\u2029":""}function Nt(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10),56320+(e-65536&1023))}for(var Tt=new Array(256),$t=new Array(256),Ft=0;Ft<256;Ft++)Tt[Ft]=_t(Ft)?1:0,$t[Ft]=_t(Ft);function qt(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||vt,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Et(e,t){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=De(n),new Fe(t,n)}function Dt(e,t){throw Et(e,t)}function Lt(e,t){e.onWarning&&e.onWarning.call(null,Et(e,t))}var Mt={YAML:function(e,t,n){var r,i,a;null!==e.version&&Dt(e,"duplication of %YAML directive"),1!==n.length&&Dt(e,"YAML directive accepts exactly one argument"),null===(r=/^([0-9]+)\.([0-9]+)$/.exec(n[0]))&&Dt(e,"ill-formed argument of the YAML directive"),i=parseInt(r[1],10),a=parseInt(r[2],10),1!==i&&Dt(e,"unacceptable YAML version of the document"),e.version=n[0],e.checkLineBreaks=a<2,1!==a&&2!==a&&Lt(e,"unsupported YAML version of the document")},TAG:function(e,t,n){var r,i;2!==n.length&&Dt(e,"TAG directive accepts exactly two arguments"),r=n[0],i=n[1],wt.test(r)||Dt(e,"ill-formed tag handle (first argument) of the TAG directive"),bt.call(e.tagMap,r)&&Dt(e,'there is a previously declared suffix for "'+r+'" tag handle'),Ct.test(i)||Dt(e,"ill-formed tag prefix (second argument) of the TAG directive");try{i=decodeURIComponent(i)}catch(t){Dt(e,"tag prefix is malformed: "+i)}e.tagMap[r]=i}};function Qt(e,t,n,r){var i,a,s,o;if(t<n){if(o=e.input.slice(t,n),r)for(i=0,a=o.length;i<a;i+=1)9===(s=o.charCodeAt(i))||32<=s&&s<=1114111||Dt(e,"expected valid JSON character");else xt.test(o)&&Dt(e,"the stream contains non-printable characters");e.result+=o}}function zt(e,t,n,r){var i,a,s,o;for(Ne.isObject(n)||Dt(e,"cannot merge mappings; the provided source object is unacceptable"),s=0,o=(i=Object.keys(n)).length;s<o;s+=1)a=i[s],bt.call(t,a)||(t[a]=n[a],r[a]=!0)}function Bt(e,t,n,r,i,a,s,o,l){var u,c;if(Array.isArray(i))for(u=0,c=(i=Array.prototype.slice.call(i)).length;u<c;u+=1)Array.isArray(i[u])&&Dt(e,"nested arrays are not supported inside keys"),"object"==typeof i&&"[object Object]"===kt(i[u])&&(i[u]="[object Object]");if("object"==typeof i&&"[object Object]"===kt(i)&&(i="[object Object]"),i=String(i),null===t&&(t={}),"tag:yaml.org,2002:merge"===r)if(Array.isArray(a))for(u=0,c=a.length;u<c;u+=1)zt(e,t,a[u],n);else zt(e,t,a,n);else e.json||bt.call(n,i)||!bt.call(t,i)||(e.line=s||e.line,e.lineStart=o||e.lineStart,e.position=l||e.position,Dt(e,"duplicated mapping key")),"__proto__"===i?Object.defineProperty(t,i,{configurable:!0,enumerable:!0,writable:!0,value:a}):t[i]=a,delete n[i];return t}function Pt(e){var t;10===(t=e.input.charCodeAt(e.position))?e.position++:13===t?(e.position++,10===e.input.charCodeAt(e.position)&&e.position++):Dt(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function Ut(e,t,n){for(var r=0,i=e.input.charCodeAt(e.position);0!==i;){for(;At(i);)9===i&&-1===e.firstTabInLine&&(e.firstTabInLine=e.position),i=e.input.charCodeAt(++e.position);if(t&&35===i)do{i=e.input.charCodeAt(++e.position)}while(10!==i&&13!==i&&0!==i);if(!St(i))break;for(Pt(e),i=e.input.charCodeAt(e.position),r++,e.lineIndent=0;32===i;)e.lineIndent++,i=e.input.charCodeAt(++e.position)}return-1!==n&&0!==r&&e.lineIndent<n&&Lt(e,"deficient indentation"),r}function Gt(e){var t,n=e.position;return!(45!==(t=e.input.charCodeAt(n))&&46!==t||t!==e.input.charCodeAt(n+1)||t!==e.input.charCodeAt(n+2)||(n+=3,0!==(t=e.input.charCodeAt(n))&&!It(t)))}function Vt(e,t){1===t?e.result+=" ":t>1&&(e.result+=Ne.repeat("\n",t-1))}function Wt(e,t){var n,r,i=e.tag,a=e.anchor,s=[],o=!1;if(-1!==e.firstTabInLine)return!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=s),r=e.input.charCodeAt(e.position);0!==r&&(-1!==e.firstTabInLine&&(e.position=e.firstTabInLine,Dt(e,"tab characters must not be used in indentation")),45===r)&&It(e.input.charCodeAt(e.position+1));)if(o=!0,e.position++,Ut(e,!0,-1)&&e.lineIndent<=t)s.push(null),r=e.input.charCodeAt(e.position);else if(n=e.line,Kt(e,t,3,!1,!0),s.push(e.result),Ut(e,!0,-1),r=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&0!==r)Dt(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break;return!!o&&(e.tag=i,e.anchor=a,e.kind="sequence",e.result=s,!0)}function Yt(e){var t,n,r,i,a=!1,s=!1;if(33!==(i=e.input.charCodeAt(e.position)))return!1;if(null!==e.tag&&Dt(e,"duplication of a tag property"),60===(i=e.input.charCodeAt(++e.position))?(a=!0,i=e.input.charCodeAt(++e.position)):33===i?(s=!0,n="!!",i=e.input.charCodeAt(++e.position)):n="!",t=e.position,a){do{i=e.input.charCodeAt(++e.position)}while(0!==i&&62!==i);e.position<e.length?(r=e.input.slice(t,e.position),i=e.input.charCodeAt(++e.position)):Dt(e,"unexpected end of the stream within a verbatim tag")}else{for(;0!==i&&!It(i);)33===i&&(s?Dt(e,"tag suffix cannot contain exclamation marks"):(n=e.input.slice(t-1,e.position+1),wt.test(n)||Dt(e,"named tag handle cannot contain such characters"),s=!0,t=e.position+1)),i=e.input.charCodeAt(++e.position);r=e.input.slice(t,e.position),jt.test(r)&&Dt(e,"tag suffix cannot contain flow indicator characters")}r&&!Ct.test(r)&&Dt(e,"tag name cannot contain such characters: "+r);try{r=decodeURIComponent(r)}catch(t){Dt(e,"tag name is malformed: "+r)}return a?e.tag=r:bt.call(e.tagMap,n)?e.tag=e.tagMap[n]+r:"!"===n?e.tag="!"+r:"!!"===n?e.tag="tag:yaml.org,2002:"+r:Dt(e,'undeclared tag handle "'+n+'"'),!0}function Zt(e){var t,n;if(38!==(n=e.input.charCodeAt(e.position)))return!1;for(null!==e.anchor&&Dt(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;0!==n&&!It(n)&&!Ot(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&Dt(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function Kt(e,t,n,r,i){var a,s,o,l,u,c,d,p,f,h=1,g=!1,m=!1;if(null!==e.listener&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,a=s=o=4===n||3===n,r&&Ut(e,!0,-1)&&(g=!0,e.lineIndent>t?h=1:e.lineIndent===t?h=0:e.lineIndent<t&&(h=-1)),1===h)for(;Yt(e)||Zt(e);)Ut(e,!0,-1)?(g=!0,o=a,e.lineIndent>t?h=1:e.lineIndent===t?h=0:e.lineIndent<t&&(h=-1)):o=!1;if(o&&(o=g||i),1!==h&&4!==n||(p=1===n||2===n?t:t+1,f=e.position-e.lineStart,1===h?o&&(Wt(e,f)||function(e,t,n){var r,i,a,s,o,l,u,c=e.tag,d=e.anchor,p={},f=Object.create(null),h=null,g=null,m=null,v=!1,b=!1;if(-1!==e.firstTabInLine)return!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=p),u=e.input.charCodeAt(e.position);0!==u;){if(v||-1===e.firstTabInLine||(e.position=e.firstTabInLine,Dt(e,"tab characters must not be used in indentation")),r=e.input.charCodeAt(e.position+1),a=e.line,63!==u&&58!==u||!It(r)){if(s=e.line,o=e.lineStart,l=e.position,!Kt(e,n,2,!1,!0))break;if(e.line===a){for(u=e.input.charCodeAt(e.position);At(u);)u=e.input.charCodeAt(++e.position);if(58===u)It(u=e.input.charCodeAt(++e.position))||Dt(e,"a whitespace character is expected after the key-value separator within a block mapping"),v&&(Bt(e,p,f,h,g,null,s,o,l),h=g=m=null),b=!0,v=!1,i=!1,h=e.tag,g=e.result;else{if(!b)return e.tag=c,e.anchor=d,!0;Dt(e,"can not read an implicit mapping pair; a colon is missed")}}else{if(!b)return e.tag=c,e.anchor=d,!0;Dt(e,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===u?(v&&(Bt(e,p,f,h,g,null,s,o,l),h=g=m=null),b=!0,v=!0,i=!0):v?(v=!1,i=!0):Dt(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,u=r;if((e.line===a||e.lineIndent>t)&&(v&&(s=e.line,o=e.lineStart,l=e.position),Kt(e,t,4,!0,i)&&(v?g=e.result:m=e.result),v||(Bt(e,p,f,h,g,m,s,o,l),h=g=m=null),Ut(e,!0,-1),u=e.input.charCodeAt(e.position)),(e.line===a||e.lineIndent>t)&&0!==u)Dt(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return v&&Bt(e,p,f,h,g,null,s,o,l),b&&(e.tag=c,e.anchor=d,e.kind="mapping",e.result=p),b}(e,f,p))||function(e,t){var n,r,i,a,s,o,l,u,c,d,p,f,h=!0,g=e.tag,m=e.anchor,v=Object.create(null);if(91===(f=e.input.charCodeAt(e.position)))s=93,u=!1,a=[];else{if(123!==f)return!1;s=125,u=!0,a={}}for(null!==e.anchor&&(e.anchorMap[e.anchor]=a),f=e.input.charCodeAt(++e.position);0!==f;){if(Ut(e,!0,t),(f=e.input.charCodeAt(e.position))===s)return e.position++,e.tag=g,e.anchor=m,e.kind=u?"mapping":"sequence",e.result=a,!0;h?44===f&&Dt(e,"expected the node content, but found ','"):Dt(e,"missed comma between flow collection entries"),p=null,o=l=!1,63===f&&It(e.input.charCodeAt(e.position+1))&&(o=l=!0,e.position++,Ut(e,!0,t)),n=e.line,r=e.lineStart,i=e.position,Kt(e,t,1,!1,!0),d=e.tag,c=e.result,Ut(e,!0,t),f=e.input.charCodeAt(e.position),!l&&e.line!==n||58!==f||(o=!0,f=e.input.charCodeAt(++e.position),Ut(e,!0,t),Kt(e,t,1,!1,!0),p=e.result),u?Bt(e,a,v,d,c,p,n,r,i):o?a.push(Bt(e,null,v,d,c,p,n,r,i)):a.push(c),Ut(e,!0,t),44===(f=e.input.charCodeAt(e.position))?(h=!0,f=e.input.charCodeAt(++e.position)):h=!1}Dt(e,"unexpected end of the stream within a flow collection")}(e,p)?m=!0:(s&&function(e,t){var n,r,i,a,s,o=1,l=!1,u=!1,c=t,d=0,p=!1;if(124===(a=e.input.charCodeAt(e.position)))r=!1;else{if(62!==a)return!1;r=!0}for(e.kind="scalar",e.result="";0!==a;)if(43===(a=e.input.charCodeAt(++e.position))||45===a)1===o?o=43===a?3:2:Dt(e,"repeat of a chomping mode identifier");else{if(!((i=48<=(s=a)&&s<=57?s-48:-1)>=0))break;0===i?Dt(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):u?Dt(e,"repeat of an indentation width identifier"):(c=t+i-1,u=!0)}if(At(a)){do{a=e.input.charCodeAt(++e.position)}while(At(a));if(35===a)do{a=e.input.charCodeAt(++e.position)}while(!St(a)&&0!==a)}for(;0!==a;){for(Pt(e),e.lineIndent=0,a=e.input.charCodeAt(e.position);(!u||e.lineIndent<c)&&32===a;)e.lineIndent++,a=e.input.charCodeAt(++e.position);if(!u&&e.lineIndent>c&&(c=e.lineIndent),St(a))d++;else{if(e.lineIndent<c){3===o?e.result+=Ne.repeat("\n",l?1+d:d):1===o&&l&&(e.result+="\n");break}for(r?At(a)?(p=!0,e.result+=Ne.repeat("\n",l?1+d:d)):p?(p=!1,e.result+=Ne.repeat("\n",d+1)):0===d?l&&(e.result+=" "):e.result+=Ne.repeat("\n",d):e.result+=Ne.repeat("\n",l?1+d:d),l=!0,u=!0,d=0,n=e.position;!St(a)&&0!==a;)a=e.input.charCodeAt(++e.position);Qt(e,n,e.position,!1)}}return!0}(e,p)||function(e,t){var n,r,i;if(39!==(n=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,r=i=e.position;0!==(n=e.input.charCodeAt(e.position));)if(39===n){if(Qt(e,r,e.position,!0),39!==(n=e.input.charCodeAt(++e.position)))return!0;r=e.position,e.position++,i=e.position}else St(n)?(Qt(e,r,i,!0),Vt(e,Ut(e,!1,t)),r=i=e.position):e.position===e.lineStart&&Gt(e)?Dt(e,"unexpected end of the document within a single quoted scalar"):(e.position++,i=e.position);Dt(e,"unexpected end of the stream within a single quoted scalar")}(e,p)||function(e,t){var n,r,i,a,s,o,l;if(34!==(o=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,n=r=e.position;0!==(o=e.input.charCodeAt(e.position));){if(34===o)return Qt(e,n,e.position,!0),e.position++,!0;if(92===o){if(Qt(e,n,e.position,!0),St(o=e.input.charCodeAt(++e.position)))Ut(e,!1,t);else if(o<256&&Tt[o])e.result+=$t[o],e.position++;else if((s=120===(l=o)?2:117===l?4:85===l?8:0)>0){for(i=s,a=0;i>0;i--)(s=Rt(o=e.input.charCodeAt(++e.position)))>=0?a=(a<<4)+s:Dt(e,"expected hexadecimal character");e.result+=Nt(a),e.position++}else Dt(e,"unknown escape sequence");n=r=e.position}else St(o)?(Qt(e,n,r,!0),Vt(e,Ut(e,!1,t)),n=r=e.position):e.position===e.lineStart&&Gt(e)?Dt(e,"unexpected end of the document within a double quoted scalar"):(e.position++,r=e.position)}Dt(e,"unexpected end of the stream within a double quoted scalar")}(e,p)?m=!0:!function(e){var t,n,r;if(42!==(r=e.input.charCodeAt(e.position)))return!1;for(r=e.input.charCodeAt(++e.position),t=e.position;0!==r&&!It(r)&&!Ot(r);)r=e.input.charCodeAt(++e.position);return e.position===t&&Dt(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),bt.call(e.anchorMap,n)||Dt(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],Ut(e,!0,-1),!0}(e)?function(e,t,n){var r,i,a,s,o,l,u,c,d=e.kind,p=e.result;if(It(c=e.input.charCodeAt(e.position))||Ot(c)||35===c||38===c||42===c||33===c||124===c||62===c||39===c||34===c||37===c||64===c||96===c)return!1;if((63===c||45===c)&&(It(r=e.input.charCodeAt(e.position+1))||n&&Ot(r)))return!1;for(e.kind="scalar",e.result="",i=a=e.position,s=!1;0!==c;){if(58===c){if(It(r=e.input.charCodeAt(e.position+1))||n&&Ot(r))break}else if(35===c){if(It(e.input.charCodeAt(e.position-1)))break}else{if(e.position===e.lineStart&&Gt(e)||n&&Ot(c))break;if(St(c)){if(o=e.line,l=e.lineStart,u=e.lineIndent,Ut(e,!1,-1),e.lineIndent>=t){s=!0,c=e.input.charCodeAt(e.position);continue}e.position=a,e.line=o,e.lineStart=l,e.lineIndent=u;break}}s&&(Qt(e,i,a,!1),Vt(e,e.line-o),i=a=e.position,s=!1),At(c)||(a=e.position+1),c=e.input.charCodeAt(++e.position)}return Qt(e,i,a,!1),!!e.result||(e.kind=d,e.result=p,!1)}(e,p,1===n)&&(m=!0,null===e.tag&&(e.tag="?")):(m=!0,null===e.tag&&null===e.anchor||Dt(e,"alias node should not have any properties")),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):0===h&&(m=o&&Wt(e,f))),null===e.tag)null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);else if("?"===e.tag){for(null!==e.result&&"scalar"!==e.kind&&Dt(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),l=0,u=e.implicitTypes.length;l<u;l+=1)if((d=e.implicitTypes[l]).resolve(e.result)){e.result=d.construct(e.result),e.tag=d.tag,null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);break}}else if("!"!==e.tag){if(bt.call(e.typeMap[e.kind||"fallback"],e.tag))d=e.typeMap[e.kind||"fallback"][e.tag];else for(d=null,l=0,u=(c=e.typeMap.multi[e.kind||"fallback"]).length;l<u;l+=1)if(e.tag.slice(0,c[l].tag.length)===c[l].tag){d=c[l];break}d||Dt(e,"unknown tag !<"+e.tag+">"),null!==e.result&&d.kind!==e.kind&&Dt(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+d.kind+'", not "'+e.kind+'"'),d.resolve(e.result,e.tag)?(e.result=d.construct(e.result,e.tag),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):Dt(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return null!==e.listener&&e.listener("close",e),null!==e.tag||null!==e.anchor||m}function Ht(e){var t,n,r,i,a=e.position,s=!1;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);0!==(i=e.input.charCodeAt(e.position))&&(Ut(e,!0,-1),i=e.input.charCodeAt(e.position),!(e.lineIndent>0||37!==i));){for(s=!0,i=e.input.charCodeAt(++e.position),t=e.position;0!==i&&!It(i);)i=e.input.charCodeAt(++e.position);for(r=[],(n=e.input.slice(t,e.position)).length<1&&Dt(e,"directive name must not be less than one character in length");0!==i;){for(;At(i);)i=e.input.charCodeAt(++e.position);if(35===i){do{i=e.input.charCodeAt(++e.position)}while(0!==i&&!St(i));break}if(St(i))break;for(t=e.position;0!==i&&!It(i);)i=e.input.charCodeAt(++e.position);r.push(e.input.slice(t,e.position))}0!==i&&Pt(e),bt.call(Mt,n)?Mt[n](e,n,r):Lt(e,'unknown document directive "'+n+'"')}Ut(e,!0,-1),0===e.lineIndent&&45===e.input.charCodeAt(e.position)&&45===e.input.charCodeAt(e.position+1)&&45===e.input.charCodeAt(e.position+2)?(e.position+=3,Ut(e,!0,-1)):s&&Dt(e,"directives end mark is expected"),Kt(e,e.lineIndent-1,4,!1,!0),Ut(e,!0,-1),e.checkLineBreaks&&yt.test(e.input.slice(a,e.position))&&Lt(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&Gt(e)?46===e.input.charCodeAt(e.position)&&(e.position+=3,Ut(e,!0,-1)):e.position<e.length-1&&Dt(e,"end of the stream or a document separator is expected")}function Jt(e,t){t=t||{},0!==(e=String(e)).length&&(10!==e.charCodeAt(e.length-1)&&13!==e.charCodeAt(e.length-1)&&(e+="\n"),65279===e.charCodeAt(0)&&(e=e.slice(1)));var n=new qt(e,t),r=e.indexOf("\0");for(-1!==r&&(n.position=r,Dt(n,"null byte is not allowed in input")),n.input+="\0";32===n.input.charCodeAt(n.position);)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)Ht(n);return n.documents}var Xt=function(e,t,n){null!==t&&"object"==typeof t&&void 0===n&&(n=t,t=null);var r=Jt(e,n);if("function"!=typeof t)return r;for(var i=0,a=r.length;i<a;i+=1)t(r[i])},en=function(e,t){var n=Jt(e,t);if(0!==n.length){if(1===n.length)return n[0];throw new Fe("expected a single document in the stream, but found more")}},tn={loadAll:Xt,load:en},nn=Object.prototype.toString,rn=Object.prototype.hasOwnProperty,an=65279,sn={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},on=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],ln=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function un(e){var t,n,r;if(t=e.toString(16).toUpperCase(),e<=255)n="x",r=2;else if(e<=65535)n="u",r=4;else{if(!(e<=4294967295))throw new Fe("code point within a string may not be greater than 0xFFFFFFFF");n="U",r=8}return"\\"+n+Ne.repeat("0",r-t.length)+t}function cn(e){this.schema=e.schema||vt,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=Ne.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=function(e,t){var n,r,i,a,s,o,l;if(null===t)return{};for(n={},i=0,a=(r=Object.keys(t)).length;i<a;i+=1)s=r[i],o=String(t[s]),"!!"===s.slice(0,2)&&(s="tag:yaml.org,2002:"+s.slice(2)),(l=e.compiledTypeMap.fallback[s])&&rn.call(l.styleAliases,o)&&(o=l.styleAliases[o]),n[s]=o;return n}(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType='"'===e.quotingType?2:1,this.forceQuotes=e.forceQuotes||!1,this.replacer="function"==typeof e.replacer?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function dn(e,t){for(var n,r=Ne.repeat(" ",t),i=0,a=-1,s="",o=e.length;i<o;)-1===(a=e.indexOf("\n",i))?(n=e.slice(i),i=o):(n=e.slice(i,a+1),i=a+1),n.length&&"\n"!==n&&(s+=r),s+=n;return s}function pn(e,t){return"\n"+Ne.repeat(" ",e.indent*t)}function fn(e){return 32===e||9===e}function hn(e){return 32<=e&&e<=126||161<=e&&e<=55295&&8232!==e&&8233!==e||57344<=e&&e<=65533&&e!==an||65536<=e&&e<=1114111}function gn(e){return hn(e)&&e!==an&&13!==e&&10!==e}function mn(e,t,n){var r=gn(e),i=r&&!fn(e);return(n?r:r&&44!==e&&91!==e&&93!==e&&123!==e&&125!==e)&&35!==e&&!(58===t&&!i)||gn(t)&&!fn(t)&&35===e||58===t&&i}function vn(e,t){var n,r=e.charCodeAt(t);return r>=55296&&r<=56319&&t+1<e.length&&(n=e.charCodeAt(t+1))>=56320&&n<=57343?1024*(r-55296)+n-56320+65536:r}function bn(e){return/^\n* /.test(e)}function xn(e,t,n,r,i,a,s,o){var l,u,c=0,d=null,p=!1,f=!1,h=-1!==r,g=-1,m=hn(u=vn(e,0))&&u!==an&&!fn(u)&&45!==u&&63!==u&&58!==u&&44!==u&&91!==u&&93!==u&&123!==u&&125!==u&&35!==u&&38!==u&&42!==u&&33!==u&&124!==u&&61!==u&&62!==u&&39!==u&&34!==u&&37!==u&&64!==u&&96!==u&&function(e){return!fn(e)&&58!==e}(vn(e,e.length-1));if(t||s)for(l=0;l<e.length;c>=65536?l+=2:l++){if(!hn(c=vn(e,l)))return 5;m=m&&mn(c,d,o),d=c}else{for(l=0;l<e.length;c>=65536?l+=2:l++){if(10===(c=vn(e,l)))p=!0,h&&(f=f||l-g-1>r&&" "!==e[g+1],g=l);else if(!hn(c))return 5;m=m&&mn(c,d,o),d=c}f=f||h&&l-g-1>r&&" "!==e[g+1]}return p||f?n>9&&bn(e)?5:s?2===a?5:2:f?4:3:!m||s||i(e)?2===a?5:2:1}function yn(e,t,n,r,i){e.dump=function(){if(0===t.length)return 2===e.quotingType?'""':"''";if(!e.noCompatMode&&(-1!==on.indexOf(t)||ln.test(t)))return 2===e.quotingType?'"'+t+'"':"'"+t+"'";var a=e.indent*Math.max(1,n),s=-1===e.lineWidth?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-a),o=r||e.flowLevel>-1&&n>=e.flowLevel;switch(xn(t,o,e.indent,s,(function(t){return function(e,t){var n,r;for(n=0,r=e.implicitTypes.length;n<r;n+=1)if(e.implicitTypes[n].resolve(t))return!0;return!1}(e,t)}),e.quotingType,e.forceQuotes&&!r,i)){case 1:return t;case 2:return"'"+t.replace(/'/g,"''")+"'";case 3:return"|"+jn(t,e.indent)+wn(dn(t,a));case 4:return">"+jn(t,e.indent)+wn(dn(function(e,t){var n,r,i=/(\n+)([^\n]*)/g,a=(o=e.indexOf("\n"),o=-1!==o?o:e.length,i.lastIndex=o,Cn(e.slice(0,o),t)),s="\n"===e[0]||" "===e[0];var o;for(;r=i.exec(e);){var l=r[1],u=r[2];n=" "===u[0],a+=l+(s||n||""===u?"":"\n")+Cn(u,t),s=n}return a}(t,s),a));case 5:return'"'+function(e){for(var t,n="",r=0,i=0;i<e.length;r>=65536?i+=2:i++)r=vn(e,i),!(t=sn[r])&&hn(r)?(n+=e[i],r>=65536&&(n+=e[i+1])):n+=t||un(r);return n}(t)+'"';default:throw new Fe("impossible error: invalid scalar style")}}()}function jn(e,t){var n=bn(e)?String(t):"",r="\n"===e[e.length-1];return n+(r&&("\n"===e[e.length-2]||"\n"===e)?"+":r?"":"-")+"\n"}function wn(e){return"\n"===e[e.length-1]?e.slice(0,-1):e}function Cn(e,t){if(""===e||" "===e[0])return e;for(var n,r,i=/ [^ ]/g,a=0,s=0,o=0,l="";n=i.exec(e);)(o=n.index)-a>t&&(r=s>a?s:o,l+="\n"+e.slice(a,r),a=r+1),s=o;return l+="\n",e.length-a>t&&s>a?l+=e.slice(a,s)+"\n"+e.slice(s+1):l+=e.slice(a),l.slice(1)}function kn(e,t,n,r){var i,a,s,o="",l=e.tag;for(i=0,a=n.length;i<a;i+=1)s=n[i],e.replacer&&(s=e.replacer.call(n,String(i),s)),(An(e,t+1,s,!0,!0,!1,!0)||void 0===s&&An(e,t+1,null,!0,!0,!1,!0))&&(r&&""===o||(o+=pn(e,t)),e.dump&&10===e.dump.charCodeAt(0)?o+="-":o+="- ",o+=e.dump);e.tag=l,e.dump=o||"[]"}function Sn(e,t,n){var r,i,a,s,o,l;for(a=0,s=(i=n?e.explicitTypes:e.implicitTypes).length;a<s;a+=1)if(((o=i[a]).instanceOf||o.predicate)&&(!o.instanceOf||"object"==typeof t&&t instanceof o.instanceOf)&&(!o.predicate||o.predicate(t))){if(n?o.multi&&o.representName?e.tag=o.representName(t):e.tag=o.tag:e.tag="?",o.represent){if(l=e.styleMap[o.tag]||o.defaultStyle,"[object Function]"===nn.call(o.represent))r=o.represent(t,l);else{if(!rn.call(o.represent,l))throw new Fe("!<"+o.tag+'> tag resolver accepts not "'+l+'" style');r=o.represent[l](t,l)}e.dump=r}return!0}return!1}function An(e,t,n,r,i,a,s){e.tag=null,e.dump=n,Sn(e,n,!1)||Sn(e,n,!0);var o,l=nn.call(e.dump),u=r;r&&(r=e.flowLevel<0||e.flowLevel>t);var c,d,p="[object Object]"===l||"[object Array]"===l;if(p&&(d=-1!==(c=e.duplicates.indexOf(n))),(null!==e.tag&&"?"!==e.tag||d||2!==e.indent&&t>0)&&(i=!1),d&&e.usedDuplicates[c])e.dump="*ref_"+c;else{if(p&&d&&!e.usedDuplicates[c]&&(e.usedDuplicates[c]=!0),"[object Object]"===l)r&&0!==Object.keys(e.dump).length?(!function(e,t,n,r){var i,a,s,o,l,u,c="",d=e.tag,p=Object.keys(n);if(!0===e.sortKeys)p.sort();else if("function"==typeof e.sortKeys)p.sort(e.sortKeys);else if(e.sortKeys)throw new Fe("sortKeys must be a boolean or a function");for(i=0,a=p.length;i<a;i+=1)u="",r&&""===c||(u+=pn(e,t)),o=n[s=p[i]],e.replacer&&(o=e.replacer.call(n,s,o)),An(e,t+1,s,!0,!0,!0)&&((l=null!==e.tag&&"?"!==e.tag||e.dump&&e.dump.length>1024)&&(e.dump&&10===e.dump.charCodeAt(0)?u+="?":u+="? "),u+=e.dump,l&&(u+=pn(e,t)),An(e,t+1,o,!0,l)&&(e.dump&&10===e.dump.charCodeAt(0)?u+=":":u+=": ",c+=u+=e.dump));e.tag=d,e.dump=c||"{}"}(e,t,e.dump,i),d&&(e.dump="&ref_"+c+e.dump)):(!function(e,t,n){var r,i,a,s,o,l="",u=e.tag,c=Object.keys(n);for(r=0,i=c.length;r<i;r+=1)o="",""!==l&&(o+=", "),e.condenseFlow&&(o+='"'),s=n[a=c[r]],e.replacer&&(s=e.replacer.call(n,a,s)),An(e,t,a,!1,!1)&&(e.dump.length>1024&&(o+="? "),o+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),An(e,t,s,!1,!1)&&(l+=o+=e.dump));e.tag=u,e.dump="{"+l+"}"}(e,t,e.dump),d&&(e.dump="&ref_"+c+" "+e.dump));else if("[object Array]"===l)r&&0!==e.dump.length?(e.noArrayIndent&&!s&&t>0?kn(e,t-1,e.dump,i):kn(e,t,e.dump,i),d&&(e.dump="&ref_"+c+e.dump)):(!function(e,t,n){var r,i,a,s="",o=e.tag;for(r=0,i=n.length;r<i;r+=1)a=n[r],e.replacer&&(a=e.replacer.call(n,String(r),a)),(An(e,t,a,!1,!1)||void 0===a&&An(e,t,null,!1,!1))&&(""!==s&&(s+=","+(e.condenseFlow?"":" ")),s+=e.dump);e.tag=o,e.dump="["+s+"]"}(e,t,e.dump),d&&(e.dump="&ref_"+c+" "+e.dump));else{if("[object String]"!==l){if("[object Undefined]"===l)return!1;if(e.skipInvalid)return!1;throw new Fe("unacceptable kind of an object to dump "+l)}"?"!==e.tag&&yn(e,e.dump,t,a,u)}null!==e.tag&&"?"!==e.tag&&(o=encodeURI("!"===e.tag[0]?e.tag.slice(1):e.tag).replace(/!/g,"%21"),o="!"===e.tag[0]?"!"+o:"tag:yaml.org,2002:"===o.slice(0,18)?"!!"+o.slice(18):"!<"+o+">",e.dump=o+" "+e.dump)}return!0}function In(e,t){var n,r,i=[],a=[];for(On(e,i,a),n=0,r=a.length;n<r;n+=1)t.duplicates.push(i[a[n]]);t.usedDuplicates=new Array(r)}function On(e,t,n){var r,i,a;if(null!==e&&"object"==typeof e)if(-1!==(i=t.indexOf(e)))-1===n.indexOf(i)&&n.push(i);else if(t.push(e),Array.isArray(e))for(i=0,a=e.length;i<a;i+=1)On(e[i],t,n);else for(i=0,a=(r=Object.keys(e)).length;i<a;i+=1)On(e[r[i]],t,n)}var Rn=function(e,t){var n=new cn(t=t||{});n.noRefs||In(e,n);var r=e;return n.replacer&&(r=n.replacer.call({"":r},"",r)),An(n,0,r,!0,!0)?n.dump+"\n":""};function _n(e,t){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+t+" instead, which is now safe by default.")}}var Nn=tn.load,Tn={dump:Rn}.dump;_n("safeLoad","load"),_n("safeLoadAll","loadAll"),_n("safeDump","dump");const $n=[{label:"Yaml",value:"yaml"}],Fn=e=>{let{onClose:t}=e;const[n,r]=(0,i.useState)("yaml"),{setValue:a}=(0,c.Gc)(),s=(0,o.useStyles2)(Ln);return(0,q.jsx)(o.Drawer,{title:"Inspect Alert rule",subtitle:(0,q.jsx)("div",{className:s.subtitle,children:(0,q.jsx)(qn,{setActiveTab:r,activeTab:n})}),onClose:t,children:"yaml"===n&&(0,q.jsx)(En,{onSubmit:e=>{for(const t in e)a(t,e[t]);t()}})})},qn=e=>{let{activeTab:t,setActiveTab:n}=e;return(0,q.jsx)(o.TabsBar,{children:$n.map(((e,r)=>(0,q.jsx)(o.Tab,{label:e.label,value:e.value,onChangeTab:()=>n(e.value),active:t===e.value},`${e.value}-${r}`)))})},En=e=>{let{onSubmit:t}=e;const n=(0,o.useStyles2)(Dn),{getValues:r}=(0,c.Gc)(),[a,s]=(0,i.useState)(Tn(r()));return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)("div",{className:n.applyButton,children:(0,q.jsx)(o.Button,{type:"button",onClick:()=>{t(Nn(a))},children:"Apply"})}),(0,q.jsx)("div",{className:n.content,children:(0,q.jsx)(F.Z,{disableWidth:!0,children:e=>{let{height:t}=e;return(0,q.jsx)(o.CodeEditor,{width:"100%",height:t,language:"yaml",value:a,onBlur:s,monacoOptions:{minimap:{enabled:!1}}})}})})]})},Dn=e=>({content:r.css`
    flex-grow: 1;
    height: 100%;
    padding-bottom: 16px;
    margin-bottom: ${e.spacing(2)};
  `,applyButton:r.css`
    display: flex;
    flex-grow: 0;
  `}),Ln=()=>({subtitle:r.css`
    display: flex;
    align-items: center;
    justify-content: space-between;
  `});var Mn=n("./public/app/features/expressions/ExpressionDatasource.ts");const Qn=["onChange","ref"];const zn=()=>{var e,t;const{watch:n,setValue:r,formState:{errors:a}}=(0,c.Gc)(),s=n("queries"),l=n("condition"),u=(0,i.useMemo)((()=>s.filter((e=>!!e.refId)).map((e=>({value:e.refId,label:e.refId})))),[s]),d=(0,i.useMemo)((()=>s.filter((e=>e.datasourceUid===Mn.Yq))),[s]);return(0,i.useEffect)((()=>{const e=(0,xe.last)(d);e&&r("condition",e.refId,{shouldValidate:!0})}),[d,r]),(0,i.useEffect)((()=>{const e=(0,xe.last)(d),t=u.find((e=>{let{value:t}=e;return t===l}));var n;l&&!t?r("condition",null!==(n=null==e?void 0:e.refId)&&void 0!==n?n:null):!l&&e&&r("condition",e.refId,{shouldValidate:!0})}),[l,d,u,r]),(0,q.jsx)(o.Field,{label:"Condition",description:"The query or expression that will be alerted on",error:null===(e=a.condition)||void 0===e?void 0:e.message,invalid:!(null===(t=a.condition)||void 0===t||!t.message),children:(0,q.jsx)(o.InputControl,{name:"condition",render:e=>{let{field:{onChange:t}}=e,n=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e.field,Qn);return(0,q.jsx)(o.Select,Object.assign({"aria-label":"Condition"},n,{width:42,options:u,onChange:e=>{var n;return t(null!==(n=null==e?void 0:e.value)&&void 0!==n?n:null)},noOptionsMessage:"No queries defined"}))},rules:{required:{value:!0,message:"Please select the condition to alert on"}}})})};var Bn=n("./public/app/core/services/context_srv.ts"),Pn=n("./public/app/types/index.ts"),Un=n("./public/app/features/alerting/unified/utils/datasource.ts");function Gn(){const e=(0,h._)((e=>e.dataSources));return Object.values(e).map((e=>e.result)).filter((e=>Boolean(null==e?void 0:e.rulerConfig))).map((e=>(0,Un.c$)(e.name))).filter((e=>Boolean(e)))}const Vn=["value"];function Wn(e){let{value:t}=e,n=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,Vn);const r=Gn(),a=(0,i.useCallback)((e=>!!r.find((t=>{let{id:n}=t;return n===e.id}))),[r]);return(0,q.jsx)(O.DataSourcePicker,Object.assign({noDefault:!0,alerting:!0,filter:a,current:t},n))}const Yn=e=>{const{name:t,description:n,image:i,selected:a=!1,value:s,onClick:l,disabled:u=!1}=e,c=(0,o.useStyles2)(Zn),d=(0,r.cx)({[c.wrapper]:!0,[c.disabled]:u});return(0,q.jsxs)(o.Card,{className:d,isSelected:a,onClick:()=>l(s),disabled:u,children:[(0,q.jsx)(o.Card.Figure,{children:(0,q.jsx)("img",{src:i})}),(0,q.jsx)(o.Card.Heading,{children:t}),(0,q.jsx)(o.Card.Description,{children:n})]})},Zn=e=>({wrapper:r.css`
    width: 380px;
    cursor: pointer;
    user-select: none;
  `,disabled:r.css`
    opacity: 0.5;
  `});var Kn;const Hn=e=>{let{selected:t=!1,disabled:n,onClick:r}=e;return(0,q.jsx)(Yn,{name:"Grafana managed alert",description:Kn||(Kn=(0,q.jsxs)("span",{children:["Supports multiple data sources of any kind.",(0,q.jsx)("br",{}),"Transform data with expressions."]})),image:"/public/img/grafana_icon.svg",selected:t,disabled:n,value:m.$.grafana,onClick:r})},Jn=e=>{let{children:t,visible:n=!1}=e;return n?(0,q.jsx)(o.Tooltip,{content:"You do not appear to have any compatible datasources.",placement:"top",children:(0,q.jsx)("div",{children:t})}):(0,q.jsx)(q.Fragment,{children:t})};var Xn;const er=e=>{let{selected:t=!1,disabled:n=!1,onClick:r}=e;return(0,q.jsx)(Jn,{visible:n,children:(0,q.jsx)(Yn,{name:"Mimir or Loki alert",description:Xn||(Xn=(0,q.jsxs)("span",{children:["Use a Mimir, Loki or Cortex datasource.",(0,q.jsx)("br",{}),"Expressions are not supported."]})),image:"/public/img/alerting/mimir_logo.svg",selected:t,disabled:n,value:m.$.cloudAlerting,onClick:r})})};var tr;const nr=e=>{let{selected:t=!1,disabled:n=!1,onClick:r}=e;return(0,q.jsx)(Jn,{visible:n,children:(0,q.jsx)(Yn,{name:"Mimir or Loki recording rule",description:tr||(tr=(0,q.jsxs)("span",{children:["Precompute expressions.",(0,q.jsx)("br",{}),"Should be combined with an alert rule."]})),image:"/public/img/alerting/mimir_logo_recording.svg",selected:t,disabled:n,value:m.$.cloudRecording,onClick:r})})},rr=e=>{let{selected:t,onChange:n,enabledTypes:r}=e;const i=Gn(),a=!(0,xe.isEmpty)(i),s=(0,o.useStyles2)(ir);return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(W.Stack,{direction:"row",gap:2,children:[r.includes(m.$.grafana)&&(0,q.jsx)(Hn,{selected:t===m.$.grafana,onClick:n}),r.includes(m.$.cloudAlerting)&&(0,q.jsx)(er,{selected:t===m.$.cloudAlerting,onClick:n,disabled:!a}),r.includes(m.$.cloudRecording)&&(0,q.jsx)(nr,{selected:t===m.$.cloudRecording,onClick:n,disabled:!a})]}),r.includes(m.$.grafana)&&(0,q.jsx)("small",{className:s.meta,children:"Select â€œGrafana managedâ€ unless you have a Mimir, Loki or Cortex data source with the Ruler API enabled."})]})},ir=e=>({meta:r.css`
    color: ${e.colors.text.disabled};
  `}),ar=["onChange","ref"];const sr=e=>{var t,n,r,i;let{editingExistingRule:a}=e;const{enabledRuleTypes:s,defaultRuleType:l}=function(){const e=Bn.Vt.hasPermission(Pn.bW.AlertingRuleCreate),t=Bn.Vt.hasPermission(Pn.bW.AlertingRuleExternalWrite),n=e?m.$.grafana:m.$.cloudAlerting,r=[];e&&r.push(m.$.grafana);t&&r.push(m.$.cloudAlerting,m.$.cloudRecording);return{enabledRuleTypes:r,defaultRuleType:n}}(),{control:u,formState:{errors:d},getValues:p,setValue:f,watch:h}=(0,c.Gc)(),g=(0,o.useStyles2)(or),v=h("type");return(0,q.jsxs)(q.Fragment,{children:[!a&&(0,q.jsx)(o.Field,{error:null===(t=d.type)||void 0===t?void 0:t.message,invalid:!(null===(n=d.type)||void 0===n||!n.message),"data-testid":"alert-type-picker",children:(0,q.jsx)(o.InputControl,{render:e=>{var t;let{field:{onChange:n}}=e;return(0,q.jsx)(rr,{"aria-label":"Rule type",selected:null!==(t=p("type"))&&void 0!==t?t:l,onChange:n,enabledTypes:s})},name:"type",control:u,rules:{required:{value:!0,message:"Please select alert type"}}})}),(0,q.jsx)("div",{className:g.flexRow,children:(v===m.$.cloudRecording||v===m.$.cloudAlerting)&&(0,q.jsx)(o.Field,{className:g.formInput,label:"Select data source",error:null===(r=d.dataSourceName)||void 0===r?void 0:r.message,invalid:!(null===(i=d.dataSourceName)||void 0===i||!i.message),"data-testid":"datasource-picker",children:(0,q.jsx)(o.InputControl,{render:e=>{let{field:{onChange:t}}=e,n=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e.field,ar);return(0,q.jsx)(Wn,Object.assign({},n,{onChange:e=>{var n;f("location",void 0),t(null!==(n=null==e?void 0:e.name)&&void 0!==n?n:null)}}))},name:"dataSourceName",control:u,rules:{required:{value:!0,message:"Please select a data source"}}})})})]})};const or=e=>({formInput:r.css`
    width: 330px;
    & + & {
      margin-left: ${e.spacing(3)};
    }
  `,flexRow:r.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    align-items: flex-end;
  `});var lr;const ur=e=>{var t,n;let{value:r,onChange:a,dataSourceName:o}=e;const{mapToValue:l,mapToQuery:u}=function(e){return(0,i.useMemo)((()=>{const t=(0,O.getDataSourceSrv)().getInstanceSettings(e);switch(null==t?void 0:t.type){case"loki":case"prometheus":return{mapToValue:e=>e.expr,mapToQuery:(e,t)=>Object.assign({},e,{expr:t})};default:throw new Error(`${e} is not supported as an expression editor`)}}),[e])}(o),[c,d]=(0,i.useState)(u({refId:"A",hide:!1},r)),{error:p,loading:f,value:h}=(0,s.Z)((()=>(0,O.getDataSourceSrv)().get(o)),[o]),g=(0,i.useCallback)((e=>{d(e),a(l(e))}),[a,l]);if(f||(null==h?void 0:h.name)!==o)return null;if(p||!h||null==h||null===(t=h.components)||void 0===t||!t.QueryEditor){const e=(null==p?void 0:p.message)||"Data source plugin does not export any Query Editor component";return lr||(lr=(0,q.jsxs)("div",{children:["Could not load query editor due to: ",e]}))}const m=null==h||null===(n=h.components)||void 0===n?void 0:n.QueryEditor;return(0,q.jsx)(m,{query:c,queries:[c],app:C.CoreApp.CloudAlerting,onChange:g,onRunQuery:xe.noop,datasource:h})};var cr=n("./packages/grafana-e2e-selectors/src/index.ts"),dr=n("./public/app/core/utils/query.ts"),pr=n("./public/app/features/expressions/types.ts"),fr=n("./public/app/features/expressions/utils/expressionTypes.ts"),hr=n("./public/app/features/plugins/datasource_srv.ts"),gr=n("./public/app/features/alerting/unified/state/AlertingQueryRunner.ts"),mr=n("./.yarn/__virtual__/react-beautiful-dnd-virtual-27e4b658e7/0/cache/react-beautiful-dnd-npm-13.1.0-fcf5568b1c-12b7e9fbe8.zip/node_modules/react-beautiful-dnd/dist/react-beautiful-dnd.esm.js"),vr=n("./public/app/core/components/QueryOperationRow/QueryOperationRow.tsx"),br=n("./public/app/features/query/components/QueryEditorRow.tsx"),xr=n("./public/app/features/alerting/unified/utils/constants.ts"),yr=n("./packages/grafana-schema/src/index.ts"),jr=n("./public/app/core/app_events.ts");var wr=n("./public/app/features/alerting/unified/components/PanelPluginsButtonGroup.tsx");const Cr=e=>{let{data:t,currentPanel:n,changePanel:r,onThresholdsChange:a,thresholds:s}=e;const[l,u]=(0,i.useState)({frameIndex:0,showHeader:!0}),c=function(e,t,n){const r=(0,o.useTheme2)();if(t===xr.GC||t===xr.Kd||function(e){return!(e&&e.series[0]&&e.series[0].fields[0]&&e.series[0].fields[0].values)}(e))return 200;const i=e.series[n].fields[0].values.length,a=5*r.spacing.gridSize,s=i*a+a;return s>=200?200:s}(t,n,l.frameIndex),d=(0,o.useStyles2)(kr(c)),[p,f]=(0,i.useState)(function(e,t){if(!e)return{defaults:{},overrides:[]};return{defaults:{thresholds:e,unit:Sr(t),custom:{thresholdsStyle:{mode:yr.i3.Line}}},overrides:[]}}(s,t));(0,i.useEffect)((()=>{f((e=>Object.assign({},e,{defaults:Object.assign({},e.defaults,{thresholds:s,unit:Sr(t),custom:Object.assign({},e.defaults.custom,{thresholdsStyle:{mode:yr.i3.Line}})})})))}),[s,f,t]);const h=(0,i.useMemo)((()=>({eventBus:jr.Z,canEditThresholds:!0,onThresholdsChange:a})),[a]);return l&&t?(0,q.jsxs)("div",{className:d.wrapper,children:[(0,q.jsx)("div",{className:d.buttonGroup,children:(0,q.jsx)(wr.j,{onChange:r,value:n})}),(0,q.jsx)(F.Z,{children:e=>{let{width:r}=e;return 0===r?null:(0,q.jsx)("div",{style:{height:`${c}px`,width:`${r}px`},children:(0,q.jsx)(o.PanelContextProvider,{value:h,children:(0,q.jsx)(O.PanelRenderer,{height:c,width:r,data:t,pluginId:n,title:"title",onOptionsChange:u,options:l,fieldConfig:p})})})}})]}):null},kr=e=>t=>({wrapper:r.css`
    padding: 0 ${t.spacing(2)};
    height: ${e+4*t.spacing.gridSize}px;
  `,buttonGroup:r.css`
    display: flex;
    justify-content: flex-end;
  `});function Sr(e){var t,n;return null===(t=e.series[0])||void 0===t||null===(n=t.fields.find((e=>"number"===e.type)))||void 0===n?void 0:n.config.unit}const Ar=e=>{let{data:t,dsSettings:n,index:r,onChangeDataSource:a,onChangeQuery:s,onChangeTimeRange:l,onRunQueries:u,onRemoveQuery:c,onDuplicateQuery:d,query:p,queries:f,thresholds:h,onChangeThreshold:g}=e;const m=(0,o.useStyles2)(Or),v=(0,K.j)(p.model),[b,x]=(0,i.useState)(v?xr.Fe:xr.GC);return(0,q.jsx)("div",{className:m.wrapper,children:(0,q.jsx)(br.x,{alerting:!0,dataSource:n,onChangeDataSource:v?void 0:e=>a(e,r),id:p.refId,index:r,data:t,query:(0,xe.cloneDeep)(p.model),onChange:e=>s(e,r),onRemoveQuery:c,onAddQuery:()=>d((0,xe.cloneDeep)(p)),onRunQuery:u,queries:f,renderHeaderExtras:()=>((e,t)=>{var n;return(0,K.j)(e.model)||!l?null:(0,q.jsx)(o.RelativeTimeRangePicker,{timeRange:null!==(n=e.relativeTimeRange)&&void 0!==n?n:(0,C.getDefaultRelativeTimeRange)(),onChange:e=>l(e,t)})})(p,r),app:C.CoreApp.UnifiedAlerting,visualization:t.state!==C.LoadingState.NotStarted?(0,q.jsx)(Cr,{data:t,changePanel:x,currentPanel:b,thresholds:h,onThresholdsChange:e=>g(e,r)}):null,hideDisableQuery:!0},p.refId)})},Ir=e=>{let{children:t}=e;const n=(0,o.useStyles2)(Or);return(0,q.jsx)("div",{className:n.wrapper,children:t})},Or=e=>({wrapper:r.css`
    label: AlertingQueryWrapper;
    margin-bottom: ${e.spacing(1)};
    border: 1px solid ${e.colors.border.medium};
    border-radius: ${e.shape.borderRadius(1)};
  `});var Rr;function _r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Nr extends i.PureComponent{constructor(e){super(e),_r(this,"onRemoveQuery",(e=>{this.props.onQueriesChange(this.props.queries.filter((t=>t.model.refId!==e.refId)))})),_r(this,"onChangeTimeRange",((e,t)=>{const{queries:n,onQueriesChange:r}=this.props;r(n.map(((n,r)=>r!==t?n:Object.assign({},n,{relativeTimeRange:e}))))})),_r(this,"onChangeThreshold",((e,t)=>{const{queries:n,onQueriesChange:r}=this.props,i=n[t].refId;r(n.map((t=>(0,K.j)(t.model)&&t.model.conditions&&t.model.conditions[0].query.params[0]===i?Object.assign({},t,{model:Object.assign({},t.model,{conditions:t.model.conditions.map(((t,n)=>t.query.params[0]===i&&0===n?Object.assign({},t,{evaluator:Object.assign({},t.evaluator,{params:[parseFloat(e.steps[1].value.toPrecision(3))]})}):t))})}):t)))})),_r(this,"onChangeDataSource",((e,t)=>{const{queries:n,onQueriesChange:r}=this.props;r(n.map(((n,r)=>r!==t?n:function(e,t){return Object.assign({},e,{model:(0,xe.omit)(e.model,"datasource"),datasourceUid:t})}(n,e.uid))))})),_r(this,"onChangeQuery",((e,t)=>{const{queries:n,onQueriesChange:r}=this.props;r(function(e,t,n){return e.map((e=>{if(t===n)return e;if(!(0,K.j)(e.model))return e;const r="math"===e.model.type,i="reduce"===e.model.type,a="resample"===e.model.type,s="classic_conditions"===e.model.type;var o;if(r)return Object.assign({},e,{model:Object.assign({},e.model,{expression:H(null!==(o=e.model.expression)&&void 0!==o?o:"",t,n)})});if(a||i){const r=e.model.expression===t;return Object.assign({},e,{model:Object.assign({},e.model,{expression:r?n:e.model.expression})})}if(s){var l;const r=null===(l=e.model.conditions)||void 0===l?void 0:l.map((e=>Object.assign({},e,{query:Object.assign({},e.query,{params:e.query.params.map((e=>e===t?n:e))})})));return Object.assign({},e,{model:Object.assign({},e.model,{conditions:r})})}return e}))}(n,n[t].refId,e.refId).map(((n,r)=>{var i;return r!==t?n:Object.assign({},n,{refId:e.refId,queryType:null!==(i=n.model.queryType)&&void 0!==i?i:"",model:Object.assign({},n.model,e,{datasource:e.datasource})})})))})),_r(this,"onDragEnd",(e=>{const{queries:t,onQueriesChange:n}=this.props;if(!e||!e.destination)return;const r=e.source.index,i=e.destination.index;if(r===i)return;const a=Array.from(t),[s]=a.splice(r,1);a.splice(i,0,s),n(a)})),_r(this,"onDuplicateQuery",((e,t)=>{this.props.onDuplicateQuery(Object.assign({},t,{model:e}))})),_r(this,"getDataSourceSettings",(e=>(0,O.getDataSourceSrv)().getInstanceSettings(e.datasourceUid))),_r(this,"getThresholdsForQueries",(e=>{const t={};for(const n of e)(0,K.j)(n.model)&&Array.isArray(n.model.conditions)&&n.model.conditions.forEach(((e,n)=>{if(n>0)return;const r=e.evaluator.params[0],i=e.query.params[0];"outside_range"!==e.evaluator.type&&"within_range"!==e.evaluator.type&&(t[i]||(t[i]={mode:C.ThresholdsMode.Absolute,steps:[{value:-1/0,color:O.config.theme2.colors.success.main}]}),t[i].steps.push({value:r,color:O.config.theme2.colors.error.main}))}));return t})),this.state={dataPerQuery:{}}}render(){const{onDuplicateQuery:e,onRunQueries:t,queries:n}=this.props,r=this.getThresholdsForQueries(n);return(0,q.jsx)(mr.Z5,{onDragEnd:this.onDragEnd,children:(0,q.jsx)(mr.bK,{droppableId:"alerting-queries",direction:"vertical",children:i=>(0,q.jsxs)("div",Object.assign({ref:i.innerRef},i.droppableProps,{children:[n.map(((i,a)=>{var s,o;const l=null!==(s=null===(o=this.props.data)||void 0===o?void 0:o[i.refId])&&void 0!==s?s:{series:[],state:C.LoadingState.NotStarted},u=this.getDataSourceSettings(i);return u?(0,q.jsx)(Ar,{index:a,dsSettings:u,data:l,query:i,onChangeQuery:this.onChangeQuery,onRemoveQuery:this.onRemoveQuery,queries:n,onChangeDataSource:this.onChangeDataSource,onDuplicateQuery:e,onRunQueries:t,onChangeTimeRange:this.onChangeTimeRange,thresholds:r[i.refId],onChangeThreshold:this.onChangeThreshold},`${i.refId}-${a}`):(0,q.jsx)(Tr,{index:a,model:i.model,onUpdateDatasource:()=>{const e=(0,hr.ak)().getInstanceSettings(null);e&&this.onChangeDataSource(e,a)},onRemoveQuery:()=>{this.onRemoveQuery(i)}},`${i.refId}-${a}`)})),i.placeholder]}))})})}}const Tr=e=>{let{index:t,onUpdateDatasource:n,onRemoveQuery:r,model:a}=e;const s=a.refId,[l,u]=(0,i.useState)(!1);return(0,q.jsx)(Ir,{children:(0,q.jsxs)(vr.t,{title:s,draggable:!0,index:t,id:s,isOpen:!0,children:[(0,q.jsxs)(o.Card,{heading:"This datasource has been removed",description:"The datasource for this query was not found, it was either removed or is not installed correctly.",children:[Rr||(Rr=(0,q.jsx)(o.Card.Figure,{children:(0,q.jsx)(o.Icon,{name:"question-circle"})})),(0,q.jsxs)(o.Card.Actions,{children:[(0,q.jsx)(o.Button,{variant:"secondary",onClick:()=>{n()},children:"Update datasource"},"update"),(0,q.jsx)(o.Button,{variant:"destructive",onClick:r,children:"Remove query"},"remove")]}),(0,q.jsx)(o.Card.SecondaryActions,{children:(0,q.jsx)(o.Button,{onClick:()=>{u((e=>!e))},icon:l?"angle-up":"angle-down",fill:"text",size:"sm",children:"Show details"},"details")})]}),l&&(0,q.jsx)("div",{children:(0,q.jsx)("pre",{children:(0,q.jsx)("code",{children:JSON.stringify(a,null,2)})})})]})})};function $r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Fr extends i.PureComponent{constructor(e){var t;super(e),$r(this,"runner",void 0),$r(this,"queries",void 0),$r(this,"onRunQueries",(()=>{const{queries:e}=this;this.runner.run(e)})),$r(this,"onCancelQueries",(()=>{this.runner.cancel()})),$r(this,"onChangeQueries",(e=>{this.queries=e,this.props.onChange(e)})),$r(this,"onDuplicateQuery",(e=>{const{queries:t}=this;this.onChangeQueries(qr(t,e))})),$r(this,"onNewAlertingQuery",(()=>{const{queries:e}=this,t=(0,hr.ak)().getInstanceSettings("default");t&&this.onChangeQueries(qr(e,{datasourceUid:t.uid,model:{refId:"",datasource:{type:t.type,uid:t.uid}}}))})),$r(this,"onNewExpressionQuery",(()=>{const{queries:e}=this;this.onChangeQueries(qr(e,{datasourceUid:Mn.Yq,model:Mn.mV.newQuery({type:pr.Us.classic,conditions:[fr.R]})}))})),this.state={panelDataByRefId:{}},this.runner=new gr.v,this.queries=null!==(t=e.value)&&void 0!==t?t:[]}componentDidMount(){this.runner.get().subscribe((e=>{this.setState({panelDataByRefId:e})}))}componentWillUnmount(){this.runner.destroy()}isRunning(){const e=Object.values(this.state.panelDataByRefId).find((e=>Boolean(e)));return(null==e?void 0:e.state)===C.LoadingState.Loading}renderRunQueryButton(){return this.isRunning()?(0,q.jsx)(o.Button,{icon:"fa fa-spinner",type:"button",variant:"destructive",onClick:this.onCancelQueries,children:"Cancel"}):(0,q.jsx)(o.Button,{icon:"sync",type:"button",onClick:this.onRunQueries,children:"Run queries"})}render(){const{value:e=[]}=this.props,{panelDataByRefId:t}=this.state,n=Dr(O.config.theme2);return(0,q.jsxs)("div",{className:n.container,children:[(0,q.jsx)(Nr,{data:t,queries:e,onQueriesChange:this.onChangeQueries,onDuplicateQuery:this.onDuplicateQuery,onRunQueries:this.onRunQueries}),(0,q.jsxs)(o.HorizontalGroup,{spacing:"sm",align:"flex-start",children:[(0,q.jsx)(o.Button,{type:"button",icon:"plus",onClick:this.onNewAlertingQuery,variant:"secondary","aria-label":cr.wl.components.QueryTab.addQuery,children:"Add query"}),O.config.expressionsEnabled&&(0,q.jsx)(o.Button,{type:"button",icon:"plus",onClick:this.onNewExpressionQuery,variant:"secondary",children:"Add expression"}),this.renderRunQueryButton()]})]})}}const qr=(e,t)=>{const n=(0,dr.Hs)(e),r=Object.assign({},t,{refId:n,queryType:"",model:Object.assign({},t.model,{hide:!1,refId:n}),relativeTimeRange:Er(t.model)});return[...e,r]},Er=e=>{if(!(0,K.j)(e))return(0,C.getDefaultRelativeTimeRange)()},Dr=(0,o.stylesFactory)((e=>({container:r.css`
      background-color: ${e.colors.background.primary};
      height: 100%;
      max-width: ${e.breakpoints.values.xxl}px;
    `,runWrapper:r.css`
      margin-top: ${e.spacing(1)};
    `,editorWrapper:r.css`
      border: 1px solid ${e.colors.border.medium};
      border-radius: ${e.shape.borderRadius()};
    `}))),Lr=["ref"],Mr=["ref"];function Qr(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}const zr=()=>{var e,t;const{control:n,watch:r,formState:{errors:i}}=(0,c.Gc)(),a=r("type"),s=r("dataSourceName"),l=a===m.$.grafana,u=a===m.$.cloudAlerting,d=(a===m.$.cloudRecording||u)&&s;return(0,q.jsxs)("div",{children:[d&&(0,q.jsx)(o.Field,{error:null===(e=i.expression)||void 0===e?void 0:e.message,invalid:!(null===(t=i.expression)||void 0===t||!t.message),children:(0,q.jsx)(o.InputControl,{name:"expression",render:e=>{let{}=e,t=Qr(e.field,Lr);return(0,q.jsx)(ur,Object.assign({},t,{dataSourceName:s}))},control:n,rules:{required:{value:!0,message:"A valid expression is required"}}})}),l&&(0,q.jsx)(o.Field,{invalid:!!i.queries,error:!i.queries?void 0:"Must provide at least one valid query.",children:(0,q.jsx)(o.InputControl,{name:"queries",render:e=>{let{}=e,t=Qr(e.field,Mr);return(0,q.jsx)(Fr,Object.assign({},t))},control:n,rules:{validate:e=>Array.isArray(e)&&!!e.length}})})]})};var Br,Pr;const Ur=e=>{let{editingExistingRule:t}=e;const{watch:n}=(0,c.Gc)(),r=n("type"),i=r===m.$.grafana;return(0,q.jsxs)(z,{stepNo:1,title:"Set a query and alert condition",children:[(0,q.jsx)(sr,{editingExistingRule:t}),r&&(Br||(Br=(0,q.jsx)(zr,{}))),i&&(Pr||(Pr=(0,q.jsx)(zn,{})))]})};var Gr,Vr,Wr;const Yr=e=>{var t;let{existing:n}=e;const r=(0,o.useStyles2)(Kr),s=(0,a.useDispatch)(),l=(0,p.iG)(),[y]=(0,f.K)(),[j,w]=(0,i.useState)(!1),C=null!==(t=y.returnTo)&&void 0!==t?t:"/alerting/list",[k,S]=(0,i.useState)(!1),A=(0,i.useMemo)((()=>n?(0,b.DQ)(n):Object.assign({},(0,b.uZ)(),{queries:(0,b.s0)()},y.defaults?JSON.parse(y.defaults):{},{type:m.$.grafana})),[n,y]),I=(0,c.cI)({mode:"onSubmit",defaultValues:A,shouldFocusError:!0}),{handleSubmit:O,watch:R}=I,_=R("type"),N=R("dataSourceName"),T=Boolean(_&&(_===m.$.grafana||!!N)),$=(0,h._)((e=>e.ruleForm.saveRule))||v.oq;(0,u.x)((e=>e.unifiedAlerting.ruleForm.saveRule));const F=(e,t)=>{var r,i,a,o;s((0,g.wy)({values:Object.assign({},A,e,{annotations:null!==(r=null===(i=e.annotations)||void 0===i?void 0:i.map((e=>{let{key:t,value:n}=e;return{key:t.trim(),value:n.trim()}})).filter((e=>{let{key:t,value:n}=e;return!!t&&!!n})))&&void 0!==r?r:[],labels:null!==(a=null===(o=e.labels)||void 0===o?void 0:o.map((e=>{let{key:t,value:n}=e;return{key:t.trim(),value:n.trim()}})).filter((e=>{let{key:t}=e;return!!t})))&&void 0!==a?a:[]}),existing:n,redirectOnSave:t?C:void 0}))},E=()=>{l.error("There are errors in the form. Please correct them and try again!")};return(0,q.jsxs)(c.RV,Object.assign({},I,{children:[(0,q.jsxs)("form",{onSubmit:e=>e.preventDefault(),className:r.form,children:[(0,q.jsxs)(o.PageToolbar,{title:(n?"Edit":"Create")+" alert rule",pageIcon:"bell",children:[(0,q.jsx)(d.Link,{to:C,children:(0,q.jsx)(o.Button,{variant:"secondary",disabled:$.loading,type:"button",fill:"outline",children:"Cancel"})}),n?(0,q.jsx)(o.Button,{variant:"destructive",type:"button",onClick:()=>S(!0),children:"Delete"}):null,Zr(R)&&(0,q.jsx)(o.Button,{variant:"secondary",type:"button",onClick:()=>w(!0),disabled:$.loading,children:"Edit yaml"}),(0,q.jsxs)(o.Button,{variant:"primary",type:"button",onClick:O((e=>F(e,!1)),E),disabled:$.loading,children:[$.loading&&(0,q.jsx)(o.Spinner,{className:r.buttonSpinner,inline:!0}),"Save"]}),(0,q.jsxs)(o.Button,{variant:"primary",type:"button",onClick:O((e=>F(e,!0)),E),disabled:$.loading,children:[$.loading&&(0,q.jsx)(o.Spinner,{className:r.buttonSpinner,inline:!0}),"Save and exit"]})]}),(0,q.jsx)("div",{className:r.contentOuter,children:(0,q.jsx)(o.CustomScrollbar,{autoHeightMin:"100%",hideHorizontalTrack:!0,children:(0,q.jsxs)("div",{className:r.contentInner,children:[(0,q.jsx)(Ur,{editingExistingRule:!!n}),T&&(0,q.jsxs)(q.Fragment,{children:[_===m.$.grafana?Gr||(Gr=(0,q.jsx)(Oe,{})):Vr||(Vr=(0,q.jsx)(G,{})),Wr||(Wr=(0,q.jsx)(de,{}))]})]})})})]}),k?(0,q.jsx)(o.ConfirmModal,{isOpen:!0,title:"Delete rule",body:"Deleting this rule will permanently remove it. Are you sure you want to delete this rule?",confirmText:"Yes, delete",icon:"exclamation-triangle",onConfirm:()=>{if(n){const e=x.Zk(n.ruleSourceName,n.namespace,n.group.name,n.rule);s((0,g.hS)(e,{navigateTo:"/alerting/list"}))}},onDismiss:()=>S(!1)}):null,j?(0,q.jsx)(Fn,{onClose:()=>w(!1)}):null]}))},Zr=e=>{const[t,n]=e(["type","dataSourceName"]);return(t===m.$.cloudAlerting||t===m.$.cloudRecording)&&""!==n},Kr=e=>({buttonSpinner:r.css`
      margin-right: ${e.spacing(1)};
    `,form:r.css`
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
    `,contentInner:r.css`
      flex: 1;
      padding: ${e.spacing(2)};
    `,contentOuter:r.css`
      background: ${e.colors.background.primary};
      border: 1px solid ${e.colors.border.weak};
      border-radius: ${e.shape.borderRadius()};
      margin: ${e.spacing(0,2,2)};
      overflow: hidden;
      flex: 1;
    `,flexRow:r.css`
      display: flex;
      flex-direction: row;
      justify-content: flex-start;
    `});var Hr,Jr,Xr,ei,ti,ni,ri,ii,ai=n("./public/app/features/alerting/unified/hooks/useIsRuleEditable.ts"),si=n("./public/app/features/alerting/unified/utils/accessControlHooks.ts");const oi=e=>{let{identifier:t}=e;(0,u.x)((e=>e.unifiedAlerting.ruleForm.existingRule));const{loading:n,result:r,error:s,dispatched:c}=(0,h._)((e=>e.ruleForm.existingRule)),d=(0,a.useDispatch)(),{isEditable:p}=(0,ai.M)(x.s0(t),null==r?void 0:r.rule);return(0,i.useEffect)((()=>{c||d((0,g.on)(t))}),[c,d,t]),n||void 0===p?Hr||(Hr=(0,q.jsx)(l.Z.Contents,{children:(0,q.jsx)(o.LoadingPlaceholder,{text:"Loading rule..."})})):s?(0,q.jsx)(l.Z.Contents,{children:(0,q.jsx)(o.Alert,{severity:"error",title:"Failed to load rule",children:s.message})}):r?!1===p?Xr||(Xr=(0,q.jsx)(li,{title:"Cannot edit rule",children:"Sorry! You do not have permission to edit this rule."})):(0,q.jsx)(Yr,{existing:r}):Jr||(Jr=(0,q.jsx)(li,{title:"Rule not found",children:"Sorry! This rule does not exist."}))},li=e=>{let{title:t,children:n}=e;return(0,q.jsxs)(o.Alert,{className:(0,o.useStyles2)(ui).warning,severity:"warning",title:t,children:[(0,q.jsx)("p",{children:n}),ii||(ii=(0,q.jsx)(o.LinkButton,{href:"alerting/list",children:"To rule list"}))]})},ui=e=>({warning:r.css`
    margin: ${e.spacing(4)};
  `}),ci=(0,o.withErrorBoundary)((e=>{let{match:t}=e;const n=(0,a.useDispatch)(),{id:r}=t.params,i=x.OA(r,!0),{loading:u}=(0,s.Z)((async()=>{await n((0,g.dV)())}),[n]),{canCreateGrafanaRules:c,canCreateCloudRules:d,canEditRules:p}=(0,si.B)();return i||c||d?i&&!p(i.ruleSourceName)?ti||(ti=(0,q.jsx)(li,{title:"Cannot edit rules",children:"Sorry! You are not allowed to edit rules."})):u?ni||(ni=(0,q.jsx)(l.Z.Contents,{children:(0,q.jsx)(o.LoadingPlaceholder,{text:"Loading..."})})):i?(0,q.jsx)(oi,{identifier:i},r):ri||(ri=(0,q.jsx)(Yr,{})):ei||(ei=(0,q.jsx)(li,{title:"Cannot create rules",children:"Sorry! You are not allowed to create rules."}))}),{style:"page"})},"./public/app/features/alerting/unified/components/PanelPluginsButtonGroup.tsx":(e,t,n)=>{n.d(t,{j:()=>l});var r=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=n("./packages/grafana-runtime/src/index.ts"),a=n("./packages/grafana-ui/src/index.ts"),s=n("./public/app/features/alerting/unified/utils/constants.ts"),o=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function l(e){const{value:t,onChange:n,size:l="md"}=e,u=(0,r.useMemo)((()=>Object.values(i.config.panels).reduce(((e,t)=>(function(e){switch(e){case s.GC:case s.Fe:case s.Kd:return!0;default:return!1}}(t.id)&&e.push({value:t.id,label:t.name,imgUrl:t.info.logos.small}),e)),[])),[]);return(0,o.jsx)(a.RadioButtonGroup,{options:u,value:t,onChange:n,size:l})}},"./public/app/features/alerting/unified/components/rule-editor/AnnotationsField.tsx":(e,t,n)=>{n.d(t,{Z:()=>g});var r=n("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),a=n("./.yarn/__virtual__/react-hook-form-virtual-92b6119fd4/0/cache/react-hook-form-npm-7.5.3-f9cc466c62-fbfaa3b664.zip/node_modules/react-hook-form/dist/index.esm.js"),s=n("./packages/grafana-ui/src/index.ts"),o=n("./public/app/features/alerting/unified/utils/constants.ts"),l=n("./public/app/features/alerting/unified/components/rule-editor/SelectWIthAdd.tsx"),u=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const c=["value","existingKeys","aria-label"];const d=e=>{let{value:t,existingKeys:n,"aria-label":r}=e,a=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,c);const s=(0,i.useMemo)((()=>Object.values(o.q6).filter((e=>!n.includes(e))).map((e=>({value:e,label:o.vY[e]})))),[n]);return(0,u.jsx)(l.P,Object.assign({"aria-label":r,value:t,options:s,custom:!!t&&!Object.values(o.q6).includes(t)},a))},p=["ref"];var f;const h=e=>({annotationValueInput:r.css`
    width: 426px;
  `,textarea:r.css`
    height: 76px;
  `,addAnnotationsButton:r.css`
    flex-grow: 0;
    align-self: flex-start;
    margin-left: 148px;
  `,flexColumn:r.css`
    display: flex;
    flex-direction: column;
  `,field:r.css`
    margin-bottom: ${e.spacing.xs};
  `,flexRow:r.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
  `,flexRowItemMargin:r.css`
    margin-left: ${e.spacing.xs};
  `}),g=()=>{const e=(0,s.useStyles)(h),{control:t,register:n,watch:o,formState:{errors:l}}=(0,a.Gc)(),c=o("annotations"),g=(0,i.useCallback)((e=>c.filter(((t,n)=>n!==e)).map((e=>{let{key:t}=e;return t}))),[c]);return(0,u.jsxs)(u.Fragment,{children:[f||(f=(0,u.jsx)(s.Label,{children:"Summary and annotations"})),(0,u.jsx)(s.FieldArray,{name:"annotations",control:t,children:i=>{let{fields:a,append:o,remove:f}=i;return(0,u.jsxs)("div",{className:e.flexColumn,children:[a.map(((i,a)=>{var o,h,m,v,b,x,y,j,w,C,k,S,A,I,O;const R=null===(o=c[a])||void 0===o||null===(h=o.key)||void 0===h?void 0:h.toLocaleLowerCase().endsWith("url"),_=R?s.Input:s.TextArea;return(0,u.jsxs)("div",{className:e.flexRow,children:[(0,u.jsx)(s.Field,{className:e.field,invalid:!(null===(m=l.annotations)||void 0===m||null===(v=m[a])||void 0===v||null===(b=v.key)||void 0===b||!b.message),error:null===(x=l.annotations)||void 0===x||null===(y=x[a])||void 0===y||null===(j=y.key)||void 0===j?void 0:j.message,"data-testid":`annotation-key-${a}`,children:(0,u.jsx)(s.InputControl,{name:`annotations[${a}].key`,render:e=>{let{}=e,t=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e.field,p);return(0,u.jsx)(d,Object.assign({},t,{"aria-label":`Annotation detail ${a+1}`,existingKeys:g(a),width:18}))},control:t,rules:{required:{value:!(null===(w=c[a])||void 0===w||!w.value),message:"Required."}}})}),(0,u.jsx)(s.Field,{className:(0,r.cx)(e.flexRowItemMargin,e.field),invalid:!(null===(C=l.annotations)||void 0===C||null===(k=C[a])||void 0===k||null===(S=k.value)||void 0===S||!S.message),error:null===(A=l.annotations)||void 0===A||null===(I=A[a])||void 0===I||null===(O=I.value)||void 0===O?void 0:O.message,children:(0,u.jsx)(_,Object.assign({"data-testid":`annotation-value-${a}`,className:(0,r.cx)(e.annotationValueInput,{[e.textarea]:!R})},n(`annotations[${a}].value`),{placeholder:R?"https://":"Text",defaultValue:i.value}))}),(0,u.jsx)(s.Button,{type:"button",className:e.flexRowItemMargin,"aria-label":"delete annotation",icon:"trash-alt",variant:"secondary",onClick:()=>f(a)})]},i.id)})),(0,u.jsx)(s.Button,{className:e.addAnnotationsButton,icon:"plus-circle",type:"button",variant:"secondary",onClick:()=>{o({key:"",value:""})},children:"Add info"})]})}})]})}},"./public/app/features/alerting/unified/components/rule-editor/LabelsField.tsx":(e,t,n)=>{n.d(t,{Z:()=>c});var r,i,a=n("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),s=(n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),n("./.yarn/__virtual__/react-hook-form-virtual-92b6119fd4/0/cache/react-hook-form-npm-7.5.3-f9cc466c62-fbfaa3b664.zip/node_modules/react-hook-form/dist/index.esm.js")),o=n("./packages/grafana-ui/src/index.ts"),l=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const u=e=>({wrapper:a.css`
      margin-top: ${e.spacing.md};
    `,flexColumn:a.css`
      display: flex;
      flex-direction: column;
    `,flexRow:a.css`
      display: flex;
      flex-direction: row;
      justify-content: flex-start;

      & + button {
        margin-left: ${e.spacing.xs};
      }
    `,deleteLabelButton:a.css`
      margin-left: ${e.spacing.xs};
      align-self: flex-start;
    `,addLabelButton:a.css`
      flex-grow: 0;
      align-self: flex-start;
    `,centerAlignRow:a.css`
      align-items: baseline;
    `,equalSign:a.css`
      align-self: flex-start;
      width: 28px;
      justify-content: center;
      margin-left: ${e.spacing.xs};
    `,labelInput:a.css`
      width: 183px;
      margin-bottom: ${e.spacing.sm};
      & + & {
        margin-left: ${e.spacing.sm};
      }
    `}),c=e=>{let{className:t}=e;const n=(0,o.useStyles)(u),{register:c,control:d,watch:p,formState:{errors:f}}=(0,s.Gc)(),h=p("labels");return(0,l.jsxs)("div",{className:(0,a.cx)(t,n.wrapper),children:[r||(r=(0,l.jsx)(o.Label,{children:"Custom Labels"})),(0,l.jsx)(o.FieldArray,{control:d,name:"labels",children:e=>{let{fields:t,append:r,remove:s}=e;return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:n.flexRow,children:[i||(i=(0,l.jsx)(o.InlineLabel,{width:18,children:"Labels"})),(0,l.jsxs)("div",{className:n.flexColumn,children:[t.map(((e,t)=>{var r,i,u,d,p,g,m,v,b,x,y,j,w,C;return(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:(0,a.cx)(n.flexRow,n.centerAlignRow),children:[(0,l.jsx)(o.Field,{className:n.labelInput,invalid:!(null===(r=f.labels)||void 0===r||null===(i=r[t])||void 0===i||null===(u=i.key)||void 0===u||!u.message),error:null===(d=f.labels)||void 0===d||null===(p=d[t])||void 0===p||null===(g=p.key)||void 0===g?void 0:g.message,children:(0,l.jsx)(o.Input,Object.assign({},c(`labels[${t}].key`,{required:{value:!(null===(m=h[t])||void 0===m||!m.value),message:"Required."}}),{placeholder:"key","data-testid":`label-key-${t}`,defaultValue:e.key}))}),(0,l.jsx)(o.InlineLabel,{className:n.equalSign,children:"="}),(0,l.jsx)(o.Field,{className:n.labelInput,invalid:!(null===(v=f.labels)||void 0===v||null===(b=v[t])||void 0===b||null===(x=b.value)||void 0===x||!x.message),error:null===(y=f.labels)||void 0===y||null===(j=y[t])||void 0===j||null===(w=j.value)||void 0===w?void 0:w.message,children:(0,l.jsx)(o.Input,Object.assign({},c(`labels[${t}].value`,{required:{value:!(null===(C=h[t])||void 0===C||!C.key),message:"Required."}}),{placeholder:"value","data-testid":`label-value-${t}`,defaultValue:e.value}))}),(0,l.jsx)(o.Button,{className:n.deleteLabelButton,"aria-label":"delete label",icon:"trash-alt",variant:"secondary",onClick:()=>{s(t)}})]})},e.id)})),(0,l.jsx)(o.Button,{className:n.addLabelButton,icon:"plus-circle",type:"button",variant:"secondary",onClick:()=>{r({})},children:"Add label"})]})]})})}})]})}},"./public/app/features/alerting/unified/components/rule-editor/SelectWIthAdd.tsx":(e,t,n)=>{n.d(t,{P:()=>s});var r=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=n("./packages/grafana-ui/src/index.ts"),a=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const s=e=>{let{value:t,onChange:n,options:s,className:o,placeholder:l,width:u,custom:c,onCustomChange:d,disabled:p=!1,addLabel:f="+ Add new","aria-label":h}=e;const[g,m]=(0,r.useState)(c);(0,r.useEffect)((()=>{c&&m(c)}),[c]);const v=(0,r.useMemo)((()=>[...s,{value:"__add__",label:f}]),[s,f]);return g?(0,a.jsx)(i.Input,{"aria-label":h,width:u,autoFocus:!c,value:t||"",placeholder:l,className:o,disabled:p,onChange:e=>n(e.target.value)}):(0,a.jsx)(i.Select,{"aria-label":h,width:u,options:v,value:t,className:o,placeholder:l,disabled:p,onChange:e=>{const t=null==e?void 0:e.value;"__add__"===t?(m(!0),d&&d(!0),n("")):n(t)}})}},"./public/app/features/alerting/unified/hooks/useAlertQueriesStatus.ts":(e,t,n)=>{n.d(t,{S:()=>a});var r=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=n("./packages/grafana-runtime/src/index.ts");function a(e){return{allDataSourcesAvailable:(0,r.useMemo)((()=>e.every((e=>Boolean((0,i.getDataSourceSrv)().getInstanceSettings(e.datasourceUid))))),[e])}}},"./public/app/features/alerting/unified/hooks/useFolder.ts":(e,t,n)=>{n.d(t,{W:()=>l});var r=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=n("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),a=n("./public/app/features/alerting/unified/state/actions.ts"),s=n("./public/app/features/alerting/unified/utils/redux.ts"),o=n("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts");function l(e){const t=(0,i.useDispatch)(),n=(0,o._)((e=>e.folders));if((0,r.useEffect)((()=>{e&&t((0,a.sw)(e))}),[t,e]),e){const t=n[e]||s.oq;return{folder:t.result,loading:t.loading}}return{loading:!1}}},"./public/app/features/alerting/unified/hooks/useIsRuleEditable.ts":(e,t,n)=>{n.d(t,{M:()=>l});var r=n("./public/app/core/services/context_srv.ts"),i=n("./public/app/features/alerting/unified/utils/access-control.ts"),a=n("./public/app/features/alerting/unified/utils/rules.ts"),s=n("./public/app/features/alerting/unified/hooks/useFolder.ts"),o=n("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts");function l(e,t){var n,l,u;const c=(0,o._)((e=>e.dataSources)),d=t&&(0,a.Pc)(t)?t.grafana_alert.namespace_uid:void 0,p=(0,i.Bz)(e),f=r.Vt.hasAccess(p.update,r.Vt.isEditor),h=r.Vt.hasAccess(p.delete,r.Vt.isEditor),{folder:g,loading:m}=(0,s.W)(d);if(!t)return{isEditable:!1,isRemovable:!1,loading:!1};if((0,a.Pc)(t)){if(!d)throw new Error(`Rule ${t.grafana_alert.title} does not have a folder uid, cannot determine if it is editable.`);return{isEditable:f&&(null==g?void 0:g.canSave),isRemovable:h&&(null==g?void 0:g.canSave),loading:m}}const v=Boolean(null===(n=c[e])||void 0===n||null===(l=n.result)||void 0===l?void 0:l.rulerConfig);return{isEditable:f&&v,isRemovable:h&&v,loading:null===(u=c[e])||void 0===u?void 0:u.loading}}},"./public/app/features/alerting/unified/state/AlertingQueryRunner.ts":(e,t,n)=>{n.d(t,{v:()=>k});var r=n("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/ReplaySubject.js"),i=n("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/observable/of.js"),a=n("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),s=n("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/share.js"),o=n("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/map.js"),l=n("./.yarn/cache/uuid-npm-8.3.2-eca0baba53-5575a8a75c.zip/node_modules/uuid/dist/esm-browser/v4.js"),u=n("./packages/grafana-data/src/index.ts"),c=n("./packages/grafana-runtime/src/index.ts"),d=n("./public/app/core/services/backend_srv.ts"),p=n("./public/app/features/expressions/guards.ts"),f=n("./public/app/features/query/state/processing/canceler.ts"),h=n("./public/app/features/query/state/processing/revision.ts"),g=n("./public/app/features/query/state/runRequest.ts"),m=n("./public/app/features/expressions/types.ts");const v={from:21600,to:0},b=(e,t)=>{switch(e.type){case m.Us.classic:return x(e);case m.Us.math:return j(e,t);case m.Us.resample:case m.Us.reduce:return w(e)}},x=e=>{var t;return null===(t=e.conditions)||void 0===t?void 0:t.map((e=>e.query.params[0]))},y=(e,t)=>{let n=[],r=[v.to];for(const i of e){const e=t.find((e=>e.refId===i));e&&e.relativeTimeRange&&(n.push(e.relativeTimeRange.from),r.push(e.relativeTimeRange.to))}return{from:n,to:r}},j=(e,t)=>t.filter((t=>{var n;return"query"===t.queryType&&(null===(n=e.expression)||void 0===n?void 0:n.includes(t.refId))})).map((e=>e.refId)),w=e=>e.expression?[e.expression]:void 0;function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class k{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,d.i)(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,c.getDataSourceSrv)();this.backendSrv=e,this.dataSourceSrv=t,C(this,"subject",void 0),C(this,"subscription",void 0),C(this,"lastResult",void 0),this.backendSrv=e,this.dataSourceSrv=t,this.subject=new r.t(1),this.lastResult={}}get(){return this.subject.asObservable()}async run(e){if(0===e.length){const t=A(e,u.LoadingState.Done);return this.subject.next(t)}for(const t of e)if(!(0,p.j)(t.model)){const n=await this.dataSourceSrv.get(t.datasourceUid);if(n.filterQuery&&!n.filterQuery(t.model)){const t=A(e,u.LoadingState.Done);return this.subject.next(t)}}this.subscription=S(this.backendSrv,e).subscribe({next:e=>{const t=_(e,((e,t)=>{const n=this.lastResult[e],r=(0,g.zR)(t,n);return(0,h.C)(r,n)}));this.lastResult=t,this.subject.next(this.lastResult)},error:e=>{this.lastResult=R(this.lastResult,e),this.subject.next(this.lastResult)}})}cancel(){if(!this.subscription)return;this.subscription.unsubscribe();let e=!1;const t=_(this.lastResult,((t,n)=>(n.state===u.LoadingState.Loading&&(e=!0),Object.assign({},n,{state:u.LoadingState.Done}))));e&&this.subject.next(t)}destroy(){this.subject&&this.subject.complete(),this.cancel()}}const S=(e,t)=>{const n=A(t,u.LoadingState.Loading),r={data:{data:t},url:"/api/v1/eval",method:"POST",requestId:(0,l.Z)()};return(0,u.withLoadingIndicator)({whileLoading:n,source:e.fetch(r).pipe(O(n),(0,a.K)((e=>(0,i.of)(R(n,e)))),(0,f.V)(e,r.requestId),(0,s.B)())})},A=(e,t)=>e.reduce(((n,r)=>(n[r.refId]={state:t,series:[],timeRange:I(r,e)},n)),{}),I=(e,t)=>{if((0,p.j)(e.model)){const n=((e,t)=>{const n=b(e,t);if(!n)return v;const{from:r,to:i}=y(n,t);return r.length||i.length?{from:Math.max(...r),to:Math.min(...i)}:v})(e.model,t);return u.rangeUtil.relativeToTimeRange(n)}return e.relativeTimeRange?u.rangeUtil.relativeToTimeRange(e.relativeTimeRange):(0,u.getDefaultTimeRange)()},O=e=>(0,o.U)((t=>{const{data:n}=t,r={};for(const[t,i]of Object.entries(n.results))r[t]={timeRange:e[t].timeRange,state:u.LoadingState.Done,series:i.frames.map(u.dataFrameFromJSON)};return r})),R=(e,t)=>{const n=(0,c.toDataQueryError)(t);return _(e,((e,t)=>Object.assign({},t,{state:u.LoadingState.Error,error:n})))},_=(e,t)=>{const n={};for(const[r,i]of Object.entries(e))n[r]=t(r,i);return n}},"./public/app/features/alerting/unified/utils/accessControlHooks.ts":(e,t,n)=>{n.d(t,{B:()=>a});var r=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=n("./public/app/features/alerting/unified/utils/access-control.ts");function a(){return(0,r.useMemo)((()=>(0,i.Rv)()),[])}},"./public/app/features/expressions/guards.ts":(e,t,n)=>{n.d(t,{j:()=>a});var r=n("./packages/grafana-runtime/src/utils/DataSourceWithBackend.ts"),i=n("./public/app/features/expressions/types.ts");const a=e=>{if(!e)return!1;if((0,r.Pr)(e.datasource))return!0;const t=e;return"string"==typeof t.type&&Object.values(i.Us).includes(t.type)}}}]);