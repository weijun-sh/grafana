"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2364],{"./public/app/plugins/datasource/grafana-azure-monitor-datasource/module.ts":(e,r,t)=>{t.r(r),t.d(r,{plugin:()=>zt});var s=t("./packages/grafana-data/src/index.ts"),o=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=t("./packages/grafana-runtime/src/index.ts"),a=t("./packages/grafana-ui/src/index.ts"),n=t("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),c=t.n(n);class u{static createISO8601Duration(e,r){return(0,n.includes)(["hour","minute","h","m"],r)?`PT${e}${r[0].toUpperCase()}`:`P${e}${r[0].toUpperCase()}`}static createISO8601DurationFromInterval(e){const r=+e.slice(0,e.length-1),t=e[e.length-1];if(e.indexOf("ms")>-1)return u.createISO8601Duration(1,"m");if("s"===e[e.length-1]){let e=60*r%60;return e<1&&(e=1),u.createISO8601Duration(e,"m")}return u.createISO8601Duration(r,t)}static findClosestTimeGrain(e,r){const t=(0,n.filter)(r,(e=>"auto"!==e));let o=t[0];const i=s.rangeUtil.intervalToMs(e);for(let e=0;e<t.length;e++)i>s.rangeUtil.intervalToMs(t[e])&&(o=e+1<t.length?t[e+1]:t[e]);return o}static createTimeGrainFromISO8601Duration(e){let r=1;"PT"===e.substring(0,2)&&(r=2);const t=e.substring(r,e.length-1),s=e.substring(e.length-1);return t+" "+u.timeUnitToText(+t,s)}static timeUnitToText(e,r){let t="";return"S"===r&&(t="second"),"M"===r&&(t="minute"),"H"===r&&(t="hour"),"D"===r&&(t="day"),e>1?t+"s":t}static createKbnUnitFromISO8601Duration(e){if("auto"===e)return"auto";let r=1;"PT"===e.substring(0,2)&&(r=2);const t=e.substring(r,e.length-1),s=e.substring(e.length-1);return t+u.timeUnitToKbn(+t,s)}static timeUnitToKbn(e,r){return"S"===r?"s":"M"===r?"m":"H"===r?"h":"D"===r?"d":""}}class l{static parseResponseValues(e,r,t){const s=[];if(!e)return s;for(let o=0;o<e.value.length;o++)if(!(0,n.find)(s,["value",(0,n.get)(e.value[o],t)])){const i=(0,n.get)(e.value[o],t),a=(0,n.get)(e.value[o],r,i);s.push({text:a,value:i})}return s}static parseResourceNames(e,r){const t=[];if(!e)return t;for(let s=0;s<e.value.length;s++)"string"==typeof e.value[s].type&&e.value[s].type.toLocaleLowerCase()===r.toLocaleLowerCase()&&t.push({text:e.value[s].name,value:e.value[s].name});return t}static parseMetadata(e,r){var t,s;const o=["None","Average","Minimum","Maximum","Total","Count"],i=null==e?void 0:e.value.find((e=>e.name.value===r));return i?{primaryAggType:i.primaryAggregationType,supportedAggTypes:i.supportedAggregationTypes||o,supportedTimeGrains:[{label:"Auto",value:"auto"},...l.parseTimeGrains(null!==(t=i.metricAvailabilities)&&void 0!==t?t:[])],dimensions:l.parseDimensions(null!==(s=i.dimensions)&&void 0!==s?s:[])}:{primaryAggType:"",supportedAggTypes:o,supportedTimeGrains:[],dimensions:[]}}static parseTimeGrains(e){const r=[];return e?(e.forEach((e=>{e.timeGrain&&r.push({label:u.createTimeGrainFromISO8601Duration(e.timeGrain),value:e.timeGrain})})),r):r}static parseDimensions(e){return e.map((e=>({label:e.localizedValue||e.value,value:e.value})))}static parseSubscriptions(e){const r=[];if(!e)return r;const t="subscriptionId";for(let s=0;s<e.value.length;s++)(0,n.find)(r,["value",(0,n.get)(e.value[s],t)])||r.push({text:`${(0,n.get)(e.value[s],"displayName")}`,value:(0,n.get)(e.value[s],t)});return r}static parseSubscriptionsForSelect(e){const r=[];if(!e)return r;const t="subscriptionId";for(let s=0;s<e.data.value.length;s++)(0,n.find)(r,["value",(0,n.get)(e.data.value[s],t)])||r.push({label:`${(0,n.get)(e.data.value[s],"displayName")} - ${(0,n.get)(e.data.value[s],t)}`,value:(0,n.get)(e.data.value[s],t)});return r}static parseWorkspacesForSelect(e){const r=[];if(!e)return r;const t="customerId";for(let s=0;s<e.data.value.length;s++)(0,n.find)(r,["value",(0,n.get)(e.data.value[s].properties,t)])||r.push({label:(0,n.get)(e.data.value[s],"name"),value:(0,n.get)(e.data.value[s].properties,t)});return r}}const p=(e,r)=>e.some((e=>e.options?p(e.options,r):e.value===r)),d=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0===r.length)return[];const t=r.reduce(((e,r)=>(e.add(r),e)),new Set);return e.filter((e=>t.has(e.value)))},m=e=>({value:e.value,label:e.text});const g="azuremonitor",f="loganalytics",h="resourcegraph";function y(e,r){if("string"==typeof e)return r.multi||r.includeAll?"'"+e+"'":e;if("number"==typeof e)return e;return(0,n.map)(e,(r=>"number"==typeof e?e:"'"+r+"'")).join(",")}let v,b;!function(e){e.AzureMonitor="Azure Monitor",e.LogAnalytics="Azure Log Analytics",e.AzureResourceGraph="Azure Resource Graph",e.GrafanaTemplateVariableFn="Grafana Template Variable Function"}(v||(v={})),function(e){e.Public="AzureCloud",e.China="AzureChinaCloud",e.USGovernment="AzureUSGovernment",e.Germany="AzureGermanCloud",e.None=""}(b||(b={}));const w=Symbol("Concealed client secret");function N(e){return e.jsonData.azureAuthType?e.jsonData.azureAuthType:e.jsonData.tenantId&&e.jsonData.clientId?"clientsecret":i.config.azure.managedIdentityEnabled?"msi":"clientsecret"}function M(){switch(i.config.azure.cloud){case b.Public:case b.None:case void 0:return"azuremonitor";case b.China:return"chinaazuremonitor";case b.USGovernment:return"govazuremonitor";case b.Germany:return"germanyazuremonitor";default:throw new Error(`The cloud '${i.config.azure.cloud}' not supported.`)}}function S(e){switch(e){case"azuremonitor":return"https://portal.azure.com";case"chinaazuremonitor":return"https://portal.azure.cn";case"govazuremonitor":return"https://portal.azure.us";case"germanyazuremonitor":return"https://portal.microsoftazure.de";default:throw new Error("The cloud not supported.")}}function j(e){switch(N(e)){case"msi":return M();case"clientsecret":return e.jsonData.cloudName||M()}}function x(e){if(e.secureJsonFields.clientSecret)return w;{var r;const t=null===(r=e.secureJsonData)||void 0===r?void 0:r.clientSecret;return"string"==typeof t&&t.length>0?t:void 0}}var z,k,T,L,A,C,I,G=t("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const{Input:D}=a.LegacyForms,O=[{value:"msi",label:"Managed Identity"},{value:"clientsecret",label:"App Registration"}],R=e=>{const{credentials:r,azureCloudOptions:t,onCredentialsChange:s,getSubscriptions:i,disabled:n}=e,c=function(e){switch(e.authType){case"msi":return!0;case"clientsecret":return!!(e.azureCloud&&e.tenantId&&e.clientId&&e.clientSecret)}}(r),[u,l]=(0,o.useState)([]),[p,d]=(0,o.useReducer)((e=>e+1),0);(0,o.useEffect)((()=>{if(!i||!c)return void m([]);let e=!1;return i().then((r=>{e||m(r,p)})),()=>{e=!0}}),[p]);const m=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(l(e),i)if(t&&!r.defaultSubscriptionId&&e.length>0)g(e[0]);else if(r.defaultSubscriptionId){e.find((e=>e.value===r.defaultSubscriptionId))||g(void 0)}},g=e=>{if(s){const t=Object.assign({},r,{defaultSubscriptionId:null==e?void 0:e.value});s(t)}};return(0,G.jsxs)("div",{className:"gf-form-group",children:[e.managedIdentityEnabled&&(0,G.jsx)("div",{className:"gf-form-inline",children:(0,G.jsxs)("div",{className:"gf-form",children:[z||(z=(0,G.jsx)(a.InlineFormLabel,{className:"width-12",tooltip:"Choose the type of authentication to Azure services",children:"Authentication"})),(0,G.jsx)(a.Select,{className:"width-15",value:O.find((e=>e.value===r.authType)),options:O,onChange:e=>{if(s){l([]);const t=Object.assign({},r,{authType:e.value||"msi",defaultSubscriptionId:void 0});s(t)}},disabled:n})]})}),"clientsecret"===r.authType&&(0,G.jsxs)(G.Fragment,{children:[t&&(0,G.jsx)("div",{className:"gf-form-inline",children:(0,G.jsxs)("div",{className:"gf-form",children:[k||(k=(0,G.jsx)(a.InlineFormLabel,{className:"width-12",tooltip:"Choose an Azure Cloud",children:"Azure Cloud"})),(0,G.jsx)(a.Select,{"aria-label":"Azure Cloud",className:"width-15",value:t.find((e=>e.value===r.azureCloud)),options:t,onChange:e=>{if(s&&"clientsecret"===r.authType){l([]);const t=Object.assign({},r,{azureCloud:e.value,defaultSubscriptionId:void 0});s(t)}},disabled:n})]})}),(0,G.jsx)("div",{className:"gf-form-inline",children:(0,G.jsxs)("div",{className:"gf-form",children:[T||(T=(0,G.jsx)(a.InlineFormLabel,{className:"width-12",children:"Directory (tenant) ID"})),(0,G.jsx)("div",{className:"width-15",children:(0,G.jsx)(D,{className:"width-30",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:r.tenantId||"",onChange:e=>{if(s&&"clientsecret"===r.authType){l([]);const t=Object.assign({},r,{tenantId:e.target.value,defaultSubscriptionId:void 0});s(t)}},disabled:n})})]})}),(0,G.jsx)("div",{className:"gf-form-inline",children:(0,G.jsxs)("div",{className:"gf-form",children:[L||(L=(0,G.jsx)(a.InlineFormLabel,{className:"width-12",children:"Application (client) ID"})),(0,G.jsx)("div",{className:"width-15",children:(0,G.jsx)(D,{className:"width-30",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:r.clientId||"",onChange:e=>{if(s&&"clientsecret"===r.authType){l([]);const t=Object.assign({},r,{clientId:e.target.value,defaultSubscriptionId:void 0});s(t)}},disabled:n})})]})}),!n&&("symbol"==typeof r.clientSecret?(0,G.jsxs)("div",{className:"gf-form-inline",children:[A||(A=(0,G.jsxs)("div",{className:"gf-form",children:[(0,G.jsx)(a.InlineFormLabel,{className:"width-12",children:"Client Secret"}),(0,G.jsx)(D,{"data-testid":"client-secret",className:"width-25",placeholder:"configured",disabled:!0})]})),(0,G.jsx)("div",{className:"gf-form",children:(0,G.jsx)("div",{className:"max-width-30 gf-form-inline",children:(0,G.jsx)(a.Button,{variant:"secondary",type:"button",onClick:()=>{if(s&&"clientsecret"===r.authType){l([]);const e=Object.assign({},r,{clientSecret:"",defaultSubscriptionId:void 0});s(e)}},disabled:n,children:"reset"})})})]}):(0,G.jsx)("div",{className:"gf-form-inline",children:(0,G.jsxs)("div",{className:"gf-form",children:[C||(C=(0,G.jsx)(a.InlineFormLabel,{className:"width-12",children:"Client Secret"})),(0,G.jsx)("div",{className:"width-15",children:(0,G.jsx)(D,{className:"width-30",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:r.clientSecret||"",onChange:e=>{if(s&&"clientsecret"===r.authType){l([]);const t=Object.assign({},r,{clientSecret:e.target.value,defaultSubscriptionId:void 0});s(t)}},disabled:n})})]})}))]}),i&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{className:"gf-form-inline",children:(0,G.jsxs)("div",{className:"gf-form",children:[I||(I=(0,G.jsx)(a.InlineFormLabel,{className:"width-12",children:"Default Subscription"})),(0,G.jsx)("div",{className:"width-30",children:(0,G.jsx)(a.Select,{"aria-label":"Default Subscription",value:r.defaultSubscriptionId?u.find((e=>e.value===r.defaultSubscriptionId)):void 0,options:u,onChange:g,disabled:n})})]})}),!n&&(0,G.jsx)("div",{className:"gf-form-inline",children:(0,G.jsx)("div",{className:"gf-form",children:(0,G.jsx)("div",{className:"max-width-30 gf-form-inline",children:(0,G.jsx)(a.Button,{variant:"secondary",size:"sm",type:"button",onClick:d,disabled:!c,children:"Load Subscriptions"})})})})]}),e.children]})};var q;const E=[{value:"azuremonitor",label:"Azure"},{value:"govazuremonitor",label:"Azure US Government"},{value:"germanyazuremonitor",label:"Azure Germany"},{value:"chinaazuremonitor",label:"Azure China"}],P=e=>{const{updateOptions:r,getSubscriptions:t}=e,s=(0,o.useMemo)((()=>function(e){switch(N(e)){case"msi":return i.config.azure.managedIdentityEnabled?{authType:"msi",defaultSubscriptionId:e.jsonData.subscriptionId}:{authType:"clientsecret",azureCloud:M()};case"clientsecret":return{authType:"clientsecret",azureCloud:e.jsonData.cloudName||M(),tenantId:e.jsonData.tenantId,clientId:e.jsonData.clientId,clientSecret:x(e),defaultSubscriptionId:e.jsonData.subscriptionId}}}(e.options)),[e.options]);return(0,G.jsxs)(G.Fragment,{children:[q||(q=(0,G.jsx)("h3",{className:"page-heading",children:"Authentication"})),(0,G.jsx)(R,{managedIdentityEnabled:i.config.azure.managedIdentityEnabled,credentials:s,azureCloudOptions:E,onCredentialsChange:e=>{r((r=>function(e,r){switch(r.authType){case"msi":if(!i.config.azure.managedIdentityEnabled)throw new Error("Managed Identity authentication is not enabled in Grafana config.");return Object.assign({},e,{jsonData:Object.assign({},e.jsonData,{azureAuthType:"msi",subscriptionId:r.defaultSubscriptionId})});case"clientsecret":return Object.assign({},e,{jsonData:Object.assign({},e.jsonData,{azureAuthType:"clientsecret",cloudName:r.azureCloud||M(),tenantId:r.tenantId,clientId:r.clientId,subscriptionId:r.defaultSubscriptionId}),secureJsonData:Object.assign({},e.secureJsonData,{clientSecret:"string"==typeof r.clientSecret&&r.clientSecret.length>0?r.clientSecret:void 0}),secureJsonFields:Object.assign({},e.secureJsonFields,{clientSecret:"symbol"==typeof r.clientSecret})})}}(r,e)))},getSubscriptions:t,disabled:e.options.readOnly})]})};function F(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class Q extends o.PureComponent{constructor(e){super(e),F(this,"templateSrv",(0,i.getTemplateSrv)()),F(this,"baseURL",void 0),F(this,"updateOptions",(e=>{const r=e(this.props.options);this.props.onOptionsChange(r),this.setState({unsaved:!0})})),F(this,"saveOptions",(async()=>{this.state.unsaved&&(await(0,i.getBackendSrv)().put(`/api/datasources/${this.props.options.id}`,this.props.options).then((e=>{(0,s.updateDatasourcePluginOption)(this.props,"version",e.datasource.version)})),this.setState({unsaved:!1}))})),F(this,"getSubscriptions",(async()=>{await this.saveOptions();try{const e=await(0,i.getBackendSrv)().fetch({url:this.baseURL+"?api-version=2019-03-01",method:"GET"}).toPromise();return this.setState({error:void 0}),l.parseSubscriptionsForSelect(e)}catch(r){var e;return this.setState({error:{title:"Error requesting subscriptions",description:"Could not request subscriptions from Azure. Check your credentials and try again.",details:null==r||null===(e=r.data)||void 0===e?void 0:e.message}}),Promise.resolve([])}})),this.state={unsaved:!1},this.baseURL=`/api/datasources/${this.props.options.id}/resources/${g}/subscriptions`}render(){const{options:e}=this.props,{error:r}=this.state;return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(P,{options:e,updateOptions:this.updateOptions,getSubscriptions:this.getSubscriptions}),r&&(0,G.jsxs)(a.Alert,{severity:"error",title:r.title,children:[(0,G.jsx)("p",{children:r.description}),r.details&&(0,G.jsx)("details",{style:{whiteSpace:"pre-wrap"},children:r.details})]})]})}}var $=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/utils/messageFromError.ts");function V(){const[e,r]=(0,o.useState)([]),t=(0,o.useCallback)(((e,t)=>{r((r=>{const s=[...r],o=r.findIndex((r=>{let[t]=r;return t===e}));return o>-1&&s.splice(o,1),t&&s.unshift([e,t]),s}))}),[]);return[(0,o.useMemo)((()=>{const r=e[0];return r&&(0,$.Z)(r[1])}),[e]),t]}var U=t("./.yarn/__virtual__/@grafana-experimental-virtual-22e4fdfd25/0/cache/@grafana-experimental-npm-0.0.2-canary.30-71a280d204-b5b453b937.zip/node_modules/@grafana/experimental/index.js");const W=e=>i.config.featureToggles.azureMonitorExperimentalUI?(0,G.jsx)(U.EditorField,Object.assign({width:18},e)):(0,G.jsx)(a.InlineField,Object.assign({labelWidth:18},e)),X=e=>{let{query:r,subscriptions:t,variableOptionGroup:s,onQueryChange:i,multiSelect:n=!1}=e;const c=(0,o.useCallback)((e=>{if(!e.value)return;let t=Object.assign({},r,{subscription:e.value});r.queryType===v.AzureMonitor&&(t.azureMonitor=Object.assign({},t.azureMonitor,{resourceGroup:void 0,metricDefinition:void 0,metricNamespace:void 0,resourceName:void 0,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})),i(t)}),[r,i]),u=(0,o.useCallback)((e=>{e&&(r.subscriptions=e.map((e=>{var r;return null!==(r=e.value)&&void 0!==r?r:""})),i(r))}),[r,i]),l=(0,o.useMemo)((()=>[...t,s]),[t,s]);return n?(0,G.jsx)(W,{label:"Subscriptions",children:(0,G.jsx)(a.MultiSelect,{isClearable:!0,value:d([...t,...s.options],r.subscriptions),inputId:"azure-monitor-subscriptions-field",onChange:u,options:l,width:38})}):(0,G.jsx)(W,{label:"Subscription",children:(0,G.jsx)(a.Select,{value:r.subscription,inputId:"azure-monitor-subscriptions-field",onChange:c,options:l,width:38,allowCustomValue:!0})})},B=e=>{var r,t;let{query:s,onQueryChange:i}=e;const n=(0,o.useCallback)((e=>{i(Object.assign({},s,{azureResourceGraph:Object.assign({},s.azureResourceGraph,{query:e})}))}),[i,s]);return(0,G.jsx)(a.CodeEditor,{value:null!==(r=null===(t=s.azureResourceGraph)||void 0===t?void 0:t.query)&&void 0!==r?r:"",language:"kusto",height:200,width:1e3,showMiniMap:!1,onBlur:n,onSave:n})},_="arg-subscriptions",H=e=>{let{query:r,datasource:t,subscriptionId:s,variableOptionGroup:i,onChange:n,setError:c}=e;const u=(0,o.useRef)(!1),[l,p]=(0,o.useState)([]);return(0,o.useEffect)((()=>{u.current||(u.current=!0,t.azureMonitorDatasource.getSubscriptions().then((e=>{var t;const s=e.map((e=>({label:e.text,value:e.value,description:e.value})));var o;(p(s),c(_,void 0),null!==(t=r.subscriptions)&&void 0!==t&&t.length||null==s||!s.length)||n(Object.assign({},r,{subscriptions:[null!==(o=r.subscription)&&void 0!==o?o:s[0].value]}))})).catch((e=>c(_,e))))}),[t,n,r,c]),(0,G.jsxs)("div",{"data-testid":"azure-monitor-logs-query-editor",children:[(0,G.jsx)(a.InlineFieldRow,{children:(0,G.jsx)(X,{multiSelect:!0,subscriptions:l,query:r,datasource:t,subscriptionId:s,variableOptionGroup:i,onQueryChange:n,setError:c})}),(0,G.jsx)(B,{query:r,datasource:t,subscriptionId:s,variableOptionGroup:i,onQueryChange:n,setError:c})]})};var K=t("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),J=t("./.yarn/__virtual__/react-use-virtual-00326e70ba/0/cache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useEffectOnce.js");const Z=e=>{const r=(0,a.useTheme2)(),t=Y(r,e);return(0,G.jsx)("span",{className:(0,K.cx)(t.wrapper)})};Z.defaultProps={v:0,h:0,layout:"block"};const Y=(0,a.stylesFactory)(((e,r)=>{var t,s;return{wrapper:(0,K.css)([{paddingRight:e.spacing(null!==(t=r.h)&&void 0!==t?t:0),paddingBottom:e.spacing(null!==(s=r.v)&&void 0!==s?s:0)},"inline"===r.layout&&{display:"inline-block"},"block"===r.layout&&{display:"block"}])}}));let ee;var re,te,se,oe;!function(e){e.Subscription="Subscription",e.ResourceGroup="ResourceGroup",e.Resource="Resource",e.VariableGroup="TemplateVariableGroup",e.Variable="TemplateVariable"}(ee||(ee={}));const ie=e=>{let{isOpen:r,entry:{type:t}}=e;switch(t){case ee.Subscription:return re||(re=(0,G.jsx)(a.Icon,{name:"layer-group"}));case ee.ResourceGroup:return(0,G.jsx)(a.Icon,{name:r?"folder-open":"folder"});case ee.Resource:return te||(te=(0,G.jsx)(a.Icon,{name:"cube"}));case ee.VariableGroup:return se||(se=(0,G.jsx)(a.Icon,{name:"x"}));case ee.Variable:return oe||(oe=(0,G.jsx)(a.Icon,{name:"x"}));default:return null}},ae=e=>({table:(0,K.css)({width:"100%",tableLayout:"fixed"}),tableScroller:(0,K.css)({maxHeight:"50vh",overflow:"auto"}),header:(0,K.css)({background:e.colors.background.secondary}),row:(0,K.css)({borderBottom:`1px solid ${e.colors.border.weak}`,"&:last-of-type":{borderBottomColor:e.colors.border.medium}}),disabledRow:(0,K.css)({opacity:.5}),cell:(0,K.css)({padding:e.spacing(1,1,1,0),width:"25%",overflow:"hidden",textOverflow:"ellipsis","&:first-of-type":{width:"50%",padding:e.spacing(1,1,1,2)}}),collapseButton:(0,K.css)({margin:0}),loadingCell:(0,K.css)({textAlign:"center"}),spinner:(0,K.css)({marginBottom:0}),nestedEntry:(0,K.css)({display:"flex",alignItems:"center"}),entryContentItem:(0,K.css)({margin:e.spacing(0,1,0,0)}),truncated:(0,K.css)({minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),nestedRowCheckbox:(0,K.css)({zIndex:0}),selectionFooter:(0,K.css)({position:"sticky",bottom:0,background:e.colors.background.primary,paddingTop:e.spacing(2)}),loadingWrapper:(0,K.css)({textAlign:"center",paddingTop:e.spacing(2),paddingBottom:e.spacing(2),color:e.colors.text.secondary}),resultLimit:(0,K.css)({margin:"4px 0",fontStyle:"italic"})});var ne,ce,ue,le;const pe=e=>{let{entry:r,isSelected:t,isDisabled:s,isOpen:i,isSelectable:n,level:c,scrollIntoView:u,onToggleCollapse:l,onSelectedChange:p}=e;const d=(0,a.useTheme2)(),m=(0,a.useStyles2)(ae),g=!!r.children,f=(0,o.useCallback)((()=>{l(r)}),[l,r]),h=(0,o.useCallback)((e=>{const t=e.target.checked;p(r,t)}),[r,p]),y=`${u?"table":"summary"}_checkbox_${r.uri}`;return(0,o.useEffect)((()=>{var e;t&&u&&(null===(e=document.getElementById(y))||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"}))}),[]),(0,G.jsxs)("div",{className:m.nestedEntry,style:{marginLeft:c*(3*d.spacing.gridSize)},children:[g?(0,G.jsx)(a.IconButton,{className:m.collapseButton,name:i?"angle-down":"angle-right","aria-label":i?`Collapse ${r.name}`:`Expand ${r.name}`,onClick:f,id:r.id}):ne||(ne=(0,G.jsx)(Z,{layout:"inline",h:2})),ce||(ce=(0,G.jsx)(Z,{layout:"inline",h:2})),n&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(a.Checkbox,{id:y,onChange:h,disabled:s,value:t,className:m.nestedRowCheckbox}),ue||(ue=(0,G.jsx)(Z,{layout:"inline",h:2}))]}),(0,G.jsx)(ie,{entry:r,isOpen:i}),le||(le=(0,G.jsx)(Z,{layout:"inline",h:1})),(0,G.jsx)("label",{htmlFor:y,className:(0,K.cx)(m.entryContentItem,m.truncated),children:r.name})]})};var de=t("./.yarn/cache/immer-npm-9.0.12-e8cd7358fa-bcbec6d76d.zip/node_modules/immer/dist/immer.esm.js");const me=/\/subscriptions\/(?<subscriptionID>[^/]+)(?:\/resourceGroups\/(?<resourceGroup>[^/]+)(?:\/providers.+\/(?<resource>[^/]+))?)?/;function ge(e){var r;const t=me.exec(e),s=null!==(r=null==t?void 0:t.groups)&&void 0!==r?r:{},{subscriptionID:o,resourceGroup:i,resource:a}=s;if(o)return{subscriptionID:o,resourceGroup:i,resource:a}}function fe(e){return!!e.match(/^[A-Z0-9]+/i)}function he(e,r){for(const t of e){if(t.uri.toLowerCase()===r.toLowerCase())return t;if(t.children){const e=he(t.children,r);if(e)return e}}}function ye(e,r,t){return(0,de.ZP)(e,(e=>{const s=he(e,r);s&&(s.children=t)}))}const ve=e=>{var r;let{row:t,selectedRows:s,level:i,requestNestedRows:n,onRowSelectedChange:c,selectableEntryTypes:u,scrollIntoView:l}=e;const p=(0,a.useStyles2)(ae),[d,m]=(0,o.useState)("closed"),g=!!s.find((e=>e.uri===t.uri)),f=s.length>0&&!g,h="open"===d;return(0,o.useEffect)((()=>{var e;const r=s[0];r&&!!he(null!==(e=t.children)&&void 0!==e?e:[],r.uri)&&m("open")}),[s,t]),(0,G.jsxs)(G.Fragment,{children:[(0,G.jsxs)("tr",{className:(0,K.cx)(p.row,f&&p.disabledRow),children:[(0,G.jsx)("td",{className:p.cell,children:(0,G.jsx)(pe,{level:i,isSelected:g,isDisabled:f,isOpen:h,entry:t,onToggleCollapse:async()=>{"open"!==d?(m("loading"),n(t).then((()=>m("open"))).catch((()=>m("closed")))):m("closed")},onSelectedChange:c,isSelectable:u.some((e=>e===t.type)),scrollIntoView:l})}),(0,G.jsx)("td",{className:p.cell,children:t.typeLabel}),(0,G.jsx)("td",{className:p.cell,children:null!==(r=t.location)&&void 0!==r?r:"-"})]},t.id),h&&t.children&&Object.keys(t.children).length>0&&t.children.map((e=>(0,G.jsx)(ve,{row:e,selectedRows:s,level:i+1,requestNestedRows:n,onRowSelectedChange:c,selectableEntryTypes:u,scrollIntoView:l},e.uri))),(0,G.jsx)(a.FadeTransition,{visible:"loading"===d,children:(0,G.jsx)("tr",{children:(0,G.jsx)("td",{className:(0,K.cx)(p.cell,p.loadingCell),colSpan:3,children:(0,G.jsx)(a.LoadingPlaceholder,{text:"Loading...",className:p.spinner})})})})]})},be=ve;var we;const Ne=e=>{let{searchFn:r}=e;const[t,s]=(0,o.useState)(""),i=(0,o.useMemo)((()=>(0,n.debounce)(r,600)),[r]);return(0,o.useEffect)((()=>()=>{i.cancel()}),[i]),(0,G.jsx)(a.Input,{"aria-label":"resource search",prefix:we||(we=(0,G.jsx)(a.Icon,{name:"search"})),value:t,onChange:e=>{const r=e.currentTarget.value;s(r),i(r)},placeholder:"search for a resource"})};var Me,Se,je,xe,ze,ke,Te,Le,Ae;const Ce=e=>{let{resourcePickerData:r,resourceURI:t,onApply:s,onCancel:i,selectableEntryTypes:n}=e;const c=(0,a.useStyles2)(ae),[u,l]=(0,o.useState)(!1),[p,d]=(0,o.useState)([]),[m,g]=(0,o.useState)([]),[f,h]=(0,o.useState)(t),[y,v]=(0,o.useState)(void 0),[b,w]=(0,o.useState)(null==t?void 0:t.includes("$")),[N,M]=(0,o.useState)(!1);(0,o.useEffect)((()=>{h(t)}),[t]);const S=(0,o.useCallback)((async()=>{if(!u){try{l(!0);const e=await r.fetchInitialRows(f||"");d(e)}catch(e){v((0,$.Z)(e))}l(!1)}}),[f,u,r]);(0,J.Z)((()=>{S()})),(0,o.useEffect)((()=>{f||g([]);const e=f&&he(p,f);if(e)return g([Object.assign({},e,{children:void 0})])}),[f,p]);const j=(0,o.useCallback)((async e=>{var t;if(v(void 0),null===(t=e.children)||void 0===t||!t.length)try{const t=await r.fetchAndAppendNestedRow(p,e);d(t)}catch(e){throw v((0,$.Z)(e)),e}}),[r,p]),x=(0,o.useCallback)(((e,r)=>{h(r?e.uri:void 0)}),[]),z=(0,o.useCallback)((()=>{s(f)}),[f,s]),k=(0,o.useCallback)((async e=>{if(v(void 0),M(!1),e){try{l(!0);const t=n.length>1?"logs":"metrics",s=await r.search(e,t);d(s),s.length>=r.resultLimit&&M(!0)}catch(e){v((0,$.Z)(e))}l(!1)}else S()}),[S,n.length,r]);return(0,G.jsxs)("div",{children:[(0,G.jsx)(Ne,{searchFn:k}),N?(0,G.jsxs)("p",{className:c.resultLimit,children:["Showing first ",r.resultLimit," results"]}):Me||(Me=(0,G.jsx)(Z,{v:2})),(0,G.jsx)("table",{className:c.table,children:(0,G.jsx)("thead",{children:(0,G.jsxs)("tr",{className:(0,K.cx)(c.row,c.header),children:[(0,G.jsx)("td",{className:c.cell,children:"Scope"}),(0,G.jsx)("td",{className:c.cell,children:"Type"}),(0,G.jsx)("td",{className:c.cell,children:"Location"})]})})}),(0,G.jsx)("div",{className:c.tableScroller,children:(0,G.jsx)("table",{className:c.table,children:(0,G.jsxs)("tbody",{children:[u&&(0,G.jsx)("tr",{className:(0,K.cx)(c.row),children:(0,G.jsx)("td",{className:c.cell,children:Se||(Se=(0,G.jsx)(a.LoadingPlaceholder,{text:"Loading..."}))})}),!u&&0===p.length&&(0,G.jsx)("tr",{className:(0,K.cx)(c.row),children:(0,G.jsx)("td",{className:c.cell,"aria-live":"polite",children:"No resources found"})}),!u&&p.map((e=>(0,G.jsx)(be,{row:e,selectedRows:m,level:0,requestNestedRows:j,onRowSelectedChange:x,selectableEntryTypes:n,scrollIntoView:!0},e.uri)))]})})}),(0,G.jsxs)("div",{className:c.selectionFooter,children:[m.length>0&&(0,G.jsxs)(G.Fragment,{children:[je||(je=(0,G.jsx)("h5",{children:"Selection"})),(0,G.jsx)("div",{className:c.tableScroller,children:(0,G.jsx)("table",{className:c.table,children:(0,G.jsx)("tbody",{children:m.map((e=>(0,G.jsx)(be,{row:e,selectedRows:m,level:0,requestNestedRows:j,onRowSelectedChange:x,selectableEntryTypes:n},e.uri)))})})}),xe||(xe=(0,G.jsx)(Z,{v:2}))]}),(0,G.jsxs)(a.Collapse,{collapsible:!0,label:"Advanced",isOpen:b,onToggle:()=>w(!b),children:[(0,G.jsx)(a.Label,{htmlFor:`input-${f}`,children:ze||(ze=(0,G.jsxs)("h6",{children:["Resource URI"," ",(0,G.jsx)(a.Tooltip,{content:(0,G.jsxs)(G.Fragment,{children:["Manually edit the"," ",(0,G.jsxs)("a",{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/logs/log-standard-columns#_resourceid",rel:"noopener noreferrer",target:"_blank",children:["resource uri."," "]}),"Supports the use of multiple template variables (ex: /subscriptions/$subId/resourceGroups/$rg)"]}),placement:"right",interactive:!0,children:(0,G.jsx)(a.Icon,{name:"info-circle"})})]}))}),(0,G.jsx)(a.Input,{id:`input-${f}`,value:f,onChange:e=>h(e.currentTarget.value),placeholder:"ex: /subscriptions/$subId"}),ke||(ke=(0,G.jsx)(Z,{v:2}))]}),Te||(Te=(0,G.jsx)(Z,{v:2})),(0,G.jsx)(a.Button,{disabled:!!y,onClick:z,children:"Apply"}),Le||(Le=(0,G.jsx)(Z,{layout:"inline",h:1})),(0,G.jsx)(a.Button,{onClick:i,variant:"secondary",children:"Cancel"})]}),y&&(0,G.jsxs)(G.Fragment,{children:[Ae||(Ae=(0,G.jsx)(Z,{v:2})),(0,G.jsx)(a.Alert,{severity:"error",title:"An error occurred while requesting resources from Azure Monitor",children:y})]})]})};var Ie,Ge,De,Oe,Re,qe,Ee,Pe;function Fe(e){const r=ge(e);if(r)return{subscriptionName:r.subscriptionID,resourceGroupName:r.resourceGroup,resourceName:r.resource}}const Qe=e=>{let{resource:r,datasource:t}=e;const[s,i]=(0,o.useState)(Fe(null!=r?r:""));return(0,o.useEffect)((()=>{r&&Fe(r)?t.resourcePickerData.getResourceURIDisplayProperties(r).then(i):i(void 0)}),[t.resourcePickerData,r]),r?s?(0,G.jsx)($e,{resource:s}):r.startsWith("$")?(0,G.jsxs)("span",{children:[Ie||(Ie=(0,G.jsx)(a.Icon,{name:"x"}))," ",r]}):(0,G.jsx)(G.Fragment,{children:r}):(0,G.jsx)(G.Fragment,{children:"Select a resource"})},$e=e=>{let{resource:r}=e;return(0,G.jsxs)("span",{children:[Ge||(Ge=(0,G.jsx)(a.Icon,{name:"layer-group"}))," ",r.subscriptionName,r.resourceGroupName&&(0,G.jsxs)(G.Fragment,{children:[De||(De=(0,G.jsx)(Ve,{})),Oe||(Oe=(0,G.jsx)(a.Icon,{name:"folder"}))," ",r.resourceGroupName]}),r.resourceName&&(0,G.jsxs)(G.Fragment,{children:[Re||(Re=(0,G.jsx)(Ve,{})),qe||(qe=(0,G.jsx)(a.Icon,{name:"cube"}))," ",r.resourceName]})]})},Ve=()=>(0,G.jsxs)(G.Fragment,{children:[Ee||(Ee=(0,G.jsx)(Z,{layout:"inline",h:2})),"/",Pe||(Pe=(0,G.jsx)(Z,{layout:"inline",h:2}))]}),Ue=e=>{let{query:r,datasource:t,onQueryChange:s,setResource:i,selectableEntryTypes:n,resourceUri:c}=e;const u=(0,a.useStyles2)(We),[l,p]=(0,o.useState)(!1),d=(0,o.useCallback)((()=>{p(!0)}),[]),m=(0,o.useCallback)((()=>{p(!1)}),[]),g=(0,o.useCallback)((e=>{s(i(r,e)),m()}),[m,s,r,i]);return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(a.Modal,{className:u.modal,title:"Select a resource",isOpen:l,onDismiss:m,trapFocus:!1,children:(0,G.jsx)(Ce,{resourcePickerData:t.resourcePickerData,resourceURI:c,onApply:g,onCancel:m,selectableEntryTypes:n})}),(0,G.jsx)(W,{label:"Resource",children:(0,G.jsx)(a.Button,{variant:"secondary",onClick:d,type:"button",children:(0,G.jsx)(Qe,{resource:c,datasource:t})})})]})},We=e=>({modal:(0,K.css)({width:e.breakpoints.values.lg})});function Xe(e,r){return Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{query:r})})}function Be(e,r){return Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{resource:r})})}const _e=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"}],He=e=>{var r;let{query:t,variableOptionGroup:s,onQueryChange:i}=e;const n=(0,o.useMemo)((()=>[..._e,s]),[s]),c=(0,o.useCallback)((e=>{const{value:r}=e;if(!r)return;const s=function(e,r){return Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{resultFormat:r})})}(t,r);i(s)}),[i,t]);return(0,G.jsx)(W,{label:"Format as",children:(0,G.jsx)(a.Select,{inputId:"azure-monitor-logs-workspaces-field",value:null===(r=t.azureLogAnalytics)||void 0===r?void 0:r.resultFormat,onChange:c,options:n,width:38})})};function Ke(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class Je{constructor(){Ke(this,"resolve",void 0),Ke(this,"reject",void 0),Ke(this,"promise",void 0),this.resolve=void 0,this.reject=void 0,this.promise=new Promise(((e,r)=>{this.resolve=e,this.reject=r})),Object.freeze(this)}}const Ze=e=>{var r,t,s;let{query:i,datasource:n,onQueryChange:c}=e;const u=(0,o.useRef)();(0,o.useEffect)((()=>{var e;if(null===(e=i.azureLogAnalytics)||void 0===e||!e.resource)return;const r=[n.azureLogAnalyticsDatasource.getKustoSchema(i.azureLogAnalytics.resource),(u.current||(u.current=new Je),u.current.promise)];Promise.all(r).then((e=>{let[r,{monaco:t,editor:s}]=e;t.languages.kusto.getKustoWorker().then((e=>{const r=s.getModel();return r&&e(r.uri)})).then((e=>{null==e||e.setSchema(r,"https://help.kusto.windows.net","Samples")}))}))}),[n.azureLogAnalyticsDatasource,null===(r=i.azureLogAnalytics)||void 0===r?void 0:r.resource]);const l=(0,o.useCallback)(((e,r)=>{var t,s;null===(t=u.current)||void 0===t||null===(s=t.resolve)||void 0===s||s.call(t,{editor:e,monaco:r})}),[]),p=(0,o.useCallback)((e=>{c(Xe(i,e))}),[c,i]);return(0,G.jsx)(a.CodeEditor,{value:null!==(t=null===(s=i.azureLogAnalytics)||void 0===s?void 0:s.query)&&void 0!==t?t:"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:p,onSave:p,onEditorDidMount:l})};function Ye(e,r,t){const[s,i]=(0,o.useState)();return(0,o.useEffect)((()=>{(async function(e,r,t){var s;if(void 0!==(null===(s=r.azureLogAnalytics)||void 0===s?void 0:s.workspace)&&!r.azureLogAnalytics.resource){let s;s=fe(r.azureLogAnalytics.workspace)?await e.resourcePickerData.getResourceURIFromWorkspace(r.azureLogAnalytics.workspace):r.azureLogAnalytics.workspace;const o=Object.assign({},r,{azureLogAnalytics:Object.assign({},r.azureLogAnalytics,{resource:s,workspace:void 0})});delete o.azureLogAnalytics.workspace,t(o)}})(e,r,t).catch((e=>i({title:"Unable to migrate workspace as a resource",message:e.message})))}),[e,r,t]),s}const er=e=>{var r;let{query:t,datasource:s,subscriptionId:o,variableOptionGroup:i,onChange:n,setError:c,hideFormatAs:u}=e;const l=Ye(s,t,n);return(0,G.jsxs)("div",{"data-testid":"azure-monitor-logs-query-editor",children:[(0,G.jsx)(a.InlineFieldRow,{children:(0,G.jsx)(Ue,{query:t,datasource:s,subscriptionId:o,variableOptionGroup:i,onQueryChange:n,setError:c,selectableEntryTypes:[ee.Subscription,ee.ResourceGroup,ee.Resource,ee.Variable],setResource:Be,resourceUri:null===(r=t.azureLogAnalytics)||void 0===r?void 0:r.resource})}),(0,G.jsx)(Ze,{query:t,datasource:s,subscriptionId:o,variableOptionGroup:i,onQueryChange:n,setError:c}),!u&&(0,G.jsx)(He,{query:t,datasource:s,subscriptionId:o,variableOptionGroup:i,onQueryChange:n,setError:c}),l&&(0,G.jsx)(a.Alert,{title:l.title,children:l.message})]})};function rr(e,r){return Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{resourceUri:r,metricNamespace:void 0,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}function tr(e,r){return e.subscription===r?e:Object.assign({},e,{subscription:r,azureMonitor:Object.assign({},e.azureMonitor,{resourceUri:"",resourceGroup:void 0,metricDefinition:void 0,metricNamespace:void 0,resourceName:void 0,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}function sr(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.metricNamespace)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{metricNamespace:r,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}function or(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.timeGrain)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{timeGrain:r})})}function ir(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.dimensionFilters)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{dimensionFilters:r})})}function ar(e){var r,t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"eq",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const a=null!==(r=null===(t=e.azureMonitor)||void 0===t?void 0:t.dimensionFilters)&&void 0!==r?r:[];return ir(e,[...a,{dimension:s,operator:o,filters:i}])}const nr=e=>{var r;let{query:t,variableOptionGroup:s,onQueryChange:i,aggregationOptions:n,isLoading:c}=e;const u=(0,o.useCallback)((e=>{if(!e.value)return;const r=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.aggregation)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{aggregation:r})})}(t,e.value);i(r)}),[i,t]),l=(0,o.useMemo)((()=>[...n,s]),[n,s]);return(0,G.jsx)(W,{label:"Aggregation",children:(0,G.jsx)(a.Select,{inputId:"azure-monitor-metrics-aggregation-field",value:null===(r=t.azureMonitor)||void 0===r?void 0:r.aggregation,onChange:u,options:l,width:38,isLoading:c})})},cr=e=>{var r;let{data:t,query:s,dimensionOptions:i,onQueryChange:n}=e;const c=(0,o.useMemo)((()=>{var e,r;return null!==(e=null===(r=s.azureMonitor)||void 0===r?void 0:r.dimensionFilters)&&void 0!==e?e:[]}),[null===(r=s.azureMonitor)||void 0===r?void 0:r.dimensionFilters]),u=((e,r)=>{const[t,s]=(0,o.useState)({});return(0,o.useEffect)((()=>{var t;let o={};if(null!=e&&null!==(t=e.series)&&void 0!==t&&t.length){const t=e.series.flat().filter((e=>e.refId===r.refId)).flatMap((e=>e.fields)).map((e=>e.labels)).flat().filter((e=>e));for(const e of t)if(e)for(const[r,t]of Object.entries(e))o[r]?o[r].add(t):o[r]=new Set([t])}s((e=>{const r={},t=Object.keys(o);if(0===t.length)return e;for(const s of t)e[s]&&o[s].size<e[s].size?r[s]=e[s]:r[s]=o[s];return r}))}),[null==e?void 0:e.series,r.refId]),t})(t,s),l=[{label:"==",value:"eq"},{label:"!=",value:"ne"},{label:"starts with",value:"sw"}],p=(0,o.useMemo)((()=>{let e=i;return c.length&&(e=i.filter((e=>!c.some((r=>r.dimension===e.value))))),e}),[c,i]),d=e=>{n(function(e,r){var t,s;const o=[...null!==(t=null===(s=e.azureMonitor)||void 0===s?void 0:s.dimensionFilters)&&void 0!==t?t:[]];return o.splice(r,1),ir(e,o)}(s,e))},m=(e,r,t)=>{n(function(e,r,t,s){var o,i;const a=[...null!==(o=null===(i=e.azureMonitor)||void 0===i?void 0:i.dimensionFilters)&&void 0!==o?o:[]],n=a[r];return n[t]=s,"dimension"!==t&&"operator"!==t||(n.filters=[]),ir(e,a)}(s,e,r,t))},g=(e,r)=>{var t;const s=Array.from(null!==(t=u[r.toLowerCase()])&&void 0!==t?t:[]);return s.find((r=>r===e))?s.map((e=>({value:e,label:e}))):[...s,...e&&"*"!==e?[e]:[]].map((e=>({value:e,label:e})))},f=(e,r)=>{const t=g(void 0,r);if(e)for(const r of e)t.find((e=>e.value===r))||t.push({value:r,label:r});return t};return(0,G.jsx)(W,{label:"Dimension",children:(0,G.jsxs)(a.VerticalGroup,{spacing:"xs",children:[c.map(((e,r)=>{return(0,G.jsxs)(a.HorizontalGroup,{spacing:"xs",children:[(0,G.jsx)(a.Select,{placeholder:"Field",value:e.dimension,options:(s=e.dimension,p.concat(i.filter((e=>e.value===s)))),onChange:e=>{var t;return m(r,"dimension",null!==(t=e.value)&&void 0!==t?t:"")},width:38}),(0,G.jsx)(a.Select,{menuShouldPortal:!0,placeholder:"Operation",value:e.operator,options:(t=e.operator,l.find((e=>e.value===t))?l:[...l,...t?[{label:t,value:t}]:[]]),onChange:e=>{var t;return m(r,"operator",null!==(t=e.value)&&void 0!==t?t:"")},allowCustomValue:!0}),"eq"===e.operator||"ne"===e.operator?(0,G.jsx)(a.MultiSelect,{menuShouldPortal:!0,placeholder:"Select value(s)",value:e.filters,options:f(e.filters,e.dimension),onChange:e=>((e,r)=>{m(e,"filters",r.map((e=>e.value||"")))})(r,e),"aria-label":"dimension-labels-select",allowCustomValue:!0}):(0,G.jsx)(a.Select,{menuShouldPortal:!0,placeholder:"Select value",value:e.filters?e.filters[0]:"",allowCustomValue:!0,options:g(e.filters?e.filters[0]:"",e.dimension),onChange:e=>((e,r)=>{var t;m(e,"filters",[null!==(t=null==r?void 0:r.value)&&void 0!==t?t:""])})(r,e),isClearable:!0}),(0,G.jsx)(a.Button,{variant:"secondary",size:"md",icon:"trash-alt","aria-label":"Remove",onClick:()=>d(r)})]},r);var t,s})),(0,G.jsx)(a.Button,{variant:"secondary",size:"md",onClick:()=>{n(ar(s))},children:"Add new dimension"})]})})},ur=e=>{var r,t;let{onQueryChange:s,query:i}=e;const[n,c]=(0,o.useState)(null!==(r=null===(t=i.azureMonitor)||void 0===t?void 0:t.alias)&&void 0!==r?r:""),u=(0,o.useCallback)((e=>{e.target instanceof HTMLInputElement&&c(e.target.value)}),[]),l=(0,o.useCallback)((()=>{const e=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.alias)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{alias:r})})}(i,n);s(e)}),[s,i,n]);return(0,G.jsx)(W,{label:"Legend format",children:(0,G.jsx)(a.Input,{id:"azure-monitor-metrics-legend-field",placeholder:"Alias patterns",value:n,onChange:u,onBlur:l,width:38})})},lr=e=>{var r,t;let{metricNames:s,query:i,variableOptionGroup:n,onQueryChange:c}=e;const u=(0,o.useCallback)((e=>{if(!e.value)return;const r=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.metricName)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{metricName:r,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}(i,e.value);c(r)}),[c,i]),l=(0,o.useMemo)((()=>[...s,n]),[s,n]);return(0,G.jsx)(W,{label:"Metric",children:(0,G.jsx)(a.Select,{inputId:"azure-monitor-metrics-metric-field",value:null!==(r=null===(t=i.azureMonitor)||void 0===t?void 0:t.metricName)&&void 0!==r?r:null,onChange:u,options:l,width:38,allowCustomValue:!0})})},pr=e=>{var r,t;let{metricNamespaces:s,query:i,variableOptionGroup:n,onQueryChange:c}=e;const u=(0,o.useCallback)((e=>{if(!e.value)return;const r=sr(i,e.value);c(r)}),[c,i]),l=(0,o.useMemo)((()=>[...s,n]),[s,n]),p=s.map((e=>e.value)).concat(n.options.map((e=>e.value))),d=null===(r=i.azureMonitor)||void 0===r?void 0:r.metricNamespace;return d&&!p.includes(d)&&l.push({label:d,value:d}),(0,G.jsx)(W,{label:"Metric namespace",children:(0,G.jsx)(a.Select,{inputId:"azure-monitor-metrics-metric-namespace-field",value:null===(t=i.azureMonitor)||void 0===t?void 0:t.metricNamespace,onChange:u,options:l,width:38,allowCustomValue:!0})})},dr=e=>{var r;let{query:t,resourceGroups:s,variableOptionGroup:i,onQueryChange:n,setError:c}=e;const u=(0,o.useCallback)((e=>{const r=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.resourceGroup)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{resourceUri:"",resourceGroup:r,metricDefinition:void 0,metricNamespace:void 0,resourceName:void 0,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}(t,e.value);n(r)}),[n,t]),l=(0,o.useMemo)((()=>[...s,i]),[s,i]);return(0,G.jsx)(W,{label:"Resource group",children:(0,G.jsx)(a.Select,{inputId:"azure-monitor-metrics-resource-group-field",value:null===(r=t.azureMonitor)||void 0===r?void 0:r.resourceGroup,onChange:u,options:l,width:38,allowCustomValue:!0})})},mr=e=>{var r,t;let{resourceNames:s,query:i,variableOptionGroup:n,onQueryChange:c}=e;const u=(0,o.useCallback)((e=>{const r=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.resourceName)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{resourceUri:"",resourceName:r,metricNamespace:void 0,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}(i,e.value);c(r)}),[c,i]),l=(0,o.useMemo)((()=>[...s,n]),[s,n]),p=null!==(r=null===(t=i.azureMonitor)||void 0===t?void 0:t.resourceName)&&void 0!==r?r:null;return(0,G.jsx)(W,{label:"Resource name",children:(0,G.jsx)(a.Select,{inputId:"azure-monitor-metrics-resource-name-field",value:p,onChange:u,options:l,width:38,allowCustomValue:!0})})},gr=e=>{var r;let{resourceTypes:t,query:s,variableOptionGroup:i,onQueryChange:n}=e;const c=(0,o.useCallback)((e=>{if(!e.value)return;const r=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.metricDefinition)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{resourceUri:"",metricDefinition:r,resourceName:void 0,metricNamespace:void 0,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}(s,e.value);n(r)}),[n,s]),u=(0,o.useMemo)((()=>[...t,i]),[t,i]);return(0,G.jsx)(W,{label:"Resource type",children:(0,G.jsx)(a.Select,{inputId:"azure-monitor-metrics-resource-type-field",value:null===(r=s.azureMonitor)||void 0===r?void 0:r.metricDefinition,onChange:c,options:u,width:38,allowCustomValue:!0})})},fr=e=>{var r;let{query:t,timeGrainOptions:s,variableOptionGroup:i,onQueryChange:n}=e;const c=(0,o.useCallback)((e=>{if(!e.value)return;const r=or(t,e.value);n(r)}),[n,t]),l=(0,o.useMemo)((()=>{const e=u.findClosestTimeGrain("1m",s.map((e=>u.createKbnUnitFromISO8601Duration(e.value)))||["1m","5m","15m","30m","1h","6h","12h","1d"]);return[...s.map((r=>"auto"===r.value?Object.assign({},r,{description:e}):r)),i]}),[s,i]);return(0,G.jsx)(W,{label:"Time grain",children:(0,G.jsx)(a.Select,{inputId:"azure-monitor-metrics-time-grain-field",value:null===(r=t.azureMonitor)||void 0===r?void 0:r.timeGrain,onChange:c,options:l,width:38})})},hr=e=>{var r,t;let{onQueryChange:s,query:i}=e;const[n,c]=(0,o.useState)(null!==(r=null===(t=i.azureMonitor)||void 0===t?void 0:t.top)&&void 0!==r?r:""),u=(0,o.useCallback)((e=>{e.target instanceof HTMLInputElement&&c(e.target.value)}),[]),l=(0,o.useCallback)((()=>{const e=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.top)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{top:r})})}(i,n);s(e)}),[s,i,n]);return(0,G.jsx)(W,{label:"Top",children:(0,G.jsx)(a.Input,{id:"azure-monitor-metrics-top-field",value:n,onChange:u,onBlur:l,width:16})})};function yr(e,r,t){const[s]=(0,o.useState)((()=>Math.random())),[i,a]=(0,o.useState)(),n=(0,o.useMemo)((()=>null!=i?i:[]),[i]);return(0,o.useEffect)((()=>{e().then((e=>{a(e),r(s,void 0)})).catch((e=>{r(s,e)}))}),t),n}const vr=(e,r,t,s)=>{const i=r.azureMonitorDatasource.defaultSubscriptionId,{subscription:a}=e,n=yr((async()=>br(await r.azureMonitorDatasource.getSubscriptions(),a)),s,[]);return(0,o.useEffect)((()=>{((e,r,t,s)=>{const{subscription:o}=e;if(!r.length||o&&(p(r,o)||o.includes("$")))return;const i=s||r[0].value;!o&&i&&p(r,i)&&t(tr(e,i)),o&&!p(r,o)&&(p(r,i)?t(tr(e,i)):t(tr(e,"")))})(e,n,t,i)}),[n,e,i,t]),n};function br(e,r){const t=e.map(m);return r&&!t.find((e=>e.value===r))&&t.push({label:r,value:r}),t}const wr=e=>{var r,t,s;let{data:i,query:n,datasource:c,subscriptionId:u,variableOptionGroup:l,onChange:p,setError:d}=e;const m=((e,r,t)=>{var s;const[i,a]=(0,o.useState)({aggOptions:[],timeGrains:[],dimensions:[],isLoading:!1,supportedAggTypes:[],primaryAggType:void 0}),{subscription:n}=e,{resourceGroup:c,metricDefinition:u,resourceName:l,metricNamespace:p,metricName:d,aggregation:m,timeGrain:g}=null!==(s=e.azureMonitor)&&void 0!==s?s:{};return(0,o.useEffect)((()=>{n&&c&&u&&l&&p&&d&&r.azureMonitorDatasource.getMetricMetadata({subscription:n,resourceGroup:c,metricDefinition:u,resourceName:l,metricNamespace:p,metricName:d}).then((e=>{var r;const t=(e.supportedAggTypes||[e.primaryAggType]).map((e=>({label:e,value:e})));a({aggOptions:t,timeGrains:e.supportedTimeGrains,dimensions:e.dimensions,isLoading:!1,supportedAggTypes:null!==(r=e.supportedAggTypes)&&void 0!==r?r:[],primaryAggType:e.primaryAggType})}))}),[r,n,c,u,l,p,d]),(0,o.useEffect)((()=>{const r=m||i.primaryAggType,s=g||"auto";r===m&&s===g||t(Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{aggregation:r,timeGrain:s})}))}),[t,i,m,g,e]),i})(n,c,p),g=vr(n,c,p,d),f=((e,r,t,s)=>{var o;const{subscription:i}=e,{resourceGroup:a}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return yr((async()=>{if(i)return br(await r.getResourceGroups(i),a)}),s,[i])})(n,c,0,d),h=((e,r,t,s)=>{var o;const{subscription:i}=e,{resourceGroup:a,metricDefinition:n}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return yr((async()=>{if(i&&a)return br(await r.getMetricDefinitions(i,a),n)}),s,[i,a])})(n,c,0,d),y=((e,r,t,s)=>{var o;const{subscription:i}=e,{resourceGroup:a,metricDefinition:n,resourceName:c}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return yr((async()=>{if(i&&a&&n)return br(await r.getResourceNames(i,a,n),c)}),s,[i,a,n])})(n,c,0,d),v=((e,r,t,s)=>{var o;const{subscription:i}=e,{resourceGroup:a,metricDefinition:n,resourceName:c,metricNamespace:u,metricName:l}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return yr((async()=>{if(i&&a&&n&&c&&u)return br(await r.azureMonitorDatasource.getMetricNames({subscription:i,resourceGroup:a,metricDefinition:n,resourceName:c,metricNamespace:u}),l)}),s,[i,a,n,c,u])})(n,c,0,d),b=((e,r,t,s)=>{var o;const{subscription:i}=e,{resourceGroup:a,metricDefinition:n,resourceName:c,metricNamespace:u}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return yr((async()=>{if(!(i&&a&&n&&c))return;const s=br(await r.azureMonitorDatasource.getMetricNamespaces({subscription:i,resourceGroup:a,metricDefinition:n,resourceName:c}),u);return!u&&s.length&&t(sr(e,s[0].value)),s}),s,[i,a,n,c])})(n,c,p,d);return(0,G.jsxs)("div",{"data-testid":"azure-monitor-metrics-query-editor",children:[(0,G.jsxs)(a.InlineFieldRow,{children:[(0,G.jsx)(X,{subscriptions:g,query:n,datasource:c,subscriptionId:u,variableOptionGroup:l,onQueryChange:p,setError:d}),(0,G.jsx)(dr,{resourceGroups:f,query:n,datasource:c,subscriptionId:u,variableOptionGroup:l,onQueryChange:p,setError:d})]}),(0,G.jsxs)(a.InlineFieldRow,{children:[(0,G.jsx)(gr,{resourceTypes:h,query:n,datasource:c,subscriptionId:u,variableOptionGroup:l,onQueryChange:p,setError:d}),(0,G.jsx)(mr,{resourceNames:y,query:n,datasource:c,subscriptionId:u,variableOptionGroup:l,onQueryChange:p,setError:d})]}),(0,G.jsxs)(a.InlineFieldRow,{children:[(0,G.jsx)(pr,{metricNamespaces:b,query:n,datasource:c,subscriptionId:u,variableOptionGroup:l,onQueryChange:p,setError:d}),(0,G.jsx)(lr,{metricNames:v,query:n,datasource:c,subscriptionId:u,variableOptionGroup:l,onQueryChange:p,setError:d})]}),(0,G.jsxs)(a.InlineFieldRow,{children:[(0,G.jsx)(nr,{query:n,datasource:c,subscriptionId:u,variableOptionGroup:l,onQueryChange:p,setError:d,aggregationOptions:null!==(r=null==m?void 0:m.aggOptions)&&void 0!==r?r:[],isLoading:m.isLoading}),(0,G.jsx)(fr,{query:n,datasource:c,subscriptionId:u,variableOptionGroup:l,onQueryChange:p,setError:d,timeGrainOptions:null!==(t=null==m?void 0:m.timeGrains)&&void 0!==t?t:[]})]}),(0,G.jsx)(cr,{data:i,query:n,datasource:c,subscriptionId:u,variableOptionGroup:l,onQueryChange:p,setError:d,dimensionOptions:null!==(s=null==m?void 0:m.dimensions)&&void 0!==s?s:[]}),(0,G.jsx)(hr,{query:n,datasource:c,subscriptionId:u,variableOptionGroup:l,onQueryChange:p,setError:d}),(0,G.jsx)(ur,{query:n,datasource:c,subscriptionId:u,variableOptionGroup:l,onQueryChange:p,setError:d})]})},Nr={aggOptions:[],timeGrains:[],dimensions:[],isLoading:!1,supportedAggTypes:[],primaryAggType:void 0};function Mr(e,r){const t=e.map(m);return r&&!t.find((e=>e.value===r))&&t.push({label:r,value:r}),t}const Sr=e=>{var r,t,s,n,c,u;let{data:l,query:p,datasource:d,variableOptionGroup:m,onChange:g,setError:f}=e;const h=((e,r,t)=>{var s;const[i,a]=(0,o.useState)(Nr),{resourceUri:n,metricNamespace:c,metricName:u,aggregation:l,timeGrain:p}=null!==(s=e.azureMonitor)&&void 0!==s?s:{};return(0,o.useEffect)((()=>{n&&c&&u?r.azureMonitorDatasource.getMetricMetadata({resourceUri:n,metricNamespace:c,metricName:u}).then((e=>{var r;const t=(e.supportedAggTypes||[e.primaryAggType]).map((e=>({label:e,value:e})));a({aggOptions:t,timeGrains:e.supportedTimeGrains,dimensions:e.dimensions,isLoading:!1,supportedAggTypes:null!==(r=e.supportedAggTypes)&&void 0!==r?r:[],primaryAggType:e.primaryAggType})})):a(Nr)}),[r,n,c,u]),(0,o.useEffect)((()=>{const r=l||i.primaryAggType,s=p||"auto";r===l&&s===p||t(Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{aggregation:r,timeGrain:s})}))}),[t,i,l,p,e]),i})(p,d,g),y=((e,r,t,s)=>{var o;const{metricNamespace:i,resourceUri:a}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return yr((async()=>{if(!a)return;const s=Mr(await r.azureMonitorDatasource.getMetricNamespaces({resourceUri:a}),i);return!i&&s.length&&t(sr(e,s[0].value)),s}),s,[a])})(p,d,g,f),v=((e,r,t,s)=>{var o;const{metricNamespace:i,metricName:a,resourceUri:n}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return yr((async()=>{if(i&&n)return Mr(await r.azureMonitorDatasource.getMetricNames({resourceUri:n,metricNamespace:i}),a)}),s,[n,i])})(p,d,0,f);var b,w,N,M,S,j,x,z;return i.config.featureToggles.azureMonitorExperimentalUI?(0,G.jsx)("span",{"data-testid":"azure-monitor-metrics-query-editor-with-experimental-ui",children:(0,G.jsxs)(U.EditorRows,{children:[(0,G.jsx)(U.EditorRow,{children:(0,G.jsx)(U.EditorFieldGroup,{children:(0,G.jsx)(Ue,{query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f,selectableEntryTypes:[ee.Resource],setResource:rr,resourceUri:null===(b=p.azureMonitor)||void 0===b?void 0:b.resourceUri})})}),r||(r=(0,G.jsx)(U.EditorRow,{children:(0,G.jsxs)(U.EditorFieldGroup,{children:[(0,G.jsx)(pr,{metricNamespaces:y,query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f}),(0,G.jsx)(lr,{metricNames:v,query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f})]})})),(0,G.jsx)(U.EditorRow,{children:(0,G.jsxs)(U.EditorFieldGroup,{children:[(0,G.jsx)(nr,{query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f,aggregationOptions:null!==(w=null==h?void 0:h.aggOptions)&&void 0!==w?w:[],isLoading:h.isLoading}),(0,G.jsx)(fr,{query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f,timeGrainOptions:null!==(N=null==h?void 0:h.timeGrains)&&void 0!==N?N:[]})]})}),(0,G.jsx)(U.EditorRow,{children:(0,G.jsx)(U.EditorFieldGroup,{children:(0,G.jsx)(cr,{data:l,query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f,dimensionOptions:null!==(M=null==h?void 0:h.dimensions)&&void 0!==M?M:[]})})}),t||(t=(0,G.jsx)(U.EditorRow,{children:(0,G.jsx)(U.EditorFieldGroup,{children:(0,G.jsx)(hr,{query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f})})})),s||(s=(0,G.jsx)(U.EditorRow,{children:(0,G.jsx)(U.EditorFieldGroup,{children:(0,G.jsx)(ur,{query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f})})}))]})}):(0,G.jsxs)("div",{"data-testid":"azure-monitor-metrics-query-editor-with-resource-picker",children:[(0,G.jsx)(a.InlineFieldRow,{children:(0,G.jsx)(Ue,{query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f,selectableEntryTypes:[ee.Resource],setResource:rr,resourceUri:null===(S=p.azureMonitor)||void 0===S?void 0:S.resourceUri})}),n||(n=(0,G.jsxs)(a.InlineFieldRow,{children:[(0,G.jsx)(pr,{metricNamespaces:y,query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f}),(0,G.jsx)(lr,{metricNames:v,query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f})]})),(0,G.jsxs)(a.InlineFieldRow,{children:[(0,G.jsx)(nr,{query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f,aggregationOptions:null!==(j=null==h?void 0:h.aggOptions)&&void 0!==j?j:[],isLoading:h.isLoading}),(0,G.jsx)(fr,{query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f,timeGrainOptions:null!==(x=null==h?void 0:h.timeGrains)&&void 0!==x?x:[]})]}),(0,G.jsx)(cr,{data:l,query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f,dimensionOptions:null!==(z=null==h?void 0:h.dimensions)&&void 0!==z?z:[]}),c||(c=(0,G.jsx)(hr,{query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f})),u||(u=(0,G.jsx)(ur,{query:p,datasource:d,variableOptionGroup:m,onQueryChange:g,setError:f}))]})},jr=e=>{let{query:r,onQueryChange:t}=e;const s=[{value:v.AzureMonitor,label:"Metrics"},{value:v.LogAnalytics,label:"Logs"},{value:v.AzureResourceGraph,label:"Azure Resource Graph"}],i=(0,o.useCallback)((e=>{e.value&&t(Object.assign({},r,{queryType:e.value}))}),[t,r]);return(0,G.jsx)("span",{"data-testid":"azure-monitor-experimental-header",children:(0,G.jsx)(U.EditorHeader,{children:(0,G.jsx)(U.InlineSelect,{label:"Service",value:r.queryType,placeholder:"Service...",allowCustomValue:!0,options:s,onChange:i})})})},xr=e=>{let{query:r,onQueryChange:t}=e;const s=[{value:v.AzureMonitor,label:"Metrics"},{value:v.LogAnalytics,label:"Logs"},{value:v.AzureResourceGraph,label:"Azure Resource Graph"}],i=(0,o.useCallback)((e=>{e.value&&t(Object.assign({},r,{queryType:e.value}))}),[t,r]);return(0,G.jsx)(W,{label:"Service",children:(0,G.jsx)(a.Select,{inputId:"azure-monitor-query-type-field",value:r.queryType,options:s,onChange:i,width:38})})};var zr=t("./.yarn/cache/fast-deep-equal-npm-3.1.3-790edcfcf5-e21a9d8d84.zip/node_modules/fast-deep-equal/index.js"),kr=t.n(zr);class Tr{static buildResourceUri(e,r,t,s){const o=t.split("/"),i=s.split("/"),a=["/subscriptions",e,"resourceGroups",r,"providers",o.shift()];for(const e in o)a.push(o[e]),a.push(i[e]);return a.join("/")}static buildAzureMonitorGetMetricNamespacesUrl(e,r,t){let s;if("resourceUri"in t)s=t.resourceUri;else{const{subscription:e,resourceGroup:r,metricDefinition:o,resourceName:i}=t;s=Tr.buildResourceUri(e,r,o,i)}return`${e}${s}/providers/microsoft.insights/metricNamespaces?api-version=${r}`}static buildAzureMonitorGetMetricNamesUrl(e,r,t){let s;const{metricNamespace:o}=t;if("resourceUri"in t)s=t.resourceUri;else{const{subscription:e,resourceGroup:r,metricDefinition:o,resourceName:i}=t;s=Tr.buildResourceUri(e,r,o,i)}return`${e}${s}/providers/microsoft.insights/metricdefinitions?api-version=${r}&metricnamespace=${encodeURIComponent(o)}`}}const Lr="select";function Ar(e){let r=e;return r=function(e){var r;let t=e;if(null!==(r=t.azureMonitor)&&void 0!==r&&r.timeGrainUnit&&"auto"!==t.azureMonitor.timeGrain){var s,o;t=or(t,u.createISO8601Duration(null!==(s=t.azureMonitor.timeGrain)&&void 0!==s?s:"auto",t.azureMonitor.timeGrainUnit)),null===(o=t.azureMonitor)||void 0===o||delete o.timeGrainUnit}return t}(r),r=function(e){var r,t,s,o;let i=e;null!==(r=i.azureLogAnalytics)&&void 0!==r&&null!==(t=r.query)&&void 0!==t&&t.match(/\$__from\s/gi)&&(i=Xe(i,i.azureLogAnalytics.query.replace(/\$__from\s/gi,"$__timeFrom() ")));null!==(s=i.azureLogAnalytics)&&void 0!==s&&null!==(o=s.query)&&void 0!==o&&o.match(/\$__to\s/gi)&&(i=Xe(i,i.azureLogAnalytics.query.replace(/\$__to\s/gi,"$__timeTo() ")));return i}(r),r=function(e){var r,t;if((!(null===(r=e.azureMonitor)||void 0===r?void 0:r.metricNamespace)||e.azureMonitor.metricNamespace===Lr)&&null!==(t=e.azureMonitor)&&void 0!==t&&t.metricDefinition)return Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{metricNamespace:e.azureMonitor.metricDefinition})});return e}(r),r=Cr(r),r=Ir(r),r=Gr(r),r}function Cr(e){var r;let t=e;const s=null===(r=t.azureMonitor)||void 0===r?void 0:r.dimension;var o;s&&"None"!==s&&(t=ar(t,s,"eq",[(null===(o=t.azureMonitor)||void 0===o?void 0:o.dimensionFilter)||""]));return t}function Ir(e){const r=e.azureMonitor;if(!r||r.resourceUri)return e;const{subscription:t}=e,{resourceGroup:s,metricDefinition:o,resourceName:i}=r;if(!(t&&s&&o&&i))return e;const a=Tr.buildResourceUri(t,s,o,i);return Object.assign({},e,{azureMonitor:Object.assign({},r,{resourceUri:a})})}function Gr(e){const r=e.azureMonitor;if(!r)return e;const t=[],s=r.dimensionFilters;return s&&s.length>0&&(s.forEach((e=>{const r={dimension:e.dimension,operator:e.operator};if(!e.filters&&e.filter)t.push(Object.assign({},r,{filters:[e.filter]}));else{let s=!1;if(e.filters&&e.filter){for(const r of e.filters)if(e.filter===r){s=!0;break}s||"*"===e.filter||e.filters.push(e.filter),t.push(Object.assign({},r,{filters:e.filters}))}}})),t.length>0)?Object.assign({},e,{azureMonitor:Object.assign({},r,{dimensionFilters:t})}):e}function Dr(e){let r=e;return r.queryType||(r=Object.assign({},r,{queryType:v.AzureMonitor})),r.queryType===v.AzureMonitor&&r.azureMonitor&&(r=Cr(r),r=Ir(r),r=Gr(r)),r}const Or={queryType:v.AzureMonitor},Rr=(e,r)=>{const t=(0,o.useMemo)((()=>(e=>{const r=Ar((0,n.defaults)({},e,Or));return kr()(r,e)?e:r})(e)),[e]);return(0,o.useEffect)((()=>{t!==e&&r(t)}),[t,e,r]),t};var qr,Er;const Pr=e=>{let{data:r,subscriptionId:t,query:s,datasource:o,variableOptionGroup:n,onChange:c,setError:u}=e;switch(s.queryType){case v.AzureMonitor:return i.config.featureToggles.azureMonitorResourcePickerForMetrics?(0,G.jsx)(Sr,{data:r,query:s,datasource:o,onChange:c,variableOptionGroup:n,setError:u}):(0,G.jsx)(wr,{data:r,subscriptionId:t,query:s,datasource:o,onChange:c,variableOptionGroup:n,setError:u});case v.LogAnalytics:return(0,G.jsx)(er,{subscriptionId:t,query:s,datasource:o,onChange:c,variableOptionGroup:n,setError:u});case v.AzureResourceGraph:return(0,G.jsx)(H,{subscriptionId:t,query:s,datasource:o,onChange:c,variableOptionGroup:n,setError:u});default:const e=s.queryType;return(0,G.jsx)(a.Alert,{title:"Unknown query type",children:("Application Insights"===e||"Insights Analytics"===e)&&(0,G.jsxs)(G.Fragment,{children:[e," was deprecated in Grafana 9. See the"," ",Er||(Er=(0,G.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/datasources/azuremonitor/deprecated-application-insights/",target:"_blank",rel:"noreferrer",children:"deprecation notice"}))," ","to get more information about how to migrate your queries. This is the current query definition:",(0,G.jsx)(a.CodeEditor,{height:"200px",readOnly:!0,language:"json",value:JSON.stringify(s,null,4)})]})})}return null},Fr=e=>{let{query:r,datasource:t,onChange:s,onRunQuery:c,data:u}=e;const[l,p]=V(),d=(0,o.useMemo)((()=>(0,n.debounce)(c,500)),[c]),m=(0,o.useCallback)((e=>{s(e),d()}),[s,d]),g=Rr(r,m),f=g.subscription||t.azureMonitorDatasource.defaultSubscriptionId,h={label:"Template Variables",options:t.getVariables().map((e=>({label:e,value:e})))};return(0,G.jsxs)("div",{"data-testid":"azure-monitor-query-editor",children:[i.config.featureToggles.azureMonitorExperimentalUI&&(0,G.jsx)(jr,{query:g,onQueryChange:m}),!i.config.featureToggles.azureMonitorExperimentalUI&&(0,G.jsx)(xr,{query:g,onQueryChange:m}),(0,G.jsx)(Pr,{data:u,subscriptionId:f,query:g,datasource:t,onChange:m,variableOptionGroup:h,setError:p}),l&&(0,G.jsxs)(G.Fragment,{children:[qr||(qr=(0,G.jsx)(Z,{v:2})),(0,G.jsx)(a.Alert,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor",children:l})]})]})};var Qr=t("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/observable/forkJoin.js"),$r=t("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/observable/of.js"),Vr=t("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/map.js"),Ur=t("./public/app/features/templating/template_srv.ts"),Wr=t("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/observable/from.js"),Xr=t("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js");class Br{constructor(e,r,t){this.rawQueryString=e,this.options=r,this.defaultTimeField=t,this.rawQueryString=e,this.options=r,this.defaultTimeField=t}generate(){let e=this.rawQueryString;const r=/\$__([_a-zA-Z0-9]+)\(([^()]*)\)/gi;e=e.replace(r,((e,r,t)=>"contains"===r?this.getMultiContains(t):e)),e=e.replace(/\$__escapeMulti\(('[^]*')\)/gi,((e,r)=>this.escape(r))),this.options&&(e=e.replace(r,((e,r,t)=>"timeFilter"===r?this.getTimeFilter(t,this.options):"timeFrom"===r?this.getFrom(this.options):"timeTo"===r?this.getUntil(this.options):e)),e=e.replace(/\$__interval/gi,this.options.interval));const t=e;e=encodeURIComponent(e);return{uriString:`query=${e}`,rawQuery:t}}getFrom(e){const r=e.range.from;return`datetime(${(0,s.dateTime)(r).startOf("minute").toISOString()})`}getUntil(e){var r;if("now"===(null===(r=e.rangeRaw)||void 0===r?void 0:r.to)){const e=Date.now();return`datetime(${(0,s.dateTime)(e).startOf("minute").toISOString()})`}{const r=e.range.to;return`datetime(${(0,s.dateTime)(r).startOf("minute").toISOString()})`}}getTimeFilter(e,r){var t;const s=e||this.defaultTimeField;return"now"===(null===(t=r.rangeRaw)||void 0===t?void 0:t.to)?`${s} >= ${this.getFrom(r)}`:`${s}  >= ${this.getFrom(r)} and ${s} <= ${this.getUntil(r)}`}getMultiContains(e){const r=e.indexOf(","),t=e.substring(0,r),s=e.substring(e.indexOf(",")+1);return s&&"all"===s.toLowerCase().trim()?"1 == 1":`${t.trim()} in (${s.trim()})`}escape(e){return e.substring(1,e.length-1).split("','").map((e=>`@'${e}'`)).join(", ")}}class _r{constructor(e){this.results=e,this.results=e}parseQueryResult(){let e=[],r=[];for(let t=0;t<this.results.length;t++){if(0===this.results[t].result.tables.length)continue;r=this.results[t].result.tables[0].columns;const s=this.results[t].result.tables[0].rows;e="time_series"===this.results[t].query.resultFormat?(0,n.concat)(e,this.parseTimeSeriesResult(this.results[t].query,r,s)):(0,n.concat)(e,this.parseTableResult(this.results[t].query,r,s))}return e}parseTimeSeriesResult(e,r,t){const s=[];let o=-1,i=-1,a=-1;for(let e=0;e<r.length;e++)-1===o&&"datetime"===r[e].type&&(o=e),-1===i&&"string"===r[e].type&&(i=e),-1===a&&["int","long","real","double"].indexOf(r[e].type)>-1&&(a=e);if(-1===o)throw new Error("No datetime column found in the result. The Time Series format requires a time column.");return(0,n.forEach)(t,(t=>{const n=_r.dateTimeToEpoch(t[o]),c=i>-1?t[i]:r[a].name,u=_r.findOrCreateBucket(s,c);u.datapoints.push([t[a],n]),u.refId=e.refId,u.meta={executedQueryString:e.query}})),s}parseTableResult(e,r,t){return{type:"table",columns:(0,n.map)(r,(e=>({text:e.name,type:e.type}))),rows:t,refId:e.refId,meta:{executedQueryString:e.query}}}parseToVariables(){const e=this.parseQueryResult(),r=[];return(0,n.forEach)(e,(e=>{(0,n.forEach)((0,n.flattenDeep)(e.rows),(e=>{r.push({text:e,value:e})}))})),r}transformToAnnotations(e){const r=this.parseQueryResult(),t=[];return(0,n.forEach)(r,(r=>{let s=-1,o=-1,i=-1;for(let e=0;e<r.columns.length;e++)-1===s&&"datetime"===r.columns[e].type&&(s=e),-1===o&&"text"===r.columns[e].text.toLowerCase()&&(o=e),-1===i&&"tags"===r.columns[e].text.toLowerCase()&&(i=e);(0,n.forEach)(r.rows,(r=>{t.push({annotation:e.annotation,time:Math.floor(_r.dateTimeToEpoch(r[s])),text:r[o]?r[o].toString():"",tags:r[i]?r[i].trim().split(/\s*,\s*/):[]})}))})),t}static findOrCreateBucket(e,r){let t=(0,n.find)(e,["target",r]);return t||(t={target:r,datapoints:[],refId:"",query:""},e.push(t)),t}static dateTimeToEpoch(e){return(0,s.dateTime)(e).valueOf()}static parseSubscriptions(e){const r=[];if(!e)return r;const t="subscriptionId";for(let s=0;s<e.value.length;s++)(0,n.find)(r,["value",(0,n.get)(e.value[s],t)])||r.push({text:`${(0,n.get)(e.value[s],"displayName")}`,value:(0,n.get)(e.value[s],t)});return r}}const Hr=/([\w\W]+):([\w]+)(?:\s?=\s?([\w\W]+))?/;function Kr(e){return e.functions?e.functions.map((e=>{const r=e.parameters&&e.parameters.split(", ").map((e=>{const r=e.match(Hr);if(!r)return;const[,t,s,o]=r;return{name:t,type:s,defaultValue:o,cslDefaultValue:o}})).filter((e=>!!e));return{name:e.name,body:e.body,inputParameters:r||[]}})):[]}function Jr(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class Zr extends i.DataSourceWithBackend{constructor(e){super(e),this.instanceSettings=e,Jr(this,"resourcePath",void 0),Jr(this,"azurePortalUrl",void 0),Jr(this,"defaultSubscriptionId",void 0),Jr(this,"azureMonitorPath",void 0),Jr(this,"firstWorkspace",void 0),Jr(this,"cache",void 0),this.instanceSettings=e,this.cache=new Map,this.resourcePath=`${f}`,this.azureMonitorPath=`${g}/subscriptions`;const r=j(e);this.azurePortalUrl=S(r),this.defaultSubscriptionId=this.instanceSettings.jsonData.subscriptionId||""}isConfigured(){return!this.validateDatasource()}filterQuery(e){var r;return!(!0===e.hide||null===(r=e.azureLogAnalytics)||void 0===r||!r.query||!e.azureLogAnalytics.resource&&!e.azureLogAnalytics.workspace)}async getSubscriptions(){if(!this.isConfigured())return[];const e=`${this.azureMonitorPath}?api-version=2019-03-01`;return await this.getResource(e).then((e=>_r.parseSubscriptions(e)))}async getWorkspaces(e){const r=await this.getWorkspaceList(e);return(0,n.map)(r.value,(e=>({text:e.name,value:e.id})))||[]}getWorkspaceList(e){const r=(0,i.getTemplateSrv)().replace(e||this.defaultSubscriptionId),t=this.azureMonitorPath+`/${r}/providers/Microsoft.OperationalInsights/workspaces?api-version=2017-04-26-preview`;return this.getResource(t)}async getMetadata(e){const r=`${this.resourcePath}/v1${e}/metadata`;return await this.getResource(r)}async getKustoSchema(e){const r=(0,i.getTemplateSrv)(),t=r.replace(e,{},y);return function(e,r,t){const s={name:r,tables:e.tables,functions:Kr(e),majorVersion:0,minorVersion:0};return s.functions.push({name:"$__timeFilter",body:"{ true }",inputParameters:[{name:"timeColumn",type:"System.String",defaultValue:'""',cslDefaultValue:'""'}]},{name:"$__timeFrom",body:"{ datetime(2018-06-05T18:09:58.907Z) }",inputParameters:[]},{name:"$__timeTo",body:"{ datetime(2018-06-05T20:09:58.907Z) }",inputParameters:[]},{name:"$__escapeMulti",body:"{ @'\\grafana-vmNetwork(eth0)Total', @'\\hello!'}",inputParameters:[{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]},{name:"$__contains",body:"{ colName in ('value1','value2') }",inputParameters:[{name:"colName",type:"System.String",defaultValue:"colName",cslDefaultValue:"colName"},{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]}),{clusterType:"Engine",cluster:{connectionString:r,databases:[s]},database:s,globalParameters:t.map((e=>({name:`$${e.name}`,type:"dynamic"})))}}(await this.getMetadata(t),t,r.getVariables())}applyTemplateVariables(e,r){const t=e.azureLogAnalytics;if(!t)return e;const s=(0,i.getTemplateSrv)(),o=s.replace(t.resource,r);let a=s.replace(t.workspace,r);a||o||!this.firstWorkspace||(a=this.firstWorkspace);const n=s.replace(t.query,r,y);return{refId:e.refId,queryType:v.LogAnalytics,azureLogAnalytics:{resultFormat:t.resultFormat,query:n,resource:o,workspace:a}}}query(e){return super.query(e).pipe((0,Xr.z)((e=>(0,Wr.D)(this.processResponse(e)))))}async processResponse(e){if(e.data)for(const s of e.data){var r,t;const e=null===(r=s.meta)||void 0===r||null===(t=r.custom)||void 0===t?void 0:t.encodedQuery;if(e&&e.length>0){const e=await this.buildDeepLink(s.meta.custom);if(null!=e&&e.length)for(const r of s.fields)r.config.links=[{url:e,title:"View in Azure Portal",targetBlank:!0}]}}return e}async buildDeepLink(e){const r=encodeURIComponent(e.encodedQuery),t=e.workspace,s=e.subscription,o=await this.getWorkspaceDetails(t);if(!o.workspace||!o.resourceGroup)return"";return`${this.azurePortalUrl}/#blade/Microsoft_OperationsManagementSuite_Workspace/AnalyticsBlade/initiator/AnalyticsShareLinkToQuery/isQueryEditorVisible/true/scope/%7B%22resources%22%3A%5B%7B%22resourceId%22%3A%22%2Fsubscriptions%2F${s}%2Fresourcegroups%2F${o.resourceGroup}%2Fproviders%2Fmicrosoft.operationalinsights%2Fworkspaces%2F${o.workspace}%22%7D%5D%7D/query/${r}/isQueryBase64Compressed/true/timespanInIsoFormat/P1D`}async getWorkspaceDetails(e){if(!this.defaultSubscriptionId)return{};const r=(await this.getWorkspaceList(this.defaultSubscriptionId)).value.find((r=>r.properties.customerId===e));if(!r)return{};const t=/.*resourcegroups\/(.*)\/providers.*/.exec(r.id);return!t||t.length<2?{}:{workspace:r.name,resourceGroup:t[1]}}getDeprecatedDefaultWorkSpace(){return this.instanceSettings.jsonData.logAnalyticsDefaultWorkspace}buildQuery(e,r,t){const s=new Br((0,i.getTemplateSrv)().replace(e,{},y),r,"TimeGenerated").generate().uriString,o=fe(t)?`${this.resourcePath}/v1/workspaces/${t}/query?${s}`:`${this.resourcePath}/v1${t}/query?${s}`;return[{datasource:this.getRef(),path:o,resultFormat:"table"}]}async getDefaultOrFirstSubscription(){var e;if(this.defaultSubscriptionId)return this.defaultSubscriptionId;return null===(e=(await this.getSubscriptions())[0])||void 0===e?void 0:e.value}async getFirstWorkspace(){var e;if(this.firstWorkspace)return this.firstWorkspace;const r=await this.getDefaultOrFirstSubscription();if(!r)return;const t=null===(e=(await this.getWorkspaces(r))[0])||void 0===e?void 0:e.value;return t&&(this.firstWorkspace=t),t}annotationQuery(e){if(!e.annotation.rawQuery)return Promise.reject({message:"Query missing in annotation definition"});const r=this.buildQuery(e.annotation.rawQuery,e,e.annotation.workspace),t=this.doQueries(r);return Promise.all(t).then((r=>new _r(r).transformToAnnotations(e)))}doQueries(e){return(0,n.map)(e,(e=>this.getResource(e.path).then((r=>({result:r,query:e}))).catch((r=>{throw{error:r,query:e}}))))}async testDatasource(){const e=this.validateDatasource();if(e)return e;let r;try{const e=await this.getFirstWorkspace();if(!e)return{status:"error",message:"Workspace not found."};r=e}catch(e){let r="Azure Log Analytics requires access to Azure Monitor but had the following error: ";return{status:"error",message:this.getErrorMessage(r,e)}}try{const e=fe(r)?`${this.resourcePath}/v1/workspaces/${r}/metadata`:`${this.resourcePath}/v1${r}/metadata`;return await this.getResource(e).then((e=>({status:"success",message:"Successfully queried the Azure Log Analytics service.",title:"Success"})))}catch(e){let r="Azure Log Analytics: ";return{status:"error",message:this.getErrorMessage(r,e)}}}getErrorMessage(e,r){return e+=r.statusText?r.statusText+": ":"",r.data&&r.data.error&&r.data.error.code?e+=r.data.error.code+". "+r.data.error.message:r.data&&r.data.error?e+=r.data.error:r.data?e+=r.data:e+="Cannot connect to Azure Log Analytics REST API.",e}validateDatasource(){if("clientsecret"===N(this.instanceSettings)){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(e){return"string"==typeof e&&e.length>0}}var Yr=t("./public/app/features/dashboard/services/TimeSrv.ts");const et=[{location:"eastus",displayName:"East US",supportsLogs:!0},{location:"eastus2",displayName:"East US 2",supportsLogs:!0},{location:"southcentralus",displayName:"South Central US",supportsLogs:!0},{location:"westus2",displayName:"West US 2",supportsLogs:!0},{location:"westus3",displayName:"West US 3",supportsLogs:!0},{location:"australiaeast",displayName:"Australia East",supportsLogs:!0},{location:"southeastasia",displayName:"Southeast Asia",supportsLogs:!0},{location:"northeurope",displayName:"North Europe",supportsLogs:!0},{location:"uksouth",displayName:"UK South",supportsLogs:!0},{location:"westeurope",displayName:"West Europe",supportsLogs:!0},{location:"centralus",displayName:"Central US",supportsLogs:!0},{location:"northcentralus",displayName:"North Central US",supportsLogs:!0},{location:"westus",displayName:"West US",supportsLogs:!0},{location:"southafricanorth",displayName:"South Africa North",supportsLogs:!0},{location:"centralindia",displayName:"Central India",supportsLogs:!0},{location:"eastasia",displayName:"East Asia",supportsLogs:!0},{location:"japaneast",displayName:"Japan East",supportsLogs:!0},{location:"jioindiawest",displayName:"Jio India West",supportsLogs:!0},{location:"koreacentral",displayName:"Korea Central",supportsLogs:!0},{location:"canadacentral",displayName:"Canada Central",supportsLogs:!0},{location:"francecentral",displayName:"France Central",supportsLogs:!0},{location:"germanywestcentral",displayName:"Germany West Central",supportsLogs:!0},{location:"norwayeast",displayName:"Norway East",supportsLogs:!0},{location:"switzerlandnorth",displayName:"Switzerland North",supportsLogs:!0},{location:"uaenorth",displayName:"UAE North",supportsLogs:!0},{location:"brazilsouth",displayName:"Brazil South",supportsLogs:!0},{location:"centralusstage",displayName:"Central US (Stage)",supportsLogs:!0},{location:"eastusstage",displayName:"East US (Stage)",supportsLogs:!0},{location:"eastus2stage",displayName:"East US 2 (Stage)",supportsLogs:!0},{location:"northcentralusstage",displayName:"North Central US (Stage)",supportsLogs:!0},{location:"southcentralusstage",displayName:"South Central US (Stage)",supportsLogs:!0},{location:"westusstage",displayName:"West US (Stage)",supportsLogs:!0},{location:"westus2stage",displayName:"West US 2 (Stage)",supportsLogs:!0},{location:"asia",displayName:"Asia",supportsLogs:!0},{location:"asiapacific",displayName:"Asia Pacific",supportsLogs:!0},{location:"australia",displayName:"Australia",supportsLogs:!0},{location:"brazil",displayName:"Brazil",supportsLogs:!0},{location:"canada",displayName:"Canada",supportsLogs:!0},{location:"europe",displayName:"Europe",supportsLogs:!0},{location:"global",displayName:"Global",supportsLogs:!0},{location:"india",displayName:"India",supportsLogs:!0},{location:"japan",displayName:"Japan",supportsLogs:!0},{location:"uk",displayName:"United Kingdom",supportsLogs:!0},{location:"unitedstates",displayName:"United States",supportsLogs:!0},{location:"eastasiastage",displayName:"East Asia (Stage)",supportsLogs:!0},{location:"southeastasiastage",displayName:"Southeast Asia (Stage)",supportsLogs:!0},{location:"westcentralus",displayName:"West Central US",supportsLogs:!0},{location:"southafricawest",displayName:"South Africa West",supportsLogs:!0},{location:"australiacentral",displayName:"Australia Central",supportsLogs:!0},{location:"australiacentral2",displayName:"Australia Central 2",supportsLogs:!0},{location:"australiasoutheast",displayName:"Australia Southeast",supportsLogs:!0},{location:"japanwest",displayName:"Japan West",supportsLogs:!0},{location:"koreasouth",displayName:"Korea South",supportsLogs:!0},{location:"southindia",displayName:"South India",supportsLogs:!0},{location:"westindia",displayName:"West India",supportsLogs:!0},{location:"canadaeast",displayName:"Canada East",supportsLogs:!0},{location:"francesouth",displayName:"France South",supportsLogs:!0},{location:"germanynorth",displayName:"Germany North",supportsLogs:!0},{location:"norwaywest",displayName:"Norway West",supportsLogs:!0},{location:"switzerlandwest",displayName:"Switzerland West",supportsLogs:!0},{location:"ukwest",displayName:"UK West",supportsLogs:!0},{location:"uaecentral",displayName:"UAE Central",supportsLogs:!0},{location:"brazilsoutheast",displayName:"Brazil Southeast",supportsLogs:!0},{location:"chinaeast",displayName:"China Eest",supportsLogs:!0},{location:"chinaeast2",displayName:"China Eest 2",supportsLogs:!0},{location:"chinanorth",displayName:"China North",supportsLogs:!0},{location:"chinanorth2",displayName:"China North 2",supportsLogs:!0},{location:"chinanorth3",displayName:"China North 3",supportsLogs:!0}],rt=et.filter((e=>e.supportsLogs)).map((e=>`"${e.location}"`)).join(","),tt=et.reduce(((e,r)=>Object.assign({},e,{[r.location]:r.displayName})),{}),st=[{resourceType:"microsoft.analysisservices/servers",displayName:"Analysis Services",supportsLogs:!0},{resourceType:"microsoft.synapse/workspaces/bigdatapools",displayName:"Apache Spark pool",supportsLogs:!0},{resourceType:"microsoft.apimanagement/service",displayName:"API Management service",supportsLogs:!0},{resourceType:"microsoft.appconfiguration/configurationstores",displayName:"App Configuration",supportsLogs:!0},{resourceType:"microsoft.web/sites/slots",displayName:"App Service (Slot)",supportsLogs:!0},{resourceType:"microsoft.web/hostingenvironments",displayName:"App Service Environment",supportsLogs:!0},{resourceType:"microsoft.web/serverfarms",displayName:"App Service plan",supportsLogs:!0},{resourceType:"microsoft.web/sites",displayName:"App Service",supportsLogs:!0},{resourceType:"microsoft.network/applicationgateways",displayName:"Application gateway",supportsLogs:!0},{resourceType:"microsoft.insights/components",displayName:"Application Insights",supportsLogs:!0},{resourceType:"microsoft.automation/automationaccounts",displayName:"Automation Account",supportsLogs:!0},{resourceType:"microsoft.insights/autoscalesettings",displayName:"Autoscale Settings",supportsLogs:!0},{resourceType:"microsoft.aadiam/azureadmetrics",displayName:"Azure AD Metrics",supportsLogs:!0},{resourceType:"microsoft.cache/redis",displayName:"Azure Cache for Redis",supportsLogs:!0},{resourceType:"microsoft.documentdb/databaseaccounts",displayName:"Azure Cosmos DB account",supportsLogs:!0},{resourceType:"microsoft.kusto/clusters",displayName:"Azure Data Explorer Cluster",supportsLogs:!0},{resourceType:"microsoft.dbformariadb/servers",displayName:"Azure Database for MariaDB server",supportsLogs:!0},{resourceType:"microsoft.dbformysql/servers",displayName:"Azure Database for MySQL server",supportsLogs:!0},{resourceType:"microsoft.dbforpostgresql/flexibleservers",displayName:"Azure Database for PostgreSQL flexible server",supportsLogs:!0},{resourceType:"microsoft.dbforpostgresql/servergroupsv2",displayName:"Azure Database for PostgreSQL server group",supportsLogs:!0},{resourceType:"microsoft.dbforpostgresql/servers",displayName:"Azure Database for PostgreSQL server",supportsLogs:!0},{resourceType:"microsoft.dbforpostgresql/serversv2",displayName:"Azure Database for PostgreSQL server v2",supportsLogs:!0},{resourceType:"microsoft.resources/subscriptions",displayName:"Subscription",supportsLogs:!0},{resourceType:"microsoft.appplatform/spring",displayName:"Azure Spring Cloud",supportsLogs:!0},{resourceType:"microsoft.databoxedge/databoxedgedevices",displayName:"Azure Stack Edge / Data Box Gateway",supportsLogs:!0},{resourceType:"microsoft.azurestackresourcemonitor/storageaccountmonitor",displayName:"Azure Stack Resource Monitor",supportsLogs:!0},{resourceType:"microsoft.synapse/workspaces",displayName:"Synapse workspace",supportsLogs:!0},{resourceType:"microsoft.network/bastionhosts",displayName:"Bastion",supportsLogs:!0},{resourceType:"microsoft.batch/batchaccounts",displayName:"Batch account",supportsLogs:!0},{resourceType:"microsoft.botservice/botservices",displayName:"Bot Service",supportsLogs:!0},{resourceType:"microsoft.netapp/netappaccounts/capacitypools",displayName:"Capacity pool",supportsLogs:!0},{resourceType:"microsoft.classiccompute/domainnames",displayName:"Cloud service (classic)",supportsLogs:!0},{resourceType:"microsoft.vmwarecloudsimple/virtualmachines",displayName:"CloudSimple Virtual Machine",supportsLogs:!0},{resourceType:"microsoft.cognitiveservices/accounts",displayName:"Cognitive Services",supportsLogs:!0},{resourceType:"microsoft.network/networkwatchers/connectionmonitors",displayName:"Connection Monitors",supportsLogs:!0},{resourceType:"microsoft.network/connections",displayName:"Connection",supportsLogs:!0},{resourceType:"microsoft.containerinstance/containergroups",displayName:"Container instances",supportsLogs:!0},{resourceType:"microsoft.containerregistry/registries",displayName:"Container registry",supportsLogs:!0},{resourceType:"microsoft.insights/qos",displayName:"Custom Metric Usage",supportsLogs:!0},{resourceType:"microsoft.customerinsights/hubs",displayName:"CustomerInsights",supportsLogs:!0},{resourceType:"microsoft.datafactory/datafactories",displayName:"Data factory",supportsLogs:!0},{resourceType:"microsoft.datafactory/factories",displayName:"Data factory (V2)",supportsLogs:!0},{resourceType:"microsoft.datalakeanalytics/accounts",displayName:"Data Lake Analytics",supportsLogs:!0},{resourceType:"microsoft.datalakestore/accounts",displayName:"Data Lake Storage Gen1",supportsLogs:!0},{resourceType:"microsoft.datashare/accounts",displayName:"Data Share",supportsLogs:!0},{resourceType:"microsoft.synapse/workspaces/sqlpools",displayName:"Dedicated SQL pool",supportsLogs:!0},{resourceType:"microsoft.devices/provisioningservices",displayName:"Device Provisioning Service",supportsLogs:!0},{resourceType:"microsoft.compute/disks",displayName:"Disk",supportsLogs:!0},{resourceType:"microsoft.network/dnszones",displayName:"DNS zone",supportsLogs:!0},{resourceType:"microsoft.eventgrid/domains",displayName:"Event Grid Domain",supportsLogs:!0},{resourceType:"microsoft.eventgrid/systemtopics",displayName:"Event Grid System Topic",supportsLogs:!0},{resourceType:"microsoft.eventgrid/topics",displayName:"Event Grid Topic",supportsLogs:!0},{resourceType:"microsoft.eventhub/clusters",displayName:"Event Hubs Cluster",supportsLogs:!0},{resourceType:"microsoft.eventhub/namespaces",displayName:"Event Hubs Namespace",supportsLogs:!0},{resourceType:"microsoft.network/expressroutecircuits",displayName:"ExpressRoute circuit",supportsLogs:!0},{resourceType:"microsoft.network/expressrouteports",displayName:"ExpressRoute Direct",supportsLogs:!0},{resourceType:"microsoft.network/expressroutegateways",displayName:"ExpressRoute Gateways",supportsLogs:!0},{resourceType:"microsoft.fabric.admin/fabriclocations",displayName:"Fabric Locations",supportsLogs:!0},{resourceType:"microsoft.network/azurefirewalls",displayName:"Firewall",supportsLogs:!0},{resourceType:"microsoft.network/frontdoors",displayName:"Front Door",supportsLogs:!0},{resourceType:"microsoft.hdinsight/clusters",displayName:"HDInsight cluster",supportsLogs:!0},{resourceType:"microsoft.storagecache/caches",displayName:"HPC cache",supportsLogs:!0},{resourceType:"microsoft.logic/integrationserviceenvironments",displayName:"Integration Service Environment",supportsLogs:!0},{resourceType:"microsoft.iotcentral/iotapps",displayName:"IoT Central Application",supportsLogs:!0},{resourceType:"microsoft.devices/iothubs",displayName:"IoT Hub",supportsLogs:!0},{resourceType:"microsoft.keyvault/vaults",displayName:"Key vault",supportsLogs:!0},{resourceType:"microsoft.kubernetes/connectedclusters",displayName:"Kubernetes - Azure Arc",supportsLogs:!0},{resourceType:"microsoft.containerservice/managedclusters",displayName:"Kubernetes service",supportsLogs:!0},{resourceType:"microsoft.media/mediaservices/liveevents",displayName:"Live event",supportsLogs:!0},{resourceType:"microsoft.network/loadbalancers",displayName:"Load balancer",supportsLogs:!0},{resourceType:"microsoft.operationalinsights/workspaces",displayName:"Log Analytics workspace",supportsLogs:!0},{resourceType:"microsoft.logic/workflows",displayName:"Logic app",supportsLogs:!0},{resourceType:"microsoft.machinelearningservices/workspaces",displayName:"Machine learning",supportsLogs:!0},{resourceType:"microsoft.media/mediaservices",displayName:"Media service",supportsLogs:!0},{resourceType:"microsoft.network/natgateways",displayName:"NAT gateway",supportsLogs:!0},{resourceType:"microsoft.network/networkinterfaces",displayName:"Network interface",supportsLogs:!0},{resourceType:"microsoft.network/networkvirtualappliances",displayName:"Network Virtual Appliances",supportsLogs:!0},{resourceType:"microsoft.network/networkwatchers",displayName:"Network Watcher",supportsLogs:!0},{resourceType:"microsoft.notificationhubs/namespaces/notificationhubs",displayName:"Notification Hub",supportsLogs:!0},{resourceType:"microsoft.network/p2svpngateways",displayName:"P2S VPN Gateways",supportsLogs:!0},{resourceType:"microsoft.peering/peeringservices",displayName:"Peering Service",supportsLogs:!0},{resourceType:"microsoft.powerbidedicated/capacities",displayName:"Power BI Embedded",supportsLogs:!0},{resourceType:"microsoft.network/privateendpoints",displayName:"Private endpoint",supportsLogs:!0},{resourceType:"microsoft.network/privatelinkservices",displayName:"Private link service",supportsLogs:!0},{resourceType:"microsoft.network/publicipaddresses",displayName:"Public IP address",supportsLogs:!0},{resourceType:"microsoft.cache/redisenterprise",displayName:"Redis Enterprise",supportsLogs:!0},{resourceType:"microsoft.relay/namespaces",displayName:"Relay",supportsLogs:!0},{resourceType:"microsoft.synapse/workspaces/scopepools",displayName:"Scope pool",supportsLogs:!0},{resourceType:"microsoft.search/searchservices",displayName:"Search service",supportsLogs:!0},{resourceType:"microsoft.servicebus/namespaces",displayName:"Service Bus Namespace",supportsLogs:!0},{resourceType:"microsoft.signalrservice/signalr",displayName:"SignalR",supportsLogs:!0},{resourceType:"microsoft.operationsmanagement/solutions",displayName:"Solution",supportsLogs:!0},{resourceType:"microsoft.sql/servers/databases",displayName:"SQL database",supportsLogs:!0},{resourceType:"microsoft.sql/servers/elasticpools",displayName:"SQL elastic pool",supportsLogs:!0},{resourceType:"microsoft.sql/managedinstances",displayName:"SQL managed instance",supportsLogs:!0},{resourceType:"microsoft.storage/storageaccounts",displayName:"Storage account",supportsLogs:!0},{resourceType:"microsoft.classicstorage/storageaccounts",displayName:"Storage account (classic)",supportsLogs:!0},{resourceType:"microsoft.storagesync/storagesyncservices",displayName:"Storage Sync Service",supportsLogs:!0},{resourceType:"microsoft.streamanalytics/streamingjobs",displayName:"Stream Analytics job",supportsLogs:!0},{resourceType:"microsoft.media/mediaservices/streamingendpoints",displayName:"Streaming Endpoint",supportsLogs:!0},{resourceType:"microsoft.timeseriesinsights/environments",displayName:"Time Series Insights environment",supportsLogs:!0},{resourceType:"microsoft.network/trafficmanagerprofiles",displayName:"Traffic Manager profile",supportsLogs:!0},{resourceType:"microsoft.compute/virtualmachinescalesets",displayName:"Virtual machine scale set",supportsLogs:!0},{resourceType:"microsoft.compute/virtualmachines",displayName:"Virtual machine",supportsLogs:!0},{resourceType:"microsoft.classiccompute/virtualmachines",displayName:"Virtual machine (classic)",supportsLogs:!0},{resourceType:"microsoft.network/virtualnetworkgateways",displayName:"Virtual network gateway",supportsLogs:!0},{resourceType:"microsoft.netapp/netappaccounts/capacitypools/volumes",displayName:"Volume",supportsLogs:!0},{resourceType:"microsoft.network/vpngateways",displayName:"VPN Gateways",supportsLogs:!0},{resourceType:"microsoft.cdn/cdnwebapplicationfirewallpolicies",displayName:"Content Delivery Network WAF policy",supportsLogs:!0},{resourceType:"microsoft.web/hostingenvironments/workerpools",displayName:"WorkerPools",supportsLogs:!0},{resourceType:"microsoft.resources/subscriptions/resourcegroups",displayName:"Resource Group",supportsLogs:!0}],ot=st.filter((e=>e.supportsLogs)).map((e=>`"${e.resourceType}"`)).join(","),it=st.reduce(((e,r)=>Object.assign({},e,{[r.resourceType]:r.displayName})),{});class at{constructor(e){var r,t,s;this.cloudName=e,s={azuremonitor:["Microsoft.AnalysisServices/servers","Microsoft.ApiManagement/service","Microsoft.AppConfiguration/configurationStores","Microsoft.Automation/automationAccounts","Microsoft.Batch/batchAccounts","Microsoft.Cache/redis","Microsoft.Cdn/cdnwebapplicationfirewallpolicies","Microsoft.Cdn/profiles","Microsoft.ClassicCompute/virtualMachines","Microsoft.ClassicCompute/domainNames","Microsoft.CognitiveServices/accounts","Microsoft.Compute/virtualMachines","Microsoft.Compute/virtualMachineScaleSets","Microsoft.ContainerInstance/containerGroups","Microsoft.ContainerRegistry/registries","Microsoft.ContainerService/managedClusters","Microsoft.CustomerInsights/hubs","Microsoft.DataBoxEdge/dataBoxEdgeDevices","Microsoft.DataFactory/datafactories","Microsoft.DataFactory/factories","Microsoft.DataLakeAnalytics/accounts","Microsoft.DataLakeStore/accounts","Microsoft.DBforMariaDB/servers","Microsoft.DBforMySQL/servers","Microsoft.DBforMySQL/flexibleServers","Microsoft.DBforPostgreSQL/servers","Microsoft.DBforPostgreSQL/serversv2","Microsoft.DBforPostgreSQL/serverGroups","Microsoft.DBforPostgreSQL/serverGroupsv2","Microsoft.DBforPostgreSQL/flexibleServers","Microsoft.Devices/IotHubs","Microsoft.Devices/provisioningServices","Microsoft.DocumentDB/databaseAccounts","Microsoft.EventGrid/topics","Microsoft.EventGrid/eventSubscriptions","Microsoft.EventGrid/extensionTopics","Microsoft.EventHub/namespaces","Microsoft.EventHub/clusters","Microsoft.HDInsight/clusters","Microsoft.Insights/AutoscaleSettings","Microsoft.Insights/components","Microsoft.KeyVault/vaults","Microsoft.Kusto/clusters","Microsoft.LocationBasedServices/accounts","Microsoft.Logic/workflows","Microsoft.Logic/integrationServiceEnvironments","Microsoft.NetApp/netAppAccounts/capacityPools","Microsoft.NetApp/netAppAccounts/capacityPools/volumes","Microsoft.Network/networkInterfaces","Microsoft.Network/loadBalancers","Microsoft.Network/dnsZones","Microsoft.Network/publicIPAddresses","Microsoft.Network/azureFirewalls","Microsoft.Network/applicationGateways","Microsoft.Network/virtualNetworkGateways","Microsoft.Network/expressRouteCircuits","Microsoft.Network/expressRouteCircuits/Peerings","Microsoft.Network/connections","Microsoft.Network/trafficManagerProfiles","Microsoft.Network/networkWatchers/connectionMonitors","Microsoft.Network/frontdoors","Microsoft.Network/natGateways","Microsoft.Network/vpngateways","Microsoft.Network/virtualNetworkGateways","Microsoft.NotificationHubs/namespaces/notificationHubs","Microsoft.OperationalInsights/workspaces","Microsoft.PowerBIDedicated/capacities","Microsoft.Relay/namespaces","Microsoft.Search/searchServices","Microsoft.ServiceBus/namespaces","Microsoft.SignalRService/SignalR","Microsoft.Sql/servers/databases","Microsoft.Sql/servers/elasticPools","Microsoft.Sql/managedInstances","Microsoft.Storage/storageAccounts","Microsoft.Storage/storageAccounts/blobServices","Microsoft.Storage/storageAccounts/fileServices","Microsoft.Storage/storageAccounts/queueServices","Microsoft.Storage/storageAccounts/tableServices","Microsoft.StorageSync/storageSyncServices","Microsoft.StorageSync/storageSyncServices/syncGroups","Microsoft.StorageSync/storageSyncServices/syncGroups/serverEndpoints","Microsoft.StorageSync/storageSyncServices/registeredServers","Microsoft.StreamAnalytics/streamingJobs","Microsoft.Web/serverfarms","Microsoft.Web/sites","Microsoft.Web/sites/slots","Microsoft.Web/hostingEnvironments/multiRolePools","Microsoft.Web/hostingEnvironments/workerPools"],govazuremonitor:["Microsoft.AnalysisServices/servers","Microsoft.ApiManagement/service","Microsoft.Batch/batchAccounts","Microsoft.Cache/redis","Microsoft.Cdn/cdnwebapplicationfirewallpolicies","Microsoft.Cdn/profiles","Microsoft.ClassicCompute/virtualMachines","Microsoft.ClassicCompute/domainNames","Microsoft.CognitiveServices/accounts","Microsoft.Compute/virtualMachines","Microsoft.Compute/virtualMachineScaleSets","Microsoft.ContainerRegistry/registries","Microsoft.DBforMySQL/servers","Microsoft.DBforPostgreSQL/servers","Microsoft.DBforPostgreSQL/serversv2","Microsoft.Devices/IotHubs","Microsoft.Devices/provisioningServices","Microsoft.EventGrid/topics","Microsoft.EventGrid/eventSubscriptions","Microsoft.EventGrid/extensionTopics","Microsoft.EventHub/namespaces","Microsoft.EventHub/clusters","Microsoft.Insights/AutoscaleSettings","Microsoft.Insights/components","Microsoft.KeyVault/vaults","Microsoft.Logic/workflows","Microsoft.Network/networkInterfaces","Microsoft.Network/loadBalancers","Microsoft.Network/dnsZones","Microsoft.Network/publicIPAddresses","Microsoft.Network/azureFirewalls","Microsoft.Network/applicationGateways","Microsoft.Network/virtualNetworkGateways","Microsoft.Network/expressRouteCircuits","Microsoft.Network/expressRouteCircuits/Peerings","Microsoft.Network/connections","Microsoft.Network/trafficManagerProfiles","Microsoft.Network/networkWatchers/connectionMonitors","Microsoft.Network/frontdoors","Microsoft.NotificationHubs/namespaces/notificationHubs","Microsoft.OperationalInsights/workspaces","Microsoft.PowerBIDedicated/capacities","Microsoft.Relay/namespaces","Microsoft.ServiceBus/namespaces","Microsoft.Sql/servers/databases","Microsoft.Sql/servers/elasticPools","Microsoft.Sql/managedInstances","Microsoft.Storage/storageAccounts","Microsoft.Storage/storageAccounts/blobServices","Microsoft.Storage/storageAccounts/fileServices","Microsoft.Storage/storageAccounts/queueServices","Microsoft.Storage/storageAccounts/tableServices","Microsoft.Web/serverfarms","Microsoft.Web/sites","Microsoft.Web/sites/slots","Microsoft.Web/hostingEnvironments/multiRolePools","Microsoft.Web/hostingEnvironments/workerPools"],germanyazuremonitor:["Microsoft.AnalysisServices/servers","Microsoft.Batch/batchAccounts","Microsoft.Cache/redis","Microsoft.Cdn/cdnwebapplicationfirewallpolicies","Microsoft.Cdn/profiles","Microsoft.ClassicCompute/virtualMachines","Microsoft.ClassicCompute/domainNames","Microsoft.Compute/virtualMachines","Microsoft.Compute/virtualMachineScaleSets","Microsoft.DBforMySQL/servers","Microsoft.DBforPostgreSQL/servers","Microsoft.DBforPostgreSQL/serversv2","Microsoft.Devices/IotHubs","Microsoft.Devices/provisioningServices","Microsoft.EventHub/namespaces","Microsoft.EventHub/clusters","Microsoft.Insights/AutoscaleSettings","Microsoft.Insights/components","Microsoft.KeyVault/vaults","Microsoft.Network/networkInterfaces","Microsoft.Network/loadBalancers","Microsoft.Network/dnsZones","Microsoft.Network/publicIPAddresses","Microsoft.Network/azureFirewalls","Microsoft.Network/applicationGateways","Microsoft.Network/virtualNetworkGateways","Microsoft.Network/expressRouteCircuits","Microsoft.Network/expressRouteCircuits/Peerings","Microsoft.Network/connections","Microsoft.Network/trafficManagerProfiles","Microsoft.Network/networkWatchers/connectionMonitors","Microsoft.Network/frontdoors","Microsoft.NotificationHubs/namespaces/notificationHubs","Microsoft.OperationalInsights/workspaces","Microsoft.PowerBIDedicated/capacities","Microsoft.Relay/namespaces","Microsoft.ServiceBus/namespaces","Microsoft.Sql/servers/databases","Microsoft.Sql/servers/elasticPools","Microsoft.Sql/managedInstances","Microsoft.Storage/storageAccounts","Microsoft.Storage/storageAccounts/blobServices","Microsoft.Storage/storageAccounts/fileServices","Microsoft.Storage/storageAccounts/queueServices","Microsoft.Storage/storageAccounts/tableServices","Microsoft.StreamAnalytics/streamingJobs","Microsoft.Web/serverfarms","Microsoft.Web/sites","Microsoft.Web/sites/slots","Microsoft.Web/hostingEnvironments/multiRolePools","Microsoft.Web/hostingEnvironments/workerPools"],chinaazuremonitor:["Microsoft.AnalysisServices/servers","Microsoft.Batch/batchAccounts","Microsoft.Cache/redis","Microsoft.Cdn/cdnwebapplicationfirewallpolicies","Microsoft.Cdn/profiles","Microsoft.ClassicCompute/virtualMachines","Microsoft.ClassicCompute/domainNames","Microsoft.CognitiveServices/accounts","Microsoft.Compute/virtualMachines","Microsoft.Compute/virtualMachineScaleSets","Microsoft.ContainerRegistry/registries","Microsoft.DBforMySQL/servers","Microsoft.DBforPostgreSQL/servers","Microsoft.DBforPostgreSQL/serversv2","Microsoft.Devices/IotHubs","Microsoft.Devices/provisioningServices","Microsoft.EventHub/namespaces","Microsoft.Insights/AutoscaleSettings","Microsoft.Insights/components","Microsoft.KeyVault/vaults","Microsoft.Logic/workflows","Microsoft.Network/networkInterfaces","Microsoft.Network/loadBalancers","Microsoft.Network/dnsZones","Microsoft.Network/publicIPAddresses","Microsoft.Network/azureFirewalls","Microsoft.Network/applicationGateways","Microsoft.Network/virtualNetworkGateways","Microsoft.Network/expressRouteCircuits","Microsoft.Network/expressRouteCircuits/Peerings","Microsoft.Network/connections","Microsoft.Network/trafficManagerProfiles","Microsoft.Network/networkWatchers/connectionMonitors","Microsoft.Network/frontdoors","Microsoft.NotificationHubs/namespaces/notificationHubs","Microsoft.PowerBIDedicated/capacities","Microsoft.Relay/namespaces","Microsoft.ServiceBus/namespaces","Microsoft.Sql/servers/databases","Microsoft.Sql/servers/elasticPools","Microsoft.Sql/managedInstances","Microsoft.Storage/storageAccounts","Microsoft.Storage/storageAccounts/blobServices","Microsoft.Storage/storageAccounts/fileServices","Microsoft.Storage/storageAccounts/queueServices","Microsoft.Storage/storageAccounts/tableServices","Microsoft.StreamAnalytics/streamingJobs","Microsoft.Web/serverfarms","Microsoft.Web/sites","Microsoft.Web/sites/slots","Microsoft.Web/hostingEnvironments/multiRolePools","Microsoft.Web/hostingEnvironments/workerPools"]},(t="supportedMetricNamespaces")in(r=this)?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s,this.cloudName=e}get(){return this.supportedMetricNamespaces[this.cloudName]}}function nt(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}const ct="select";function ut(e){return!(!e||e===ct)}class lt extends i.DataSourceWithBackend{constructor(e){super(e),this.instanceSettings=e,nt(this,"apiVersion","2018-01-01"),nt(this,"apiPreviewVersion","2017-12-01-preview"),nt(this,"listByResourceGroupApiVersion","2021-04-01"),nt(this,"defaultSubscriptionId",void 0),nt(this,"resourcePath",void 0),nt(this,"azurePortalUrl",void 0),nt(this,"supportedMetricNamespaces",[]),nt(this,"timeSrv",void 0),this.instanceSettings=e,this.timeSrv=(0,Yr.$t)(),this.defaultSubscriptionId=e.jsonData.subscriptionId;const r=j(e);this.resourcePath=g,this.supportedMetricNamespaces=new at(r).get(),this.azurePortalUrl=S(r)}isConfigured(){return!this.validateDatasource()}filterQuery(e){var r,t,s,o,i,a;const n=!(null==e||null===(r=e.azureMonitor)||void 0===r||!r.resourceUri),c=ut(null==e||null===(t=e.azureMonitor)||void 0===t?void 0:t.resourceGroup)&&ut(null==e||null===(s=e.azureMonitor)||void 0===s?void 0:s.resourceName)&&ut(null==e||null===(o=e.azureMonitor)||void 0===o?void 0:o.metricDefinition);return!(!0===e.hide||!n&&!c||!ut(null==e||null===(i=e.azureMonitor)||void 0===i?void 0:i.metricName)||!ut(null==e||null===(a=e.azureMonitor)||void 0===a?void 0:a.aggregation))}applyTemplateVariables(e,r){var t;const s=e.azureMonitor;if(!s)throw new Error("Query is not a valid Azure Monitor Metrics query");s.timeGrain&&s.timeGrainUnit&&"auto"!==s.timeGrain&&(s.timeGrain=u.createISO8601Duration(s.timeGrain,s.timeGrainUnit));const o=(0,i.getTemplateSrv)(),a=o.replace(s.resourceUri,r),n=o.replace(e.subscription||this.defaultSubscriptionId,r),c=o.replace(s.resourceGroup,r),l=o.replace(s.resourceName,r),p=o.replace(s.metricNamespace,r),d=o.replace(s.metricDefinition,r),m=o.replace((s.timeGrain||"").toString(),r),g=o.replace(s.aggregation,r),f=o.replace(s.top||"",r),h=(null!==(t=s.dimensionFilters)&&void 0!==t?t:[]).filter((e=>e.dimension&&"None"!==e.dimension)).map((e=>{var t;const s=null===(t=e.filters)||void 0===t?void 0:t.map((e=>o.replace(null!=e?e:"",r)));return{dimension:o.replace(e.dimension,r),operator:e.operator||"eq",filters:s||[]}}));return{refId:e.refId,subscription:n,queryType:v.AzureMonitor,azureMonitor:{resourceUri:a,resourceGroup:c,resourceName:l,metricDefinition:d,timeGrain:m,allowedTimeGrainsMs:s.allowedTimeGrainsMs,metricName:o.replace(s.metricName,r),metricNamespace:p&&p!==ct?p:d,aggregation:g,dimensionFilters:h,top:f||"10",alias:s.alias}}}async getSubscriptions(){return this.isConfigured()?this.getResource(`${this.resourcePath}/subscriptions?api-version=2019-03-01`).then((e=>l.parseSubscriptions(e))):[]}getResourceGroups(e){return this.getResource(`${this.resourcePath}/subscriptions/${e}/resourceGroups?api-version=${this.listByResourceGroupApiVersion}`).then((e=>l.parseResponseValues(e,"name","name")))}getMetricDefinitions(e,r){return this.getResource(`${this.resourcePath}/subscriptions/${e}/resourceGroups/${r}/resources?api-version=${this.listByResourceGroupApiVersion}`).then((e=>l.parseResponseValues(e,"type","type"))).then((e=>(0,n.filter)(e,(e=>{for(let r=0;r<this.supportedMetricNamespaces.length;r++)if(e.value.toLowerCase()===this.supportedMetricNamespaces[r].toLowerCase())return!0;return!1})))).then((e=>{let r=!1;for(let t=0;t<e.length;t++)if("Microsoft.Storage/storageAccounts"===e[t].value){r=!0;break}return r&&(e.push({text:"Microsoft.Storage/storageAccounts/blobServices",value:"Microsoft.Storage/storageAccounts/blobServices"}),e.push({text:"Microsoft.Storage/storageAccounts/fileServices",value:"Microsoft.Storage/storageAccounts/fileServices"}),e.push({text:"Microsoft.Storage/storageAccounts/tableServices",value:"Microsoft.Storage/storageAccounts/tableServices"}),e.push({text:"Microsoft.Storage/storageAccounts/queueServices",value:"Microsoft.Storage/storageAccounts/queueServices"})),e.map((e=>({value:e.value,text:it[e.value.toLowerCase()]||e.value})))}))}getResourceNames(e,r,t,s){let o=`${this.resourcePath}/subscriptions/${e}/resourceGroups/${r}/resources?$filter=resourceType eq '${t}'&api-version=${this.listByResourceGroupApiVersion}`;return s&&(o+=`&$skiptoken=${s}`),this.getResource(o).then((async s=>{let o=[];if((0,n.startsWith)(t,"Microsoft.Storage/storageAccounts/")){o=l.parseResourceNames(s,"Microsoft.Storage/storageAccounts");for(let e=0;e<o.length;e++)o[e].text+="/default",o[e].value+="/default"}else o=l.parseResourceNames(s,t);if(s.nextLink){const i=new URL(s.nextLink).searchParams.get("$skiptoken");if(!i)throw Error("unable to request the next page of resources");const a=await this.getResourceNames(e,r,t,i);o=o.concat(a)}return o}))}getMetricNamespaces(e){const r=Tr.buildAzureMonitorGetMetricNamespacesUrl(this.resourcePath,this.apiPreviewVersion,this.replaceTemplateVariables(e));return this.getResource(r).then((e=>l.parseResponseValues(e,"name","properties.metricNamespaceName")))}getMetricNames(e){const r=Tr.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,this.apiVersion,this.replaceTemplateVariables(e));return this.getResource(r).then((e=>l.parseResponseValues(e,"name.localizedValue","name.value")))}getMetricMetadata(e){const{metricName:r}=e,t=Tr.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,this.apiVersion,this.replaceTemplateVariables(e));return this.getResource(t).then((e=>l.parseMetadata(e,r)))}async testDatasource(){const e=this.validateDatasource();if(e)return Promise.resolve(e);try{const e=`${this.resourcePath}/subscriptions?api-version=2019-03-01`;return await this.getResource(e).then((e=>({status:"success",message:"Successfully queried the Azure Monitor service.",title:"Success"})))}catch(e){let r="Azure Monitor: ";return r+=e.statusText?e.statusText+": ":"",e.data&&e.data.error&&e.data.error.code?r+=e.data.error.code+". "+e.data.error.message:e.data&&e.data.error?r+=e.data.error:e.data?r+=e.data:r+="Cannot connect to Azure Monitor REST API.",{status:"error",message:r}}}validateDatasource(){if("clientsecret"===N(this.instanceSettings)){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(e){return"string"==typeof e&&e.length>0}replaceTemplateVariables(e){const r=(0,i.getTemplateSrv)(),t=Object.assign({},e);return Object.keys(e).forEach((e=>{t[e]=r.replace(t[e])})),t}}class pt extends i.DataSourceWithBackend{filterQuery(e){var r;return!(null===(r=e.azureResourceGraph)||void 0===r||!r.query)}applyTemplateVariables(e,r){const t=e.azureResourceGraph;if(!t)return e;const s=(0,i.getTemplateSrv)(),o=s.getVariables().map((e=>`$${e.name}`)),a=c().find(e.subscriptions,(e=>c().includes(o,e))),n=[...s.replace(a,r,(e=>e)).split(",").filter((e=>e.length>0)),...c().filter(e.subscriptions,(e=>!c().includes(o,e)))],u=s.replace(t.query,r,y);return{refId:e.refId,queryType:v.AzureResourceGraph,subscriptions:n,azureResourceGraph:{resultFormat:"table",query:u}}}}function dt(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class mt extends i.DataSourceWithBackend{constructor(e){super(e),dt(this,"resourcePath",void 0),dt(this,"supportedMetricNamespaces",void 0),dt(this,"resultLimit",200),dt(this,"search",(async(e,r)=>{const t={metrics:`\n        resources\n        | where id contains "${e}"\n        | where type in (${this.supportedMetricNamespaces.map((e=>`"${e.toLowerCase()}"`)).join(",")})\n        | order by tolower(name) asc\n        | limit ${this.resultLimit}\n      `,logs:`\n        resources\n        | union resourcecontainers \n        | where id contains "${e}"\n        | where type in (${ot})\n        | order by tolower(name) asc\n        | limit ${this.resultLimit}\n      `},{data:s}=await this.makeResourceGraphRequest(t[r]);return s.map((e=>{const r=ge(e.id);if(!r||!(r.resource||r.resourceGroup||r.subscriptionID))throw new Error("unable to fetch resource details");let t=r.subscriptionID,s=ee.Subscription;return r.resource?(t=r.resource,s=ee.Resource):r.resourceGroup&&(t=r.resourceGroup,s=ee.ResourceGroup),{name:e.name,id:t,uri:e.id,resourceGroupName:e.resourceGroup,type:s,typeLabel:it[e.type]||e.type,location:tt[e.location]||e.location}}))})),this.resourcePath=`${h}`;const r=j(e);this.supportedMetricNamespaces=new at(r).get()}async fetchInitialRows(e){const r=await this.getSubscriptions();if(!e)return r;let t=r;const s=ge(e);if(s){const e=`/subscriptions/${s.subscriptionID}/resourceGroups/${s.resourceGroup}`;if(s.resourceGroup){const e=await this.getResourceGroupsBySubscriptionId(s.subscriptionID);t=ye(t,`/subscriptions/${s.subscriptionID}`,e)}if(s.resource){t=ye(t,e,await this.getResourcesForResourceGroup(e))}}return t}async fetchAndAppendNestedRow(e,r){const t=r.type===ee.Subscription?await this.getResourceGroupsBySubscriptionId(r.id):await this.getResourcesForResourceGroup(r.id);return ye(e,r.uri,t)}async getSubscriptions(){let e,r=[],t=!1;for(;!t;){let s={};e&&(s={$skipToken:e});const o=await this.makeResourceGraphRequest("\n    resources\n    | join kind=inner (\n              ResourceContainers\n                | where type == 'microsoft.resources/subscriptions'\n                | project subscriptionName=name, subscriptionURI=id, subscriptionId\n              ) on subscriptionId\n    | summarize count() by subscriptionName, subscriptionURI, subscriptionId\n    | order by subscriptionName desc\n  ",1,s);if(!o.data.length)throw new Error("No subscriptions were found");r=r.concat(o.data),e=o.$skipToken,t=!e}return r.map((e=>({name:e.subscriptionName,id:e.subscriptionId,uri:`/subscriptions/${e.subscriptionId}`,typeLabel:"Subscription",type:ee.Subscription,children:[]})))}async getResourceGroupsBySubscriptionId(e){const r=`\n    resources\n     | join kind=inner (\n       ResourceContainers\n       | where type == 'microsoft.resources/subscriptions/resourcegroups'\n       | project resourceGroupURI=id, resourceGroupName=name, resourceGroup, subscriptionId\n     ) on resourceGroup, subscriptionId\n\n     | where type in (${ot})\n     | where subscriptionId == '${e}'\n     | summarize count() by resourceGroupName, resourceGroupURI\n     | order by resourceGroupURI asc`;let t,s=[],o=!1;for(;!o;){let e={};t&&(e={$skipToken:t});const i=await this.makeResourceGraphRequest(r,1,e);s=s.concat(i.data),t=i.$skipToken,o=!t}return s.map((e=>{const r=ge(e.resourceGroupURI);if(!r||!r.resourceGroup)throw new Error("unable to fetch resource groups");return{name:e.resourceGroupName,uri:e.resourceGroupURI,id:r.resourceGroup,type:ee.ResourceGroup,typeLabel:"Resource Group",children:[]}}))}async getResourcesForResourceGroup(e){const{data:r}=await this.makeResourceGraphRequest(`\n      resources\n      | where id hasprefix "${e}"\n      | where type in (${ot}) and location in (${rt})\n    `);return r.map((e=>{const r=ge(e.id);if(!r||!r.resource)throw new Error("unable to fetch resource details");return{name:e.name,id:r.resource,uri:e.id,resourceGroupName:e.resourceGroup,type:ee.Resource,typeLabel:it[e.type]||e.type,location:tt[e.location]||e.location}}))}async getResourceURIDisplayProperties(e){var r;const{subscriptionID:t,resourceGroup:s,resource:o}=null!==(r=ge(e))&&void 0!==r?r:{};if(!t)throw new Error("Invalid resource URI passed");const i=`/subscriptions/${t}`,a=`\n    resourcecontainers\n    | where type == "microsoft.resources/subscriptions"\n    | where id =~ "${i}"\n    | project subscriptionName=name, subscriptionId\n\n    | join kind=leftouter (\n      resourcecontainers            \n            | where type == "microsoft.resources/subscriptions/resourcegroups"\n            | where id =~ "${`${i}/resourceGroups/${s}`}"\n            | project resourceGroupName=name, resourceGroup, subscriptionId\n        ) on subscriptionId\n\n        | join kind=leftouter (\n          resources\n            | where id =~ "${e}"\n            | project resourceName=name, subscriptionId\n        ) on subscriptionId\n\n        | project subscriptionName, resourceGroupName, resourceName\n    `,{data:n}=await this.makeResourceGraphRequest(a);if(!n.length)throw new Error("unable to fetch resource details");const{subscriptionName:c,resourceGroupName:u,resourceName:l}=n[0];return{subscriptionName:c||t,resourceGroupName:u||s,resourceName:l||o}}async getResourceURIFromWorkspace(e){const{data:r}=await this.makeResourceGraphRequest(`\n      resources\n      | where properties['customerId'] == "${e}"\n      | project id\n    `);if(!r.length)throw new Error("unable to find resource for workspace "+e);return r[0].id}async makeResourceGraphRequest(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2?arguments[2]:void 0;try{return await this.postResource(this.resourcePath+"/providers/Microsoft.ResourceGraph/resources?api-version=2021-03-01",{query:e,options:Object.assign({resultFormat:"objectArray"},t)})}catch(t){if(r>0)return this.makeResourceGraphRequest(e,r-1);throw t}}}function gt(e){var r,t,s,o,i;const a="string"==typeof e.rawQuery?e.rawQuery:null,n="string"==typeof e.workspace?e.workspace:null;if(!a||!n||null!==(r=e.target)&&void 0!==r&&null!==(t=r.azureLogAnalytics)&&void 0!==t&&t.query)return e;const c=Object.assign({},null!==(s=e.target)&&void 0!==s?s:{},{refId:null!==(o=null===(i=e.target)||void 0===i?void 0:i.refId)&&void 0!==o?o:"Anno",queryType:v.LogAnalytics,azureLogAnalytics:{query:a,resource:n}});return Object.assign({},e,{rawQuery:void 0,workspace:void 0,subscription:void 0,queryType:void 0,target:c})}var ft=t("./.yarn/cache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/lastValueFrom.js");const ht=e=>({subscriptions:e.match(/^Subscriptions\(\)/i),resourceGroups:e.match(/^ResourceGroups\(\)/i),resourceGroupsWithSub:e.match(/^ResourceGroups\(([^\)]+?)(,\s?([^,]+?))?\)/i),metricDefinitions:e.match(/^Namespaces\(([^\)]+?)(,\s?([^,]+?))?\)/i),metricDefinitionsWithSub:e.match(/^Namespaces\(([^,]+?),\s?([^,]+?)\)/i),resourceNames:e.match(/^ResourceNames\(([^,]+?),\s?([^,]+?)\)/i),resourceNamesWithSub:e.match(/^ResourceNames\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),metricNamespace:e.match(/^MetricNamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamespaceWithSub:e.match(/^metricnamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNames:e.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamesWithSub:e.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),appInsightsMetricNameQuery:e.match(/^AppInsightsMetricNames\(\)/i),appInsightsGroupByQuery:e.match(/^AppInsightsGroupBys\(([^\)]+?)(,\s?([^,]+?))?\)/i),workspacesQuery:e.match(/^workspaces\(\)/i),workspacesQueryWithSub:e.match(/^workspaces\(["']?([^\)]+?)["']?\)/i)}),yt=async(e,r)=>"string"!=typeof e?e:(e=>{const r=ht(e);return Object.keys(r).some((e=>!!r[e]))})(e)?((e,r)=>{const t=ht(e),s=r.azureMonitorDatasource.defaultSubscriptionId;return{refId:"A",queryType:v.GrafanaTemplateVariableFn,grafanaTemplateVariableFn:t.appInsightsMetricNameQuery?{rawQuery:e,kind:"AppInsightsMetricNameQuery"}:t.appInsightsGroupByQuery?{kind:"AppInsightsGroupByQuery",rawQuery:e,metricName:t.appInsightsGroupByQuery[1]}:t.subscriptions?{kind:"SubscriptionsQuery",rawQuery:e}:t.resourceGroupsWithSub?{kind:"ResourceGroupsQuery",rawQuery:e,subscription:t.resourceGroupsWithSub[1]}:t.resourceGroups&&s?{kind:"ResourceGroupsQuery",rawQuery:e,subscription:s}:t.metricDefinitionsWithSub?{kind:"MetricDefinitionsQuery",rawQuery:e,subscription:t.metricDefinitionsWithSub[1],resourceGroup:t.metricDefinitionsWithSub[2]}:t.metricDefinitions&&s?{kind:"MetricDefinitionsQuery",rawQuery:e,subscription:s,resourceGroup:t.metricDefinitions[1]}:t.resourceNamesWithSub?{kind:"ResourceNamesQuery",rawQuery:e,subscription:t.resourceNamesWithSub[1],resourceGroup:t.resourceNamesWithSub[2],metricDefinition:t.resourceNamesWithSub[3]}:t.resourceNames&&s?{kind:"ResourceNamesQuery",rawQuery:e,subscription:s,resourceGroup:t.resourceNames[1],metricDefinition:t.resourceNames[2]}:t.metricNamespaceWithSub?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:t.metricNamespaceWithSub[1],resourceGroup:t.metricNamespaceWithSub[2],metricDefinition:t.metricNamespaceWithSub[3],resourceName:t.metricNamespaceWithSub[4]}:t.metricNamespace&&s?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:s,resourceGroup:t.metricNamespace[1],metricDefinition:t.metricNamespace[2],resourceName:t.metricNamespace[3]}:t.metricNames&&s&&-1===t.metricNames[3].indexOf(",")?{kind:"MetricNamesQuery",rawQuery:e,subscription:s,resourceGroup:t.metricNames[1],metricDefinition:t.metricNames[2],resourceName:t.metricNames[3],metricNamespace:t.metricNames[4]}:t.metricNamesWithSub?{kind:"MetricNamesQuery",rawQuery:e,subscription:t.metricNamesWithSub[1],resourceGroup:t.metricNamesWithSub[2],metricDefinition:t.metricNamesWithSub[3],resourceName:t.metricNamesWithSub[4],metricNamespace:t.metricNamesWithSub[5]}:t.workspacesQueryWithSub?{kind:"WorkspacesQuery",rawQuery:e,subscription:(t.workspacesQueryWithSub[1]||"").trim()}:t.workspacesQuery&&s?{kind:"WorkspacesQuery",rawQuery:e,subscription:s}:{kind:"SubscriptionsQuery",rawQuery:e},subscription:s}})(e,r.datasource):(async(e,r)=>{const t=r.azureMonitorDatasource.defaultSubscriptionId;let s="";if(e){const e=r.azureLogAnalyticsDatasource.getDeprecatedDefaultWorkSpace();s=e?fe(e)?await r.resourcePickerData.getResourceURIFromWorkspace(e):e:await r.azureLogAnalyticsDatasource.getFirstWorkspace()||""}return{refId:"A",queryType:v.LogAnalytics,azureLogAnalytics:{query:e,resource:s},subscription:t}})(e,r.datasource);var vt;const bt=[{label:"Grafana Query Function",value:v.GrafanaTemplateVariableFn},{label:"Logs",value:v.LogAnalytics}],wt=e=>{var r;let{query:t,updateQuery:s,datasource:i}=e;const[n,c]=(0,o.useState)("");(0,o.useEffect)((()=>{var e;c((null===(e=t.grafanaTemplateVariableFn)||void 0===e?void 0:e.rawQuery)||"")}),[null===(r=t.grafanaTemplateVariableFn)||void 0===r?void 0:r.rawQuery]);const u=(0,o.useCallback)((e=>{yt(e,{datasource:i}).then((r=>{r.queryType===v.GrafanaTemplateVariableFn?s(r):s(Object.assign({},t,{grafanaTemplateVariableFn:{kind:"UnknownQuery",rawQuery:e}}))}))}),[i,t,s]);return(0,G.jsx)(a.InlineField,{label:"Grafana template variable function",children:(0,G.jsx)(a.Input,{placeholder:"type a grafana template variable function, ex: Subscriptions()",value:n,onChange:e=>{c(e.target.value)},onBlur:()=>u(n)})})},Nt=e=>{const r={refId:"A",queryType:v.GrafanaTemplateVariableFn},[t,s]=(0,o.useState)(r);(0,o.useEffect)((()=>{yt(e.query,{datasource:e.datasource}).then((e=>{s(e)}))}),[e.query,e.datasource]);const[i,n]=V();return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(a.InlineField,{label:"Select query type",children:(0,G.jsx)(a.Select,{"aria-label":"select query type",onChange:e=>{e.value&&s(Object.assign({},t,{queryType:e.value}))},options:bt,width:25,value:t.queryType})}),t.queryType===v.LogAnalytics&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(er,{subscriptionId:t.subscription,query:t,datasource:e.datasource,onChange:r=>{var t;s(r),null!==(t=r.azureLogAnalytics)&&void 0!==t&&t.query&&e.onChange(r)},variableOptionGroup:{label:"Template Variables",options:[]},setError:n,hideFormatAs:!0}),i&&(0,G.jsxs)(G.Fragment,{children:[vt||(vt=(0,G.jsx)(Z,{v:2})),(0,G.jsx)(a.Alert,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor",children:i})]})]}),t.queryType===v.GrafanaTemplateVariableFn&&(0,G.jsx)(wt,{query:t,updateQuery:e.onChange,datasource:e.datasource})]})};class Mt extends s.CustomVariableSupport{constructor(e){var r,t,s;super(),this.datasource=e,s=Nt,(t="editor")in(r=this)?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s,this.datasource=e,this.datasource=e,this.query=this.query.bind(this)}query(e){return(0,Wr.D)((async()=>{const r=await yt(e.targets[0],{datasource:this.datasource});if(r.queryType===v.GrafanaTemplateVariableFn&&r.grafanaTemplateVariableFn)try{const e=await this.callGrafanaTemplateVariableFn(r.grafanaTemplateVariableFn);return{data:null!=e&&e.length?[(0,s.toDataFrame)(e)]:[]}}catch(e){return{data:[],error:{message:(0,$.Z)(e)}}}return e.targets[0]=r,(0,ft.n)(this.datasource.query(e))})())}callGrafanaTemplateVariableFn(e){return"SubscriptionsQuery"===e.kind?this.datasource.getSubscriptions():"ResourceGroupsQuery"===e.kind?this.datasource.getResourceGroups(this.replaceVariable(e.subscription)):"MetricDefinitionsQuery"===e.kind?this.datasource.getMetricDefinitions(this.replaceVariable(e.subscription),this.replaceVariable(e.resourceGroup)):"ResourceNamesQuery"===e.kind?this.datasource.getResourceNames(this.replaceVariable(e.subscription),this.replaceVariable(e.resourceGroup),this.replaceVariable(e.metricDefinition)):"MetricNamespaceQuery"===e.kind?this.datasource.azureMonitorDatasource.getMetricNamespaces(e):"MetricNamesQuery"===e.kind?this.datasource.azureMonitorDatasource.getMetricNames(e):"WorkspacesQuery"===e.kind?this.datasource.azureLogAnalyticsDatasource.getWorkspaces(this.replaceVariable(e.subscription)):null}replaceVariable(e){return(0,i.getTemplateSrv)().replace((e||"").trim())}}function St(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class jt extends s.DataSourceApi{constructor(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,Ur.J)();super(e),this.templateSrv=r,St(this,"annotations",{prepareAnnotation:gt}),St(this,"azureMonitorDatasource",void 0),St(this,"azureLogAnalyticsDatasource",void 0),St(this,"resourcePickerData",void 0),St(this,"azureResourceGraphDatasource",void 0),St(this,"pseudoDatasource",{}),this.templateSrv=r,this.azureMonitorDatasource=new lt(e),this.azureLogAnalyticsDatasource=new Zr(e),this.azureResourceGraphDatasource=new pt(e),this.resourcePickerData=new mt(e),this.pseudoDatasource={[v.AzureMonitor]:this.azureMonitorDatasource,[v.LogAnalytics]:this.azureLogAnalyticsDatasource,[v.AzureResourceGraph]:this.azureResourceGraphDatasource},this.variables=new Mt(this)}filterQuery(e){var r,t;if(!e.queryType)return!0;const s=this.pseudoDatasource[e.queryType];return null===(r=null==s||null===(t=s.filterQuery)||void 0===t?void 0:t.call(s,e))||void 0===r||r}query(e){const r=new Map;for(const t of e.targets){const s=Dr(t);if(!s.queryType||s.hide||!xt(s))continue;if(!r.has(s.queryType)){const t=(0,n.cloneDeep)(e);t.requestId=`${t.requestId}-${s.refId}`,t.targets=[],r.set(s.queryType,t)}const o=r.get(s.queryType);null==o||o.targets.push(s)}const t=Array.from(r.entries()).map((e=>{let[r,t]=e;const s=this.pseudoDatasource[r];if(!s)throw new Error("Data source not created for query type "+r);return s.query(t)}));return 1===t.length?t[0]:t.length>1?(0,Qr.D)(t).pipe((0,Vr.U)((e=>{const r=[];for(const t of e)for(const e of t.data)r.push(e);return{state:s.LoadingState.Done,data:r}}))):(0,$r.of)({state:s.LoadingState.Done,data:[]})}targetContainsTemplate(e){if(e.subscription&&this.templateSrv.containsTemplate(e.subscription))return!0;let r;return e.queryType===v.AzureMonitor?r=JSON.stringify(e.azureMonitor):e.queryType===v.LogAnalytics?r=JSON.stringify(e.azureLogAnalytics):e.queryType===v.AzureResourceGraph&&(r=JSON.stringify([e.azureResourceGraph,e.subscriptions])),!!r&&this.templateSrv.containsTemplate(r)}async annotationQuery(e){return this.azureLogAnalyticsDatasource.annotationQuery(e)}async testDatasource(){const e=[];return e.push(this.azureMonitorDatasource.testDatasource()),e.push(this.azureLogAnalyticsDatasource.testDatasource()),await Promise.all(e).then((e=>{let r="success",t="";for(let s=0;s<e.length;s++)"success"!==e[s].status&&(r=e[s].status),t+=`${s+1}. ${e[s].message} `;return{status:r,message:t,title:(0,n.upperFirst)(r)}}))}getResourceGroups(e){return this.azureMonitorDatasource.getResourceGroups(this.replaceTemplateVariable(e))}getMetricDefinitions(e,r){return this.azureMonitorDatasource.getMetricDefinitions(this.replaceTemplateVariable(e),this.replaceTemplateVariable(r))}getResourceNames(e,r,t){return this.azureMonitorDatasource.getResourceNames(this.replaceTemplateVariable(e),this.replaceTemplateVariable(r),this.replaceTemplateVariable(t))}getAzureLogAnalyticsWorkspaces(e){return this.azureLogAnalyticsDatasource.getWorkspaces(e)}getSubscriptions(){return this.azureMonitorDatasource.getSubscriptions()}interpolateVariablesInQueries(e,r){return e.map((e=>{var t;if(!e.queryType)return e;const s=this.pseudoDatasource[e.queryType];return null!==(t=null==s?void 0:s.applyTemplateVariables(e,r))&&void 0!==t?t:e}))}replaceTemplateVariable(e){return this.templateSrv.replace(e)}getVariables(){return this.templateSrv.getVariables().map((e=>`$${e.name}`))}isTemplateVariable(e){return this.getVariables().includes(e)}}function xt(e){switch(e.queryType){case v.AzureMonitor:return!!e.azureMonitor;case v.LogAnalytics:return!!e.azureLogAnalytics;case v.AzureResourceGraph:return!!e.azureResourceGraph;case v.GrafanaTemplateVariableFn:return!!e.grafanaTemplateVariableFn;default:return!1}}const zt=new s.DataSourcePlugin(jt).setConfigEditor(Q).setQueryEditor(Fr)},"./.yarn/cache/immer-npm-9.0.12-e8cd7358fa-bcbec6d76d.zip/node_modules/immer/dist/immer.esm.js":(e,r,t)=>{function s(e){for(var r=arguments.length,t=Array(r>1?r-1:0),s=1;s<r;s++)t[s-1]=arguments[s];throw Error("[Immer] minified error nr: "+e+(t.length?" "+t.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function o(e){return!!e&&!!e[W]}function i(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var r=Object.getPrototypeOf(e);if(null===r)return!0;var t=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return t===Object||"function"==typeof t&&Function.toString.call(t)===X}(e)||Array.isArray(e)||!!e[U]||!!e.constructor[U]||d(e)||m(e))}function a(e,r,t){void 0===t&&(t=!1),0===n(e)?(t?Object.keys:B)(e).forEach((function(s){t&&"symbol"==typeof s||r(s,e[s],e)})):e.forEach((function(t,s){return r(s,t,e)}))}function n(e){var r=e[W];return r?r.i>3?r.i-4:r.i:Array.isArray(e)?1:d(e)?2:m(e)?3:0}function c(e,r){return 2===n(e)?e.has(r):Object.prototype.hasOwnProperty.call(e,r)}function u(e,r){return 2===n(e)?e.get(r):e[r]}function l(e,r,t){var s=n(e);2===s?e.set(r,t):3===s?(e.delete(r),e.add(t)):e[r]=t}function p(e,r){return e===r?0!==e||1/e==1/r:e!=e&&r!=r}function d(e){return F&&e instanceof Map}function m(e){return Q&&e instanceof Set}function g(e){return e.o||e.t}function f(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var r=_(e);delete r[W];for(var t=B(r),s=0;s<t.length;s++){var o=t[s],i=r[o];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(r[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[o]})}return Object.create(Object.getPrototypeOf(e),r)}function h(e,r){return void 0===r&&(r=!1),v(e)||o(e)||!i(e)||(n(e)>1&&(e.set=e.add=e.clear=e.delete=y),Object.freeze(e),r&&a(e,(function(e,r){return h(r,!0)}),!0)),e}function y(){s(2)}function v(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function b(e){var r=H[e];return r||s(18,e),r}function w(){return E}function N(e,r){r&&(b("Patches"),e.u=[],e.s=[],e.v=r)}function M(e){S(e),e.p.forEach(x),e.p=null}function S(e){e===E&&(E=e.l)}function j(e){return E={p:[],l:E,h:e,m:!0,_:0}}function x(e){var r=e[W];0===r.i||1===r.i?r.j():r.O=!0}function z(e,r){r._=r.p.length;var t=r.p[0],o=void 0!==e&&e!==t;return r.h.g||b("ES5").S(r,e,o),o?(t[W].P&&(M(r),s(4)),i(e)&&(e=k(r,e),r.l||L(r,e)),r.u&&b("Patches").M(t[W].t,e,r.u,r.s)):e=k(r,t,[]),M(r),r.u&&r.v(r.u,r.s),e!==V?e:void 0}function k(e,r,t){if(v(r))return r;var s=r[W];if(!s)return a(r,(function(o,i){return T(e,s,r,o,i,t)}),!0),r;if(s.A!==e)return r;if(!s.P)return L(e,s.t,!0),s.t;if(!s.I){s.I=!0,s.A._--;var o=4===s.i||5===s.i?s.o=f(s.k):s.o;a(3===s.i?new Set(o):o,(function(r,i){return T(e,s,o,r,i,t)})),L(e,o,!1),t&&e.u&&b("Patches").R(s,t,e.u,e.s)}return s.o}function T(e,r,t,s,a,n){if(o(a)){var u=k(e,a,n&&r&&3!==r.i&&!c(r.D,s)?n.concat(s):void 0);if(l(t,s,u),!o(u))return;e.m=!1}if(i(a)&&!v(a)){if(!e.h.F&&e._<1)return;k(e,a),r&&r.A.l||L(e,a)}}function L(e,r,t){void 0===t&&(t=!1),e.h.F&&e.m&&h(r,t)}function A(e,r){var t=e[W];return(t?g(t):e)[r]}function C(e,r){if(r in e)for(var t=Object.getPrototypeOf(e);t;){var s=Object.getOwnPropertyDescriptor(t,r);if(s)return s;t=Object.getPrototypeOf(t)}}function I(e){e.P||(e.P=!0,e.l&&I(e.l))}function G(e){e.o||(e.o=f(e.t))}function D(e,r,t){var s=d(r)?b("MapSet").N(r,t):m(r)?b("MapSet").T(r,t):e.g?function(e,r){var t=Array.isArray(e),s={i:t?1:0,A:r?r.A:w(),P:!1,I:!1,D:{},l:r,t:e,k:null,o:null,j:null,C:!1},o=s,i=K;t&&(o=[s],i=J);var a=Proxy.revocable(o,i),n=a.revoke,c=a.proxy;return s.k=c,s.j=n,c}(r,t):b("ES5").J(r,t);return(t?t.A:w()).p.push(s),s}function O(e){return o(e)||s(22,e),function e(r){if(!i(r))return r;var t,s=r[W],o=n(r);if(s){if(!s.P&&(s.i<4||!b("ES5").K(s)))return s.t;s.I=!0,t=R(r,o),s.I=!1}else t=R(r,o);return a(t,(function(r,o){s&&u(s.t,r)===o||l(t,r,e(o))})),3===o?new Set(t):t}(e)}function R(e,r){switch(r){case 2:return new Map(e);case 3:return Array.from(e)}return f(e)}t.d(r,{ZP:()=>re});var q,E,P="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),F="undefined"!=typeof Map,Q="undefined"!=typeof Set,$="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,V=P?Symbol.for("immer-nothing"):((q={})["immer-nothing"]=!0,q),U=P?Symbol.for("immer-draftable"):"__$immer_draftable",W=P?Symbol.for("immer-state"):"__$immer_state",X=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),B="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,_=Object.getOwnPropertyDescriptors||function(e){var r={};return B(e).forEach((function(t){r[t]=Object.getOwnPropertyDescriptor(e,t)})),r},H={},K={get:function(e,r){if(r===W)return e;var t=g(e);if(!c(t,r))return function(e,r,t){var s,o=C(r,t);return o?"value"in o?o.value:null===(s=o.get)||void 0===s?void 0:s.call(e.k):void 0}(e,t,r);var s=t[r];return e.I||!i(s)?s:s===A(e.t,r)?(G(e),e.o[r]=D(e.A.h,s,e)):s},has:function(e,r){return r in g(e)},ownKeys:function(e){return Reflect.ownKeys(g(e))},set:function(e,r,t){var s=C(g(e),r);if(null==s?void 0:s.set)return s.set.call(e.k,t),!0;if(!e.P){var o=A(g(e),r),i=null==o?void 0:o[W];if(i&&i.t===t)return e.o[r]=t,e.D[r]=!1,!0;if(p(t,o)&&(void 0!==t||c(e.t,r)))return!0;G(e),I(e)}return e.o[r]===t&&"number"!=typeof t&&(void 0!==t||r in e.o)||(e.o[r]=t,e.D[r]=!0,!0)},deleteProperty:function(e,r){return void 0!==A(e.t,r)||r in e.t?(e.D[r]=!1,G(e),I(e)):delete e.D[r],e.o&&delete e.o[r],!0},getOwnPropertyDescriptor:function(e,r){var t=g(e),s=Reflect.getOwnPropertyDescriptor(t,r);return s?{writable:!0,configurable:1!==e.i||"length"!==r,enumerable:s.enumerable,value:t[r]}:s},defineProperty:function(){s(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){s(12)}},J={};a(K,(function(e,r){J[e]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}})),J.deleteProperty=function(e,r){return J.set.call(this,e,r,void 0)},J.set=function(e,r,t){return K.set.call(this,e[0],r,t,e[0])};var Z=function(){function e(e){var r=this;this.g=$,this.F=!0,this.produce=function(e,t,o){if("function"==typeof e&&"function"!=typeof t){var a=t;t=e;var n=r;return function(e){var r=this;void 0===e&&(e=a);for(var s=arguments.length,o=Array(s>1?s-1:0),i=1;i<s;i++)o[i-1]=arguments[i];return n.produce(e,(function(e){var s;return(s=t).call.apply(s,[r,e].concat(o))}))}}var c;if("function"!=typeof t&&s(6),void 0!==o&&"function"!=typeof o&&s(7),i(e)){var u=j(r),l=D(r,e,void 0),p=!0;try{c=t(l),p=!1}finally{p?M(u):S(u)}return"undefined"!=typeof Promise&&c instanceof Promise?c.then((function(e){return N(u,o),z(e,u)}),(function(e){throw M(u),e})):(N(u,o),z(c,u))}if(!e||"object"!=typeof e){if(void 0===(c=t(e))&&(c=e),c===V&&(c=void 0),r.F&&h(c,!0),o){var d=[],m=[];b("Patches").M(e,c,d,m),o(d,m)}return c}s(21,e)},this.produceWithPatches=function(e,t){if("function"==typeof e)return function(t){for(var s=arguments.length,o=Array(s>1?s-1:0),i=1;i<s;i++)o[i-1]=arguments[i];return r.produceWithPatches(t,(function(r){return e.apply(void 0,[r].concat(o))}))};var s,o,i=r.produce(e,t,(function(e,r){s=e,o=r}));return"undefined"!=typeof Promise&&i instanceof Promise?i.then((function(e){return[e,s,o]})):[i,s,o]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var r=e.prototype;return r.createDraft=function(e){i(e)||s(8),o(e)&&(e=O(e));var r=j(this),t=D(this,e,void 0);return t[W].C=!0,S(r),t},r.finishDraft=function(e,r){var t=(e&&e[W]).A;return N(t,r),z(void 0,t)},r.setAutoFreeze=function(e){this.F=e},r.setUseProxies=function(e){e&&!$&&s(20),this.g=e},r.applyPatches=function(e,r){var t;for(t=r.length-1;t>=0;t--){var s=r[t];if(0===s.path.length&&"replace"===s.op){e=s.value;break}}t>-1&&(r=r.slice(t+1));var i=b("Patches").$;return o(e)?i(e,r):this.produce(e,(function(e){return i(e,r)}))},e}(),Y=new Z,ee=Y.produce;Y.produceWithPatches.bind(Y),Y.setAutoFreeze.bind(Y),Y.setUseProxies.bind(Y),Y.applyPatches.bind(Y),Y.createDraft.bind(Y),Y.finishDraft.bind(Y);const re=ee}}]);