"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6618],{"./public/app/core/hooks/useCleanup.ts":(e,t,n)=>{n.d(t,{x:()=>(function(e){const t=(0,i.useDispatch)(),n=(0,a.useRef)(e);n.current=e,(0,a.useEffect)(()=>()=>{t((0,s.e)({stateSelector:n.current}))},[t])})});var a=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=n("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),s=n("./public/app/core/actions/cleanUp.ts")},"./public/app/core/hooks/useNavModel.ts":(e,t,n)=>{n.d(t,{q:()=>s});var a=n("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),i=n("./public/app/core/selectors/navModel.ts");const s=e=>{const t=(0,a.useSelector)(e=>e.navIndex);return(0,i.h)(t,e)}},"./public/app/features/alerting/NotificationsListPage.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var a,i,s,r,o=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),l=n("./.yarn/__virtual__/react-use-virtual-00326e70ba/0/cache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useAsyncFn.js"),c=n("./packages/grafana-runtime/src/index.ts"),d=n("./packages/grafana-ui/src/index.ts"),u=n("./public/app/core/components/EmptyListCTA/EmptyListCTA.tsx"),p=n("./public/app/core/components/Page/Page.tsx"),m=n("./public/app/core/core.ts"),h=n("./public/app/core/hooks/useNavModel.ts"),f=n("./public/app/types/events.ts"),g=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const v=()=>{const e=(0,h.q)("channels"),[t,n]=(0,o.useState)([]),[v,x]=(0,l.Z)(async()=>await(0,c.getBackendSrv)().get("/api/alert-notifications"));(0,o.useEffect)(()=>{x().then(e=>{n(e)})},[x]);const b=async e=>{await(0,c.getBackendSrv)().delete(`/api/alert-notifications/${e}`);const t=await x();n(t)};return(0,g.jsx)(p.Z,{navModel:e,children:(0,g.jsxs)(p.Z.Contents,{children:[v.error&&(0,g.jsx)("p",{children:v.error}),!!t.length&&(0,g.jsxs)(g.Fragment,{children:[a||(a=(0,g.jsxs)("div",{className:"page-action-bar",children:[(0,g.jsx)("div",{className:"page-action-bar__spacer"}),(0,g.jsx)(d.LinkButton,{icon:"channel-add",href:"alerting/notification/new",children:"New channel"})]})),(0,g.jsxs)("table",{className:"filter-table filter-table--hover",children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{style:{minWidth:"200px"},children:i||(i=(0,g.jsx)("strong",{children:"Name"}))}),(0,g.jsx)("th",{style:{minWidth:"100px"},children:"Type"}),(0,g.jsx)("th",{style:{width:"1%"}})]})}),(0,g.jsx)("tbody",{children:t.map(e=>(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{className:"link-td",children:(0,g.jsx)("a",{href:`alerting/notification/${e.id}/edit`,children:e.name})}),(0,g.jsx)("td",{className:"link-td",children:(0,g.jsx)("a",{href:`alerting/notification/${e.id}/edit`,children:e.type})}),(0,g.jsx)("td",{className:"text-right",children:(0,g.jsxs)(d.HorizontalGroup,{justify:"flex-end",children:[e.isDefault&&(s||(s=(0,g.jsx)(d.Button,{disabled:!0,variant:"secondary",size:"sm",children:"default"}))),(0,g.jsx)(d.Button,{variant:"destructive",icon:"times",size:"sm",onClick:()=>{(e=>{m.h$.publish(new f.VJ({title:"Delete",text:"Do you want to delete this notification channel?",text2:"Deleting this notification channel will not delete from alerts any references to it",icon:"trash-alt",confirmText:"Delete",yesText:"Delete",onConfirm:async()=>{b(e)}}))})(e.id)}})]})})]},e.id))})]})]}),!(t.length||v.loading)&&(r||(r=(0,g.jsx)(u.Z,{title:"There are no notification channels defined yet",buttonIcon:"channel-add",buttonLink:"alerting/notification/new",buttonTitle:"Add channel",proTip:"You can include images in your alert notifications.",proTipLink:"http://docs.grafana.org/alerting/notifications/",proTipLinkTitle:"Learn more",proTipTarget:"_blank"})))]})})}},"./public/app/features/alerting/unified/Receivers.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>Tt});var a=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=n("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),s=n("./.yarn/__virtual__/react-router-virtual-31642fe47a/0/cache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js"),r=n("./packages/grafana-ui/src/index.ts"),o=n("./public/app/features/alerting/unified/components/AlertManagerPicker.tsx"),l=n("./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx"),c=n("./public/app/features/alerting/unified/components/NoAlertManagerWarning.tsx"),d=n("./public/app/features/alerting/unified/utils/datasource.ts"),u=n("./public/app/features/alerting/unified/state/actions.ts");function p(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object.assign({propertyName:e,label:t,description:n,element:"input",inputType:"",required:!1,secure:!1,placeholder:"",validationRule:"",showWhen:{field:"",is:""},dependsOn:""},a)}const m=p("basic_auth","Basic auth","Sets the `Authorization` header with the configured username and password. Password and password_file are mutually exclusive.",{element:"subform",subformOptions:[p("username","Username",""),p("password","Password",""),p("password_file","Password file","")]}),h=p("tls_config","TLS config","Configures the TLS settings.",{element:"subform",subformOptions:[p("ca_file","CA file","CA certificate to validate the server certificate with."),p("cert_file","Cert file","Certificate for client cert authentication to the server."),p("key_file","Key file","Key file for client cert authentication to the server."),p("server_name","Server name","ServerName extension to indicate the name of the server."),p("insecure_skip_verify","Skip verify","Disable validation of the server certificate.",{element:"checkbox"})]}),f=p("http_config","HTTP Config","Note that `basic_auth`, `bearer_token` and `bearer_token_file` options are mutually exclusive.",{element:"subform",subformOptions:[p("bearer_token","Bearer token","Sets the `Authorization` header with the configured bearer token."),p("bearer_token_file","Bearer token file","Sets the `Authorization` header with the bearer token read from the configured file."),p("proxy_url","Proxy URL","Optional proxy URL."),m,h]}),g=[{name:"Email",description:"Send notification over SMTP",type:"email",info:"",heading:"Email settings",options:[p("to","To","The email address to send notifications to.",{required:!0}),p("from","From","The sender address."),p("smarthost","SMTP host","The SMTP host through which emails are sent."),p("hello","Hello","The hostname to identify to the SMTP server."),p("auth_username","Username","SMTP authentication information"),p("auth_password","Password","SMTP authentication information"),p("auth_secret","Secret","SMTP authentication information"),p("auth_identity","Identity","SMTP authentication information"),p("require_tls","Require TLS","The SMTP TLS requirement",{element:"checkbox"}),p("html","Email HTML body","The HTML body of the email notification.",{placeholder:'{{ template "email.default.html" . }}',element:"textarea"}),p("text","Email text body","The text body of the email notification.",{element:"textarea"}),p("headers","Headers","Further headers email header key/value pairs. Overrides any headers previously set by the notification implementation.",{element:"key_value_map"}),h]},{name:"PagerDuty",description:"Send notifications to PagerDuty",type:"pagerduty",info:"",heading:"PagerDuty settings",options:[p("routing_key","Routing key","The PagerDuty integration key (when using PagerDuty integration type `Events API v2`)"),p("service_key","Service key","The PagerDuty integration key (when using PagerDuty integration type `Prometheus`)."),p("url","URL","The URL to send API requests to"),p("client","Client","The client identification of the Alertmanager.",{placeholder:'{{ template "pagerduty.default.client" . }}'}),p("client_url","Client URL","A backlink to the sender of the notification.",{placeholder:'{{ template "pagerduty.default.clientURL" . }}'}),p("description","Description","A description of the incident.",{placeholder:'{{ template "pagerduty.default.description" .}}'}),p("severity","Severity","Severity of the incident.",{placeholder:"error"}),p("details","Details","A set of arbitrary key/value pairs that provide further detail about the incident.",{element:"key_value_map"}),p("images","Images","Images to attach to the incident.",{element:"subform_array",subformOptions:[p("href","URL","",{required:!0}),p("source","Source","",{required:!0}),p("alt","Alt","",{required:!0})]}),p("links","Links","Links to attach to the incident.",{element:"subform_array",subformOptions:[p("href","URL","",{required:!0}),p("text","Text","",{required:!0})]}),f]},{name:"Pushover",description:"Send notifications to Pushover",type:"pushover",info:"",heading:"Pushover settings",options:[p("user_key","User key","The recipient user’s user key.",{required:!0}),p("token","Token","Your registered application’s API token, see https://pushover.net/app",{required:!0}),p("title","Title","Notification title.",{placeholder:'{{ template "pushover.default.title" . }}'}),p("message","Message","Notification message.",{placeholder:'{{ template "pushover.default.message" . }}'}),p("url","URL","A supplementary URL shown alongside the message.",{placeholder:'{{ template "pushover.default.url" . }}'}),p("priority","Priority","Priority, see https://pushover.net/api#priority",{placeholder:'{{ if eq .Status "firing" }}2{{ else }}0{{ end }}'}),p("retry","Retry","How often the Pushover servers will send the same notification to the user. Must be at least 30 seconds.",{placeholder:"1m"}),p("expire","Expire","How long your notification will continue to be retried for, unless the user acknowledges the notification.",{placeholder:"1h"}),f]},{name:"Slack",description:"Send notifications to Slack",type:"slack",info:"",heading:"Slack settings",options:[p("api_url","Webhook URL","The Slack webhook URL."),p("channel","Channel","The #channel or @user to send notifications to.",{required:!0}),p("icon_emoji","Emoji icon",""),p("icon_url","Icon URL",""),p("link_names","Names link","",{element:"checkbox"}),p("username","Username","",{placeholder:'{{ template "slack.default.username" . }}'}),p("callback_id","Callback ID","",{placeholder:'{{ template "slack.default.callbackid" . }}'}),p("color","Color","",{placeholder:'{{ if eq .Status "firing" }}danger{{ else }}good{{ end }}'}),p("fallback","Fallback","",{placeholder:'{{ template "slack.default.fallback" . }}'}),p("footer","Footer","",{placeholder:'{{ template "slack.default.footer" . }}'}),p("mrkdwn_in","Mrkdwn fields","An array of field names that should be formatted by mrkdwn syntax.",{element:"string_array"}),p("pretext","Pre-text","",{placeholder:'{{ template "slack.default.pretext" . }}'}),p("short_fields","Short fields","",{element:"checkbox"}),p("text","Message body","",{element:"textarea",placeholder:'{{ template "slack.default.text" . }}'}),p("title","Title","",{placeholder:'{{ template "slack.default.title" . }}'}),p("title_link","Title link","",{placeholder:'{{ template "slack.default.titlelink" . }}'}),p("image_url","Image URL",""),p("thumb_url","Thumbnail URL",""),p("actions","Actions","",{element:"subform_array",subformOptions:[p("text","Text","",{required:!0}),p("type","Type","",{required:!0}),p("url","URL","Either url or name and value are mandatory."),p("name","Name",""),p("value","Value",""),p("confirm","Confirm","",{element:"subform",subformOptions:[p("text","Text","",{required:!0}),p("dismiss_text","Dismiss text",""),p("ok_text","OK text",""),p("title","Title","")]}),p("style","Style","")]}),p("fields","Fields","",{element:"subform_array",subformOptions:[p("title","Title","",{required:!0}),p("value","Value","",{required:!0}),p("short","Short","",{element:"checkbox"})]}),f]},{name:"OpsGenie",description:"Send notifications to OpsGenie",type:"opsgenie",info:"",heading:"OpsGenie settings",options:[p("api_key","API key","The API key to use when talking to the OpsGenie API."),p("api_url","API URL","The host to send OpsGenie API requests to."),p("message","Message","Alert text limited to 130 characters."),p("description","Description","A description of the incident.",{placeholder:'{{ template "opsgenie.default.description" . }}'}),p("source","Source","A backlink to the sender of the notification.",{placeholder:'{{ template "opsgenie.default.source" . }}'}),p("details","Details","A set of arbitrary key/value pairs that provide further detail about the incident.",{element:"key_value_map"}),p("tags","Tags","Comma separated list of tags attached to the notifications."),p("note","Note","Additional alert note."),p("priority","Priority","Priority level of alert. Possible values are P1, P2, P3, P4, and P5."),p("responders","Responders","List of responders responsible for notifications.",{element:"subform_array",subformOptions:[p("type","Type",'"team", "user", "escalation" or schedule".',{required:!0}),p("id","ID","Exactly one of these fields should be defined."),p("name","Name","Exactly one of these fields should be defined."),p("username","Username","Exactly one of these fields should be defined.")]}),f]},{name:"VictorOps",description:"Send notifications to VictorOps",type:"victorops",info:"",heading:"VictorOps settings",options:[p("api_key","API key","The API key to use when talking to the VictorOps API."),p("api_url","API URL","The VictorOps API URL."),p("routing_key","Routing key","A key used to map the alert to a team.",{required:!0}),p("message_type","Message type","Describes the behavior of the alert (CRITICAL, WARNING, INFO)."),p("entity_display_name","Entity display name","Contains summary of the alerted problem.",{placeholder:'{{ template "victorops.default.entity_display_name" . }}'}),p("state_message","State message","Contains long explanation of the alerted problem.",{placeholder:'{{ template "victorops.default.state_message" . }}'}),p("monitoring_tool","Monitoring tool","The monitoring tool the state message is from.",{placeholder:'{{ template "victorops.default.monitoring_tool" . }}'}),f]},{name:"Webhook",description:"Send notifications to a webhook",type:"webhook",info:"",heading:"Webhook settings",options:[p("url","URL","The endpoint to send HTTP POST requests to.",{required:!0}),p("max_alerts","Max alerts","The maximum number of alerts to include in a single webhook message. Alerts above this threshold are truncated. When leaving this at its default value of 0, all alerts are included.",{placeholder:"0",validationRule:"(^\\d+$|^$)"}),f]}],v=[p("smtp_from","SMTP from","The default SMTP From header field."),p("smtp_smarthost","SMTP smarthost","The default SMTP smarthost used for sending emails, including port number. Port number usually is 25, or 587 for SMTP over TLS (sometimes referred to as STARTTLS). Example: smtp.example.org:587"),p("smtp_hello","SMTP hello","The default hostname to identify to the SMTP server.",{placeholder:"localhost"}),p("smtp_auth_username","SMTP auth username","SMTP Auth using CRAM-MD5, LOGIN and PLAIN. If empty, Alertmanager doesn't authenticate to the SMTP server."),p("smtp_auth_password","SMTP auth password","SMTP Auth using LOGIN and PLAIN."),p("smtp_auth_identity","SMTP auth identity","SMTP Auth using PLAIN."),p("smtp_auth_secret","SMTP auth secret","SMTP Auth using CRAM-MD5."),p("smtp_require_tls","SMTP require TLS","The default SMTP TLS requirement. Note that Go does not support unencrypted connections to remote SMTP endpoints.",{element:"checkbox"}),p("slack_api_url","Slack API URL",""),p("victorops_api_key","VictorOps API key",""),p("victorops_api_url","VictorOps API URL","",{placeholder:"https://alert.victorops.com/integrations/generic/20131114/alert/"}),p("pagerduty_url","PagerDuty URL","https://events.pagerduty.com/v2/enqueue"),p("opsgenie_api_key","OpsGenie API key",""),p("opsgenie_api_url","OpsGenie API URL","",{placeholder:"https://api.opsgenie.com/"}),p("wechat_api_url","WeChat API URL","",{placeholder:"https://qyapi.weixin.qq.com/cgi-bin/"}),p("wechat_api_secret","WeChat API secret",""),p("wechat_api_corp_id","WeChat API corp id",""),f,p("resolve_timeout","Resolve timeout","ResolveTimeout is the default value used by alertmanager if the alert does not include EndsAt, after this time passes it can declare the alert as resolved if it has not been updated. This has no impact on alerts from Prometheus, as they always include EndsAt.",{placeholder:"5m"})];var x=n("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js");function b(e,t){var n,a;const i={};let s=1;return[{name:e.name,items:null!==(n=null===(a=e.grafana_managed_receiver_configs)||void 0===a?void 0:a.map(e=>{const n=String(s++);i[n]=e;const a=t.find(t=>{let{type:n}=t;return n===e.type});return function(e,t,n){const a={__id:e,type:t.type,secureSettings:{},settings:Object.assign({},t.settings),secureFields:Object.assign({},t.secureFields),disableResolveMessage:t.disableResolveMessage};return null===n||void 0===n||n.options.forEach(e=>{e.secure&&a.settings[e.propertyName]&&(delete a.settings[e.propertyName],a.secureFields[e.propertyName]=!0)}),a}(n,e,a)}))&&void 0!==n?n:[]},i]}function y(e,t){const n={};let a=1;const i=Object.entries(e).filter(e=>{let[t]=e;return t.endsWith("_configs")&&"grafana_managed_receiver_configs"!==t}).map(e=>{let[t,n]=e;return[t.replace("_configs",""),n]}).map(e=>{let[i,r]=e;return r.map(e=>{const r=String(a++);if(n[r]={type:i,config:e},!t.find(e=>e.type===i))throw new Error(`unknown cloud notifier: ${i}`);return s=e,{__id:r,type:i,settings:Object.assign({},s),secureFields:{},secureSettings:{},sendResolved:s.send_resolved}})}).flat();var s;return[{name:e.name,items:i},n]}function j(e,t,n){var a;const i=null!==(a=e.alertmanager_config.receivers)&&void 0!==a?a:[];if(t.name!==n&&i.find(e=>{let{name:n}=e;return n===t.name}))throw new Error(`Duplicate receiver name ${t.name}`);if(n&&!i.find(e=>{let{name:t}=e;return t===n}))throw new Error(`Expected receiver ${n} to exist, but did not find it in the config`);const s=Object.assign({},e,{alertmanager_config:Object.assign({},e.alertmanager_config,{receivers:n?i.map(e=>e.name===n?t:e):[...i,t]})});return s.alertmanager_config.route&&n&&t.name!==n&&(s.alertmanager_config.route=function e(t,n,a){const i=Object.assign({},t);i.receiver===n&&(i.receiver=a);i.routes&&(i.routes=i.routes.map(t=>e(t,n,a)));return i}(s.alertmanager_config.route,n,t.name)),s}function _(e,t,n,a){var i,s,r,o,l;const c={settings:k(Object.assign({},a&&a.type===e.type&&null!==(i=a.settings)&&void 0!==i?i:{},null!==(s=e.settings)&&void 0!==s?s:{})),secureSettings:null!==(r=e.secureSettings)&&void 0!==r?r:{},type:e.type,name:n,disableResolveMessage:null!==(o=null!==(l=e.disableResolveMessage)&&void 0!==l?l:null===a||void 0===a?void 0:a.disableResolveMessage)&&void 0!==o?o:t.disableResolveMessage};return a&&(c.uid=a.uid),c}function k(e){return(0,x.isArray)(e)?e.forEach(k):"object"==typeof e&&null!==e&&Object.entries(e).forEach(t=>{let[n,a]=t;""===a||null===a||void 0===a?delete e[n]:k(a)}),e}var S=n("./.yarn/__virtual__/react-hook-form-virtual-92b6119fd4/0/cache/react-hook-form-npm-7.5.3-f9cc466c62-fbfaa3b664.zip/node_modules/react-hook-form/dist/index.esm.js"),N=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const w=e=>{let{pathPrefix:t,className:n,readOnly:a=!1}=e;const{register:i}=(0,S.Gc)();return(0,N.jsx)("div",{className:n,children:(0,N.jsx)(r.Field,{disabled:a,children:(0,N.jsx)(r.Checkbox,Object.assign({},i(`${t}sendResolved`),{label:"Send resolved",disabled:a,description:"Whether or not to notify about resolved alerts."}))})})};var C=n("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),A=n("./public/app/core/copy/appNotification.ts"),O=n("./public/app/core/hooks/useCleanup.ts");const M=[];function P(e){var t,n;const{name:i,formAPI:s,defaults:r,softDelete:o}=e,{watch:l,getValues:c,reset:d,setValue:u}=s,p=null!==(t=null!==(n=l(i))&&void 0!==n?n:r)&&void 0!==t?t:M,m=(0,a.useCallback)(e=>{const t=JSON.parse(JSON.stringify(c())),n=e(null!==p&&void 0!==p?p:[]);d((0,x.set)(t,i,n))},[c,i,d,p]);return{fields:p,append:(0,a.useCallback)(e=>m(t=>[...t,e]),[m]),remove:(0,a.useCallback)(e=>{o?u(`${i}.${e}.__deleted`,!0):m(t=>{const n=t.slice();return n.splice(e,1),n})},[m,i,u,o])}}var T,$,R,I=n("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts"),L=n("./public/app/features/alerting/unified/utils/misc.ts"),q=n("./public/app/features/alerting/unified/components/rules/ActionIcon.tsx");const F=e=>{let{value:t,onChange:n,readOnly:i=!1}=e;const s=(0,r.useStyles2)(z),[o,l]=(0,a.useState)(D(t));(0,a.useEffect)(()=>l(D(t)),[t]);const c=e=>{n(B(e))},d=(e,t)=>{const n=o[t],a=o.map((n,a)=>a===t?e:n);l(a),(e[0]||n[0])&&c(a)};return(0,N.jsxs)("div",{children:[!!o.length&&(0,N.jsxs)("table",{className:s.table,children:[(0,N.jsx)("thead",{children:(0,N.jsxs)("tr",{children:[T||(T=(0,N.jsx)("th",{children:"Name"})),$||($=(0,N.jsx)("th",{children:"Value"})),!i&&(R||(R=(0,N.jsx)("th",{})))]})}),(0,N.jsx)("tbody",{children:o.map((e,t)=>{let[n,a]=e;return(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{children:(0,N.jsx)(r.Input,{readOnly:i,value:n,onChange:e=>d([e.currentTarget.value,a],t)})}),(0,N.jsx)("td",{children:(0,N.jsx)(r.Input,{readOnly:i,value:a,onChange:e=>d([n,e.currentTarget.value],t)})}),!i&&(0,N.jsx)("td",{children:(0,N.jsx)(q.A,{icon:"trash-alt",tooltip:"delete",onClick:()=>(e=>{const t=o.slice(),n=t.splice(e,1)[0];l(t),n[0]&&c(t)})(t)})})]},t)})})]}),!i&&(0,N.jsx)(r.Button,{className:s.addButton,type:"button",variant:"secondary",icon:"plus",size:"sm",onClick:()=>l([...o,["",""]]),children:"Add"})]})},z=e=>({addButton:C.css`
    margin-top: ${e.spacing(1)};
  `,table:C.css`
    tbody td {
      padding: 0 ${e.spacing(1)} ${e.spacing(1)} 0;
    }
  `}),B=e=>{const t={};for(const[n,a]of e)n&&(t[n]=a);return t},D=e=>Object.entries(null!==e&&void 0!==e?e:{}),V=e=>{let{value:t,onChange:n,readOnly:a=!1}=e;const i=(0,r.useStyles2)(E);return(0,N.jsxs)("div",{children:[!(null===t||void 0===t||!t.length)&&t.map((e,s)=>(0,N.jsxs)("div",{className:i.row,children:[(0,N.jsx)(r.Input,{readOnly:a,value:e,onChange:e=>((e,a)=>{t&&n(t.map((t,n)=>n===a?e:t))})(e.currentTarget.value,s)}),!a&&(0,N.jsx)(q.A,{className:i.deleteIcon,icon:"trash-alt",tooltip:"delete",onClick:()=>(e=>{if(!t)return;const a=t.slice();a.splice(e,1),n(a)})(s)})]},s)),!a&&(0,N.jsx)(r.Button,{className:i.addButton,type:"button",variant:"secondary",icon:"plus",size:"sm",onClick:()=>n([...null!==t&&void 0!==t?t:[],""]),children:"Add"})]})},E=e=>({row:C.css`
    display: flex;
    flex-direction: row;
    margin-bottom: ${e.spacing(1)};
    align-items: center;
  `,deleteIcon:C.css`
    margin-left: ${e.spacing(1)};
  `,addButton:C.css`
    margin-top: ${e.spacing(1)};
  `});var U=n("./public/app/features/alerting/unified/components/CollapseToggle.tsx");const G=e=>{let{label:t,description:n,children:i,className:s,size:o="xl"}=e;const l=(0,r.useStyles2)(W),[c,d]=(0,a.useState)(!0),u=()=>d(!c);return(0,N.jsxs)("div",{className:(0,C.cx)(l.wrapper,s),children:[(0,N.jsxs)("div",{className:l.heading,onClick:u,children:[(0,N.jsx)(U.U,{className:l.caret,size:o,onToggle:u,isCollapsed:c}),(0,N.jsx)("h6",{children:t})]}),n&&(0,N.jsx)("p",{className:l.description,children:n}),(0,N.jsx)("div",{className:c?l.hidden:void 0,children:i})]})},W=e=>({wrapper:C.css`
    margin-top: ${e.spacing(1)};
    padding-bottom: ${e.spacing(1)};
  `,caret:C.css`
    margin-left: -${e.spacing(.5)}; // make it align with fields despite icon size
  `,heading:C.css`
    cursor: pointer;
    h6 {
      display: inline-block;
    }
  `,hidden:C.css`
    display: none;
  `,description:C.css`
    color: ${e.colors.text.secondary};
    font-size: ${e.typography.size.sm};
    font-weight: ${e.typography.fontWeightRegular};
    margin: 0;
  `}),Y=e=>({collapsibleSection:C.css`
    margin: 0;
    padding: 0;
  `,wrapper:C.css`
    margin: ${e.spacing(2,0)};
    padding: ${e.spacing(1)};
    border: solid 1px ${e.colors.border.medium};
    border-radius: ${e.shape.borderRadius(1)};
    position: relative;
  `,description:C.css`
    color: ${e.colors.text.secondary};
    font-size: ${e.typography.size.sm};
    font-weight: ${e.typography.fontWeightRegular};
    margin: 0;
  `,deleteIcon:C.css`
    position: absolute;
    right: ${e.spacing(1)};
    top: ${e.spacing(1)};
  `,addButton:C.css`
    margin-top: ${e.spacing(1)};
  `}),Z=e=>{var t;let{option:n,pathPrefix:a,errors:i,defaultValues:s,readOnly:o=!1}=e;const l=(0,r.useStyles2)(Y),c=`${a}${n.propertyName}`,d=(0,S.Gc)(),{fields:u,append:p,remove:m}=P({name:c,formAPI:d,defaults:s});return(0,N.jsx)("div",{className:l.wrapper,children:(0,N.jsxs)(G,{className:l.collapsibleSection,label:`${n.label} (${u.length})`,description:n.description,children:[(null!==(t=null!==u&&void 0!==u?u:s)&&void 0!==t?t:[]).map((e,t)=>{var a;return(0,N.jsxs)("div",{className:l.wrapper,children:[!o&&(0,N.jsx)(q.A,{"data-testid":`${c}.${t}.delete-button`,icon:"trash-alt",tooltip:"delete",onClick:()=>m(t),className:l.deleteIcon}),null===(a=n.subformOptions)||void 0===a?void 0:a.map(n=>{var a;return(0,N.jsx)(J,{readOnly:o,defaultValue:null===e||void 0===e?void 0:e[n.propertyName],option:n,pathPrefix:`${c}.${t}.`,error:null===i||void 0===i?void 0:null===(a=i[t])||void 0===a?void 0:a[n.propertyName]},n.propertyName)})]},t)}),!o&&(0,N.jsx)(r.Button,{"data-testid":`${c}.add-button`,className:l.addButton,type:"button",variant:"secondary",icon:"plus",size:"sm",onClick:()=>p({__id:String(Math.random())}),children:"Add"})]})})},H=e=>{var t;let{option:n,pathPrefix:i,errors:s,defaultValue:o,readOnly:l=!1}=e;const c=(0,r.useStyles2)(Y),d=`${i}${n.propertyName}`,{watch:u}=(0,S.Gc)(),p=u(d),m=void 0===p?o:p,[h,f]=(0,a.useState)(!!m);return(0,N.jsxs)("div",{className:c.wrapper,"data-testid":`${d}.container`,children:[(0,N.jsx)("h6",{children:n.label}),n.description&&(0,N.jsx)("p",{className:c.description,children:n.description}),h&&(0,N.jsxs)(N.Fragment,{children:[!l&&(0,N.jsx)(q.A,{"data-testid":`${d}.delete-button`,icon:"trash-alt",tooltip:"delete",onClick:()=>f(!1),className:c.deleteIcon}),(null!==(t=n.subformOptions)&&void 0!==t?t:[]).map(e=>(0,N.jsx)(J,{readOnly:l,defaultValue:null===o||void 0===o?void 0:o[e.propertyName],option:e,pathPrefix:`${d}.`,error:null===s||void 0===s?void 0:s[e.propertyName]},e.propertyName))]}),!h&&!l&&(0,N.jsx)(r.Button,{className:c.addButton,type:"button",variant:"secondary",icon:"plus",size:"sm",onClick:()=>f(!0),"data-testid":`${d}.add-button`,children:"Add"})]})},Q=["onChange","ref"];const J=e=>{let{option:t,invalid:n,pathPrefix:a,pathSuffix:i="",error:s,defaultValue:o,readOnly:l=!1}=e;const c=`${a}${i}`;return"subform"===t.element?(0,N.jsx)(H,{readOnly:l,defaultValue:o,option:t,errors:s,pathPrefix:c}):"subform_array"===t.element?(0,N.jsx)(Z,{readOnly:l,defaultValues:o,option:t,pathPrefix:c,errors:s}):(0,N.jsx)(r.Field,{label:"checkbox"!==t.element?t.label:void 0,description:t.description||void 0,invalid:!!s,error:null===s||void 0===s?void 0:s.message,children:(0,N.jsx)(K,{id:`${c}${t.propertyName}`,defaultValue:o,option:t,invalid:n,pathPrefix:c,readOnly:l,pathIndex:a})})},K=e=>{let{option:t,invalid:n,id:i,pathPrefix:s="",pathIndex:o="",readOnly:l=!1}=e;const{control:c,register:d,unregister:u,getValues:p}=(0,S.Gc)(),m=`${s}${t.propertyName}`;switch((0,a.useEffect)(()=>()=>{u(m,{keepValue:!1})},[u,m]),t.element){case"checkbox":return(0,N.jsx)(r.Checkbox,Object.assign({id:i,readOnly:l,disabled:l,className:X.checkbox},d(m),{label:t.label,description:t.description}));case"input":return(0,N.jsx)(r.Input,Object.assign({id:i,readOnly:l||ne(t,p,o),invalid:n,type:t.inputType},d(m,{required:te(t,p,o),validate:e=>""===t.validationRule||ee(e,t.validationRule)}),{placeholder:t.placeholder}));case"select":return(0,N.jsx)(r.InputControl,{render:e=>{var a;let{field:{onChange:i}}=e,s=function(e,t){if(null==e)return{};var n,a,i={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e.field,Q);return(0,N.jsx)(r.Select,Object.assign({disabled:l},s,{options:null!==(a=t.selectOptions)&&void 0!==a?a:void 0,invalid:n,onChange:e=>i(e.value)}))},control:c,name:m});case"textarea":return(0,N.jsx)(r.TextArea,Object.assign({id:i,readOnly:l,invalid:n},d(m,{required:!!t.required&&"Required",validate:e=>""===t.validationRule||ee(e,t.validationRule)})));case"string_array":return(0,N.jsx)(r.InputControl,{render:e=>{let{field:{value:t,onChange:n}}=e;return(0,N.jsx)(V,{readOnly:l,value:t,onChange:n})},control:c,name:m});case"key_value_map":return(0,N.jsx)(r.InputControl,{render:e=>{let{field:{value:t,onChange:n}}=e;return(0,N.jsx)(F,{readOnly:l,value:t,onChange:n})},control:c,name:m});default:return console.error("Element not supported",t.element),null}},X={checkbox:C.css`
    height: auto; // native checkbox has fixed height which does not take into account description
  `},ee=(e,t)=>!!RegExp(t).test(e)||"Invalid format",te=(e,t,n)=>{if(!e.dependsOn)return!!e.required&&"Required";if((0,x.isEmpty)(t(`${n}secureFields`))){const a=t(`${n}secureSettings.${e.dependsOn}`);return!(Boolean(a)||!e.required)&&"Required"}return!(t(`${n}secureFields.${e.dependsOn}`)||!e.required)&&"Required"},ne=(e,t,n)=>!!e.dependsOn&&((0,x.isEmpty)(t(`${n}secureFields`))?t(`${n}secureSettings.${e.dependsOn}`):t(`${n}secureFields.${e.dependsOn}`));function ae(e){let{defaultValues:t,selectedChannelOptions:n,onResetSecureField:a,secureFields:i,errors:s,pathPrefix:o="",readOnly:l=!1}=e;const{watch:c}=(0,S.Gc)(),d=c();return(0,N.jsx)(N.Fragment,{children:n.map((e,n)=>{var c,u;const p=`${e.label}-${n}`,m=d[`${o}settings.${e.showWhen.field}`];if(e.showWhen.field&&m!==e.showWhen.is)return null;if(i&&i[e.propertyName])return(0,N.jsx)(r.Field,{label:e.label,description:e.description||void 0,children:(0,N.jsx)(r.Input,{readOnly:!0,value:"Configured",suffix:l?null:(0,N.jsx)(r.Button,{onClick:()=>a(e.propertyName),fill:"text",type:"button",size:"sm",children:"Clear"})})},p);const h=null===(c=e.secure?null===s||void 0===s?void 0:s.secureSettings:null===s||void 0===s?void 0:s.settings)||void 0===c?void 0:c[e.propertyName],f=null===t||void 0===t?void 0:null===(u=t.settings)||void 0===u?void 0:u[e.propertyName];return(0,N.jsx)(J,{defaultValue:f,readOnly:l,error:h,pathPrefix:o,pathSuffix:e.secure?"secureSettings.":"settings.",option:e},p)})})}const ie=["ref","onChange"];function se(e){var t;let{defaultValues:n,pathPrefix:i,onDuplicate:s,onDelete:o,onTest:l,notifiers:c,errors:d,secureFields:u,commonSettingsComponent:p,readOnly:m=!1}=e;const h=(0,r.useStyles2)(re),f=e=>`${i}${e}`,{control:g,watch:v,register:x,trigger:b,formState:y,setValue:j}=(0,S.Gc)(),_=null!==(t=v(f("type")))&&void 0!==t?t:n.type,{loading:k}=(0,I._)(e=>e.testReceivers);(0,a.useEffect)(()=>{x(`${i}.__id`),x(`${i}.secureFields`)},[x,i]);const[w,C]=(0,a.useState)(null!==u&&void 0!==u?u:{}),A=e=>{if(w[e]){const t=Object.assign({},u);delete t[e],C(t),j(`${i}.secureFields`,t)}},O=(0,a.useMemo)(()=>c.map(e=>{let{name:t,type:n}=e;return{label:t,value:n}}).sort((e,t)=>e.label.localeCompare(t.label)),[c]),M=c.find(e=>{let{type:t}=e;return t===_}),P=null===M||void 0===M?void 0:M.options.filter(e=>e.required),T=null===M||void 0===M?void 0:M.options.filter(e=>!e.required),$=`contact-point-type-${i}`;return(0,N.jsxs)("div",{className:h.wrapper,"data-testid":"item-container",children:[(0,N.jsxs)("div",{className:h.topRow,children:[(0,N.jsx)("div",{children:(0,N.jsx)(r.Field,{label:"Contact point type",htmlFor:$,"data-testid":`${i}type`,children:(0,N.jsx)(r.InputControl,{name:f("type"),defaultValue:n.type,render:e=>{let{field:{onChange:t}}=e,n=function(e,t){if(null==e)return{};var n,a,i={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e.field,ie);return(0,N.jsx)(r.Select,Object.assign({disabled:m,inputId:$},n,{width:37,options:O,onChange:e=>t(null===e||void 0===e?void 0:e.value)}))},control:g,rules:{required:!0}})})}),!m&&(0,N.jsxs)("div",{className:h.buttons,children:[l&&(0,N.jsx)(r.Button,{disabled:k,size:"xs",variant:"secondary",type:"button",onClick:()=>(async()=>{await b(),0===Object.keys(y.errors).length&&l&&l()})(),icon:k?"fa fa-spinner":"message",children:"Test"}),(0,N.jsx)(r.Button,{size:"xs",variant:"secondary",type:"button",onClick:()=>s(),icon:"copy",children:"Duplicate"}),o&&(0,N.jsx)(r.Button,{"data-testid":`${i}delete-button`,size:"xs",variant:"secondary",type:"button",onClick:()=>o(),icon:"trash-alt",children:"Delete"})]})]}),M&&(0,N.jsxs)("div",{className:h.innerContent,children:[(0,N.jsx)(ae,{defaultValues:n,selectedChannelOptions:null!==P&&void 0!==P&&P.length?P:T,secureFields:w,errors:d,onResetSecureField:A,pathPrefix:i,readOnly:m}),!(null===P||void 0===P||!P.length||null===T||void 0===T||!T.length)&&(0,N.jsxs)(G,{label:`Optional ${M.name} settings`,children:[""!==M.info&&(0,N.jsx)(r.Alert,{title:"",severity:"info",children:M.info}),(0,N.jsx)(ae,{defaultValues:n,selectedChannelOptions:T,secureFields:w,onResetSecureField:A,errors:d,pathPrefix:i,readOnly:m})]}),(0,N.jsx)(G,{label:"Notification settings",children:(0,N.jsx)(p,{pathPrefix:i,readOnly:m})})]})]})}const re=e=>({buttons:C.css`
    & > * + * {
      margin-left: ${e.spacing(1)};
    }
  `,innerContent:C.css`
    max-width: 536px;
  `,wrapper:C.css`
    margin: ${e.spacing(2,0)};
    padding: ${e.spacing(1)};
    border: solid 1px ${e.colors.border.medium};
    border-radius: ${e.shape.borderRadius(1)};
    max-width: ${e.breakpoints.values.xl}${e.breakpoints.unit};
  `,topRow:C.css`
    display: flex;
    flex-direction: row;
    justify-content: space-between;
  `,channelSettingsHeader:C.css`
    margin-top: ${e.spacing(2)};
  `});function oe(e){let{pathPrefix:t}=e;const{register:n}=(0,S.Gc)();return(0,a.useEffect)(()=>{n(`${t}.__id`),n(`${t}.__deleted`)},[n,t]),(0,N.jsx)(N.Fragment,{})}var le,ce,de;function ue(e){let{config:t,initialValues:n,defaultItem:i,notifiers:s,alertManagerSourceName:o,onSubmit:l,onTestChannel:c,takenReceiverNames:u,commonSettingsComponent:p}=e;const m=(0,A.iG)(),h=(0,r.useStyles2)(pe),f=(0,d.RY)(o),g=n||{name:"",items:[Object.assign({},i,{__id:String(Math.random())})]},v=(0,S.cI)({defaultValues:JSON.parse(JSON.stringify(g))});(0,O.x)(e=>e.unifiedAlerting.saveAMConfig);const{loading:x}=(0,I._)(e=>e.saveAMConfig),{handleSubmit:b,register:y,formState:{errors:j},getValues:_}=v,{fields:k,append:w,remove:C}=P({name:"items",formAPI:v,softDelete:!0}),M=(0,a.useCallback)(e=>!u.map(e=>e.trim().toLowerCase()).includes(e.trim().toLowerCase())||"Another receiver with this name already exists.",[u]);return(0,N.jsxs)(S.RV,Object.assign({},v,{children:[!t.alertmanager_config.route&&(le||(le=(0,N.jsx)(r.Alert,{severity:"warning",title:"Attention",children:"Because there is no default policy configured yet, this contact point will automatically be set as default."}))),(0,N.jsxs)("form",{onSubmit:b(e=>{l(Object.assign({},e,{items:e.items.filter(e=>!e.__deleted)}))},()=>{m.error("There are errors in the form. Please correct them and try again!")}),children:[(0,N.jsx)("h4",{className:h.heading,children:f?"Contact point":n?"Update contact point":"Create contact point"}),(0,N.jsx)(r.Field,{label:"Name",invalid:!!j.name,error:j.name&&j.name.message,required:!0,children:(0,N.jsx)(r.Input,Object.assign({readOnly:f,id:"name"},y("name",{required:"Name is required",validate:{nameIsAvailable:M}}),{width:39,placeholder:"Name"}))}),k.map((e,t)=>{var a;const i=`items.${t}.`;if(e.__deleted)return(0,N.jsx)(oe,{pathPrefix:i},e.__id);const r=null===n||void 0===n?void 0:n.items.find(t=>{let{__id:n}=t;return n===e.__id});return(0,N.jsx)(se,{defaultValues:e,onDuplicate:()=>{const e=_().items[t];w(Object.assign({},e,{__id:String(Math.random())}))},onTest:c?()=>{const e=_().items[t];c(e)}:void 0,onDelete:()=>C(t),pathPrefix:i,notifiers:s,secureFields:null===r||void 0===r?void 0:r.secureFields,errors:null===j||void 0===j?void 0:null===(a=j.items)||void 0===a?void 0:a[t],commonSettingsComponent:p,readOnly:f},e.__id)}),(0,N.jsxs)(N.Fragment,{children:[!f&&(0,N.jsx)(r.Button,{type:"button",icon:"plus",variant:"secondary",onClick:()=>w(Object.assign({},i,{__id:String(Math.random())})),children:"New contact point type"}),(0,N.jsxs)("div",{className:h.buttons,children:[!f&&(0,N.jsxs)(N.Fragment,{children:[x&&(ce||(ce=(0,N.jsx)(r.Button,{disabled:!0,icon:"fa fa-spinner",variant:"primary",children:"Saving..."}))),!x&&(de||(de=(0,N.jsx)(r.Button,{type:"submit",children:"Save contact point"})))]}),(0,N.jsx)(r.LinkButton,{disabled:x,fill:"outline",variant:"secondary","data-testid":"cancel-button",href:(0,L.eQ)("alerting/notifications",o),children:"Cancel"})]})]})]})]}))}const pe=e=>({heading:C.css`
    margin: ${e.spacing(4,0)};
  `,buttons:C.css`
    margin-top: ${e.spacing(4)};

    & > * + * {
      margin-left: ${e.spacing(1)};
    }
  `});var me;const he=Object.freeze({__id:"",sendResolved:!0,secureSettings:{},settings:{},secureFields:{},type:"email"}),fe=e=>{let{existing:t,alertManagerSourceName:n,config:s}=e;const o=(0,i.useDispatch)(),l=(0,d.RY)(n),[c]=(0,a.useMemo)(()=>t?y(t,g):[void 0,{}],[t]),p=(0,a.useMemo)(()=>{var e,n;return null!==(e=null===(n=s.alertmanager_config.receivers)||void 0===n?void 0:n.map(e=>{let{name:t}=e;return t}).filter(e=>e!==(null===t||void 0===t?void 0:t.name)))&&void 0!==e?e:[]},[s,t]);return(0,N.jsxs)(N.Fragment,{children:[!l&&(me||(me=(0,N.jsx)(r.Alert,{title:"Info",severity:"info",children:"Note that empty string values will be replaced with global defaults where appropriate."}))),(0,N.jsx)(ue,{config:s,onSubmit:e=>{const a=function(e,t){const n={name:e.name};return e.items.forEach(e=>{let{__id:a,type:i,settings:s,sendResolved:r}=e;const o=k(Object.assign({},s,{send_resolved:null!==r&&void 0!==r?r:t.sendResolved})),l=`${i}_configs`;n[l]?n[l].push(o):n[l]=[o]}),n}(e,he);o((0,u.mM)({newConfig:j(s,a,null===t||void 0===t?void 0:t.name),oldConfig:s,alertManagerSourceName:n,successMessage:t?"Contact point updated.":"Contact point created.",redirectPath:"/alerting/notifications"}))},initialValues:c,notifiers:g,alertManagerSourceName:n,defaultItem:he,takenReceiverNames:p,commonSettingsComponent:w})]})},ge=e=>{let{pathPrefix:t,className:n}=e;const{register:a}=(0,S.Gc)();return(0,N.jsx)("div",{className:n,children:(0,N.jsx)(r.Field,{children:(0,N.jsx)(r.Checkbox,Object.assign({},a(`${t}disableResolveMessage`),{label:"Disable resolved message",description:"Disable the resolve message [OK] that is sent when alerting state returns to false"}))})})};var ve,xe,be,ye,je,_e,ke=n("./public/app/features/alerting/unified/components/rule-editor/AnnotationsField.tsx"),Se=n("./public/app/features/alerting/unified/components/rule-editor/LabelsField.tsx");!function(e){e.predefined="Predefined",e.custom="Custom"}(_e||(_e={}));const Ne=Object.values(_e).map(e=>({label:e,value:e})),we={annotations:[{key:"",value:""}],labels:[{key:"",value:""}]},Ce=e=>{let{isOpen:t,onDismiss:n,onTest:i}=e;const[s,o]=(0,a.useState)(_e.predefined),l=(0,r.useStyles2)(Ae),c=(0,S.cI)({defaultValues:we,mode:"onBlur"});return(0,N.jsxs)(r.Modal,{onDismiss:n,isOpen:t,title:"Test contact point",children:[(0,N.jsxs)("div",{className:l.section,children:[ve||(ve=(0,N.jsx)(r.Label,{children:"Notification message"})),(0,N.jsx)(r.RadioButtonGroup,{options:Ne,value:s,onChange:e=>o(e)})]}),(0,N.jsx)(S.RV,Object.assign({},c,{children:(0,N.jsxs)("form",{onSubmit:c.handleSubmit(e=>{if(s===_e.custom){const t={annotations:e.annotations.filter(e=>{let{key:t,value:n}=e;return!!t&&!!n}).reduce((e,t)=>{let{key:n,value:a}=t;return Object.assign({},e,{[n]:a})},{}),labels:e.labels.filter(e=>{let{key:t,value:n}=e;return!!t&&!!n}).reduce((e,t)=>{let{key:n,value:a}=t;return Object.assign({},e,{[n]:a})},{})};i(t)}else i()}),children:[s===_e.predefined&&(0,N.jsxs)("div",{className:l.section,children:["You will send a test notification that uses a predefined alert. If you have defined a custom template or message, for better results switch to ",xe||(xe=(0,N.jsx)("strong",{children:"custom"}))," notification message, from above."]}),s===_e.custom&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("div",{className:l.section,children:"You will send a test notification that uses the annotations defined below. This is a good option if you use custom templates and messages."}),(0,N.jsx)("div",{className:l.section,children:be||(be=(0,N.jsx)(ke.Z,{}))}),(0,N.jsx)("div",{className:l.section,children:ye||(ye=(0,N.jsx)(Se.Z,{}))})]}),je||(je=(0,N.jsx)(r.Modal.ButtonRow,{children:(0,N.jsx)(r.Button,{type:"submit",children:"Send test notification"})}))]})}))]})},Ae=e=>({flexRow:C.css`
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    margin-bottom: ${e.spacing(1)};
  `,section:C.css`
    margin-bottom: ${e.spacing(2)};
  `});var Oe;const Me=Object.freeze({__id:"",secureSettings:{},settings:{},secureFields:{},disableResolveMessage:!1,type:"email"}),Pe=e=>{let{existing:t,alertManagerSourceName:n,config:s}=e;const o=(0,I._)(e=>e.grafanaNotifiers),[l,c]=(0,a.useState)(),p=(0,i.useDispatch)();(0,a.useEffect)(()=>{o.result||o.loading||p((0,u.Vj)())},[o,p]);const[m,h]=(0,a.useMemo)(()=>t&&o.result?b(t,o.result):[void 0,{}],[t,o.result]),f=e=>{const n=function(e,t,n){var a;return{name:e.name,grafana_managed_receiver_configs:(null!==(a=e.items)&&void 0!==a?a:[]).map(a=>{const i=t[a.__id];return _(a,n,e.name,i)})}}(e,h,Me);p((0,u.mM)({newConfig:j(s,n,null===t||void 0===t?void 0:t.name),oldConfig:s,alertManagerSourceName:d.GC,successMessage:t?"Contact point updated.":"Contact point created",redirectPath:"/alerting/notifications"}))},g=e=>{c(e)},v=(0,a.useMemo)(()=>{var e,n;return null!==(e=null===(n=s.alertmanager_config.receivers)||void 0===n?void 0:n.map(e=>{let{name:t}=e;return t}).filter(e=>e!==(null===t||void 0===t?void 0:t.name)))&&void 0!==e?e:[]},[s,t]);return o.result?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(ue,{config:s,onSubmit:f,initialValues:m,onTestChannel:g,notifiers:o.result,alertManagerSourceName:n,defaultItem:Me,takenReceiverNames:v,commonSettingsComponent:ge}),(0,N.jsx)(Ce,{onDismiss:()=>c(void 0),isOpen:!!l,onTest:e=>(e=>{if(l){const t=h[l.__id],a=_(l,Me,"test",t),i={alertManagerSourceName:n,receivers:[{name:"test",grafana_managed_receiver_configs:[a]}],alert:e};p((0,u.D8)(i))}})(e)})]}):Oe||(Oe=(0,N.jsx)(r.LoadingPlaceholder,{text:"Loading notifiers..."}))};var Te;const $e=e=>{var t;let{config:n,receiverName:a,alertManagerSourceName:i}=e;const s=null===(t=n.alertmanager_config.receivers)||void 0===t?void 0:t.find(e=>{let{name:t}=e;return t===a});return s?i===d.GC?(0,N.jsx)(Pe,{config:n,alertManagerSourceName:i,existing:s}):(0,N.jsx)(fe,{config:n,alertManagerSourceName:i,existing:s}):Te||(Te=(0,N.jsx)(r.InfoBox,{severity:"error",title:"Receiver not found",children:"Sorry, this receiver does not seem to exit."}))};var Re,Ie;const Le=Object.freeze({name:"",content:""}),qe=e=>{var t,n,a,s,o;let{existing:l,alertManagerSourceName:c,config:d}=e;const p=(0,r.useStyles2)(Fe),m=(0,i.useDispatch)();(0,O.x)(e=>e.unifiedAlerting.saveAMConfig);const{loading:h,error:f}=(0,I._)(e=>e.saveAMConfig),{handleSubmit:g,register:v,formState:{errors:x}}=(0,S.cI)({mode:"onSubmit",defaultValues:null!==l&&void 0!==l?l:Le});return(0,N.jsxs)("form",{onSubmit:g(e=>{var t;const n=function(e,t){let n=t.trim();return n.match(/\{\{\s*define/)||(n=`{{ define "${e}" }}\n${n.split("\n").map(e=>"  "+e).join("\n")}\n{{ end }}`),n}(e.name,e.content),a=Object.assign({},d.template_files,{[e.name]:n});l&&l.name!==e.name&&delete a[l.name];const i=[...(null!==(t=d.alertmanager_config.templates)&&void 0!==t?t:[]).filter(e=>e!==(null===l||void 0===l?void 0:l.name)),e.name],s={template_files:a,alertmanager_config:Object.assign({},d.alertmanager_config,{templates:i})};m((0,u.mM)({alertManagerSourceName:c,newConfig:s,oldConfig:d,successMessage:"Template saved.",redirectPath:"/alerting/notifications"}))}),children:[(0,N.jsx)("h4",{children:l?"Edit message template":"Create message template"}),f&&(0,N.jsx)(r.Alert,{severity:"error",title:"Error saving template",children:f.message||(null===f||void 0===f?void 0:null===(t=f.data)||void 0===t?void 0:t.message)||String(f)}),(0,N.jsx)(r.Field,{label:"Template name",error:null===x||void 0===x?void 0:null===(n=x.name)||void 0===n?void 0:n.message,invalid:!(null===(a=x.name)||void 0===a||!a.message),required:!0,children:(0,N.jsx)(r.Input,Object.assign({},v("name",{required:{value:!0,message:"Required."},validate:{nameIsUnique:e=>!d.template_files[e]||(null===l||void 0===l?void 0:l.name)===e||"Another template with this name already exists."}}),{placeholder:"Give your template a name",width:42,autoFocus:!0}))}),(0,N.jsx)(r.Field,{description:(0,N.jsxs)(N.Fragment,{children:["You can use the"," ",(0,N.jsx)("a",{href:"https://pkg.go.dev/text/template?utm_source=godoc",target:"__blank",rel:"noreferrer",className:p.externalLink,children:"Go templating language"}),"."," ",(0,N.jsx)("a",{href:"https://prometheus.io/blog/2016/03/03/custom-alertmanager-templates/",target:"__blank",rel:"noreferrer",className:p.externalLink,children:"More info about alertmanager templates"})]}),label:"Content",error:null===x||void 0===x?void 0:null===(s=x.content)||void 0===s?void 0:s.message,invalid:!(null===(o=x.content)||void 0===o||!o.message),required:!0,children:(0,N.jsx)(r.TextArea,Object.assign({},v("content",{required:{value:!0,message:"Required."}}),{className:p.textarea,placeholder:"Message",rows:12}))}),(0,N.jsxs)("div",{className:p.buttons,children:[h&&(Re||(Re=(0,N.jsx)(r.Button,{disabled:!0,icon:"fa fa-spinner",variant:"primary",children:"Saving..."}))),!h&&(Ie||(Ie=(0,N.jsx)(r.Button,{type:"submit",variant:"primary",children:"Save template"}))),(0,N.jsx)(r.LinkButton,{disabled:h,href:(0,L.eQ)("alerting/notifications",c),variant:"secondary",type:"button",fill:"outline",children:"Cancel"})]})]})},Fe=e=>({externalLink:C.css`
    color: ${e.colors.text.secondary};
    text-decoration: underline;
  `,buttons:C.css`
    & > * + * {
      margin-left: ${e.spacing(1)};
    }
  `,textarea:C.css`
    max-width: 758px;
  `});var ze;const Be=e=>{var t;let{config:n,templateName:a,alertManagerSourceName:i}=e;const s=null===(t=n.template_files)||void 0===t?void 0:t[a];return s?(0,N.jsx)(qe,{alertManagerSourceName:i,config:n,existing:{name:a,content:s}}):ze||(ze=(0,N.jsx)(r.InfoBox,{severity:"error",title:"Template not found",children:"Sorry, this template does not seem to exit."}))};var De,Ve;const Ee={smtp_require_tls:!0},Ue=e=>{var t;let{config:n,alertManagerSourceName:a}=e;const s=(0,i.useDispatch)();(0,O.x)(e=>e.unifiedAlerting.saveAMConfig);const{loading:o,error:l}=(0,I._)(e=>e.saveAMConfig),c=(0,d.RY)(a),p=(0,r.useStyles2)(Ge),m=(0,S.cI)({defaultValues:JSON.parse(JSON.stringify(Object.assign({},Ee,null!==(t=n.alertmanager_config.global)&&void 0!==t?t:{})))}),{handleSubmit:h,formState:{errors:f}}=m;return(0,N.jsx)(S.RV,Object.assign({},m,{children:(0,N.jsxs)("form",{onSubmit:h(e=>{s((0,u.mM)({newConfig:Object.assign({},n,{alertmanager_config:Object.assign({},n.alertmanager_config,{global:k(e)})}),oldConfig:n,alertManagerSourceName:a,successMessage:"Global config updated.",redirectPath:(0,L.eQ)("/alerting/notifications",a)}))}),children:[(0,N.jsx)("h4",{className:p.heading,children:"Global config"}),l&&(0,N.jsx)(r.Alert,{severity:"error",title:"Error saving receiver",children:l.message||String(l)}),v.map(e=>(0,N.jsx)(J,{readOnly:c,defaultValue:Ee[e.propertyName],option:e,error:f[e.propertyName],pathPrefix:""},e.propertyName)),(0,N.jsx)("div",{children:(0,N.jsxs)(r.HorizontalGroup,{children:[!c&&(0,N.jsxs)(N.Fragment,{children:[o&&(De||(De=(0,N.jsx)(r.Button,{disabled:!0,icon:"fa fa-spinner",variant:"primary",children:"Saving..."}))),!o&&(Ve||(Ve=(0,N.jsx)(r.Button,{type:"submit",children:"Save global config"})))]}),(0,N.jsx)(r.LinkButton,{disabled:o,fill:"outline",variant:"secondary",href:(0,L.eQ)("alerting/notifications",a),children:"Cancel"})]})})]})}))},Ge=e=>({heading:C.css`
    margin: ${e.spacing(4,0)};
  `}),We=e=>{let{alertManagerSourceName:t,config:n}=e;return t===d.GC?(0,N.jsx)(Pe,{alertManagerSourceName:t,config:n}):(0,N.jsx)(fe,{alertManagerSourceName:t,config:n})},Ye=e=>{let{config:t,alertManagerSourceName:n}=e;return(0,N.jsx)(qe,{config:t,alertManagerSourceName:n})};var Ze=n("./public/app/types/index.ts"),He=n("./public/app/features/alerting/unified/components/Authorize.tsx"),Qe=n("./public/app/core/services/context_srv.ts"),Je=n("./public/app/features/alerting/unified/styles/table.ts"),Ke=n("./public/app/features/alerting/unified/utils/access-control.ts"),Xe=n("./public/app/features/alerting/unified/utils/alertmanager.ts");const et={pagerduty:"PagerDuty",pushover:"Pushover",slack:"Slack",opsgenie:"OpsGenie",webhook:"Webhook",victorops:"VictorOps",wechat:"WeChat"};function tt(e,t){var n;return e.grafana_managed_receiver_configs?function(e,t){return e.map(e=>e.type).map(e=>{var n,a;return null!==(n=null===(a=t.find(t=>t.type===e))||void 0===a?void 0:a.name)&&void 0!==n?n:(0,x.capitalize)(e)}).reduce((e,t)=>{var n;return Object.assign({},e,{[t]:(null!==(n=e[t])&&void 0!==n?n:0)+1})},{})}(null!==(n=e.grafana_managed_receiver_configs)&&void 0!==n?n:[],t):function(e){return Object.entries(e).filter(e=>{let[t]=e;return"grafana_managed_receiver_configs"!==t&&t.endsWith("_configs")}).filter(e=>{let[t,n]=e;return Array.isArray(n)&&!!n.length}).reduce((e,t)=>{var n,a;let[i,s]=t;const r=i.replace("_configs",""),o=null!==(n=et[r])&&void 0!==n?n:(0,x.capitalize)(r);return Object.assign({},e,{[o]:(null!==(a=e[o])&&void 0!==a?a:0)+(Array.isArray(s)?s.length:1)})},{})}(e)}var nt=n("./.yarn/__virtual__/react-router-dom-virtual-e45eb1b58b/0/cache/react-router-dom-npm-5.3.0-aa9adb5bec-47584fd629.zip/node_modules/react-router-dom/esm/react-router-dom.js");const at=e=>{let{className:t,title:n,description:a,addButtonLabel:i,addButtonTo:s,children:o,showButton:l=!0}=e;const c=(0,r.useStyles2)(it);return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)("div",{className:(0,C.cx)(c.heading,t),children:[(0,N.jsxs)("div",{children:[(0,N.jsx)("h4",{children:n}),(0,N.jsx)("p",{className:c.description,children:a})]}),l&&(0,N.jsx)(nt.Link,{to:s,children:(0,N.jsx)(r.Button,{type:"button",icon:"plus",children:i})})]}),o]})},it=e=>({heading:C.css`
    display: flex;
    justify-content: space-between;
  `,description:C.css`
    color: ${e.colors.text.secondary};
  `});var st,rt,ot,lt,ct,dt,ut,pt;const mt=e=>{let{config:t,alertManagerName:n}=e;const s=(0,i.useDispatch)(),o=(0,r.useStyles2)(Je.D),l=(0,r.useStyles2)(ht),c=(0,d.RY)(n),p=(0,Ke.Ko)(n),m=(0,I._)(e=>e.grafanaNotifiers),[h,f]=(0,a.useState)(),[g,v]=(0,a.useState)(!1),x=(0,a.useMemo)(()=>{var e,n;return null!==(e=null===(n=t.alertmanager_config.receivers)||void 0===n?void 0:n.map(e=>{var t;return{name:e.name,types:Object.entries(tt(e,null!==(t=m.result)&&void 0!==t?t:[])).map(e=>{let[t,n]=e;return n>1?`${t} (${n})`:t})}}))&&void 0!==e?e:[]},[t,m.result]);return(0,N.jsxs)(at,{className:l.section,title:"Contact points",description:"Define where the notifications will be sent to, for example email or Slack.",showButton:!c&&Qe.Vt.hasPermission(p.create),addButtonLabel:"New contact point",addButtonTo:(0,L.eQ)("/alerting/notifications/receivers/new",n),children:[(0,N.jsxs)("table",{className:o.table,"data-testid":"receivers-table",children:[(0,N.jsxs)("colgroup",{children:[st||(st=(0,N.jsx)("col",{})),rt||(rt=(0,N.jsx)("col",{})),(0,N.jsx)(He.q,{actions:[p.update,p.delete],children:ot||(ot=(0,N.jsx)("col",{}))})]}),(0,N.jsx)("thead",{children:(0,N.jsxs)("tr",{children:[lt||(lt=(0,N.jsx)("th",{children:"Contact point name"})),ct||(ct=(0,N.jsx)("th",{children:"Type"})),(0,N.jsx)(He.q,{actions:[p.update,p.delete],children:dt||(dt=(0,N.jsx)("th",{children:"Actions"}))})]})}),(0,N.jsxs)("tbody",{children:[!x.length&&(0,N.jsx)("tr",{className:o.evenRow,children:ut||(ut=(0,N.jsx)("td",{colSpan:3,children:"No receivers defined."}))}),x.map((e,a)=>(0,N.jsxs)("tr",{className:a%2==0?o.evenRow:void 0,children:[(0,N.jsx)("td",{children:e.name}),(0,N.jsx)("td",{children:e.types.join(", ")}),(0,N.jsx)(He.q,{actions:[p.update,p.delete],children:(0,N.jsxs)("td",{className:o.actionsCell,children:[!c&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(He.q,{actions:[p.update],children:(0,N.jsx)(q.A,{"aria-label":"Edit","data-testid":"edit",to:(0,L.eQ)(`/alerting/notifications/receivers/${encodeURIComponent(e.name)}/edit`,n),tooltip:"Edit contact point",icon:"pen"})}),(0,N.jsx)(He.q,{actions:[p.delete],children:(0,N.jsx)(q.A,{onClick:()=>(e=>{(0,Xe.nv)(e,t)?v(!0):f(e)})(e.name),tooltip:"Delete contact point",icon:"trash-alt"})})]}),c&&(0,N.jsx)(He.q,{actions:[p.update],children:(0,N.jsx)(q.A,{"data-testid":"view",to:(0,L.eQ)(`/alerting/notifications/receivers/${encodeURIComponent(e.name)}/edit`,n),tooltip:"View contact point",icon:"file-alt"})})]})})]},e.name))]})]}),!!g&&(0,N.jsxs)(r.Modal,{isOpen:!0,title:"Cannot delete contact point",onDismiss:()=>v(!1),children:[pt||(pt=(0,N.jsx)("p",{children:"Contact point cannot be deleted because it is used in more policies. Please update or delete these policies first."})),(0,N.jsx)(r.Modal.ButtonRow,{children:(0,N.jsx)(r.Button,{variant:"secondary",onClick:()=>v(!1),fill:"outline",children:"Close"})})]}),!!h&&(0,N.jsx)(r.ConfirmModal,{isOpen:!0,title:"Delete contact point",body:`Are you sure you want to delete contact point "${h}"?`,confirmText:"Yes, delete",onConfirm:()=>{h&&s((0,u.X4)(h,n)),f(void 0)},onDismiss:()=>f(void 0)})]})},ht=e=>({section:C.css`
    margin-top: ${e.spacing(4)};
  `});var ft,gt,vt,xt,bt,yt,jt,_t=n("./public/app/features/alerting/unified/components/DetailsField.tsx");const kt=e=>{let{config:t,alertManagerName:n}=e;const s=(0,i.useDispatch)(),[o,l]=(0,a.useState)({}),c=(0,r.useStyles2)(Je.D),d=(0,Ke.Ko)(n),p=(0,a.useMemo)(()=>Object.entries(t.template_files),[t]),[m,h]=(0,a.useState)();return(0,N.jsxs)(at,{title:"Message templates",description:"Templates construct the messages that get sent to the contact points.",addButtonLabel:"New template",addButtonTo:(0,L.eQ)("/alerting/notifications/templates/new",n),showButton:Qe.Vt.hasPermission(d.create),children:[(0,N.jsxs)("table",{className:c.table,"data-testid":"templates-table",children:[(0,N.jsxs)("colgroup",{children:[(0,N.jsx)("col",{className:c.colExpand}),ft||(ft=(0,N.jsx)("col",{})),gt||(gt=(0,N.jsx)("col",{}))]}),(0,N.jsx)("thead",{children:(0,N.jsxs)("tr",{children:[vt||(vt=(0,N.jsx)("th",{})),xt||(xt=(0,N.jsx)("th",{children:"Template"})),(0,N.jsx)(He.q,{actions:[d.update,d.delete],children:bt||(bt=(0,N.jsx)("th",{children:"Actions"}))})]})}),(0,N.jsxs)("tbody",{children:[!p.length&&(0,N.jsx)("tr",{className:c.evenRow,children:yt||(yt=(0,N.jsx)("td",{colSpan:3,children:"No templates defined."}))}),p.map((e,t)=>{let[i,s]=e;const r=!!o[i];return(0,N.jsxs)(a.Fragment,{children:[(0,N.jsxs)("tr",{className:t%2==0?c.evenRow:void 0,children:[(0,N.jsx)("td",{children:(0,N.jsx)(U.U,{isCollapsed:!o[i],onToggle:()=>l(Object.assign({},o,{[i]:!r}))})}),(0,N.jsx)("td",{children:i}),(0,N.jsx)(He.q,{actions:[d.update,d.delete],children:(0,N.jsxs)("td",{className:c.actionsCell,children:[(0,N.jsx)(He.q,{actions:[d.update],children:(0,N.jsx)(q.A,{to:(0,L.eQ)(`/alerting/notifications/templates/${encodeURIComponent(i)}/edit`,n),tooltip:"edit template",icon:"pen"})}),(0,N.jsx)(He.q,{actions:[d.delete],children:(0,N.jsx)(q.A,{onClick:()=>h(i),tooltip:"delete template",icon:"trash-alt"})})]})})]},i),r&&(0,N.jsxs)("tr",{className:t%2==0?c.evenRow:void 0,children:[jt||(jt=(0,N.jsx)("td",{})),(0,N.jsx)("td",{colSpan:2,children:(0,N.jsx)(_t.C,{label:"Description",horizontal:!0,children:(0,N.jsx)("pre",{children:s})})})]})]},i)})]})]}),!!m&&(0,N.jsx)(r.ConfirmModal,{isOpen:!0,title:"Delete template",body:`Are you sure you want to delete template "${m}"?`,confirmText:"Yes, delete",onConfirm:()=>{m&&s((0,u.S6)(m,n)),h(void 0)},onDismiss:()=>h(void 0)})]})};var St;const Nt=e=>{let{config:t,alertManagerName:n}=e;const a=n!==d.GC,i=(0,r.useStyles2)(wt),s=(0,d.RY)(n);return(0,N.jsxs)(N.Fragment,{children:[!s&&(0,N.jsx)(kt,{config:t,alertManagerName:n}),(0,N.jsx)(mt,{config:t,alertManagerName:n}),a&&(0,N.jsx)(He.q,{actions:[Ze.bW.AlertingNotificationsExternalWrite],children:(0,N.jsxs)(r.Alert,{className:i.section,severity:"info",title:"Global config for contact points",children:[St||(St=(0,N.jsx)("p",{children:"For each external Alertmanager you can define global settings, like server addresses, usernames and password, for all the supported contact points."})),(0,N.jsx)(r.LinkButton,{href:(0,L.eQ)("alerting/notifications/global-config",n),variant:"secondary",children:s?"View global config":"Edit global config"})]})})]})},wt=e=>({section:C.css`
    margin-top: ${e.spacing(4)};
  `});var Ct,At,Ot=n("./public/app/features/alerting/unified/hooks/useAlertManagerSourceName.ts"),Mt=n("./public/app/features/alerting/unified/hooks/useAlertManagerSources.ts"),Pt=n("./public/app/features/alerting/unified/utils/redux.ts");const Tt=(0,r.withErrorBoundary)(()=>{const e=(0,Mt.k)("notification"),[t,n]=(0,Ot.k)(e),p=(0,i.useDispatch)(),m=(0,s.TH)().pathname.endsWith("/alerting/notifications"),h=(0,I._)(e=>e.amConfigs),{result:f,loading:g,error:v}=t&&h[t]||Pt.oq,x=(0,I._)(e=>e.grafanaNotifiers),b=m||!f;(0,a.useEffect)(()=>{t&&b&&p((0,u.Yh)(t))},[t,p,b]),(0,a.useEffect)(()=>{t!==d.GC||x.result||x.loading||x.error||p((0,u.Vj)())},[t,p,x]);const y=!m;return t?(0,N.jsxs)(l.J,{pageId:"receivers",children:[(0,N.jsx)(o.P,{current:t,disabled:y,onChange:n,dataSources:e}),v&&!g&&(0,N.jsx)(r.Alert,{severity:"error",title:"Error loading Alertmanager config",children:v.message||"Unknown error."}),g&&!f&&(At||(At=(0,N.jsx)(r.LoadingPlaceholder,{text:"loading configuration..."}))),f&&!v&&(0,N.jsxs)(s.rs,{children:[(0,N.jsx)(s.AW,{exact:!0,path:"/alerting/notifications",children:(0,N.jsx)(Nt,{config:f,alertManagerName:t})}),(0,N.jsx)(s.AW,{exact:!0,path:"/alerting/notifications/templates/new",children:(0,N.jsx)(Ye,{config:f,alertManagerSourceName:t})}),(0,N.jsx)(s.AW,{exact:!0,path:"/alerting/notifications/templates/:name/edit",children:e=>{let{match:n}=e;return(null===n||void 0===n?void 0:n.params.name)&&(0,N.jsx)(Be,{alertManagerSourceName:t,config:f,templateName:decodeURIComponent(null===n||void 0===n?void 0:n.params.name)})}}),(0,N.jsx)(s.AW,{exact:!0,path:"/alerting/notifications/receivers/new",children:(0,N.jsx)(We,{config:f,alertManagerSourceName:t})}),(0,N.jsx)(s.AW,{exact:!0,path:"/alerting/notifications/receivers/:name/edit",children:e=>{let{match:n}=e;return(null===n||void 0===n?void 0:n.params.name)&&(0,N.jsx)($e,{alertManagerSourceName:t,config:f,receiverName:decodeURIComponent(null===n||void 0===n?void 0:n.params.name)})}}),(0,N.jsx)(s.AW,{exact:!0,path:"/alerting/notifications/global-config",children:(0,N.jsx)(Ue,{config:f,alertManagerSourceName:t})})]})]}):m?(0,N.jsx)(l.J,{pageId:"receivers",children:(0,N.jsx)(c.I,{availableAlertManagers:e})}):Ct||(Ct=(0,N.jsx)(s.l_,{to:"/alerting/notifications"}))},{style:"page"})},"./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx":(e,t,n)=>{n.d(t,{J:()=>o});n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var a=n("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),i=n("./public/app/core/components/Page/Page.tsx"),s=n("./public/app/core/selectors/navModel.ts"),r=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const o=e=>{let{children:t,pageId:n,isLoading:o}=e;const l=(0,s.h)((0,a.useSelector)(e=>e.navIndex),n);return(0,r.jsx)(i.Z,{navModel:l,children:(0,r.jsx)(i.Z.Contents,{isLoading:o,children:t})})}},"./public/app/features/alerting/unified/components/Authorize.tsx":(e,t,n)=>{n.d(t,{q:()=>s});n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var a=n("./public/app/core/services/context_srv.ts"),i=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const s=e=>{let{actions:t,children:n,fallback:s=!0}=e;return t.some(e=>a.Vt.hasAccess(e,s))?(0,i.jsx)(i.Fragment,{children:n}):null}},"./public/app/features/alerting/unified/components/NoAlertManagerWarning.tsx":(e,t,n)=>{n.d(t,{I:()=>m});n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var a,i,s,r,o=n("./packages/grafana-ui/src/index.ts"),l=n("./public/app/features/alerting/unified/hooks/useAlertManagerSourceName.ts"),c=n("./public/app/features/alerting/unified/components/AlertManagerPicker.tsx"),d=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const u=()=>a||(a=(0,d.jsx)(o.Alert,{title:"No Alertmanager found",severity:"warning",children:"We could not find any external Alertmanagers and you may not have access to the built-in Grafana Alertmanager."})),p=()=>i||(i=(0,d.jsx)(o.Alert,{title:"Selected Alertmanager not found. Select a different Alertmanager.",severity:"warning",children:"Selected Alertmanager no longer exists or you may not have permission to access it."})),m=e=>{let{availableAlertManagers:t}=e;const[n,a]=(0,l.k)(t),i=t.length>0;return(0,d.jsx)("div",{children:i?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(c.P,{onChange:a,dataSources:t}),s||(s=(0,d.jsx)(p,{}))]}):r||(r=(0,d.jsx)(u,{}))})}},"./public/app/features/alerting/unified/components/rule-editor/AnnotationsField.tsx":(e,t,n)=>{n.d(t,{Z:()=>f});var a=n("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),s=n("./.yarn/__virtual__/react-hook-form-virtual-92b6119fd4/0/cache/react-hook-form-npm-7.5.3-f9cc466c62-fbfaa3b664.zip/node_modules/react-hook-form/dist/index.esm.js"),r=n("./packages/grafana-ui/src/index.ts"),o=n("./public/app/features/alerting/unified/utils/constants.ts"),l=n("./public/app/features/alerting/unified/components/rule-editor/SelectWIthAdd.tsx"),c=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const d=["value","existingKeys","aria-label"];const u=e=>{let{value:t,existingKeys:n,"aria-label":a}=e,s=function(e,t){if(null==e)return{};var n,a,i={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,d);const r=(0,i.useMemo)(()=>Object.values(o.q6).filter(e=>!n.includes(e)).map(e=>({value:e,label:o.vY[e]})),[n]);return(0,c.jsx)(l.P,Object.assign({"aria-label":a,value:t,options:r,custom:!!t&&!Object.values(o.q6).includes(t)},s))},p=["ref"];var m;const h=e=>({annotationValueInput:a.css`
    width: 426px;
  `,textarea:a.css`
    height: 76px;
  `,addAnnotationsButton:a.css`
    flex-grow: 0;
    align-self: flex-start;
    margin-left: 148px;
  `,flexColumn:a.css`
    display: flex;
    flex-direction: column;
  `,field:a.css`
    margin-bottom: ${e.spacing.xs};
  `,flexRow:a.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
  `,flexRowItemMargin:a.css`
    margin-left: ${e.spacing.xs};
  `}),f=()=>{const e=(0,r.useStyles)(h),{control:t,register:n,watch:o,formState:{errors:l}}=(0,s.Gc)(),d=o("annotations"),f=(0,i.useCallback)(e=>d.filter((t,n)=>n!==e).map(e=>{let{key:t}=e;return t}),[d]);return(0,c.jsxs)(c.Fragment,{children:[m||(m=(0,c.jsx)(r.Label,{children:"Summary and annotations"})),(0,c.jsx)(r.FieldArray,{name:"annotations",control:t,children:i=>{let{fields:s,append:o,remove:m}=i;return(0,c.jsxs)("div",{className:e.flexColumn,children:[s.map((i,s)=>{var o,h,g,v,x,b,y,j,_,k,S,N,w,C,A;const O=null===(o=d[s])||void 0===o?void 0:null===(h=o.key)||void 0===h?void 0:h.toLocaleLowerCase().endsWith("url"),M=O?r.Input:r.TextArea;return(0,c.jsxs)("div",{className:e.flexRow,children:[(0,c.jsx)(r.Field,{className:e.field,invalid:!(null===(g=l.annotations)||void 0===g||null===(v=g[s])||void 0===v||null===(x=v.key)||void 0===x||!x.message),error:null===(b=l.annotations)||void 0===b?void 0:null===(y=b[s])||void 0===y?void 0:null===(j=y.key)||void 0===j?void 0:j.message,"data-testid":`annotation-key-${s}`,children:(0,c.jsx)(r.InputControl,{name:`annotations[${s}].key`,render:e=>{let{}=e,t=function(e,t){if(null==e)return{};var n,a,i={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e.field,p);return(0,c.jsx)(u,Object.assign({},t,{"aria-label":`Annotation detail ${s+1}`,existingKeys:f(s),width:18}))},control:t,rules:{required:{value:!(null===(_=d[s])||void 0===_||!_.value),message:"Required."}}})}),(0,c.jsx)(r.Field,{className:(0,a.cx)(e.flexRowItemMargin,e.field),invalid:!(null===(k=l.annotations)||void 0===k||null===(S=k[s])||void 0===S||null===(N=S.value)||void 0===N||!N.message),error:null===(w=l.annotations)||void 0===w?void 0:null===(C=w[s])||void 0===C?void 0:null===(A=C.value)||void 0===A?void 0:A.message,children:(0,c.jsx)(M,Object.assign({"data-testid":`annotation-value-${s}`,className:(0,a.cx)(e.annotationValueInput,{[e.textarea]:!O})},n(`annotations[${s}].value`),{placeholder:O?"https://":"Text",defaultValue:i.value}))}),(0,c.jsx)(r.Button,{type:"button",className:e.flexRowItemMargin,"aria-label":"delete annotation",icon:"trash-alt",variant:"secondary",onClick:()=>m(s)})]},i.id)}),(0,c.jsx)(r.Button,{className:e.addAnnotationsButton,icon:"plus-circle",type:"button",variant:"secondary",onClick:()=>{o({key:"",value:""})},children:"Add info"})]})}})]})}},"./public/app/features/alerting/unified/components/rule-editor/LabelsField.tsx":(e,t,n)=>{n.d(t,{Z:()=>d});var a,i,s=n("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),r=(n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),n("./.yarn/__virtual__/react-hook-form-virtual-92b6119fd4/0/cache/react-hook-form-npm-7.5.3-f9cc466c62-fbfaa3b664.zip/node_modules/react-hook-form/dist/index.esm.js")),o=n("./packages/grafana-ui/src/index.ts"),l=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const c=e=>({wrapper:s.css`
      margin-top: ${e.spacing.md};
    `,flexColumn:s.css`
      display: flex;
      flex-direction: column;
    `,flexRow:s.css`
      display: flex;
      flex-direction: row;
      justify-content: flex-start;

      & + button {
        margin-left: ${e.spacing.xs};
      }
    `,deleteLabelButton:s.css`
      margin-left: ${e.spacing.xs};
      align-self: flex-start;
    `,addLabelButton:s.css`
      flex-grow: 0;
      align-self: flex-start;
    `,centerAlignRow:s.css`
      align-items: baseline;
    `,equalSign:s.css`
      align-self: flex-start;
      width: 28px;
      justify-content: center;
      margin-left: ${e.spacing.xs};
    `,labelInput:s.css`
      width: 183px;
      margin-bottom: ${e.spacing.sm};
      & + & {
        margin-left: ${e.spacing.sm};
      }
    `}),d=e=>{let{className:t}=e;const n=(0,o.useStyles)(c),{register:d,control:u,watch:p,formState:{errors:m}}=(0,r.Gc)(),h=p("labels");return(0,l.jsxs)("div",{className:(0,s.cx)(t,n.wrapper),children:[a||(a=(0,l.jsx)(o.Label,{children:"Custom Labels"})),(0,l.jsx)(o.FieldArray,{control:u,name:"labels",children:e=>{let{fields:t,append:a,remove:r}=e;return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:n.flexRow,children:[i||(i=(0,l.jsx)(o.InlineLabel,{width:18,children:"Labels"})),(0,l.jsxs)("div",{className:n.flexColumn,children:[t.map((e,t)=>{var a,i,c,u,p,f,g,v,x,b,y,j,_,k;return(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:(0,s.cx)(n.flexRow,n.centerAlignRow),children:[(0,l.jsx)(o.Field,{className:n.labelInput,invalid:!(null===(a=m.labels)||void 0===a||null===(i=a[t])||void 0===i||null===(c=i.key)||void 0===c||!c.message),error:null===(u=m.labels)||void 0===u?void 0:null===(p=u[t])||void 0===p?void 0:null===(f=p.key)||void 0===f?void 0:f.message,children:(0,l.jsx)(o.Input,Object.assign({},d(`labels[${t}].key`,{required:{value:!(null===(g=h[t])||void 0===g||!g.value),message:"Required."}}),{placeholder:"key","data-testid":`label-key-${t}`,defaultValue:e.key}))}),(0,l.jsx)(o.InlineLabel,{className:n.equalSign,children:"="}),(0,l.jsx)(o.Field,{className:n.labelInput,invalid:!(null===(v=m.labels)||void 0===v||null===(x=v[t])||void 0===x||null===(b=x.value)||void 0===b||!b.message),error:null===(y=m.labels)||void 0===y?void 0:null===(j=y[t])||void 0===j?void 0:null===(_=j.value)||void 0===_?void 0:_.message,children:(0,l.jsx)(o.Input,Object.assign({},d(`labels[${t}].value`,{required:{value:!(null===(k=h[t])||void 0===k||!k.key),message:"Required."}}),{placeholder:"value","data-testid":`label-value-${t}`,defaultValue:e.value}))}),(0,l.jsx)(o.Button,{className:n.deleteLabelButton,"aria-label":"delete label",icon:"trash-alt",variant:"secondary",onClick:()=>{r(t)}})]})},e.id)}),(0,l.jsx)(o.Button,{className:n.addLabelButton,icon:"plus-circle",type:"button",variant:"secondary",onClick:()=>{a({})},children:"Add label"})]})]})})}})]})}},"./public/app/features/alerting/unified/components/rule-editor/SelectWIthAdd.tsx":(e,t,n)=>{n.d(t,{P:()=>r});var a=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=n("./packages/grafana-ui/src/index.ts"),s=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const r=e=>{let{value:t,onChange:n,options:r,className:o,placeholder:l,width:c,custom:d,onCustomChange:u,disabled:p=!1,addLabel:m="+ Add new","aria-label":h}=e;const[f,g]=(0,a.useState)(d);(0,a.useEffect)(()=>{d&&g(d)},[d]);const v=(0,a.useMemo)(()=>[...r,{value:"__add__",label:m}],[r,m]);return f?(0,s.jsx)(i.Input,{"aria-label":h,width:c,autoFocus:!d,value:t||"",placeholder:l,className:o,disabled:p,onChange:e=>n(e.target.value)}):(0,s.jsx)(i.Select,{"aria-label":h,width:c,options:v,value:t,className:o,placeholder:l,disabled:p,onChange:e=>{const t=null===e||void 0===e?void 0:e.value;"__add__"===t?(g(!0),u&&u(!0),n("")):n(t)}})}},"./public/app/features/alerting/unified/components/rules/ActionIcon.tsx":(e,t,n)=>{n.d(t,{A:()=>r});n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var a=n("./packages/grafana-ui/src/index.ts"),i=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const s=["tooltip","icon","to","target","onClick","className","tooltipPlacement"];const r=e=>{let{tooltip:t,icon:n,to:r,target:o,onClick:l,className:c,tooltipPlacement:d="top"}=e,u=function(e,t){if(null==e)return{};var n,a,i={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,s);const p="string"==typeof t?t:void 0;return(0,i.jsx)(a.Tooltip,{content:t,placement:d,children:r?(0,i.jsx)(a.LinkButton,Object.assign({variant:"secondary",fill:"text",icon:n,href:r,size:"sm",target:o},u,{"aria-label":p})):(0,i.jsx)(a.Button,Object.assign({className:c,variant:"secondary",fill:"text",size:"sm",icon:n,type:"button",onClick:l},u,{"aria-label":p}))})}},"./public/app/features/alerting/unified/hooks/useAlertManagerSourceName.ts":(e,t,n)=>{n.d(t,{k:()=>(function(e){const[t,n]=(0,i.K)(),l=function(e){return(0,a.useCallback)(t=>{const n=e.map(e=>e.name);return n.includes(t)},[e])}(e),c=(0,a.useCallback)(e=>{l(e)&&(e===o.GC?(s.Z.delete(r.de),n({[r.c4]:null})):(s.Z.set(r.de,e),n({[r.c4]:e})))},[n,l]),d=t[r.c4];if(d&&"string"==typeof d)return l(d)?[d,c]:[void 0,c];const u=s.Z.get(r.de);if(u&&"string"==typeof u&&l(u))return c(u),[u,c];if(l(o.GC))return[o.GC,c];return[void 0,c]})});var a=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=n("./public/app/core/hooks/useQueryParams.ts"),s=n("./public/app/core/store.ts"),r=n("./public/app/features/alerting/unified/utils/constants.ts"),o=n("./public/app/features/alerting/unified/utils/datasource.ts")},"./public/app/features/alerting/unified/hooks/useAlertManagerSources.ts":(e,t,n)=>{n.d(t,{k:()=>(function(e){return(0,a.useMemo)(()=>(0,i.LE)(e),[e])})});var a=n("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=n("./public/app/features/alerting/unified/utils/datasource.ts")},"./public/app/features/alerting/unified/styles/table.ts":(e,t,n)=>{n.d(t,{D:()=>i});var a=n("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js");const i=e=>({table:a.css`
    width: 100%;
    border-radius: ${e.shape.borderRadius()};
    border: solid 1px ${e.colors.border.weak};
    background-color: ${e.colors.background.secondary};

    th {
      padding: ${e.spacing(1)};
    }

    td {
      padding: 0 ${e.spacing(1)};
    }

    tr {
      height: 38px;
    }
  `,evenRow:a.css`
    background-color: ${e.colors.background.primary};
  `,colExpand:a.css`
    width: 36px;
  `,actionsCell:a.css`
    text-align: right;
    width: 1%;
    white-space: nowrap;

    & > * + * {
      margin-left: ${e.spacing(.5)};
    }
  `})}}]);