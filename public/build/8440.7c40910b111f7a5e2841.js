(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8440],{"./public/app/plugins/datasource/cloud-monitoring/components/MQLQueryEditor.tsx":(e,t,a)=>{"use strict";a.d(t,{a:()=>(function(e){let{query:t,onChange:a,onRunQuery:r}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(l.TextArea,{name:"Query",className:"slate-query-field",value:t,rows:10,placeholder:"Enter a Cloud Monitoring MQL query (Run with Shift+Enter)",onBlur:r,onChange:e=>a(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&(e.shiftKey||e.ctrlKey)&&(e.preventDefault(),r())}})})})});a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var l=a("./packages/grafana-ui/src/index.ts"),n=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js")},"./public/app/plugins/datasource/cloud-monitoring/components/MetricQueryEditor.tsx":(e,t,a)=>{"use strict";a.d(t,{a1:()=>g,wi:()=>h});var l,n=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),r=a("./public/app/plugins/datasource/cloud-monitoring/functions.ts"),o=a("./public/app/plugins/datasource/cloud-monitoring/types.ts"),i=a("./packages/grafana-ui/src/index.ts"),s=a("./public/app/plugins/datasource/cloud-monitoring/constants.ts"),c=a("./public/app/plugins/datasource/cloud-monitoring/components/index.ts"),u=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const d=e=>{let{refId:t,onChange:a,graphPeriod:n,variableOptionGroup:r}=e;return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(c.x5,{label:"Graph period",htmlFor:`${t}-graph-period`,tooltip:(0,u.jsxs)(u.Fragment,{children:["Set ",l||(l=(0,u.jsx)("code",{children:"graph_period"}))," which forces a preferred period between points. Automatically set to the current interval if left blank."]}),children:[(0,u.jsx)(i.Switch,{"data-testid":`${t}-switch-graph-period`,value:"disabled"!==n,onChange:e=>a(e.currentTarget.checked?"":"disabled")}),(0,u.jsx)(c.$d,{inputId:`${t}-graph-period`,templateVariableOptions:r.options,current:n,onChange:a,selectWidth:s.Lh,disabled:"disabled"===n,aligmentPeriods:s.Ry})]})})};var p=a("./public/app/plugins/datasource/cloud-monitoring/components/MQLQueryEditor.tsx");const m={labels:{}},h=e=>({editorMode:o.je.Visual,projectName:e.getDefaultProject(),metricType:"",metricKind:o.lH.GAUGE,valueType:"",crossSeriesReducer:"REDUCE_MEAN",alignmentPeriod:"cloud-monitoring-auto",perSeriesAligner:o.CS.ALIGN_MEAN,groupBys:[],filters:[],aliasBy:"",query:"",preprocessor:o.mG.None});const g=n.memo(function(e){let{refId:t,query:a,datasource:l,onChange:i,onRunQuery:s,customMetaData:h,variableOptionGroup:g}=e;const[v,E]=(0,n.useState)(m),{projectName:b,metricType:f,groupBys:y,editorMode:T,crossSeriesReducer:I}=a;(0,n.useEffect)(()=>{b&&f&&l.getLabels(f,t,b).then(e=>E(t=>Object.assign({},t,{labels:e})))},[l,y,f,b,t,I]);const x=(0,n.useCallback)(e=>{i(Object.assign({},a,e)),s()},[i,s,a]),N=(0,n.useCallback)(e=>{let{valueType:t,metricKind:l,type:n}=e;const i=l===o.lH.GAUGE||t===o.$h.DISTRIBUTION?o.mG.None:o.mG.Rate,{perSeriesAligner:s}=(0,r.ID)(t,l,v.perSeriesAligner,i);x(Object.assign({},a,{perSeriesAligner:s,metricType:n,valueType:t,metricKind:l,preprocessor:i}))},[x,a,v]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(c.IK,{refId:t,templateVariableOptions:g.options,projectName:b,datasource:l,onChange:e=>{x(Object.assign({},a,{projectName:e}))}}),T===o.je.Visual&&(0,u.jsx)(c.sL,{refId:t,labels:v.labels,variableOptionGroup:g,customMetaData:h,onMetricTypeChange:N,onChange:x,datasource:l,query:a}),T===o.je.MQL&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(p.a,{onChange:e=>i(Object.assign({},a,{query:e})),onRunQuery:s,query:a.query}),(0,u.jsx)(d,{onChange:e=>i(Object.assign({},a,{graphPeriod:e})),graphPeriod:a.graphPeriod,refId:t,variableOptionGroup:g})]}),(0,u.jsx)(c.BQ,{refId:t,value:a.aliasBy,onChange:e=>{x(Object.assign({},a,{aliasBy:e}))}})]})})},"./public/app/plugins/datasource/cloud-monitoring/components/QueryEditor.tsx":(e,t,a)=>{"use strict";a.d(t,{W:()=>(class extends n.PureComponent{async UNSAFE_componentWillMount(){const{datasource:e,query:t}=this.props;if(!this.props.query.hasOwnProperty("metricQuery")){const e=this.props.query,t=function(e,t){if(null==e)return{};var a,l,n={},r=Object.keys(e);for(l=0;l<r.length;l++)a=r[l],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,m);this.props.query.metricQuery=t}this.props.query.hasOwnProperty("queryType")||(this.props.query.queryType=s.xL.METRICS),await e.ensureGCEDefaultProject(),t.metricQuery.projectName||(this.props.query.metricQuery.projectName=e.getDefaultProject())}onQueryChange(e,t){this.props.onChange(Object.assign({},this.props.query,{[e]:t})),this.props.onRunQuery()}render(){var e,t,a;const{datasource:n,query:m,onRunQuery:h,onChange:g}=this.props,v=Object.assign({},(0,c.wi)(n),m.metricQuery),E=Object.assign({},(0,u.w)(n),m.sloQuery),b=m.queryType||s.xL.METRICS,f=null!==(e=this.props.data)&&void 0!==e&&e.series.length?null===(t=this.props.data)||void 0===t?void 0:t.series[0].meta:{},y=null!==(a=null===f||void 0===f?void 0:f.custom)&&void 0!==a?a:{},T={label:"Template Variables",expanded:!1,options:n.getVariables().map(r.toOption)};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(d.x5,{label:"Query type",fillComponent:m.queryType!==s.xL.SLO&&(0,p.jsx)(o.Button,{variant:"secondary",className:l.css`
                  margin-left: auto;
                `,icon:"edit",onClick:()=>this.onQueryChange("metricQuery",Object.assign({},v,{editorMode:v.editorMode===s.je.MQL?s.je.Visual:s.je.MQL})),children:v.editorMode===s.je.MQL?"Switch to builder":"Edit MQL"}),htmlFor:`${m.refId}-query-type`,children:(0,p.jsx)(o.Select,{width:i.Lh,value:b,options:i.XI,onChange:e=>{let{value:t}=e;g(Object.assign({},m,{sloQuery:E,queryType:t})),h()},inputId:`${m.refId}-query-type`})}),b===s.xL.METRICS&&(0,p.jsx)(d.a1,{refId:m.refId,variableOptionGroup:T,customMetaData:y,onChange:e=>{this.props.onChange(Object.assign({},this.props.query,{metricQuery:e}))},onRunQuery:h,datasource:n,query:v}),b===s.xL.SLO&&(0,p.jsx)(d.D6,{refId:m.refId,variableOptionGroup:T,customMetaData:y,onChange:e=>this.onQueryChange("sloQuery",e),onRunQuery:h,datasource:n,query:E})]})}})});var l=a("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),n=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),r=a("./packages/grafana-data/src/index.ts"),o=a("./packages/grafana-ui/src/index.ts"),i=a("./public/app/plugins/datasource/cloud-monitoring/constants.ts"),s=a("./public/app/plugins/datasource/cloud-monitoring/types.ts"),c=a("./public/app/plugins/datasource/cloud-monitoring/components/MetricQueryEditor.tsx"),u=a("./public/app/plugins/datasource/cloud-monitoring/components/SLO/SLOQueryEditor.tsx"),d=a("./public/app/plugins/datasource/cloud-monitoring/components/index.ts"),p=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const m=["hide","refId","datasource","key","queryType","maxLines","metric"]},"./public/app/plugins/datasource/cloud-monitoring/components/SLO/SLOQueryEditor.tsx":(e,t,a)=>{"use strict";a.d(t,{D:()=>(function(e){let{refId:t,query:a,datasource:l,onChange:o,variableOptionGroup:i,customMetaData:p}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.IK,{refId:t,templateVariableOptions:i.options,projectName:a.projectName,datasource:l,onChange:e=>o(Object.assign({},a,{projectName:e}))}),(0,s.jsx)(c,{refId:t,datasource:l,templateVariableOptions:i.options,query:a,onChange:o}),(0,s.jsx)(u,{refId:t,datasource:l,templateVariableOptions:i.options,query:a,onChange:o}),(0,s.jsx)(d,{refId:t,datasource:l,templateVariableOptions:i.options,query:a,onChange:o}),(0,s.jsxs)(n.x5,{label:"Alignment period",htmlFor:`${t}-alignment-period`,children:[(0,s.jsx)(n.$d,{inputId:`${t}-alignment-period`,templateVariableOptions:i.options,selectWidth:r.Lh,current:a.alignmentPeriod,onChange:e=>o(Object.assign({},a,{alignmentPeriod:e})),aligmentPeriods:r.dD}),(0,s.jsx)(n.nS,{datasource:l,customMetaData:p})]}),(0,s.jsx)(n.BQ,{refId:t,value:a.aliasBy,onChange:e=>o(Object.assign({},a,{aliasBy:e}))})]})}),w:()=>p});var l=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),n=a("./public/app/plugins/datasource/cloud-monitoring/components/index.ts"),r=a("./public/app/plugins/datasource/cloud-monitoring/constants.ts"),o=a("./public/app/plugins/datasource/cloud-monitoring/types.ts"),i=a("./packages/grafana-ui/src/index.ts"),s=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const c=e=>{let{refId:t,query:a,templateVariableOptions:o,onChange:c,datasource:u}=e;const[d,p]=(0,l.useState)([]),{projectName:m}=a;return(0,l.useEffect)(()=>{m&&u.getSLOServices(m).then(e=>{p([{label:"Template Variables",options:o},...e])})},[u,m,o]),(0,s.jsx)(n.x5,{label:"Service",htmlFor:`${t}-slo-service`,children:(0,s.jsx)(i.Select,{inputId:`${t}-slo-service`,width:r.Lh,allowCustomValue:!0,value:(null===a||void 0===a?void 0:a.serviceId)&&{value:null===a||void 0===a?void 0:a.serviceId,label:(null===a||void 0===a?void 0:a.serviceName)||(null===a||void 0===a?void 0:a.serviceId)},placeholder:"Select service",options:d,onChange:e=>{let{value:t="",label:l=""}=e;return c(Object.assign({},a,{serviceId:t,serviceName:l,sloId:""}))}})})},u=e=>{let{refId:t,query:a,templateVariableOptions:o,onChange:c,datasource:u}=e;const[d,p]=(0,l.useState)([]),{projectName:m,serviceId:h}=a;return(0,l.useEffect)(()=>{m&&h&&u.getServiceLevelObjectives(m,h).then(e=>{p([{label:"Template Variables",options:o},...e])})},[u,m,h,o]),(0,s.jsx)(n.x5,{label:"SLO",htmlFor:`${t}-slo`,children:(0,s.jsx)(i.Select,{inputId:`${t}-slo`,width:r.Lh,allowCustomValue:!0,value:(null===a||void 0===a?void 0:a.sloId)&&{value:null===a||void 0===a?void 0:a.sloId,label:(null===a||void 0===a?void 0:a.sloName)||(null===a||void 0===a?void 0:a.sloId)},placeholder:"Select SLO",options:d,onChange:async e=>{let{value:t="",label:l=""}=e;const n=(await u.getServiceLevelObjectives(m,h)).find(e=>{let{value:a}=e;return a===u.templateSrv.replace(t)});c(Object.assign({},a,{sloId:t,sloName:l,goal:null===n||void 0===n?void 0:n.goal}))}})})},d=e=>{let{refId:t,query:a,templateVariableOptions:l,onChange:o,datasource:c}=e;return(0,s.jsx)(n.x5,{label:"Selector",htmlFor:`${t}-slo-selector`,children:(0,s.jsx)(i.Select,{inputId:`${t}-slo-selector`,width:r.Lh,allowCustomValue:!0,value:[...r.IR,...l].find(e=>{var t;return null!==(t=e.value===(null===a||void 0===a?void 0:a.selectorName))&&void 0!==t?t:""}),options:[{label:"Template Variables",options:l},...r.IR],onChange:e=>{let{value:t}=e;return o(Object.assign({},a,{selectorName:null!==t&&void 0!==t?t:""}))}})})},p=e=>({projectName:e.getDefaultProject(),alignmentPeriod:"cloud-monitoring-auto",perSeriesAligner:o.CS.ALIGN_MEAN,aliasBy:"",selectorName:"select_slo_health",serviceId:"",serviceName:"",sloId:"",sloName:""})},"./public/app/plugins/datasource/cloud-monitoring/components/index.ts":(e,t,a)=>{"use strict";a.d(t,{Pe:()=>O,BQ:()=>L,v2:()=>m,XY:()=>N,nS:()=>j,zI:()=>x,X9:()=>p,pj:()=>T,a1:()=>_.a1,C3:()=>c,$d:()=>B,Av:()=>V,IK:()=>(function(e){let{refId:t,projectName:a,datasource:i,onChange:s,templateVariableOptions:c}=e;const[u,d]=(0,l.useState)([]);(0,l.useEffect)(()=>{i.getProjects().then(e=>d(e))},[i]);const p=(0,l.useMemo)(()=>[u,{label:"Template Variables",options:c},...u],[u,c]);return(0,o.jsx)(R,{label:"Project",htmlFor:`${t}-project`,children:(0,o.jsx)(n.Select,{width:r.Lh,allowCustomValue:!0,formatCreateLabel:e=>`Use project: ${e}`,onChange:e=>{let{value:t}=e;return s(t)},options:p,value:{value:a,label:a},placeholder:"Select Project",inputId:`${t}-project`})})}),EC:()=>M,x5:()=>R,D6:()=>G.D,Th:()=>$,sL:()=>k});var l=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),n=a("./packages/grafana-ui/src/index.ts"),r=a("./public/app/plugins/datasource/cloud-monitoring/constants.ts"),o=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");var i=a("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),s=a("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js");function c(e){const[t,a]=(0,l.useState)({metricDescriptors:[],metrics:[],services:[],service:"",metric:"",projectName:null}),i=(0,n.useTheme2)(),c=(0,n.getSelectStyles)(i),d=(0,n.useStyles2)(u),{services:p,service:m,metrics:h,metricDescriptors:g}=t,{metricType:v,templateVariableOptions:E,projectName:b,templateSrv:f,datasource:y,onChange:T,children:I}=e,x=(0,l.useCallback)((e,t)=>e.find(e=>e.type===f.replace(t)),[f]);(0,l.useEffect)(()=>{(async()=>{if(b){const e=await y.getMetricTypes(b),t=j(e),l=(e=>{const t=x(e,v);return t?e.filter(e=>e.service===t.service).map(e=>({service:e.service,value:e.type,label:e.displayName,component:function(){return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:d,children:e.type}),(0,o.jsx)("div",{className:c.optionDescription,children:e.description})]})}})):[]})(e),n=l.length>0?l[0].service:"",r=x(e,v);a(a=>Object.assign({},a,{metricDescriptors:e,services:t,metrics:l,service:n,metricDescriptor:r}))}})()},[y,x,v,b,d,c.optionDescription]);const N=function(e){let{value:l}=e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=x(t.metricDescriptors,l);a(Object.assign({},t,{metricDescriptor:r},n)),T(Object.assign({},r,{type:l}))},j=e=>{const t=e.map(e=>({value:e.service,label:(0,s.startCase)(e.serviceShortName)}));return t.length>0?(0,s.uniqBy)(t,e=>e.value):[]};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(R,{children:[(0,o.jsx)(M,{labelWidth:r.XC,label:"Service",htmlFor:`${e.refId}-service`,children:(0,o.jsx)(n.Select,{width:r.Lh,onChange:e=>{let{value:l}=e;const n=g.filter(e=>e.service===f.replace(l)).map(e=>({service:e.service,value:e.type,label:e.displayName,description:e.description}));n.length>0&&!n.some(e=>e.value===f.replace(v))?N(n[0],{service:l,metrics:n}):a(Object.assign({},t,{service:l,metrics:n}))},value:[...p,...E].find(e=>e.value===m),options:[{label:"Template Variables",options:E},...p],placeholder:"Select Services",inputId:`${e.refId}-service`})}),(0,o.jsx)(M,{label:"Metric name",labelWidth:r.qN,htmlFor:`${e.refId}-select-metric`,children:(0,o.jsx)(n.Select,{width:r.Lh,onChange:N,value:[...h,...E].find(e=>e.value===v),options:[{label:"Template Variables",options:E},...h],placeholder:"Select Metric",inputId:`${e.refId}-select-metric`})})]}),I(t.metricDescriptor)]})}const u=e=>i.css`
  label: grafana-select-option-description;
  font-weight: normal;
  font-style: italic;
  color: ${e.colors.text.secondary};
`;var d=a("./public/app/plugins/datasource/cloud-monitoring/functions.ts");const p=e=>{var t,a;let{refId:i,labels:s=[],query:c,onChange:u,variableOptionGroup:p,metricDescriptor:m}=e;const h=(0,l.useMemo)(()=>[p,...(0,d.gY)([...s,...r.$e])],[s,p]);return(0,o.jsxs)(R,{label:"Group by",tooltip:"You can reduce the amount of data returned for a metric by combining different time series. To combine multiple time series, you can specify a grouping and a function. Grouping is done on the basis of labels. The grouping function is used to combine the time series in the group into a single time series.",htmlFor:`${i}-group-by`,children:[(0,o.jsx)(n.MultiSelect,{inputId:`${i}-group-by`,width:r.d7,placeholder:"Choose label",options:h,value:null!==(t=c.groupBys)&&void 0!==t?t:[],onChange:e=>{u(Object.assign({},c,{groupBys:e.map(e=>e.value)}))}}),(0,o.jsx)(O,{metricDescriptor:m,templateVariableOptions:p.options,crossSeriesReducer:c.crossSeriesReducer,groupBys:null!==(a=c.groupBys)&&void 0!==a?a:[],onChange:e=>u(Object.assign({},c,{crossSeriesReducer:e})),refId:i})]})},m=e=>{let{refId:t,templateVariableOptions:a,onChange:l,query:n,customMetaData:i,datasource:s}=e;return(0,o.jsxs)(R,{label:"Alignment function",tooltip:"The process of alignment consists of collecting all data points received in a fixed length of time, applying a function to combine those data points, and assigning a timestamp to the result.",fillComponent:(0,o.jsx)(j,{datasource:s,customMetaData:i}),htmlFor:`${t}-alignment-function`,children:[(0,o.jsx)(N,{inputId:`${t}-alignment-function`,templateVariableOptions:a,query:n,onChange:l}),(0,o.jsx)(M,{label:"Alignment period",htmlFor:`${t}-alignment-period`,children:(0,o.jsx)(B,{inputId:`${t}-alignment-period`,selectWidth:r.Lh,templateVariableOptions:a,current:n.alignmentPeriod,onChange:e=>l(Object.assign({},n,{alignmentPeriod:e})),aligmentPeriods:r.dD})})]})};var h=a("./packages/grafana-data/src/index.ts");const g=["value","isOpen","invalid"],v=["value"];function E(e,t){if(null==e)return{};var a,l,n={},r=Object.keys(e);for(l=0;l<r.length;l++)a=r[l],t.indexOf(a)>=0||(n[a]=e[a]);return n}const b=["=","!=","=~","!=~"],f=l.forwardRef((e,t)=>{let a=E(e,g);return(0,o.jsx)(n.Button,Object.assign({},a,{ref:t,variant:"secondary",icon:"plus","aria-label":"Add filter"}))});f.displayName="FilterButton";const y=l.forwardRef((e,t)=>{let{value:a}=e,l=E(e,v);return(0,o.jsx)(n.Button,Object.assign({},l,{ref:t,variant:"secondary",children:(0,o.jsx)("span",{className:"query-segment-operator",children:null===a||void 0===a?void 0:a.label})}))});y.displayName="OperatorButton";const T=e=>{var t;let{labels:a={},filters:i,onChange:c,variableOptionGroup:u}=e;const p=(0,l.useMemo)(()=>(0,d.mi)(i),[i]),m=(0,l.useMemo)(()=>[u,...(0,d.gY)(Object.keys(a))],[a,u]),g=(0,l.useCallback)(e=>{const t=(0,s.flatten)(e.map(e=>{let{key:t,operator:a,value:l,condition:n}=e;return[t,a,l,n]}));return t.slice(0,t.length-1)},[]),v=()=>(0,o.jsx)(n.Select,{allowCustomValue:!0,options:[u,...(0,d.gY)(Object.keys(a))],onChange:e=>{let{value:t=""}=e;return c(g([...p,{key:t,operator:"=",condition:"AND",value:""}]))},menuPlacement:"bottom",renderControl:f});return(0,o.jsx)(R,{label:"Filter",tooltip:"To reduce the amount of data charted, apply a filter. A filter has three components: a label, a comparison, and a value. The comparison can be an equality, inequality, or regular expression.",noFillEnd:p.length>1,children:(0,o.jsxs)(n.VerticalGroup,{spacing:"xs",width:"auto",children:[p.map((e,l)=>{let{key:i,operator:s,value:d,condition:E}=e;m.some(e=>e.options?m.some(e=>e.label===i):e.label===i)||m.push({label:i,value:i});const f=a.hasOwnProperty(i)?[u,...a[i].map(h.toOption)]:[u];return f.some(e=>e.label===d)||f.push({label:d,value:d}),(0,o.jsxs)(n.HorizontalGroup,{spacing:"xs",width:"auto",children:[(0,o.jsx)(n.Select,{"aria-label":"Filter label key",width:r.Lh,allowCustomValue:!0,formatCreateLabel:e=>`Use label key: ${e}`,value:i,options:m,onChange:e=>{let{value:t=""}=e;c(g(p.map((e,a)=>a===l?{key:t,operator:s,condition:E,value:""}:e)))}}),(0,o.jsx)(n.Select,{value:s,options:b.map(h.toOption),onChange:e=>{let{value:t="="}=e;return c(g(p.map((e,a)=>a===l?Object.assign({},e,{operator:t}):e)))},menuPlacement:"bottom",renderControl:y}),(0,o.jsx)(n.Select,{"aria-label":"Filter label value",width:r.Lh,formatCreateLabel:e=>`Use label value: ${e}`,allowCustomValue:!0,value:d,placeholder:"add filter value",options:f,onChange:e=>{let{value:t=""}=e;return c(g(p.map((e,a)=>a===l?Object.assign({},e,{value:t}):e)))}}),(0,o.jsx)(n.Button,{variant:"secondary",size:"md",icon:"trash-alt","aria-label":"Remove",onClick:()=>c(g(p.filter((e,t)=>t!==l)))}),l+1===p.length&&Object.values(p).every(e=>{let{value:t}=e;return t})&&(t||(t=(0,o.jsx)(v,{})))]},l)}),!p.length&&(0,o.jsx)(v,{})]})})};var I;const x=()=>I||(I=(0,o.jsx)("div",{className:"gf-form grafana-info-box alert-info",children:(0,o.jsxs)("div",{children:[(0,o.jsx)("h5",{children:"Annotation Query Format"}),(0,o.jsxs)("p",{children:["An annotation is an event that is overlaid on top of graphs. Annotation rendering is expensive so it is important to limit the number of rows returned."," "]}),(0,o.jsx)("p",{children:"The Title and Text fields support templating and can use data returned from the query. For example, the Title field could have the following text:"}),(0,o.jsxs)("code",{children:["{{metric.type}}"," has value: ","{{metric.value}}"]}),(0,o.jsxs)("p",{children:["Example Result: ",(0,o.jsx)("code",{children:"monitoring.googleapis.com/uptime_check/http_status has this value: 502"})]}),(0,o.jsx)("label",{children:"Patterns:"}),(0,o.jsxs)("p",{children:[(0,o.jsx)("code",{children:"{{metric.value}}"})," = value of the metric/point"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("code",{children:"{{metric.type}}"})," = metric type e.g. compute.googleapis.com/instance/cpu/usage_time"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("code",{children:"{{metric.name}}"})," = name part of metric e.g. instance/cpu/usage_time"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("code",{children:"{{metric.service}}"})," = service part of metric e.g. compute"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("code",{children:"{{metric.label.label_name}}"})," = Metric label metadata e.g. metric.label.instance_name"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("code",{children:"{{resource.label.label_name}}"})," = Resource label metadata e.g. resource.label.zone"]})]})})),N=e=>{let{inputId:t,query:a,templateVariableOptions:i,onChange:s}=e;const{valueType:c,metricKind:u,perSeriesAligner:p,preprocessor:m}=a,{perSeriesAligner:h,alignOptions:g}=(0,l.useMemo)(()=>(0,d.ID)(c,u,p,m),[c,u,p,m]);return(0,o.jsx)(n.Select,{width:r.Lh,onChange:e=>{let{value:t}=e;return s(Object.assign({},a,{perSeriesAligner:t}))},value:[...g,...i].find(e=>e.value===h),options:[{label:"Template Variables",options:i},{label:"Alignment options",expanded:!0,options:g}],placeholder:"Select Alignment",inputId:t})},j=e=>{let{customMetaData:t,datasource:a}=e;const{perSeriesAligner:n,alignmentPeriod:i}=t,s=(0,l.useMemo)(()=>{var e;if(!i||!n)return"";const t=r.Eu.find(e=>e.value===a.templateSrv.replace(n)),l=parseInt(null!==i&&void 0!==i?i:"".replace(/[^0-9]/g,""),10);return`${h.rangeUtil.secondsToHms(l)} interval (${null!==(e=null===t||void 0===t?void 0:t.text)&&void 0!==e?e:""})`},[a,n,i]);return(0,o.jsx)("label",{children:s})},L=e=>{let{refId:t,value:a="",onChange:i}=e;const[c,u]=(0,l.useState)(null!==a&&void 0!==a?a:""),d=(0,s.debounce)(i,1e3);return i=(e=>{u(e.target.value),d(e.target.value)}),(0,o.jsx)(R,{label:"Alias by",htmlFor:`${t}-alias-by`,children:(0,o.jsx)(n.Input,{id:`${t}-alias-by`,width:r.d7,value:c,onChange:i})})},O=e=>{const t=A(e),a=C(t,e);return(0,o.jsx)(M,{labelWidth:18,label:"Group by function","data-testid":"cloud-monitoring-aggregation",htmlFor:`${e.refId}-group-by-function`,children:(0,o.jsx)(n.Select,{width:16,onChange:t=>{let{value:a}=t;return e.onChange(a)},value:a,options:[{label:"Template Variables",options:e.templateVariableOptions},{label:"Aggregations",expanded:!0,options:t}],placeholder:"Select Reducer",inputId:`${e.refId}-group-by-function`})})},A=e=>{let{metricDescriptor:t}=e;const a=null===t||void 0===t?void 0:t.valueType,n=null===t||void 0===t?void 0:t.metricKind;return(0,l.useMemo)(()=>a&&n?(0,d.A_)(a,n).map(e=>Object.assign({},e,{label:e.text})):[],[a,n])},C=(e,t)=>(0,l.useMemo)(()=>{return[...e,...t.templateVariableOptions].find(e=>e.value===t.crossSeriesReducer)},[e,t.crossSeriesReducer,t.templateVariableOptions]);var _=a("./public/app/plugins/datasource/cloud-monitoring/components/MetricQueryEditor.tsx"),G=a("./public/app/plugins/datasource/cloud-monitoring/components/SLO/SLOQueryEditor.tsx");a("./public/app/plugins/datasource/cloud-monitoring/components/MQLQueryEditor.tsx");const D=["children","label","tooltip","fillComponent","noFillEnd","labelWidth","htmlFor"],U=["children","label","tooltip","labelWidth"];function S(e,t){if(null==e)return{};var a,l,n={},r=Object.keys(e);for(l=0;l<r.length;l++)a=r[l],t.indexOf(a)>=0||(n[a]=e[a]);return n}const $=e=>{let{label:t,onChange:a,value:l,options:r,allowCustomValue:i=!1}=e;return(0,o.jsx)(n.InlineField,{label:t,labelWidth:20,children:(0,o.jsx)(n.Select,{width:25,allowCustomValue:i,value:l,onChange:e=>{let{value:t}=e;return a(t)},options:r})})},R=e=>{let{children:t,label:a,tooltip:l,fillComponent:s,noFillEnd:c=!1,labelWidth:u=r.XC,htmlFor:d}=e,p=S(e,D);return(0,o.jsxs)("div",Object.assign({className:"gf-form"},p,{children:[a&&(0,o.jsx)(n.InlineLabel,{width:u,tooltip:l,htmlFor:d,children:a}),(0,o.jsx)("div",{className:i.css`
          margin-right: 4px;
        `,children:(0,o.jsx)(n.HorizontalGroup,{spacing:"xs",width:"auto",children:t})}),(0,o.jsx)("div",{className:"gf-form--grow",children:c||(0,o.jsx)("div",{className:"gf-form-label gf-form-label--grow",children:s})})]}))},M=e=>{let{children:t,label:a,tooltip:l,labelWidth:i=r.qN}=e,s=S(e,U);return(0,o.jsxs)(o.Fragment,{children:[a&&(0,o.jsx)(n.InlineLabel,Object.assign({width:i,tooltip:l},s,{children:a})),t]})};const k=l.memo(function(e){let{refId:t,query:a,labels:l,datasource:n,onChange:r,onMetricTypeChange:i,customMetaData:s,variableOptionGroup:u}=e;return(0,o.jsx)(c,{refId:t,templateSrv:n.templateSrv,projectName:a.projectName,metricType:a.metricType,templateVariableOptions:u.options,datasource:n,onChange:i,children:e=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(T,{labels:l,filters:a.filters,onChange:e=>r(Object.assign({},a,{filters:e})),variableOptionGroup:u}),(0,o.jsx)(V,{metricDescriptor:e,query:a,onChange:r}),(0,o.jsx)(p,{refId:t,labels:Object.keys(l),query:a,onChange:r,variableOptionGroup:u,metricDescriptor:e}),(0,o.jsx)(m,{refId:t,datasource:n,templateVariableOptions:u.options,query:a,customMetaData:s,onChange:r})]})})});function B(e){let{inputId:t,templateVariableOptions:a,onChange:r,current:i,selectWidth:s,disabled:c,aligmentPeriods:u}=e;const d=(0,l.useMemo)(()=>u.map(e=>Object.assign({},e,{label:e.text})),[u]),p=(0,l.useMemo)(()=>d.filter(e=>!e.hidden),[d]);return(0,o.jsx)(n.Select,{width:s,onChange:e=>{let{value:t}=e;return r(t)},value:[...d,...a].find(e=>e.value===i),options:[{label:"Template Variables",options:a},{label:"Aggregations",expanded:!0,options:p}],placeholder:"Select Period",inputId:t,disabled:c,allowCustomValue:!0})}var P=a("./public/app/plugins/datasource/cloud-monitoring/types.ts");const H={label:"None",value:P.mG.None},V=e=>{var t;let{query:a,metricDescriptor:l,onChange:r}=e;const i=w(l);return(0,o.jsx)(R,{label:"Pre-processing",tooltip:"Preprocessing options are displayed when the selected metric has a metric kind of delta or cumulative. The specific options available are determined by the metic's value type. If you select 'Rate', data points are aligned and converted to a rate per time series. If you select 'Delta', data points are aligned by their delta (difference) per time series",children:(0,o.jsx)(n.RadioButtonGroup,{onChange:e=>{const{valueType:t,metricKind:l,perSeriesAligner:n}=a,{perSeriesAligner:o}=(0,d.ID)(t,l,n,e);r(Object.assign({},a,{preprocessor:e,perSeriesAligner:o}))},value:null!==(t=a.preprocessor)&&void 0!==t?t:P.mG.None,options:i})})},w=e=>{const t=null===e||void 0===e?void 0:e.metricKind,a=null===e||void 0===e?void 0:e.valueType;return(0,l.useMemo)(()=>{if(!t||t===P.lH.GAUGE||a===P.$h.DISTRIBUTION)return[H];const e=[H,{label:"Rate",value:P.mG.Rate,description:"Data points are aligned and converted to a rate per time series"}];return t===P.lH.CUMULATIVE?[...e,{label:"Delta",value:P.mG.Delta,description:"Data points are aligned by their delta (difference) per time series"}]:e},[t,a])}},"./public/app/plugins/datasource/cloud-monitoring/constants.ts":(e,t,a)=>{"use strict";a.d(t,{$e:()=>m,Eu:()=>c,IR:()=>h,Lh:()=>s,Ry:()=>p,XC:()=>o,XI:()=>g,d7:()=>r,dD:()=>d,lx:()=>u,qN:()=>i});var l=a("./.yarn/cache/@grafana-google-sdk-npm-0.0.3-c91663433f-9eb5e043e0.zip/node_modules/@grafana/google-sdk/index.js"),n=a("./public/app/plugins/datasource/cloud-monitoring/types.ts");const r=71,o=19,i=14,s=28,c=(l.GoogleAuthType.JWT,l.GoogleAuthType.GCE,[{text:"delta",value:"ALIGN_DELTA",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY,n.$h.DISTRIBUTION],metricKinds:[n.lH.CUMULATIVE,n.lH.DELTA]},{text:"rate",value:"ALIGN_RATE",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY],metricKinds:[n.lH.CUMULATIVE,n.lH.DELTA]},{text:"interpolate",value:"ALIGN_INTERPOLATE",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY],metricKinds:[n.lH.GAUGE]},{text:"next older",value:"ALIGN_NEXT_OLDER",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY,n.$h.DISTRIBUTION,n.$h.STRING,n.$h.VALUE_TYPE_UNSPECIFIED,n.$h.BOOL],metricKinds:[n.lH.GAUGE]},{text:"min",value:"ALIGN_MIN",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY],metricKinds:[n.lH.GAUGE,n.lH.DELTA]},{text:"max",value:"ALIGN_MAX",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY],metricKinds:[n.lH.GAUGE,n.lH.DELTA]},{text:"mean",value:"ALIGN_MEAN",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY],metricKinds:[n.lH.GAUGE,n.lH.DELTA]},{text:"count",value:"ALIGN_COUNT",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY,n.$h.BOOL],metricKinds:[n.lH.GAUGE,n.lH.DELTA]},{text:"sum",value:"ALIGN_SUM",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY,n.$h.DISTRIBUTION],metricKinds:[n.lH.GAUGE,n.lH.DELTA]},{text:"stddev",value:"ALIGN_STDDEV",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY],metricKinds:[n.lH.GAUGE,n.lH.DELTA]},{text:"count true",value:"ALIGN_COUNT_TRUE",valueTypes:[n.$h.BOOL],metricKinds:[n.lH.GAUGE]},{text:"count false",value:"ALIGN_COUNT_FALSE",valueTypes:[n.$h.BOOL],metricKinds:[n.lH.GAUGE]},{text:"fraction true",value:"ALIGN_FRACTION_TRUE",valueTypes:[n.$h.BOOL],metricKinds:[n.lH.GAUGE]},{text:"percentile 99",value:"ALIGN_PERCENTILE_99",valueTypes:[n.$h.DISTRIBUTION],metricKinds:[n.lH.GAUGE,n.lH.DELTA]},{text:"percentile 95",value:"ALIGN_PERCENTILE_95",valueTypes:[n.$h.DISTRIBUTION],metricKinds:[n.lH.GAUGE,n.lH.DELTA]},{text:"percentile 50",value:"ALIGN_PERCENTILE_50",valueTypes:[n.$h.DISTRIBUTION],metricKinds:[n.lH.GAUGE,n.lH.DELTA]},{text:"percentile 05",value:"ALIGN_PERCENTILE_05",valueTypes:[n.$h.DISTRIBUTION],metricKinds:[n.lH.GAUGE,n.lH.DELTA]},{text:"percent change",value:"ALIGN_PERCENT_CHANGE",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY],metricKinds:[n.lH.GAUGE,n.lH.DELTA]}]),u=[{text:"none",value:"REDUCE_NONE",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY,n.$h.DISTRIBUTION,n.$h.BOOL,n.$h.STRING],metricKinds:[n.lH.GAUGE,n.lH.DELTA,n.lH.CUMULATIVE,n.lH.METRIC_KIND_UNSPECIFIED]},{text:"mean",value:"REDUCE_MEAN",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY,n.$h.DISTRIBUTION],metricKinds:[n.lH.GAUGE,n.lH.DELTA,n.lH.CUMULATIVE]},{text:"min",value:"REDUCE_MIN",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY],metricKinds:[n.lH.GAUGE,n.lH.DELTA,n.lH.CUMULATIVE,n.lH.METRIC_KIND_UNSPECIFIED]},{text:"max",value:"REDUCE_MAX",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY],metricKinds:[n.lH.GAUGE,n.lH.DELTA,n.lH.CUMULATIVE,n.lH.METRIC_KIND_UNSPECIFIED]},{text:"sum",value:"REDUCE_SUM",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY,n.$h.DISTRIBUTION],metricKinds:[n.lH.GAUGE,n.lH.DELTA,n.lH.CUMULATIVE,n.lH.METRIC_KIND_UNSPECIFIED]},{text:"std. dev.",value:"REDUCE_STDDEV",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY,n.$h.DISTRIBUTION],metricKinds:[n.lH.GAUGE,n.lH.DELTA,n.lH.CUMULATIVE,n.lH.METRIC_KIND_UNSPECIFIED]},{text:"count",value:"REDUCE_COUNT",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY,n.$h.DISTRIBUTION,n.$h.BOOL,n.$h.STRING],metricKinds:[n.lH.GAUGE,n.lH.DELTA,n.lH.CUMULATIVE]},{text:"count true",value:"REDUCE_COUNT_TRUE",valueTypes:[n.$h.BOOL],metricKinds:[n.lH.GAUGE,n.lH.DELTA]},{text:"count false",value:"REDUCE_COUNT_FALSE",valueTypes:[n.$h.BOOL],metricKinds:[n.lH.GAUGE,n.lH.DELTA]},{text:"99th percentile",value:"REDUCE_PERCENTILE_99",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY,n.$h.DISTRIBUTION],metricKinds:[n.lH.GAUGE,n.lH.DELTA,n.lH.CUMULATIVE]},{text:"95th percentile",value:"REDUCE_PERCENTILE_95",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY,n.$h.DISTRIBUTION],metricKinds:[n.lH.GAUGE,n.lH.DELTA,n.lH.CUMULATIVE]},{text:"50th percentile",value:"REDUCE_PERCENTILE_50",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY,n.$h.DISTRIBUTION],metricKinds:[n.lH.GAUGE,n.lH.DELTA,n.lH.CUMULATIVE]},{text:"5th percentile",value:"REDUCE_PERCENTILE_05",valueTypes:[n.$h.INT64,n.$h.DOUBLE,n.$h.MONEY,n.$h.DISTRIBUTION],metricKinds:[n.lH.GAUGE,n.lH.DELTA,n.lH.CUMULATIVE]}],d=[{text:"grafana auto",value:"grafana-auto"},{text:"stackdriver auto",value:"stackdriver-auto",hidden:!0},{text:"cloud monitoring auto",value:"cloud-monitoring-auto"},{text:"1m",value:"+60s"},{text:"2m",value:"+120s"},{text:"5m",value:"+300s"},{text:"10m",value:"+600s"},{text:"30m",value:"+1800s"},{text:"1h",value:"+3600s"},{text:"3h",value:"+7200s"},{text:"6h",value:"+21600s"},{text:"1d",value:"+86400s"},{text:"3d",value:"+259200s"},{text:"1w",value:"+604800s"}],p=[{text:"auto",value:"auto"},{text:"1m",value:"1m"},{text:"2m",value:"2m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"30m",value:"30m"},{text:"1h",value:"1h"},{text:"3h",value:"3h"},{text:"6h",value:"6h"},{text:"1d",value:"1d"},{text:"3d",value:"3d"},{text:"1w",value:"1w"}],m=["metadata.system_labels.cloud_account","metadata.system_labels.name","metadata.system_labels.region","metadata.system_labels.state","metadata.system_labels.instance_group","metadata.system_labels.node_name","metadata.system_labels.service_name","metadata.system_labels.top_level_controller_type","metadata.system_labels.top_level_controller_name","metadata.system_labels.container_image"],h=[{label:"SLI Value",value:"select_slo_health"},{label:"SLO Compliance",value:"select_slo_compliance"},{label:"SLO Error Budget Remaining",value:"select_slo_budget_fraction"}],g=[{label:"Metrics",value:n.xL.METRICS},{label:"Service Level Objectives (SLO)",value:n.xL.SLO}]},"./public/app/plugins/datasource/cloud-monitoring/functions.ts":(e,t,a)=>{"use strict";a.d(t,{A_:()=>p,FL:()=>u,ID:()=>h,Qd:()=>m,Qf:()=>c,gY:()=>g,mi:()=>v,oU:()=>d,qA:()=>s});var l=a("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),n=(a.n(l),a("./packages/grafana-runtime/src/index.ts")),r=a("./public/app/plugins/datasource/cloud-monitoring/constants.ts"),o=a("./public/app/plugins/datasource/cloud-monitoring/types.ts");const i=(0,n.getTemplateSrv)(),s=e=>(0,l.uniqBy)(e,"service"),c=(e,t)=>e.filter(e=>e.service===t),u=(e,t,a,l)=>{const n=c(e,l).map(e=>({value:e.type,name:e.displayName})),r=n.some(e=>e.value===a),o=n.length?n[0].value:"";return{metricTypes:n,selectedMetricType:r?t:o}},d=(e,t,a)=>(a&&a===o.mG.Rate&&(t=o.lH.GAUGE),e?r.Eu.filter(a=>-1!==a.valueTypes.indexOf(e)&&-1!==a.metricKinds.indexOf(t)):[]),p=(e,t)=>t?r.lx.filter(a=>-1!==a.valueTypes.indexOf(e)&&-1!==a.metricKinds.indexOf(t)):[],m=async(e,t,a)=>{const l=await e.getLabels(t,"handleLabelKeysQuery",a);return[...Object.keys(l),...r.$e]},h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.$h.DOUBLE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.lH.GAUGE,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.CS.ALIGN_MEAN,l=arguments.length>3?arguments[3]:void 0;const n=d(e,t,l).map(e=>Object.assign({},e,{label:e.text}));return n.some(e=>e.value===i.replace(a))||(a=n.length>0?n[0].value:o.CS.ALIGN_MEAN),{alignOptions:n,perSeriesAligner:a}},g=e=>{const t=e.reduce((e,t)=>{const a=t.split(".").map(l.startCase),n=(2===a.length?a:(0,l.initial)(a)).join(" "),r={value:t,label:t};return e[n]?e[n]=[...e[n],r]:e[n]=[r],e},{});return Object.entries(t).map(e=>{let[t,a]=e;return{label:t,options:a,expanded:!0}},[])},v=e=>(0,l.chunk)(e,4).map(e=>{let[t,a,l,n="AND"]=e;return{key:t,operator:a,value:l,condition:n}})},"./public/app/plugins/datasource/cloud-monitoring/types.ts":(e,t,a)=>{"use strict";a.d(t,{$h:()=>c,Bp:()=>n,CS:()=>u,je:()=>o,lH:()=>s,mG:()=>i,xL:()=>r});var l=a("./.yarn/cache/@grafana-google-sdk-npm-0.0.3-c91663433f-9eb5e043e0.zip/node_modules/@grafana/google-sdk/index.js");l.GoogleAuthType.JWT,l.GoogleAuthType.GCE;let n,r,o,i,s,c,u;!function(e){e.Projects="projects",e.Services="services",e.DefaultProject="defaultProject",e.MetricTypes="metricTypes",e.LabelKeys="labelKeys",e.LabelValues="labelValues",e.ResourceTypes="resourceTypes",e.Aggregations="aggregations",e.Aligners="aligners",e.AlignmentPeriods="alignmentPeriods",e.Selectors="selectors",e.SLOServices="sloServices",e.SLO="slo"}(n||(n={})),function(e){e.METRICS="metrics",e.SLO="slo"}(r||(r={})),function(e){e.Visual="visual",e.MQL="mql"}(o||(o={})),function(e){e.None="none",e.Rate="rate",e.Delta="delta"}(i||(i={})),function(e){e.METRIC_KIND_UNSPECIFIED="METRIC_KIND_UNSPECIFIED",e.GAUGE="GAUGE",e.DELTA="DELTA",e.CUMULATIVE="CUMULATIVE"}(s||(s={})),function(e){e.VALUE_TYPE_UNSPECIFIED="VALUE_TYPE_UNSPECIFIED",e.BOOL="BOOL",e.INT64="INT64",e.DOUBLE="DOUBLE",e.STRING="STRING",e.DISTRIBUTION="DISTRIBUTION",e.MONEY="MONEY"}(c||(c={})),function(e){e.ALIGN_DELTA="ALIGN_DELTA",e.ALIGN_RATE="ALIGN_RATE",e.ALIGN_INTERPOLATE="ALIGN_INTERPOLATE",e.ALIGN_NEXT_OLDER="ALIGN_NEXT_OLDER",e.ALIGN_MIN="ALIGN_MIN",e.ALIGN_MAX="ALIGN_MAX",e.ALIGN_MEAN="ALIGN_MEAN",e.ALIGN_COUNT="ALIGN_COUNT",e.ALIGN_SUM="ALIGN_SUM",e.ALIGN_STDDEV="ALIGN_STDDEV",e.ALIGN_COUNT_TRUE="ALIGN_COUNT_TRUE",e.ALIGN_COUNT_FALSE="ALIGN_COUNT_FALSE",e.ALIGN_FRACTION_TRUE="ALIGN_FRACTION_TRUE",e.ALIGN_PERCENTILE_99="ALIGN_PERCENTILE_99",e.ALIGN_PERCENTILE_95="ALIGN_PERCENTILE_95",e.ALIGN_PERCENTILE_50="ALIGN_PERCENTILE_50",e.ALIGN_PERCENTILE_05="ALIGN_PERCENTILE_05",e.ALIGN_PERCENT_CHANGE="ALIGN_PERCENT_CHANGE"}(u||(u={}))},"./.yarn/cache/@grafana-google-sdk-npm-0.0.3-c91663433f-9eb5e043e0.zip/node_modules/@grafana/google-sdk/dist/index.production.js":(e,t,a)=>{var l=a("./packages/grafana-data/src/index.ts"),n=a("./packages/grafana-ui/src/index.ts"),r=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),o=a("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js");var i=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(r),s=function(){return(s=Object.assign||function(e){for(var t,a=1,l=arguments.length;a<l;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function c(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var l,n,r=a.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(l=r.next()).done;)o.push(l.value)}catch(e){n={error:e}}finally{try{l&&!l.done&&(a=r.return)&&a.call(r)}finally{if(n)throw n.error}}return o}var u,d=["private_key","token_uri","client_email","project_id"],p=function(e){var t=e.onChange,a=c(r.useState(),2),l=a[0],o=a[1],s=c(r.useState(null),2),u=s[0],d=s[1],p=n.useTheme2(),h=r.useCallback(function(e){o(null),d(!0)},[d]),g=r.useCallback(function(e){d(null),o(null)},[d]),v=r.useCallback(function(e){if(""!==e.trim()){var a=void 0;try{a=JSON.parse(e)}catch(e){o("Invalid JWT token")}var l=m(a);l.isValid?t({privateKey:a.private_key,tokenUri:a.token_uri,clientEmail:a.client_email,projectId:a.project_id}):o(l.error)}},[o,t]);return i.default.createElement(i.default.Fragment,null,i.default.createElement(n.Field,{label:"JWT token",invalid:Boolean(l),description:u?"Paste JWT token below":"Upload or paste Google JWT token",error:l},i.default.createElement(i.default.Fragment,null,!0!==u&&i.default.createElement("div",{"data-testid":"Configuration drop zone"},i.default.createElement(n.FileDropzone,{options:{multiple:!1,accept:"application/json"},readAs:"readAsText",onLoad:function(e){v(e),d(!1)}},i.default.createElement("p",{style:{margin:0,fontSize:""+p.typography.h4.fontSize,textAlign:"center"}},"Drop the Google JWT file here",i.default.createElement("br",null),i.default.createElement("br",null),i.default.createElement(n.LinkButton,{fill:"outline"},"Click to browse files")))),u&&i.default.createElement(n.TextArea,{"data-testid":"Configuration text area",autoFocus:!0,invalid:Boolean(l),placeholder:"Paste Google JWT token here",onBlur:function(e){return v(e.currentTarget.value)},rows:12}))),!u&&i.default.createElement(n.Field,null,i.default.createElement(n.Button,{"data-testid":"Paste JWT button",type:"button",fill:"outline",style:{color:""+p.colors.primary.text},onClick:h},"Paste JWT Token")),u&&l&&i.default.createElement(n.Field,null,i.default.createElement(n.Button,{type:"button",fill:"outline",style:{color:""+p.colors.primary.text},onClick:g},"Upload JWT Token")))},m=function(e){if(!o.isObject(e))return{isValid:!1,error:"Invalid JWT token"};var t=d.filter(function(t){return!e[t]});return t.length>0?{isValid:!1,error:"Missing keys: "+t.join(", ")}:{isValid:!0}},h=function(e){var t=e.options,a=e.onReset,l=e.onChange;return i.default.createElement("div",{"data-testid":"JWT form"},i.default.createElement(n.Field,{label:"Project ID"},i.default.createElement(n.Input,{id:"defaultProject",width:60,value:t.defaultProject||"",onChange:l("defaultProject")})),i.default.createElement(n.Field,{label:"Client email"},i.default.createElement(n.Input,{width:60,id:"clientEmail",value:t.clientEmail||"",onChange:l("clientEmail")})),i.default.createElement(n.Field,{label:"Token URI"},i.default.createElement(n.Input,{width:60,id:"tokenUri",value:t.tokenUri||"",onChange:l("tokenUri")})),i.default.createElement(n.Field,{label:"Private key",disabled:!0},i.default.createElement(n.Input,{width:60,id:"privateKey",readOnly:!0,placeholder:"Private key configured",addonAfter:i.default.createElement(n.Tooltip,{content:"Click to clear the uploaded JWT token and upload a new one"},i.default.createElement(n.Button,{"data-testid":"Reset JWT button",icon:"sync",size:"xs",onClick:function(){return a(null)},fill:"outline"},"Reset token"))})))};t.GoogleAuthType=void 0,(u=t.GoogleAuthType||(t.GoogleAuthType={})).JWT="jwt",u.GCE="gce";var g=[{label:"Google JWT File",value:t.GoogleAuthType.JWT,ariaLabel:"JWT button"},{label:"GCE Default Service Account",value:t.GoogleAuthType.GCE,ariaLabel:"GCE button"}];t.ConnectionConfig=function(e){var a=e.options,r=e.onOptionsChange,o=a.jsonData,c=a.secureJsonFields,u=a.secureJsonData;o.authenticationType||(o.authenticationType=t.GoogleAuthType.JWT);var d=o.authenticationType===t.GoogleAuthType.JWT||void 0===o.authenticationType,m=Boolean(c&&c.privateKey&&o.clientEmail&&o.defaultProject&&o.tokenUri);return i.default.createElement(i.default.Fragment,null,i.default.createElement(n.FieldSet,{label:"Authentication"},i.default.createElement(n.Field,{label:"Authentication type"},i.default.createElement(n.RadioButtonGroup,{options:g,value:o.authenticationType||t.GoogleAuthType.JWT,onChange:function(e){r(s(s({},a),{jsonData:s(s({},a.jsonData),{authenticationType:e})}))}}))),d&&i.default.createElement(n.FieldSet,{label:"JWT Key Details"},m?i.default.createElement(h,{options:a.jsonData,onReset:function(e){var t=s({},u),l=e?s(s({},a.jsonData),e):s({},a.jsonData);delete l.clientEmail,delete l.defaultProject,delete l.tokenUri,delete t.privateKey,r(s(s({},a),{secureJsonData:t,jsonData:l}))},onChange:function(t){return l.onUpdateDatasourceJsonDataOption(e,t)}}):i.default.createElement(p,{onChange:function(e){r(s(s({},a),{secureJsonFields:s(s({},c),{privateKey:!0}),secureJsonData:s(s({},u),{privateKey:e.privateKey}),jsonData:s(s({},o),{clientEmail:e.clientEmail,defaultProject:e.projectId,tokenUri:e.tokenUri})}))}})," "),i.default.createElement("div",{className:"grafana-info-box",style:{marginTop:"16px"},"data-testid":"Configuration help box"},i.default.createElement("p",null,"Don’t know how to get a service account key file or create a service account? Read more"," ",i.default.createElement("a",{className:"external-link",target:"_blank",rel:"noopener noreferrer",href:"https://grafana.com/docs/grafana/latest/datasources/google-cloud-monitoring/google-authentication/"},"in the documentation."))),!d&&i.default.createElement(n.Alert,{title:"",severity:"info"},"Verify GCE default service account by clicking Save & Test"))}},"./.yarn/cache/@grafana-google-sdk-npm-0.0.3-c91663433f-9eb5e043e0.zip/node_modules/@grafana/google-sdk/index.js":(e,t,a)=>{"use strict";e.exports=a("./.yarn/cache/@grafana-google-sdk-npm-0.0.3-c91663433f-9eb5e043e0.zip/node_modules/@grafana/google-sdk/dist/index.production.js")}}]);