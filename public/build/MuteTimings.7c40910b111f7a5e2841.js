"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9355],{"./public/app/features/alerting/unified/MuteTimings.tsx":(e,t,i)=>{i.r(t),i.d(t,{default:()=>L});var a=i("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),n=i("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),s=i("./.yarn/__virtual__/react-router-virtual-31642fe47a/0/cache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js"),r=i("./packages/grafana-ui/src/index.ts"),l=i("./public/app/core/hooks/useQueryParams.ts"),o=i("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),d=i("./.yarn/__virtual__/react-hook-form-virtual-92b6119fd4/0/cache/react-hook-form-npm-7.5.3-f9cc466c62-fbfaa3b664.zip/node_modules/react-hook-form/dist/index.esm.js"),u=i("./public/app/features/alerting/unified/hooks/useAlertManagerSourceName.ts"),m=i("./public/app/features/alerting/unified/hooks/useAlertManagerSources.ts"),c=i("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts"),v=i("./public/app/features/alerting/unified/state/actions.ts"),p=i("./public/app/features/alerting/unified/utils/alertmanager.ts"),g=i("./public/app/features/alerting/unified/utils/misc.ts"),f=i("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js");const h=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],_=["january","february","march","april","may","june","july","august","september","october","november","december"],b={times:[{start_time:"",end_time:""}],weekdays:"",days_of_month:"",months:"",years:""},y=(e,t,i)=>!e||(e.split(",").map(e=>e.trim()).every(e=>e.split(":").every(t))||i),x=e=>e?e.split(",").map(e=>e.trim()):void 0;var j=i("./public/app/features/alerting/unified/utils/redux.ts"),k=i("./public/app/features/alerting/unified/components/AlertManagerPicker.tsx"),I=i("./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx"),w=i("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const C=e=>{var t,i,a;let{intervalIndex:n}=e;const s=(0,r.useStyles2)(S),{register:l,formState:o}=(0,d.Gc)(),{fields:u,append:m,remove:c}=(0,d.Dq)({name:`time_intervals.${n}.times`}),v=e=>{if(!e)return!0;const[t,i]=e.split(":").map(e=>parseInt(e,10));return(24===t?0===i:t>=0&&t<25&&(i>-1&&i<60))||"Time is invalid"},p=null===(t=o.errors.time_intervals)||void 0===t?void 0:t[n],g=null!==(i=null===p||void 0===p?void 0:null===(a=p.times)||void 0===a?void 0:a.some(e=>(null===e||void 0===e?void 0:e.start_time)||(null===e||void 0===e?void 0:e.end_time)))&&void 0!==i&&i;return(0,w.jsxs)("div",{children:[(0,w.jsx)(r.Field,{className:s.field,label:"Time range",description:"The time inclusive of the starting time and exclusive of the end time in UTC",invalid:g,error:g?"Times must be between 00:00 and 24:00 UTC":"",children:(0,w.jsx)(w.Fragment,{children:u.map((e,t)=>{var i,a,o,d;return(0,w.jsx)("div",{className:s.timeRange,children:(0,w.jsxs)(r.InlineFieldRow,{children:[(0,w.jsx)(r.InlineField,{label:"Start time",invalid:!(null===p||void 0===p||null===(i=p.times)||void 0===i||null===(a=i[t])||void 0===a||!a.start_time),children:(0,w.jsx)(r.Input,Object.assign({},l(`time_intervals.${n}.times.${t}.start_time`,{validate:v}),{className:s.timeRangeInput,defaultValue:e.start_time,placeholder:"HH:MM","data-testid":"mute-timing-starts-at"}))}),(0,w.jsx)(r.InlineField,{label:"End time",invalid:!(null===p||void 0===p||null===(o=p.times)||void 0===o||null===(d=o[t])||void 0===d||!d.end_time),children:(0,w.jsx)(r.Input,Object.assign({},l(`time_intervals.${n}.times.${t}.end_time`,{validate:v}),{className:s.timeRangeInput,defaultValue:e.end_time,placeholder:"HH:MM","data-testid":"mute-timing-ends-at"}))}),(0,w.jsx)(r.IconButton,{className:s.deleteTimeRange,title:"Remove",name:"trash-alt",type:"button",onClick:e=>{e.preventDefault(),c(t)}})]})},e.id)})})}),(0,w.jsx)(r.Button,{className:s.addTimeRange,variant:"secondary",type:"button",icon:"plus",onClick:()=>m({start_time:"",end_time:""}),children:"Add another time range"})]})},S=e=>({field:o.css`
    margin-bottom: 0;
  `,timeRange:o.css`
    margin-bottom: ${e.spacing(1)};
  `,timeRangeInput:o.css`
    width: 120px;
  `,deleteTimeRange:o.css`
    margin: ${e.spacing(1)} 0 0 ${e.spacing(.5)};
  `,addTimeRange:o.css`
    margin-bottom: ${e.spacing(2)};
  `});var N;const M=()=>{const e=(0,r.useStyles2)($),{formState:t,register:i}=(0,d.Gc)(),{fields:a,append:n,remove:s}=(0,d.Dq)({name:"time_intervals"});return(0,w.jsx)(r.FieldSet,{className:e.timeIntervalLegend,label:"Time intervals",children:(0,w.jsxs)(w.Fragment,{children:[N||(N=(0,w.jsx)("p",{children:"A time interval is a definition for a moment in time. All fields are lists, and at least one list element must be satisfied to match the field. If a field is left blank, any moment of time will match the field. For an instant of time to match a complete time interval, all fields must match. A mute timing can contain multiple time intervals."})),a.map((a,n)=>{var l,o,d,u,m,c,v,p,g,f,b,x,j,k,I,S,N,M,$,A,T,F;const z=t.errors;return(0,w.jsxs)("div",{className:e.timeIntervalSection,children:[(0,w.jsx)(C,{intervalIndex:n}),(0,w.jsx)(r.Field,{label:"Days of the week",error:null!==(l=null===(o=z.time_intervals)||void 0===o?void 0:null===(d=o[n])||void 0===d?void 0:null===(u=d.weekdays)||void 0===u?void 0:u.message)&&void 0!==l?l:"",invalid:!(null===(m=z.time_intervals)||void 0===m||null===(c=m[n])||void 0===c||!c.weekdays),children:(0,w.jsx)(r.Input,Object.assign({},i(`time_intervals.${n}.weekdays`,{validate:e=>y(e,e=>h.includes(e.toLowerCase()),"Invalid day of the week")}),{className:e.input,"data-testid":"mute-timing-weekdays",defaultValue:a.weekdays,placeholder:"Example: monday, tuesday:thursday"}))}),(0,w.jsx)(r.Field,{label:"Days of the month",description:"The days of the month, 1-31, of a month. Negative values can be used to represent days which begin at the end of the month",invalid:!(null===(v=z.time_intervals)||void 0===v||null===(p=v[n])||void 0===p||!p.days_of_month),error:null===(g=z.time_intervals)||void 0===g?void 0:null===(f=g[n])||void 0===f?void 0:null===(b=f.days_of_month)||void 0===b?void 0:b.message,children:(0,w.jsx)(r.Input,Object.assign({},i(`time_intervals.${n}.days_of_month`,{validate:e=>y(e,e=>{const t=parseInt(e,10);return t>-31&&t<0||t>0&&t<32},"Invalid day")}),{className:e.input,defaultValue:a.days_of_month,placeholder:"Example: 1, 14:16, -1","data-testid":"mute-timing-days"}))}),(0,w.jsx)(r.Field,{label:"Months",description:"The months of the year in either numerical or the full calendar month",invalid:!(null===(x=z.time_intervals)||void 0===x||null===(j=x[n])||void 0===j||!j.months),error:null===(k=z.time_intervals)||void 0===k?void 0:null===(I=k[n])||void 0===I?void 0:null===(S=I.months)||void 0===S?void 0:S.message,children:(0,w.jsx)(r.Input,Object.assign({},i(`time_intervals.${n}.months`,{validate:e=>y(e,e=>_.includes(e)||parseInt(e,10)<13&&parseInt(e,10)>0,"Invalid month")}),{className:e.input,placeholder:"Example: 1:3, may:august, december",defaultValue:a.months,"data-testid":"mute-timing-months"}))}),(0,w.jsx)(r.Field,{label:"Years",invalid:!(null===(N=z.time_intervals)||void 0===N||null===(M=N[n])||void 0===M||!M.years),error:null!==($=null===(A=z.time_intervals)||void 0===A?void 0:null===(T=A[n])||void 0===T?void 0:null===(F=T.years)||void 0===F?void 0:F.message)&&void 0!==$?$:"",children:(0,w.jsx)(r.Input,Object.assign({},i(`time_intervals.${n}.years`,{validate:e=>y(e,e=>/^\d{4}$/.test(e),"Invalid year")}),{className:e.input,placeholder:"Example: 2021:2022, 2030",defaultValue:a.years,"data-testid":"mute-timing-years"}))}),(0,w.jsx)(r.Button,{type:"button",variant:"destructive",icon:"trash-alt",onClick:()=>s(n),children:"Remove time interval"})]},a.id)}),(0,w.jsx)(r.Button,{type:"button",variant:"secondary",className:e.removeTimeIntervalButton,onClick:()=>{n(b)},icon:"plus",children:"Add another time interval"})]})})},$=e=>({input:o.css`
    width: 400px;
  `,timeIntervalLegend:o.css`
    legend {
      font-size: 1.25rem;
    }
  `,timeIntervalSection:o.css`
    background-color: ${e.colors.background.secondary};
    padding: ${e.spacing(1)};
    margin-bottom: ${e.spacing(1)};
  `,removeTimeIntervalButton:o.css`
    margin-top: ${e.spacing(1)};
  `});var A,T;const F=e=>({input:o.css`
    width: 400px;
  `,submitButton:o.css`
    margin-left: ${e.spacing(1)};
  `}),z=e=>{var t,i,s;let{muteTiming:l,showError:o}=e;const h=(0,n.useDispatch)(),_=(0,m.k)("notification"),[y,C]=(0,u.k)(_),S=(0,r.useStyles2)(F),N={alertmanager_config:{},template_files:{}},$=(0,c._)(e=>e.amConfigs),{result:z=N,loading:R}=y&&$[y]||j.oq,B=null!==(t=null===z||void 0===z?void 0:z.alertmanager_config)&&void 0!==t?t:{},E=(e=>(0,a.useMemo)(()=>{if(!e)return{name:"",time_intervals:[b]};const t=e.time_intervals.map(e=>{var t,i,a,n,s,r,l,o,d;return{times:null!==(t=e.times)&&void 0!==t?t:b.times,weekdays:null!==(i=null===e||void 0===e?void 0:null===(a=e.weekdays)||void 0===a?void 0:a.join(", "))&&void 0!==i?i:b.weekdays,days_of_month:null!==(n=null===e||void 0===e?void 0:null===(s=e.days_of_month)||void 0===s?void 0:s.join(", "))&&void 0!==n?n:b.days_of_month,months:null!==(r=null===e||void 0===e?void 0:null===(l=e.months)||void 0===l?void 0:l.join(", "))&&void 0!==r?r:b.months,years:null!==(o=null===e||void 0===e?void 0:null===(d=e.years)||void 0===d?void 0:d.join(", "))&&void 0!==o?o:b.years}});return{name:e.name,time_intervals:t}},[e]))(l),L=(0,d.cI)({defaultValues:E});return(0,w.jsxs)(I.J,{pageId:"am-routes",children:[(0,w.jsx)(k.P,{current:y,onChange:C,disabled:!0,dataSources:_}),z&&!R&&(0,w.jsx)(d.RV,Object.assign({},L,{children:(0,w.jsxs)("form",{onSubmit:L.handleSubmit(e=>{var t,i;const a=(e=>{const t=e.time_intervals.map(e=>{var t;let{times:i,weekdays:a,days_of_month:n,months:s,years:r}=e;const l={times:i.filter(e=>{let{start_time:t,end_time:i}=e;return!!t&&!!i}),weekdays:null===(t=x(a))||void 0===t?void 0:t.map(e=>e.toLowerCase()),days_of_month:x(n),months:x(s),years:x(r)};return(0,f.omitBy)(l,f.isUndefined)});return{name:e.name,time_intervals:t}})(e),n=l?null===B||void 0===B?void 0:null===(t=B.mute_time_intervals)||void 0===t?void 0:t.filter(e=>{let{name:t}=e;return t!==l.name}):B.mute_time_intervals,s=Object.assign({},z,{alertmanager_config:Object.assign({},B,{route:l&&a.name!==l.name?(0,p.FM)(a.name,l.name,null!==(i=B.route)&&void 0!==i?i:{}):B.route,mute_time_intervals:[...n||[],a]})});h((0,v.mM)({newConfig:s,oldConfig:z,alertManagerSourceName:y,successMessage:"Mute timing saved",redirectPath:"/alerting/routes/"}))}),"data-testid":"mute-timing-form",children:[o&&(A||(A=(0,w.jsx)(r.Alert,{title:"No matching mute timing found"}))),(0,w.jsxs)(r.FieldSet,{label:"Create mute timing",children:[(0,w.jsx)(r.Field,{required:!0,label:"Name",description:"A unique name for the mute timing",invalid:!(null===(i=L.formState.errors)||void 0===i||!i.name),error:null===(s=L.formState.errors.name)||void 0===s?void 0:s.message,children:(0,w.jsx)(r.Input,Object.assign({},L.register("name",{required:!0,validate:e=>{var t;return l?e.length>0||"Name is required":!(null===B||void 0===B?void 0:null===(t=B.mute_time_intervals)||void 0===t?void 0:t.find(t=>{let{name:i}=t;return e===i}))||`Mute timing already exists for "${e}"`}}),{className:S.input,"data-testid":"mute-timing-name"}))}),T||(T=(0,w.jsx)(M,{})),(0,w.jsx)(r.LinkButton,{type:"button",variant:"secondary",href:(0,g.eQ)("/alerting/routes/",y),children:"Cancel"}),(0,w.jsx)(r.Button,{type:"submit",className:S.submitButton,children:l?"Save":"Submit"})]})]})}))]})};var R,B,E;const L=()=>{const[e]=(0,l.K)(),t=(0,n.useDispatch)(),i=(0,m.k)("notification"),[o]=(0,u.k)(i),d=(0,c._)(e=>e.amConfigs),p=(0,a.useCallback)(()=>{o&&t((0,v.Yh)(o))},[o,t]);(0,a.useEffect)(()=>{p()},[p]);const{result:g,error:f,loading:h}=o&&d[o]||j.oq,_=null===g||void 0===g?void 0:g.alertmanager_config,b=(0,a.useCallback)(e=>{var t;return null===_||void 0===_?void 0:null===(t=_.mute_time_intervals)||void 0===t?void 0:t.find(t=>{let{name:i}=t;return i===e})},[_]);return(0,w.jsxs)(w.Fragment,{children:[h&&(R||(R=(0,w.jsx)(r.LoadingPlaceholder,{text:"Loading mute timing"}))),f&&!h&&(0,w.jsx)(r.Alert,{severity:"error",title:`Error loading Alertmanager config for ${o}`,children:f.message||"Unknown error."}),g&&!f&&(0,w.jsxs)(s.rs,{children:[B||(B=(0,w.jsx)(s.AW,{exact:!0,path:"/alerting/routes/mute-timing/new",children:(0,w.jsx)(z,{})})),(0,w.jsx)(s.AW,{exact:!0,path:"/alerting/routes/mute-timing/edit",children:()=>{if(e.muteName){const t=b(String(e.muteName));return(0,w.jsx)(z,{muteTiming:t,showError:!t})}return E||(E=(0,w.jsx)(s.l_,{to:"/alerting/routes"}))}})]})]})}},"./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx":(e,t,i)=>{i.d(t,{J:()=>l});i("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var a=i("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),n=i("./public/app/core/components/Page/Page.tsx"),s=i("./public/app/core/selectors/navModel.ts"),r=i("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const l=e=>{let{children:t,pageId:i,isLoading:l}=e;const o=(0,s.h)((0,a.useSelector)(e=>e.navIndex),i);return(0,r.jsx)(n.Z,{navModel:o,children:(0,r.jsx)(n.Z.Contents,{isLoading:l,children:t})})}},"./public/app/features/alerting/unified/hooks/useAlertManagerSourceName.ts":(e,t,i)=>{i.d(t,{k:()=>(function(e){const[t,i]=(0,n.K)(),o=function(e){return(0,a.useCallback)(t=>{const i=e.map(e=>e.name);return i.includes(t)},[e])}(e),d=(0,a.useCallback)(e=>{o(e)&&(e===l.GC?(s.Z.delete(r.de),i({[r.c4]:null})):(s.Z.set(r.de,e),i({[r.c4]:e})))},[i,o]),u=t[r.c4];if(u&&"string"==typeof u)return o(u)?[u,d]:[void 0,d];const m=s.Z.get(r.de);if(m&&"string"==typeof m&&o(m))return d(m),[m,d];if(o(l.GC))return[l.GC,d];return[void 0,d]})});var a=i("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),n=i("./public/app/core/hooks/useQueryParams.ts"),s=i("./public/app/core/store.ts"),r=i("./public/app/features/alerting/unified/utils/constants.ts"),l=i("./public/app/features/alerting/unified/utils/datasource.ts")},"./public/app/features/alerting/unified/hooks/useAlertManagerSources.ts":(e,t,i)=>{i.d(t,{k:()=>(function(e){return(0,a.useMemo)(()=>(0,n.LE)(e),[e])})});var a=i("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),n=i("./public/app/features/alerting/unified/utils/datasource.ts")}}]);